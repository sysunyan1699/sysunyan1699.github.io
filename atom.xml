<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Sun Yan</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2024-06-16T14:23:22.633Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>Sun Yan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Understanding LSTM Networks</title>
    <link href="http://example.com/4579c6a3/"/>
    <id>http://example.com/4579c6a3/</id>
    <published>2024-06-16T10:07:01.000Z</published>
    <updated>2024-06-16T14:23:22.633Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://colah.github.io/posts/2015-08-Understanding-LSTMs/">Understanding LSTM Networks</a></p><h1 id="recurrent-neural-networks"><a href="#Recurrent-Neural-Networks" class="headerlink" title="Recurrent Neural Networks"></a>Recurrent Neural Networks</h1><p>é€’å½’ç¥ç»ç½‘ç»œ<br>Humans donâ€™t start their thinking from scratch every second. As you read this essay, you understand each word based on your understanding of previous words. You donâ€™t throw everything away and start thinking from scratch again. Your thoughts have persistence.<br>äººç±»ä¸ä¼šæ¯ç§’éƒ½ä»å¤´å¼€å§‹æ€è€ƒã€‚å½“ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« æ—¶ï¼Œä½ ä¼šåŸºäºå¯¹ä¹‹å‰è¯è¯­çš„ç†è§£æ¥ç†è§£æ¯ä¸ªè¯ã€‚ä½ ä¸ä¼šæŠŠæ‰€æœ‰ä¸œè¥¿éƒ½ä¸¢æ‰ç„¶åé‡æ–°å¼€å§‹æ€è€ƒã€‚ä½ çš„æ€ç»´æ˜¯æœ‰è¿ç»­æ€§çš„ã€‚</p><p>Traditional neural networks canâ€™t do this, and it seems like a major shortcoming. For example, imagine you want to classify what kind of event is happening at every point in a movie. Itâ€™s unclear how a traditional neural network could use its reasoning about previous events in the film to inform later ones.<br>ä¼ ç»Ÿçš„ç¥ç»ç½‘ç»œåšä¸åˆ°è¿™ä¸€ç‚¹ï¼Œè¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªä¸»è¦çš„ç¼ºé™·ã€‚æ¯”å¦‚ï¼Œæƒ³è±¡ä¸€ä¸‹ä½ æƒ³å¯¹ç”µå½±ä¸­æ¯ä¸ªæ—¶åˆ»å‘ç”Ÿçš„äº‹ä»¶ç±»å‹è¿›è¡Œåˆ†ç±»ã€‚ç›®å‰å°šä¸æ¸…æ¥šä¼ ç»Ÿçš„ç¥ç»ç½‘ç»œå¦‚ä½•åˆ©ç”¨å…¶å¯¹ç”µå½±ä¸­å…ˆå‰äº‹ä»¶çš„æ¨ç†æ¥ä¸ºåæ¥çš„äº‹ä»¶æä¾›ä¿¡æ¯ã€‚</p><p>Recurrent neural networks address this issue. They are networks with loops in them, allowing information to persist.<br>å¾ªç¯ç¥ç»ç½‘ç»œè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å®ƒä»¬æ˜¯å†…éƒ¨å¸¦æœ‰å¾ªç¯çš„ç½‘ç»œï¼Œå…è®¸ä¿¡æ¯æŒç»­å­˜åœ¨ã€‚</p><img src="/4579c6a3/1.png" class><p><strong>Recurrent Neural Networks have loops.  é€’å½’ç¥ç»ç½‘ç»œæœ‰å¾ªç¯ã€‚</strong></p><p>In the above diagram, a chunk of neural network, ğ´, looks at some input $ğ‘¥_ğ‘¡$ and outputs a value $â„_ğ‘¡$. A loop allows information to be passed from one step of the network to the next.<br>åœ¨ä¸Šå›¾ä¸­ï¼Œç¥ç»ç½‘ç»œçš„ä¸€éƒ¨åˆ† $A$ ,æŸ¥çœ‹ä¸€äº›è¾“å…¥$x_tâ€‹$ å¹¶è¾“å‡ºä¸€ä¸ªå€¼ $h_t$ã€‚ä¸€ä¸ªå¾ªç¯å…è®¸ä¿¡æ¯ä»ç½‘ç»œçš„ä¸€ä¸ªæ­¥éª¤ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªæ­¥éª¤ã€‚</p><p>These loops make recurrent neural networks seem kind of mysterious. However, if you think a bit more, it turns out that they arenâ€™t all that different than a normal neural network. A recurrent neural network can be thought of as multiple copies of the same network, each passing a message to a successor. Consider what happens if we unroll the loop:<br>è¿™äº›å¾ªç¯ä½¿å¾ªç¯ç¥ç»ç½‘ç»œçœ‹èµ·æ¥æœ‰ç‚¹ç¥ç§˜ã€‚ç„¶è€Œï¼Œå¦‚æœä½ å¤šæƒ³ä¸€ç‚¹ï¼Œå°±ä¼šå‘ç°å®ƒä»¬ä¸æ™®é€šçš„ç¥ç»ç½‘ç»œå¹¶æ²¡æœ‰å¤ªå¤§çš„ä¸åŒã€‚é€’å½’ç¥ç»ç½‘ç»œå¯ä»¥è¢«è®¤ä¸ºæ˜¯åŒä¸€ç½‘ç»œçš„å¤šä¸ªå‰¯æœ¬ï¼Œæ¯ä¸ªå‰¯æœ¬å°†æ¶ˆæ¯ä¼ é€’ç»™ç»§ä»»è€…ã€‚è€ƒè™‘ä¸€ä¸‹å¦‚æœæˆ‘ä»¬å±•å¼€å¾ªç¯ä¼šå‘ç”Ÿä»€ä¹ˆï¼š<br><img src="/4579c6a3/2.png" class><br><strong>An unrolled recurrent neural network.  å±•å¼€çš„å¾ªç¯ç¥ç»ç½‘ç»œã€‚</strong></p><p>This chain-like nature reveals that recurrent neural networks are intimately related to sequences and lists. Theyâ€™re the natural architecture of neural network to use for such data.<br>è¿™ç§é“¾å¼ç»“æ„è¡¨æ˜ï¼Œé€’å½’ç¥ç»ç½‘ç»œä¸åºåˆ—å’Œåˆ—è¡¨å¯†åˆ‡ç›¸å…³ã€‚å®ƒä»¬æ˜¯å¤„ç†æ­¤ç±»æ•°æ®çš„è‡ªç„¶ç¥ç»ç½‘ç»œæ¶æ„ã€‚</p><p>And they certainly are used! In the last few years, there have been incredible success applying RNNs to a variety of problems: speech recognition, language modeling, translation, image captioningâ€¦ The list goes on. Iâ€™ll leave discussion of the amazing feats one can achieve with RNNs to Andrej Karpathyâ€™s excellent blog post, <a href="http://karpathy.github.io/2015/05/21/rnn-effectiveness/">The Unreasonable Effectiveness of Recurrent Neural Networks</a>. But they really are pretty amazing.<br>ä»–ä»¬å½“ç„¶è¢«ä½¿ç”¨äº†ï¼åœ¨è¿‡å»çš„å‡ å¹´é‡Œï¼Œå°†RNNåº”ç”¨äºå„ç§é—®é¢˜å–å¾—äº†ä»¤äººéš¾ä»¥ç½®ä¿¡çš„æˆåŠŸï¼šè¯­éŸ³è¯†åˆ«ã€è¯­è¨€å»ºæ¨¡ã€ç¿»è¯‘ã€å›¾åƒå­—å¹•â€¦â€¦è¿™æ ·çš„ä¾‹å­ä¸èƒœæšä¸¾ã€‚æˆ‘å°†æŠŠå…³äºRNNå¯ä»¥å®ç°çš„æƒŠäººå£®ä¸¾çš„è®¨è®ºç•™ç»™Andrej Karpathyçš„ä¼˜ç§€åšå®¢æ–‡ç« ï¼Œé€’å½’ç¥ç»ç½‘ç»œçš„ä¸åˆç†æœ‰æ•ˆæ€§ã€‚ä½†ä»–ä»¬çœŸçš„éå¸¸äº†ä¸èµ·ã€‚</p><p>Essential to these successes is the use of â€œLSTMs,â€ a very special kind of recurrent neural network which works, for many tasks, much much better than the standard version. Almost all exciting results based on recurrent neural networks are achieved with them. Itâ€™s these LSTMs that this essay will explore.<br>è¿™äº›æˆåŠŸçš„å…³é”®æ˜¯â€œLSTMâ€çš„ä½¿ç”¨ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸ç‰¹æ®Šçš„é€’å½’ç¥ç»ç½‘ç»œï¼Œå¯¹äºè®¸å¤šä»»åŠ¡ï¼Œå®ƒæ¯”æ ‡å‡†ç‰ˆæœ¬è¦å¥½å¾—å¤šã€‚å‡ ä¹æ‰€æœ‰åŸºäºé€’å½’ç¥ç»ç½‘ç»œçš„ä»¤äººå…´å¥‹çš„ç»“æœéƒ½æ˜¯é€šè¿‡å®ƒä»¬å®ç°çš„ã€‚æœ¬æ–‡å°†æ¢è®¨çš„æ­£æ˜¯è¿™äº› LSTMã€‚</p><h1 id="the-problem-of-long-term-dependencies"><a href="#The-Problem-of-Long-Term-Dependencies" class="headerlink" title="The Problem of Long-Term Dependencies"></a>The Problem of Long-Term Dependencies</h1><p>é•¿æœŸä¾èµ–æ€§é—®é¢˜</p><p>One of the appeals of RNNs is the idea that they might be able to connect previous information to the present task, such as using previous video frames might inform the understanding of the present frame. If RNNs could do this, theyâ€™d be extremely useful. But can they? It depends.<br>RNNçš„å¸å¼•åŠ›ä¹‹ä¸€æ˜¯ï¼Œå®ƒä»¬å¯èƒ½èƒ½å¤Ÿå°†å…ˆå‰çš„ä¿¡æ¯ä¸å½“å‰ä»»åŠ¡è”ç³»èµ·æ¥ï¼Œä¾‹å¦‚ä½¿ç”¨ä»¥å‰çš„è§†é¢‘å¸§å¯èƒ½ä¼šä¸ºç†è§£å½“å‰å¸§æä¾›ä¿¡æ¯ã€‚å¦‚æœRNNå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå®ƒä»¬å°†éå¸¸æœ‰ç”¨ã€‚ä½†æ˜¯ä»–ä»¬èƒ½åšåˆ°å—ï¼Ÿè¿™è¦è§†æƒ…å†µè€Œå®šã€‚</p><p>Sometimes, we only need to look at recent information to perform the present task. For example, consider a language model trying to predict the next word based on the previous ones. If we are trying to predict the last word in â€œthe clouds are in the _sky_,â€ we donâ€™t need any further context â€“ itâ€™s pretty obvious the next word is going to be sky. In such cases, where the gap between the relevant information and the place that itâ€™s needed is small, RNNs can learn to use the past information.<br>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦æŸ¥çœ‹æœ€è¿‘çš„ä¿¡æ¯å°±å¯ä»¥å®Œæˆå½“å‰çš„ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªè¯­è¨€æ¨¡å‹,å®ƒå°è¯•åŸºäºå‰é¢çš„å•è¯æ¥é¢„æµ‹ä¸‹ä¸€ä¸ªå•è¯ã€‚å¦‚æœæˆ‘ä»¬è¯•å›¾é¢„æµ‹â€œthe clouds are in the skyâ€ä¸­çš„æœ€åä¸€ä¸ªå•è¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä»»ä½•è¿›ä¸€æ­¥çš„ä¸Šä¸‹æ–‡â€”â€”å¾ˆæ˜æ˜¾ä¸‹ä¸€ä¸ªå•è¯å°†æ˜¯skyã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç›¸å…³ä¿¡æ¯å’Œæ‰€éœ€ä½ç½®ä¹‹é—´çš„é—´éš”è¾ƒå°ï¼ŒRNNså¯ä»¥å­¦ä¹ ä½¿ç”¨è¿‡å»çš„ä¿¡æ¯ã€‚<br><img src="/4579c6a3/3.png" class></p><p>But there are also cases where we need more context. Consider trying to predict the last word in the text â€œI grew up in Franceâ€¦ I speak fluent _French_.â€ Recent information suggests that the next word is probably the name of a language, but if we want to narrow down which language, we need the context of France, from further back. Itâ€™s entirely possible for the gap between the relevant information and the point where it is needed to become very large.<br>ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ›´å¤šçš„èƒŒæ™¯ä¿¡æ¯ã€‚è€ƒè™‘è¯•å›¾é¢„æµ‹æ–‡æœ¬â€œI grew up in Franceâ€¦ I speak fluent French.â€ä¸­çš„æœ€åä¸€ä¸ªå•è¯ã€‚æœ€è¿‘çš„ä¿¡æ¯è¡¨æ˜ä¸‹ä¸€ä¸ªå•è¯å¯èƒ½æ˜¯æŸç§è¯­è¨€çš„åç§°ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³ç¼©å°è¯­è¨€èŒƒå›´ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ—©çš„æ³•å›½è¿™ä¸€èƒŒæ™¯ä¿¡æ¯ã€‚ç›¸å…³ä¿¡æ¯å’Œéœ€è¦ä½¿ç”¨è¯¥ä¿¡æ¯çš„ç‚¹ä¹‹é—´çš„é—´éš”å®Œå…¨æœ‰å¯èƒ½å˜å¾—éå¸¸å¤§ã€‚</p><p>Unfortunately, as that gap grows, RNNs become unable to learn to connect the information.<br>ä¸å¹¸çš„æ˜¯ï¼Œéšç€è¿™ç§é—´éš”çš„æ‰©å¤§ï¼ŒRNNå˜å¾—æ— æ³•å­¦ä¹ å»è¿æ¥ä¿¡æ¯ã€‚</p><img src="/4579c6a3/4.png" class><p>In theory, RNNs are absolutely capable of handling such â€œlong-term dependencies.â€ A human could carefully pick parameters for them to solve toy problems of this form. Sadly, in practice, RNNs donâ€™t seem to be able to learn them. The problem was explored in depth by <a href="http://people.idsia.ch/~juergen/SeppHochreiter1991ThesisAdvisorSchmidhuber.pdf">Hochreiter (1991) [German]</a> and <a href="http://www-dsi.ing.unifi.it/~paolo/ps/tnn-94-gradient.pdf">Bengio, et al. (1994)</a>, who found some pretty fundamental reasons why it might be difficult.<br>ç†è®ºä¸Šï¼ŒRNNså®Œå…¨æœ‰èƒ½åŠ›å¤„ç†è¿™ç§â€œé•¿æœŸä¾èµ–â€ã€‚äººç±»å¯ä»¥ä»”ç»†æŒ‘é€‰å‚æ•°ï¼Œä½¿å®ƒä»¬è§£å†³è¿™ç§å½¢å¼çš„ç©å…·é—®é¢˜ã€‚é—æ†¾çš„æ˜¯ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼ŒRNNsä¼¼ä¹æ— æ³•å­¦ä¼šå®ƒä»¬ã€‚è¿™ä¸ªé—®é¢˜åœ¨Hochreiterï¼ˆ1991ï¼‰å’ŒBengioç­‰äººï¼ˆ1994ï¼‰çš„ç ”ç©¶ä¸­å¾—åˆ°äº†æ·±å…¥æ¢è®¨ï¼Œä»–ä»¬å‘ç°äº†ä¸€äº›å¯èƒ½å¯¼è‡´è¿™ä¸€å›°éš¾çš„åŸºæœ¬åŸå› ã€‚</p><p>Thankfully, LSTMs donâ€™t have this problem!<br>å€¼å¾—åº†å¹¸çš„æ˜¯ï¼ŒLSTM æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼</p><h1 id="lstm-networks"><a href="#LSTM-Networks" class="headerlink" title="LSTM Networks"></a>LSTM Networks</h1><p>Long Short Term Memory networks â€“ usually just called â€œLSTMsâ€ â€“ are a special kind of RNN, capable of learning long-term dependencies. They were introduced by <a href="http://www.bioinf.jku.at/publications/older/2604.pdf">Hochreiter &amp; Schmidhuber (1997)</a>, and were refined and popularized by many people in following work.<a href="https://colah.github.io/posts/2015-08-Understanding-LSTMs/#fn1">1</a> They work tremendously well on a large variety of problems, and are now widely used.<br>é•¿çŸ­æœŸè®°å¿†ç½‘ç»œâ€”â€”é€šå¸¸ç®€ç§°ä¸ºâ€œLSTMsâ€â€”â€”æ˜¯ä¸€ç§ç‰¹æ®Šçš„RNNï¼Œèƒ½å¤Ÿå­¦ä¹ é•¿æœŸä¾èµ–ã€‚å®ƒä»¬ç”±Hochreiterå’ŒSchmidhuberï¼ˆ1997ï¼‰å¼•å…¥ï¼Œå¹¶åœ¨éšåçš„å·¥ä½œä¸­è¢«è®¸å¤šäººæ”¹è¿›å’Œæ¨å¹¿ã€‚LSTMsåœ¨å¤§é‡ä¸åŒçš„é—®é¢˜ä¸Šè¡¨ç°å‡ºè‰²ï¼Œç°åœ¨è¢«å¹¿æ³›ä½¿ç”¨ã€‚</p><p>LSTMs are explicitly designed to avoid the long-term dependency problem. Remembering information for long periods of time is practically their default behavior, not something they struggle to learn!<br>LSTMsè¢«æ˜ç¡®è®¾è®¡ç”¨äºé¿å…é•¿æœŸä¾èµ–é—®é¢˜ã€‚è®°ä½é•¿æ—¶é—´çš„ä¿¡æ¯å‡ ä¹æ˜¯å®ƒä»¬çš„é»˜è®¤è¡Œä¸ºï¼Œè€Œä¸æ˜¯å®ƒä»¬éœ€è¦åŠªåŠ›å­¦ä¹ çš„ä¸œè¥¿ï¼</p><p>All recurrent neural networks have the form of a chain of repeating modules of neural network. In standard RNNs, this repeating module will have a very simple structure, such as a single tanh layer.<br>æ‰€æœ‰é€’å½’ç¥ç»ç½‘ç»œéƒ½å…·æœ‰ç¥ç»ç½‘ç»œé‡å¤æ¨¡å—é“¾çš„å½¢å¼ã€‚åœ¨æ ‡å‡† RNN ä¸­ï¼Œè¯¥é‡å¤æ¨¡å—å°†å…·æœ‰éå¸¸ç®€å•çš„ç»“æ„ï¼Œä¾‹å¦‚å•ä¸ª tanh å±‚ã€‚</p><img src="/4579c6a3/5.png" class><p><strong>The repeating module in a standard RNN contains a single layer.<br>æ ‡å‡† RNN ä¸­çš„é‡å¤æ¨¡å—åŒ…å«å•å±‚ã€‚</strong></p><p>LSTMs also have this chain like structure, but the repeating module has a different structure. Instead of having a single neural network layer, there are four, interacting in a very special way.<br>LSTM ä¹Ÿå…·æœ‰è¿™ç§é“¾çŠ¶ç»“æ„ï¼Œä½†é‡å¤æ¨¡å—å…·æœ‰ä¸åŒçš„ç»“æ„ã€‚ä¸æ˜¯åªæœ‰ä¸€ä¸ªç¥ç»ç½‘ç»œå±‚ï¼Œè€Œæ˜¯æœ‰å››ä¸ªï¼Œä»¥ä¸€ç§éå¸¸ç‰¹æ®Šçš„æ–¹å¼è¿›è¡Œäº¤äº’ã€‚</p><img src="/4579c6a3/6.png" class><p><strong>The repeating module in an LSTM contains four interacting layers.<br>LSTM ä¸­çš„é‡å¤æ¨¡å—åŒ…å«å››ä¸ªäº¤äº’å±‚ã€‚</strong></p><p>Donâ€™t worry about the details of whatâ€™s going on. Weâ€™ll walk through the LSTM diagram step by step later. For now, letâ€™s just try to get comfortable with the notation weâ€™ll be using.<br>ä¸ç”¨æ‹…å¿ƒå…·ä½“çš„ç»†èŠ‚ã€‚æˆ‘ä»¬ç¨åä¼šä¸€æ­¥æ­¥è®²è§£LSTMçš„å›¾è¡¨ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬å…ˆç†Ÿæ‚‰ä¸€ä¸‹æˆ‘ä»¬å°†è¦ä½¿ç”¨çš„ç¬¦å·ã€‚<br><img src="/4579c6a3/7.png" class><br>In the above diagram, each line carries an entire vector, from the output of one node to the inputs of others. The pink circles represent pointwise operations, like vector addition, while the yellow boxes are learned neural network layers. Lines merging denote concatenation, while a line forking denote its content being copied and the copies going to different locations.<br>åœ¨ä¸Šå›¾ä¸­ï¼Œæ¯æ¡çº¿éƒ½å¸¦æœ‰ä¸€ä¸ªå®Œæ•´çš„å‘é‡ï¼Œä»ä¸€ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºåˆ°å…¶ä»–èŠ‚ç‚¹çš„è¾“å…¥ã€‚ç²‰çº¢è‰²çš„åœ†åœˆä»£è¡¨é€ç‚¹è¿ç®—ï¼Œå¦‚å‘é‡åŠ æ³•ï¼Œè€Œé»„è‰²æ¡†æ˜¯å­¦ä¹ çš„ç¥ç»ç½‘ç»œå±‚ã€‚åˆå¹¶çš„è¡Œè¡¨ç¤ºä¸²è”ï¼Œè€Œåˆ†å‰çš„è¡Œè¡¨ç¤ºæ­£åœ¨å¤åˆ¶å…¶å†…å®¹å¹¶å°†å‰¯æœ¬å‘é€åˆ°ä¸åŒçš„ä½ç½®ã€‚</p><h1 id="the-core-idea-behind-lstms"><a href="#The-Core-Idea-Behind-LSTMs" class="headerlink" title="The Core Idea Behind LSTMs"></a>The Core Idea Behind LSTMs</h1><p>LSTM èƒŒåçš„æ ¸å¿ƒæ€æƒ³</p><p>The key to LSTMs is the cell state, the horizontal line running through the top of the diagram.<br>LSTMsçš„å…³é”®æ˜¯å•å…ƒçŠ¶æ€ï¼Œè¿™æ¡æ¨ªçº¿è´¯ç©¿äº†å›¾è¡¨çš„é¡¶éƒ¨ã€‚</p><p>The cell state is kind of like a conveyor belt. It runs straight down the entire chain, with only some minor linear interactions. Itâ€™s very easy for information to just flow along it unchanged.<br>å•å…ƒçŠ¶æ€æœ‰ç‚¹åƒä¼ é€å¸¦ã€‚å®ƒç›´æ¥æ²¿ç€æ•´ä¸ªé“¾æ¡è¿è¡Œï¼Œåªæœ‰ä¸€äº›å°çš„çº¿æ€§äº¤äº’ã€‚ä¿¡æ¯å¯ä»¥éå¸¸å®¹æ˜“åœ°æ²¿ç€å®ƒä¸å˜åœ°æµåŠ¨ã€‚</p><img src="/4579c6a3/8.png" class><p>The LSTM does have the ability to remove or add information to the cell state, carefully regulated by structures called gates.<br>LSTMç¡®å®å…·æœ‰ä»å•å…ƒçŠ¶æ€ä¸­ç§»é™¤æˆ–æ·»åŠ ä¿¡æ¯çš„èƒ½åŠ›ï¼Œè¿™äº›æ“ä½œç”±ç§°ä¸ºé—¨æ§çš„ç»“æ„ä¸¥æ ¼è°ƒæ§ã€‚</p><p>Gates are a way to optionally let information through. They are composed out of a sigmoid neural net layer and a pointwise multiplication operation.<br>é—¨æ§æ˜¯ä¸€ç§é€‰æ‹©æ€§åœ°è®©ä¿¡æ¯é€šè¿‡çš„æ–¹å¼ã€‚å®ƒä»¬ç”±ä¸€ä¸ªsigmoidç¥ç»ç½‘ç»œå±‚å’Œä¸€ä¸ªé€ç‚¹ä¹˜æ³•æ“ä½œç»„æˆã€‚<br><img src="/4579c6a3/9.png" class><br>The sigmoid layer outputs numbers between zero and one, describing how much of each component should be let through. A value of zero means â€œlet nothing through,â€ while a value of one means â€œlet everything through!â€<br>sigmoid å±‚è¾“å‡ºä»‹äº 0 å’Œ 1 ä¹‹é—´çš„æ•°å­—ï¼Œæè¿°æ¯ä¸ªç»„ä»¶åº”é€šè¿‡å¤šå°‘ã€‚å€¼ä¸ºé›¶è¡¨ç¤ºâ€œä»€ä¹ˆéƒ½ä¸è®©é€šè¿‡â€ï¼Œè€Œå€¼ä¸º 1 è¡¨ç¤ºâ€œè®©æ‰€æœ‰ä¸œè¥¿éƒ½é€šè¿‡ï¼â€</p><p>An LSTM has three of these gates, to protect and control the cell state.<br>LSTM æœ‰ä¸‰ä¸ªè¿™æ ·çš„é—¨ï¼Œç”¨äºä¿æŠ¤å’Œæ§åˆ¶å•å…ƒçŠ¶æ€ã€‚</p><h1 id="step-by-step-lstm-walk-through"><a href="#Step-by-Step-LSTM-Walk-Through" class="headerlink" title="Step-by-Step LSTM Walk Through"></a>Step-by-Step LSTM Walk Through</h1><p>å¾ªåºæ¸è¿›çš„ LSTM æ¼”ç»ƒ</p><h2 id="forget-gate-layer"><a href="#forget-gate-layer" class="headerlink" title="forget gate layer"></a>forget gate layer</h2><p>The first step in our LSTM is to decide what information weâ€™re going to throw away from the cell state. This decision is made by a sigmoid layer called the â€œforget gate layer.â€ It looks at $h_{tâˆ’1}$ and $x_t$, and outputs a number between 00 and 11 for each number in the cell state $C_{tâˆ’1}$. A 1 represents â€œcompletely keep thisâ€ while a 0 represents â€œcompletely get rid of this.â€<br>LSTMçš„ç¬¬ä¸€æ­¥æ˜¯å†³å®šè¦ä»å•å…ƒçŠ¶æ€ä¸­ä¸¢å¼ƒå“ªäº›ä¿¡æ¯ã€‚è¿™ä¸ªå†³ç­–æ˜¯ç”±ä¸€ä¸ªåä¸ºâ€œé—å¿˜é—¨å±‚â€çš„sigmoidå±‚åšå‡ºçš„ã€‚å®ƒæŸ¥çœ‹ $h_{t-1}â€‹$ å’Œ $x_t$ï¼Œå¹¶ä¸ºå•å…ƒçŠ¶æ€ $C_{t-1}$ ä¸­çš„æ¯ä¸ªæ•°å­—è¾“å‡ºä¸€ä¸ªä»‹äº0å’Œ1ä¹‹é—´çš„æ•°å€¼ã€‚1è¡¨ç¤ºâ€œå®Œå…¨ä¿ç•™è¿™ä¸ªâ€ï¼Œè€Œ0è¡¨ç¤ºâ€œå®Œå…¨ä¸¢å¼ƒè¿™ä¸ªâ€ã€‚</p><p>Letâ€™s go back to our example of a language model trying to predict the next word based on all the previous ones. In such a problem, the cell state might include the gender of the present subject, so that the correct pronouns can be used. When we see a new subject, we want to forget the gender of the old subject.<br>è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„ä¾‹å­ï¼Œä¸€ä¸ªè¯­è¨€æ¨¡å‹è¯•å›¾åŸºäºæ‰€æœ‰å‰é¢çš„å•è¯æ¥é¢„æµ‹ä¸‹ä¸€ä¸ªå•è¯ã€‚åœ¨è¿™æ ·çš„é—®é¢˜ä¸­ï¼Œå•å…ƒçŠ¶æ€å¯èƒ½åŒ…å«å½“å‰ä¸»è¯­çš„æ€§åˆ«ï¼Œä»¥ä¾¿ä½¿ç”¨æ­£ç¡®çš„ä»£è¯ã€‚å½“æˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªæ–°çš„ä¸»è¯­æ—¶ï¼Œæˆ‘ä»¬æƒ³å¿˜è®°æ—§ä¸»è¯­çš„æ€§åˆ«ã€‚<br><img src="/4579c6a3/10.png" class></p><h2 id="input-gate-layer"><a href="#input-gate-layer" class="headerlink" title="input gate layer"></a>input gate layer</h2><p>The next step is to decide what new information weâ€™re going to store in the cell state. This has two parts. First, a sigmoid layer called the â€œinput gate layerâ€ decides which values weâ€™ll update. Next, a tanh layer creates a vector of new candidate values, $\tilde{C}_t$, that could be added to the state. In the next step, weâ€™ll combine these two to create an update to the state.<br>ä¸‹ä¸€æ­¥æ˜¯å†³å®šè¦åœ¨å•å…ƒçŠ¶æ€ä¸­å­˜å‚¨å“ªäº›æ–°ä¿¡æ¯ã€‚è¿™åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ã€‚é¦–å…ˆï¼Œä¸€ä¸ªåä¸ºâ€œè¾“å…¥é—¨å±‚â€çš„sigmoidå±‚å†³å®šæˆ‘ä»¬å°†æ›´æ–°å“ªäº›å€¼ã€‚æ¥ä¸‹æ¥ï¼Œä¸€ä¸ªtanhå±‚åˆ›å»ºä¸€ä¸ªæ–°çš„å€™é€‰å€¼å‘é‡$\tilde{C}_t$ï¼Œè¿™äº›å€™é€‰å€¼å¯ä»¥è¢«æ·»åŠ åˆ°çŠ¶æ€ä¸­ã€‚åœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†ç»“åˆè¿™ä¸¤éƒ¨åˆ†æ¥æ›´æ–°çŠ¶æ€ã€‚</p><p>In the example of our language model, weâ€™d want to add the gender of the new subject to the cell state, to replace the old one weâ€™re forgetting.<br>åœ¨æˆ‘ä»¬çš„è¯­è¨€æ¨¡å‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å°†æ–°ä¸»è¯­çš„æ€§åˆ«æ·»åŠ åˆ°å•å…ƒæ ¼çŠ¶æ€ä¸­ï¼Œä»¥æ›¿æ¢æˆ‘ä»¬å¿˜è®°çš„æ—§ä¸»è¯­ã€‚</p><img src="/4579c6a3/11.png" class><p>Itâ€™s now time to update the old cell state$C_{t-1}$, into the new cell state $C_t$â€‹. The previous steps already decided what to do, we just need to actually do it.<br>ç°åœ¨æ˜¯æ—¶å€™å°†æ—§çš„å•å…ƒæ ¼çŠ¶æ€$C_{t-1}$æ›´æ–°ä¸ºæ–°çš„å•å…ƒæ ¼çŠ¶æ€ $C_t$â€‹äº†ã€‚å‰é¢çš„æ­¥éª¤å·²ç»å†³å®šäº†è¦åšä»€ä¹ˆï¼Œæˆ‘ä»¬åªéœ€è¦å®é™…å»æ‰§è¡Œå®ƒã€‚</p><p>We multiply the old state by $ğ‘“_ğ‘¡$, forgetting the things we decided to forget earlier. Then we add $i_t \ast \tilde{C}_t$. This is the new candidate values, scaled by how much we decided to update each state value.<br>æˆ‘ä»¬å°†æ—§çŠ¶æ€ä¹˜ä»¥ $f_t$ï¼Œå¿˜è®°æˆ‘ä»¬ä¹‹å‰å†³å®šå¿˜è®°çš„å†…å®¹ã€‚ç„¶åæˆ‘ä»¬åŠ ä¸Š $i_t \ast \tilde{C}_t$ã€‚è¿™äº›æ˜¯æ–°çš„å€™é€‰å€¼ï¼ŒæŒ‰æˆ‘ä»¬å†³å®šæ›´æ–°æ¯ä¸ªçŠ¶æ€å€¼çš„ç¨‹åº¦è¿›è¡Œç¼©æ”¾ã€‚</p><p>In the case of the language model, this is where weâ€™d actually drop the information about the old subjectâ€™s gender and add the new information, as we decided in the previous steps.<br>åœ¨è¯­è¨€æ¨¡å‹çš„æƒ…å†µä¸‹ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨å‰é¢çš„æ­¥éª¤ä¸­å†³å®šçš„é‚£æ ·ï¼Œæˆ‘ä»¬å®é™…ä¸Šä¼šåˆ é™¤æœ‰å…³æ—§ä¸»é¢˜æ€§åˆ«çš„ä¿¡æ¯å¹¶æ·»åŠ æ–°ä¿¡æ¯ã€‚</p><img src="/4579c6a3/12.png" class><h2 id="output-layer"><a href="#output-layer" class="headerlink" title="output  layer"></a>output  layer</h2><p>Finally, we need to decide what weâ€™re going to output. This output will be based on our cell state, but will be a filtered version. First, we run a sigmoid layer which decides what parts of the cell state weâ€™re going to output. Then, we put the cell state through tanh (to push the values to be between âˆ’1 and 1) and multiply it by the output of the sigmoid gate, so that we only output the parts we decided to.<br>æœ€åï¼Œæˆ‘ä»¬éœ€è¦å†³å®šè¾“å‡ºä»€ä¹ˆã€‚è¿™ä¸ªè¾“å‡ºå°†åŸºäºæˆ‘ä»¬çš„å•å…ƒçŠ¶æ€ï¼Œä½†ä¼šæ˜¯ä¸€ä¸ªè¿‡æ»¤åçš„ç‰ˆæœ¬ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸ªsigmoidå±‚æ¥å†³å®šè¦è¾“å‡ºå•å…ƒçŠ¶æ€çš„å“ªäº›éƒ¨åˆ†ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†å•å…ƒçŠ¶æ€é€šè¿‡tanhï¼ˆå°†å€¼å‹ç¼©åˆ°-1åˆ°1ä¹‹é—´ï¼‰ï¼Œå¹¶å°†å…¶ä¸sigmoidé—¨çš„è¾“å‡ºç›¸ä¹˜ï¼Œè¿™æ ·æˆ‘ä»¬åªè¾“å‡ºæˆ‘ä»¬å†³å®šè¾“å‡ºçš„éƒ¨åˆ†ã€‚</p><p>For the language model example, since it just saw a subject, it might want to output information relevant to a verb, in case thatâ€™s what is coming next. For example, it might output whether the subject is singular or plural, so that we know what form a verb should be conjugated into if thatâ€™s what follows next.<br>å¯¹äºè¯­è¨€æ¨¡å‹çš„ä¾‹å­ï¼Œç”±äºå®ƒåˆšåˆšçœ‹åˆ°ä¸€ä¸ªä¸»è¯­ï¼Œå®ƒå¯èƒ½æƒ³è¾“å‡ºä¸åŠ¨è¯ç›¸å…³çš„ä¿¡æ¯ï¼Œä»¥é˜²æ¥ä¸‹æ¥éœ€è¦åŠ¨è¯ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½ä¼šè¾“å‡ºä¸»è¯­æ˜¯å•æ•°è¿˜æ˜¯å¤æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±çŸ¥é“å¦‚æœæ¥ä¸‹æ¥æ˜¯åŠ¨è¯ï¼Œè¯¥åŠ¨è¯åº”è¯¥å˜æˆä»€ä¹ˆå½¢å¼ã€‚</p><img src="/4579c6a3/13.png" class><h1 id="variants-on-long-short-term-memory"><a href="#Variants-on-Long-Short-Term-Memory" class="headerlink" title="Variants on Long Short Term Memory"></a>Variants on Long Short Term Memory</h1><p>é•¿çŸ­æœŸè®°å¿†çš„å˜ä½“</p><p>What Iâ€™ve described so far is a pretty normal LSTM. But not all LSTMs are the same as the above. In fact, it seems like almost every paper involving LSTMs uses a slightly different version. The differences are minor, but itâ€™s worth mentioning some of them.<br>æˆ‘åˆ°ç›®å‰ä¸ºæ­¢æè¿°çš„æ˜¯ä¸€ä¸ªç›¸å½“æ™®é€šçš„LSTMã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„LSTMéƒ½ä¸ä¸Šè¿°ç›¸åŒã€‚å®é™…ä¸Šï¼Œå‡ ä¹æ¯ç¯‡æ¶‰åŠLSTMçš„è®ºæ–‡éƒ½ä½¿ç”¨äº†ç¨å¾®ä¸åŒçš„ç‰ˆæœ¬ã€‚è¿™äº›å·®å¼‚å¾ˆå°ï¼Œä½†å€¼å¾—ä¸€æã€‚</p><p>One popular LSTM variant, introduced by <a href="ftp://ftp.idsia.ch/pub/juergen/TimeCount-IJCNN2000.pdf">Gers &amp; Schmidhuber (2000)</a>, is adding â€œpeephole connections.â€ This means that we let the gate layers look at the cell state.<br>ä¸€ä¸ªç”±Gerså’ŒSchmidhuberï¼ˆ2000ï¼‰å¼•å…¥çš„æµè¡ŒLSTMå˜ä½“æ˜¯æ·»åŠ â€œçª¥è§†è¿æ¥â€ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬è®©é—¨æ§å±‚æŸ¥çœ‹å•å…ƒçŠ¶æ€ã€‚</p><img src="/4579c6a3/14.png" class><p>The above diagram adds peepholes to all the gates, but many papers will give some peepholes and not others.<br>ä¸Šå›¾ä¸ºæ‰€æœ‰é—¨æ§æ·»åŠ äº†çª¥è§†è¿æ¥ï¼Œä½†è®¸å¤šè®ºæ–‡ä¼šåªä¸ºéƒ¨åˆ†é—¨æ§æ·»åŠ çª¥è§†è¿æ¥ï¼Œè€Œä¸æ˜¯å…¨éƒ¨ã€‚</p><p>Another variation is to use coupled forget and input gates. Instead of separately deciding what to forget and what we should add new information to, we make those decisions together. We only forget when weâ€™re going to input something in its place. We only input new values to the state when we forget something older.<br>å¦ä¸€ç§å˜ä½“æ˜¯ä½¿ç”¨è€¦åˆçš„é—å¿˜é—¨å’Œè¾“å…¥é—¨ã€‚æˆ‘ä»¬ä¸æ˜¯åˆ†åˆ«å†³å®šè¦å¿˜è®°ä»€ä¹ˆä»¥åŠè¦æ·»åŠ ä»€ä¹ˆæ–°ä¿¡æ¯ï¼Œè€Œæ˜¯å°†è¿™äº›å†³ç­–ç»“åˆåœ¨ä¸€èµ·ã€‚æˆ‘ä»¬åªæœ‰åœ¨è¦è¾“å…¥æ–°ä¿¡æ¯æ—¶æ‰ä¼šå¿˜è®°æŸäº›å†…å®¹ã€‚åªæœ‰åœ¨å¿˜è®°æ—§ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬æ‰ä¼šå°†æ–°å€¼è¾“å…¥åˆ°çŠ¶æ€ä¸­ã€‚</p><img src="/4579c6a3/15.png" class><p>A slightly more dramatic variation on the LSTM is the Gated Recurrent Unit, or GRU, introduced by <a href="http://arxiv.org/pdf/1406.1078v3.pdf">Cho, et al. (2014)</a>. It combines the forget and input gates into a single â€œupdate gate.â€ It also merges the cell state and hidden state, and makes some other changes. The resulting model is simpler than standard LSTM models, and has been growing increasingly popular.<br>LSTMçš„ä¸€ä¸ªç¨å¾®æ›´æ˜¾è‘—çš„å˜ä½“æ˜¯é—¨æ§å¾ªç¯å•å…ƒï¼ˆGRUï¼‰ï¼Œç”±Choç­‰äººï¼ˆ2014ï¼‰å¼•å…¥ã€‚å®ƒå°†é—å¿˜é—¨å’Œè¾“å…¥é—¨ç»„åˆæˆä¸€ä¸ªâ€œæ›´æ–°é—¨â€ã€‚å®ƒè¿˜åˆå¹¶äº†å•å…ƒçŠ¶æ€å’Œéšè—çŠ¶æ€ï¼Œå¹¶åšäº†ä¸€äº›å…¶ä»–çš„æ”¹å˜ã€‚æœ€ç»ˆçš„æ¨¡å‹æ¯”æ ‡å‡†çš„LSTMæ¨¡å‹æ›´ç®€å•ï¼Œå¹¶ä¸”è¶Šæ¥è¶Šå—æ¬¢è¿ã€‚</p><img src="/4579c6a3/16.png" class><p>These are only a few of the most notable LSTM variants. There are lots of others, like Depth Gated RNNs by <a href="http://arxiv.org/pdf/1508.03790v2.pdf">Yao, et al. (2015)</a>. Thereâ€™s also some completely different approach to tackling long-term dependencies, like Clockwork RNNs by <a href="http://arxiv.org/pdf/1402.3511v1.pdf">Koutnik, et al. (2014)</a>.<br>è¿™äº›åªæ˜¯ä¸€äº›æœ€è‘—åçš„LSTMå˜ä½“ã€‚è¿˜æœ‰è®¸å¤šå…¶ä»–å˜ä½“ï¼Œä¾‹å¦‚Yaoç­‰äººï¼ˆ2015ï¼‰æå‡ºçš„æ·±åº¦é—¨æ§RNNã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€äº›å®Œå…¨ä¸åŒçš„æ–¹æ³•æ¥è§£å†³é•¿æœŸä¾èµ–é—®é¢˜ï¼Œä¾‹å¦‚Koutnikç­‰äººï¼ˆ2014ï¼‰æå‡ºçš„æ—¶é’Ÿå¼RNNã€‚</p><p>Which of these variants is best? Do the differences matter? <a href="http://arxiv.org/pdf/1503.04069.pdf">Greff, et al. (2015)</a> do a nice comparison of popular variants, finding that theyâ€™re all about the same. <a href="http://jmlr.org/proceedings/papers/v37/jozefowicz15.pdf">Jozefowicz, et al. (2015)</a> tested more than ten thousand RNN architectures, finding some that worked better than LSTMs on certain tasks.<br>è¿™äº›å˜ä½“ä¸­å“ªä¸€ä¸ªæœ€å¥½ï¼Ÿå·®å¼‚é‡è¦å—ï¼ŸGreffç­‰äººï¼ˆ2015ï¼‰å¯¹æµè¡Œå˜ä½“è¿›è¡Œäº†å¾ˆå¥½çš„æ¯”è¾ƒï¼Œå‘ç°å®ƒä»¬çš„è¡¨ç°å‡ ä¹ç›¸åŒã€‚Jozefowiczç­‰äººï¼ˆ2015ï¼‰æµ‹è¯•äº†è¶…è¿‡ä¸€ä¸‡ç§RNNæ¶æ„ï¼Œå‘ç°å…¶ä¸­ä¸€äº›åœ¨æŸäº›ä»»åŠ¡ä¸Šçš„è¡¨ç°æ¯”LSTMsæ›´å¥½ã€‚</p><h1 id="conclusion-ç»“è®º"><a href="#Conclusion-ç»“è®º" class="headerlink" title="Conclusion ç»“è®º"></a>Conclusion ç»“è®º</h1><p>Earlier, I mentioned the remarkable results people are achieving with RNNs. Essentially all of these are achieved using LSTMs. They really work a lot better for most tasks!<br>å‰é¢ï¼Œæˆ‘æåˆ°äº†äººä»¬ç”¨é€’å½’ç¥ç»ç½‘ç»œï¼ˆRNNsï¼‰å–å¾—çš„æ˜¾è‘—æˆæœã€‚åŸºæœ¬ä¸Šæ‰€æœ‰è¿™äº›æˆæœéƒ½æ˜¯ä½¿ç”¨LSTMså®ç°çš„ã€‚å¯¹äºå¤§å¤šæ•°ä»»åŠ¡ï¼ŒLSTMsçš„æ•ˆæœç¡®å®è¦å¥½å¾—å¤šï¼</p><p>Written down as a set of equations, LSTMs look pretty intimidating. Hopefully, walking through them step by step in this essay has made them a bit more approachable.<br>ä½œä¸ºä¸€ç»„æ–¹ç¨‹å†™ä¸‹æ¥ï¼ŒLSTMsçœ‹èµ·æ¥ç›¸å½“ä»¤äººç”Ÿç•ã€‚å¸Œæœ›é€šè¿‡åœ¨æœ¬æ–‡ä¸­ä¸€æ­¥ä¸€æ­¥åœ°è®²è§£å®ƒä»¬ï¼Œä½¿å®ƒä»¬å˜å¾—æ›´å®¹æ˜“ç†è§£ã€‚</p><p>LSTMs were a big step in what we can accomplish with RNNs. Itâ€™s natural to wonder: is there another big step? A common opinion among researchers is: â€œYes! There is a next step and itâ€™s attention!â€ The idea is to let every step of an RNN pick information to look at from some larger collection of information. For example, if you are using an RNN to create a caption describing an image, it might pick a part of the image to look at for every word it outputs. In fact, <a href="http://arxiv.org/pdf/1502.03044v2.pdf">Xu, _et al._ (2015)</a> do exactly this â€“ it might be a fun starting point if you want to explore attention! Thereâ€™s been a number of really exciting results using attention, and it seems like a lot more are around the cornerâ€¦<br>LSTMsæ˜¯æˆ‘ä»¬ç”¨RNNsèƒ½å®ç°çš„ä¸€ä¸ªå¤§è¿›æ­¥ã€‚å¾ˆè‡ªç„¶åœ°ä¼šæœ‰äººé—®ï¼šè¿˜æœ‰å¦ä¸€ä¸ªå¤§è¿›æ­¥å—ï¼Ÿç ”ç©¶äººå‘˜çš„ä¸€ä¸ªæ™®éçœ‹æ³•æ˜¯ï¼šâ€œæ˜¯çš„ï¼ä¸‹ä¸€ä¸ªè¿›æ­¥æ˜¯æ³¨æ„åŠ›æœºåˆ¶ï¼â€è¿™ä¸ªæƒ³æ³•æ˜¯è®©RNNçš„æ¯ä¸€æ­¥éƒ½ä»ä¸€äº›æ›´å¤§çš„ä¿¡æ¯é›†åˆä¸­é€‰æ‹©è¦çœ‹çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ ä½¿ç”¨RNNæ¥åˆ›å»ºæè¿°å›¾åƒçš„æ ‡é¢˜ï¼Œå®ƒå¯èƒ½ä¼šä¸ºå®ƒè¾“å‡ºçš„æ¯ä¸ªå•è¯é€‰æ‹©å›¾åƒçš„ä¸€éƒ¨åˆ†ã€‚äº‹å®ä¸Šï¼ŒXuç­‰äººï¼ˆ2015ï¼‰æ­£æ˜¯è¿™æ ·åšçš„â€”â€”å¦‚æœä½ æƒ³æ¢ç´¢æ³¨æ„åŠ›æœºåˆ¶ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªæœ‰è¶£çš„èµ·ç‚¹ï¼ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶å·²ç»å–å¾—äº†è®¸å¤šéå¸¸ä»¤äººå…´å¥‹çš„æˆæœï¼Œä¼¼ä¹è¿˜ä¼šæœ‰æ›´å¤šçš„æˆæœå³å°†åˆ°æ¥â€¦â€¦</p><p>Attention isnâ€™t the only exciting thread in RNN research. For example, Grid LSTMs by <a href="http://arxiv.org/pdf/1507.01526v1.pdf">Kalchbrenner, _et al._ (2015)</a> seem extremely promising. Work using RNNs in generative models â€“ such as <a href="http://arxiv.org/pdf/1502.04623.pdf">Gregor, _et al._ (2015)</a>, <a href="http://arxiv.org/pdf/1506.02216v3.pdf">Chung, _et al._ (2015)</a>, or <a href="http://arxiv.org/pdf/1411.7610v3.pdf">Bayer &amp; Osendorfer (2015)</a> â€“ also seems very interesting. The last few years have been an exciting time for recurrent neural networks, and the coming ones promise to only be more so!<br>æ³¨æ„åŠ›æœºåˆ¶å¹¶ä¸æ˜¯RNNç ”ç©¶ä¸­å”¯ä¸€ä»¤äººå…´å¥‹çš„æ–¹å‘ã€‚ä¾‹å¦‚ï¼ŒKalchbrennerç­‰äººï¼ˆ2015ï¼‰çš„Grid LSTMsçœ‹èµ·æ¥éå¸¸æœ‰å‰é€”ã€‚åœ¨ç”Ÿæˆæ¨¡å‹ä¸­ä½¿ç”¨RNNçš„å·¥ä½œâ€”â€”ä¾‹å¦‚Gregorç­‰äººï¼ˆ2015ï¼‰ã€Chungç­‰äººï¼ˆ2015ï¼‰æˆ–Bayerå’ŒOsendorferï¼ˆ2015ï¼‰çš„å·¥ä½œâ€”â€”ä¹Ÿéå¸¸æœ‰è¶£ã€‚è¿‡å»å‡ å¹´æ˜¯é€’å½’ç¥ç»ç½‘ç»œçš„æ¿€åŠ¨äººå¿ƒçš„æ—¶æœŸï¼Œæœªæ¥å‡ å¹´åªä¼šæ›´åŠ æ¿€åŠ¨äººå¿ƒï¼</p><h1 id="acknowledgments-ç¡®è®¤"><a href="#Acknowledgments-ç¡®è®¤" class="headerlink" title="Acknowledgments ç¡®è®¤"></a>Acknowledgments ç¡®è®¤</h1><p>Iâ€™m grateful to a number of people for helping me better understand LSTMs, commenting on the visualizations, and providing feedback on this post.<br>æˆ‘æ„Ÿè°¢è®¸å¤šäººå¸®åŠ©æˆ‘æ›´å¥½åœ°ç†è§£ LSTMï¼Œå¯¹å¯è§†åŒ–è¿›è¡Œè¯„è®ºï¼Œå¹¶å¯¹è¿™ç¯‡æ–‡ç« æä¾›åé¦ˆã€‚</p><p>Iâ€™m very grateful to my colleagues at Google for their helpful feedback, especially <a href="http://research.google.com/pubs/OriolVinyals.html">Oriol Vinyals</a>, <a href="http://research.google.com/pubs/GregCorrado.html">Greg Corrado</a>, <a href="http://research.google.com/pubs/JonathonShlens.html">Jon Shlens</a>, <a href="http://people.cs.umass.edu/~luke/">Luke Vilnis</a>, and <a href="http://www.cs.toronto.edu/~ilya/">Ilya Sutskever</a>. Iâ€™m also thankful to many other friends and colleagues for taking the time to help me, including <a href="https://www.linkedin.com/pub/dario-amodei/4/493/393">Dario Amodei</a>, and <a href="http://cs.stanford.edu/~jsteinhardt/">Jacob Steinhardt</a>. Iâ€™m especially thankful to <a href="http://www.kyunghyuncho.me/">Kyunghyun Cho</a> for extremely thoughtful correspondence about my diagrams.<br>æˆ‘éå¸¸æ„Ÿè°¢ Google åŒäº‹æä¾›çš„æœ‰ç›Šåé¦ˆï¼Œå°¤å…¶æ˜¯ Oriol Vinyalsã€Greg Corradoã€Jon Shlensã€Luke Villnis å’Œ Ilya Sutskeverã€‚æˆ‘è¿˜è¦æ„Ÿè°¢è®¸å¤šå…¶ä»–æœ‹å‹å’ŒåŒäº‹æŠ½å‡ºæ—¶é—´å¸®åŠ©æˆ‘ï¼ŒåŒ…æ‹¬ Dario Amodei å’Œ Jacob Steinhardtã€‚æˆ‘ç‰¹åˆ«æ„Ÿè°¢ Kyunghyun Cho å¯¹æˆ‘çš„å›¾è¡¨è¿›è¡Œäº†éå¸¸å‘¨åˆ°çš„é€šä¿¡ã€‚</p><p>Before this post, I practiced explaining LSTMs during two seminar series I taught on neural networks. Thanks to everyone who participated in those for their patience with me, and for their feedback.<br>åœ¨è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæˆ‘åœ¨æˆ‘æ•™æˆçš„å…³äºç¥ç»ç½‘ç»œçš„ä¸¤ä¸ªç³»åˆ—ç ”è®¨ä¼šä¸Šç»ƒä¹ äº†è§£é‡Š LSTMã€‚æ„Ÿè°¢æ‰€æœ‰å‚ä¸æ´»åŠ¨çš„äººå¯¹æˆ‘çš„è€å¿ƒå’Œåé¦ˆã€‚</p><h1 id="æ³¨é‡Š-å¦‚ä½•ç†è§£é—¨æ§ç»“æ„çš„è®¡ç®—"><a href="#æ³¨é‡Š-å¦‚ä½•ç†è§£é—¨æ§ç»“æ„çš„è®¡ç®—" class="headerlink" title="æ³¨é‡Š-å¦‚ä½•ç†è§£é—¨æ§ç»“æ„çš„è®¡ç®—"></a>æ³¨é‡Š-å¦‚ä½•ç†è§£é—¨æ§ç»“æ„çš„è®¡ç®—</h1><p>æ ¹æ®å‰é¢çš„æ–‡ç« ï¼Œ æˆ‘ä»¬å·²ç»çŸ¥é“åŸºç¡€ ç¥ç»ç½‘ç»œå’Œ åŸºç¡€RNN ä¸­ï¼Œæ•°æ®ä»è¾“å…¥å±‚åˆ°éšè—å±‚åˆ°è¾“å‡ºå±‚çš„è®¡ç®—ï¼Œè¿™é‡Œå†å¤ä¹ ä¸€ä¸‹</p><h2 id="åŸºç¡€ç¥ç»ç½‘ç»œ"><a href="#åŸºç¡€ç¥ç»ç½‘ç»œ" class="headerlink" title="åŸºç¡€ç¥ç»ç½‘ç»œ"></a>åŸºç¡€ç¥ç»ç½‘ç»œ</h2><p><strong>éšè—å±‚</strong><br>$h_tâ€‹=f(W_{xhâ€‹}x_tâ€‹+b_hâ€‹)$</p><ul><li>$x_t$â€‹ï¼šå½“å‰è¾“å…¥</li><li>$W_{xh}$ï¼šè¾“å…¥å±‚åˆ°éšè—å±‚çš„æƒé‡çŸ©é˜µ</li><li>$b_h$â€‹ï¼šåç½®</li><li>$f$ï¼šæ¿€æ´»å‡½æ•°ï¼ˆå¦‚tanhæˆ–ReLUï¼‰</li></ul><p>è®¡ç®—éšè—çŠ¶æ€åˆ†ä¸º2ä¸ªæ­¥éª¤</p><ol><li>è®¡ç®—éšè—å±‚çš„è¾“å…¥åŠ æƒå’Œï¼š</li><li>åº”ç”¨æ¿€æ´»å‡½æ•°ï¼Œè®¡ç®—éšè—å±‚çš„è¾“å‡º<h2 id="åŸºç¡€rnn"><a href="#åŸºç¡€RNN" class="headerlink" title="åŸºç¡€RNN"></a>åŸºç¡€RNN</h2></li></ol><p>RNNçš„éšè—å±‚å…·æœ‰å¾ªç¯è¿æ¥ï¼Œå³å¤šäº†ä¸€ä¸ªéšè—å±‚åˆ°éšè—å±‚çš„æƒé‡çŸ©é˜µå‚ä¸è®¡ç®— ï¼Œä½¿å¾—æ¯ä¸ªéšè—çŠ¶æ€ä¾èµ–äºå‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€å’Œå½“å‰æ—¶é—´æ­¥çš„è¾“å…¥ã€‚å…¬å¼å¦‚ä¸‹ï¼š<br>$h_tâ€‹=f(W_{hh}â€‹h_{tâˆ’1}â€‹+W_{xhâ€‹}x_tâ€‹+b_hâ€‹)$</p><ul><li>$h_tâ€‹$ï¼šå½“å‰æ—¶é—´æ­¥çš„éšè—çŠ¶æ€</li><li>$h_{t-1}$ï¼šå‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€</li><li>$x_t$â€‹ï¼šå½“å‰æ—¶é—´æ­¥çš„è¾“å…¥</li><li>$W_{hh}$â€‹ï¼šéšè—çŠ¶æ€åˆ°éšè—çŠ¶æ€çš„æƒé‡çŸ©é˜µ</li><li>$W_{xh}$ï¼šè¾“å…¥åˆ°éšè—çŠ¶æ€çš„æƒé‡çŸ©é˜µ</li><li>$b_h$â€‹ï¼šåç½®</li><li>$f$ï¼šæ¿€æ´»å‡½æ•°ï¼ˆå¦‚tanhæˆ–ReLUï¼‰</li></ul><p>ä»ä¸Šé¢æ–‡ç« ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ ä¸è®ºè®¡ç®—è¿‡ç¨‹åœ¨å¤æ‚ï¼Œéƒ½æ˜¯è¦æ ¹æ®è¾“å…¥æ±‚è¾“å‡ºã€‚ã€‚ è€Œåœ¨LSTM ä¸­ï¼Œ å¤æ‚çš„ç‚¹åœ¨äºã€‚éšè—å±‚çš„è®¡ç®—ç”±ç®€å•çš„éšè—å±‚-éšè—å±‚æƒé‡çŸ©é˜µå‚ä¸è®¡ç®— æ‹†åˆ†æˆäº†å¤šä¸ªæ­¥éª¤</p><h2 id="lstm"><a href="#LSTM" class="headerlink" title="LSTM"></a>LSTM</h2><h3 id="1-é—å¿˜é—¨forget-gate"><a href="#1-é—å¿˜é—¨ï¼ˆForget-Gateï¼‰" class="headerlink" title="1. é—å¿˜é—¨ï¼ˆForget Gateï¼‰"></a>1. é—å¿˜é—¨ï¼ˆForget Gateï¼‰</h3><p>é—å¿˜é—¨æ§åˆ¶å•å…ƒçŠ¶æ€ä¸­å“ªäº›ä¿¡æ¯éœ€è¦è¢«ä¿ç•™æˆ–ä¸¢å¼ƒã€‚é—å¿˜é—¨æ¥æ”¶å½“å‰æ—¶é—´æ­¥çš„è¾“å…¥ $x_t$å’Œå‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ $h_{t-1}$ï¼Œé€šè¿‡ä¸€ä¸ª$Sigmoid$å‡½æ•°è®¡ç®—å¾—åˆ°ä¸€ä¸ªä»‹äº0å’Œ1ä¹‹é—´çš„æ ‡é‡ï¼ˆæˆ–å‘é‡ï¼‰ï¼Œç”¨äºç¼©æ”¾å‰ä¸€æ—¶é—´æ­¥çš„ç»†èƒçŠ¶æ€ã€‚</p><p>å…¬å¼å¦‚ä¸‹ï¼š $f_t = \sigma(W_f \cdot [h_{t-1}, x_t] + b_f)$<br>å¦‚æœæŠŠå±‚çº§å…³ç³»ä¹Ÿåœ¨å…¬å¼ä¸­ä½“ç°å‡ºæ¥ï¼Œè¯¥å…¬å¼å¯ä»¥ç»†åŒ–æˆå¦‚ä¸‹æ ¼å¼ï¼š<br>$f_t^l = \sigma(W_f \cdot [h_{t-1}^l, x_t^{l-1}] + b_f)$</p><p>å…¶ä¸­ $x$  ä¹Ÿå¯ä»¥æ›¿æ¢æˆå…¶ä»–å˜é‡ï¼Œåªè¦æ˜¯ä»£è¡¨å½“å‰æ—¶é—´æ­¥çš„è¾“å…¥å³å¯ã€‚<br>ä¾‹å¦‚åœ¨ <a href="https://arxiv.org/pdf/1409.2329">RECURRENT NEURAL NETWORK REGULARIZATION</a>   è¯¥å…¬å¼å°±è¡¨ç¤ºæˆäº† $f_t^l = \sigma(W_f \cdot [h_{t-1}^l, h_t^{l-1}] + b_f)$</p><ul><li>$[h_t, x_{t-1}]$æˆ–è€…$[h_t^{l-1}, h_{t-1}^l]$è¡¨ç¤ºå°†å½“å‰è¾“å…¥å’Œå‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€å‘é‡æ‹¼æ¥æˆä¸€ä¸ªå‘é‡ã€‚</li><li>$W_fâ€‹$ æ˜¯è¯¥é—å¿˜é—¨çš„æƒé‡çŸ©é˜µã€‚</li><li>$b_f$â€‹ æ˜¯åç½®å‘é‡ã€‚</li><li>$\sigma$ æ˜¯$sigmoid$ éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼Œè¾“å‡ºèŒƒå›´åœ¨0åˆ°1ä¹‹é—´ã€‚</li></ul><h3 id="2-è¾“å…¥é—¨input-gate"><a href="#2-è¾“å…¥é—¨ï¼ˆInput-Gateï¼‰" class="headerlink" title="2. è¾“å…¥é—¨ï¼ˆInput Gateï¼‰"></a>2. è¾“å…¥é—¨ï¼ˆInput Gateï¼‰</h3><p>è¾“å…¥é—¨æ§åˆ¶æ–°ä¿¡æ¯å†™å…¥å•å…ƒçŠ¶æ€çš„è¿‡ç¨‹ã€‚è¾“å…¥é—¨åŒæ ·æ¥æ”¶å½“å‰æ—¶é—´æ­¥çš„è¾“å…¥ $x_t$å’Œå‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ $h_{t-1}$ï¼Œå¹¶é€šè¿‡Sigmoidå‡½æ•°ç”Ÿæˆä¸€ä¸ªä»‹äº0å’Œ1ä¹‹é—´çš„æ ‡é‡ï¼Œè¡¨ç¤ºå…è®¸å¤šå°‘æ–°ä¿¡æ¯è¿›å…¥ç»†èƒçŠ¶æ€ã€‚0è¡¨ç¤ºå®Œå…¨ä¸å…è®¸æ–°ä¿¡æ¯è¿›å…¥ï¼Œ1è¡¨ç¤ºå®Œå…¨å…è®¸æ–°ä¿¡æ¯è¿›å…¥ã€‚<br>$tanh$å±‚ç”Ÿæˆå€™é€‰å•å…ƒçŠ¶æ€ã€‚</p><p>å…¬å¼å¦‚ä¸‹ï¼š<br>$i_t = \sigma(W_i \cdot [h_{t-1}, x_t] + b_i)$</p><p>$\tilde{C}_t = \tanh(W_C \cdot [h_{t-1}, x_t] + b_C)$</p><p>$W_iâ€‹$ï¼šè¾“å…¥é—¨çš„æƒé‡çŸ©é˜µï¼Œç”¨äºå°†å‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€å’Œå½“å‰æ—¶é—´æ­¥çš„è¾“å…¥è¿›è¡Œçº¿æ€§å˜æ¢ã€‚<br>$W_Câ€‹$ï¼šå€™é€‰ç»†èƒçŠ¶æ€çš„æƒé‡çŸ©é˜µï¼Œç”¨äºå°†å‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€å’Œå½“å‰æ—¶é—´æ­¥çš„è¾“å…¥è¿›è¡Œçº¿æ€§å˜æ¢ã€‚</p><h3 id="3-å•å…ƒçŠ¶æ€cell-state"><a href="#3-å•å…ƒçŠ¶æ€ï¼ˆCell-Stateï¼‰" class="headerlink" title="3. å•å…ƒçŠ¶æ€ï¼ˆCell Stateï¼‰"></a>3. å•å…ƒçŠ¶æ€ï¼ˆCell Stateï¼‰</h3><p>å•å…ƒçŠ¶æ€ $C_t$â€‹ æ˜¯LSTMå•å…ƒå†…éƒ¨çš„é•¿æœŸè®°å¿†ï¼Œå®ƒåœ¨æ—¶é—´æ­¥ä¹‹é—´å‡ ä¹ç›´æ¥ä¼ é€’ï¼Œé€šè¿‡é—å¿˜é—¨å’Œè¾“å…¥é—¨çš„è°ƒèŠ‚è¿›è¡Œæ›´æ–°ã€‚æ–°çš„å•å…ƒçŠ¶æ€ç”±å‰ä¸€æ—¶é—´æ­¥çš„å•å…ƒçŠ¶æ€ä¹˜ä»¥é—å¿˜é—¨çš„è¾“å‡ºåŠ ä¸Šè¾“å…¥é—¨è¾“å‡ºå’Œå€™é€‰å€¼çš„ä¹˜ç§¯å¾—åˆ°ã€‚</p><p>å…¬å¼å¦‚ä¸‹ï¼š$C_t = f_t \cdot C_{t-1} + i_t \cdot \tilde{C}_t$</p><h3 id="4-è¾“å‡ºé—¨output-gate-å¾—åˆ°éšè—çŠ¶æ€"><a href="#4-è¾“å‡ºé—¨ï¼ˆOutput-Gateï¼‰-å¾—åˆ°éšè—çŠ¶æ€" class="headerlink" title="4. è¾“å‡ºé—¨ï¼ˆOutput Gateï¼‰- å¾—åˆ°éšè—çŠ¶æ€"></a>4. è¾“å‡ºé—¨ï¼ˆOutput Gateï¼‰- å¾—åˆ°éšè—çŠ¶æ€</h3><p>è¾“å‡ºé—¨å†³å®šå“ªäº›ä¿¡æ¯ä»ç»†èƒçŠ¶æ€ä¼ é€’åˆ°éšè—çŠ¶æ€ï¼ˆLSTMå•å…ƒçš„è¾“å‡ºï¼‰ã€‚è¾“å‡ºé—¨é€šè¿‡Sigmoidå‡½æ•°å†³å®šå“ªäº›ä¿¡æ¯å°†è¢«è¾“å‡ºï¼Œå¹¶å°†ç»†èƒçŠ¶æ€é€šè¿‡Tanhå±‚å¤„ç†åä¹˜ä»¥è¯¥è¾“å‡ºã€‚</p><p>å…¬å¼å¦‚ä¸‹ï¼š<br>$o_t = \sigma(W_o \cdot [h_{t-1}, x_t] + b_o)$<br>$h_t = o_t \cdot \tanh(C_t)$</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://colah.github.io/posts/2015-08-Understanding-LSTMs/&quot;&gt;Understanding LSTM Networks&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;recurrent-neural-network</summary>
      
    
    
    
    
    <category term="AI" scheme="http://example.com/tags/AI/"/>
    
    <category term="ç¥ç»ç½‘ç»œ" scheme="http://example.com/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
    
    <category term="Ilya sutskeverâ€˜s 30  papers" scheme="http://example.com/tags/Ilya-sutskever%E2%80%98s-30-papers/"/>
    
  </entry>
  
  <entry>
    <title>RECURRENT NEURAL NETWORK REGULARIZATION</title>
    <link href="http://example.com/7057a5e3/"/>
    <id>http://example.com/7057a5e3/</id>
    <published>2024-06-12T10:10:58.000Z</published>
    <updated>2024-06-16T14:23:22.616Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://arxiv.org/pdf/1409.2329">RECURRENT NEURAL NETWORK REGULARIZATION</a></p><h1 id="abstract-æ‘˜è¦"><a href="#ABSTRACT-æ‘˜è¦" class="headerlink" title="ABSTRACT æ‘˜è¦"></a>ABSTRACT æ‘˜è¦</h1><p>We present a simple regularization technique for Recurrent Neural Networks (RNNs) with Long Short-Term Memory (LSTM) units. Dropout, the most suc- cessful technique for regularizing neural networks, does not work well with RNNs and LSTMs. In this paper, we show how to correctly apply dropout to LSTMs, and show that it substantially reduces overfitting on a variety of tasks. These tasks include language modeling, speech recognition, image caption generation, and machine translation.<br>æˆ‘ä»¬æå‡ºäº†ä¸€ç§ç”¨äºé•¿çŸ­æœŸè®°å¿†ï¼ˆLSTMï¼‰å•å…ƒçš„å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰çš„ç®€å•æ­£åˆ™åŒ–æŠ€æœ¯ã€‚æœ€æˆåŠŸçš„æ­£åˆ™åŒ–ç¥ç»ç½‘ç»œæŠ€æœ¯â€”â€”Dropoutï¼Œåœ¨RNNå’ŒLSTMä¸Šæ•ˆæœä¸å¥½ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•æ­£ç¡®åœ°å°†Dropoutåº”ç”¨äºLSTMï¼Œå¹¶è¯æ˜å®ƒåœ¨å„ç§ä»»åŠ¡ä¸Šæ˜¾è‘—å‡å°‘äº†è¿‡æ‹Ÿåˆã€‚è¿™äº›ä»»åŠ¡åŒ…æ‹¬è¯­è¨€å»ºæ¨¡ã€è¯­éŸ³è¯†åˆ«ã€å›¾åƒæè¿°ç”Ÿæˆå’Œæœºå™¨ç¿»è¯‘ã€‚</p><h1 id="1-introduction-å¼•è¨€"><a href="#1-INTRODUCTION-å¼•è¨€" class="headerlink" title="1 INTRODUCTION  å¼•è¨€"></a>1 INTRODUCTION  å¼•è¨€</h1><p>The Recurrent Neural Network (RNN) is neural sequence model that achieves state of the art per- formance on important tasks that include language modeling Mikolov (2012), speech recognition Graves et al. (2013), and machine translation Kalchbrenner &amp; Blunsom (2013). It is known that successful applications of neural networks require good regularization. Unfortunately, dropout Srivastava (2013), the most powerful regularization method for feedforward neural networks, does not work well with RNNs. As a result, practical applications of RNNs often use models that are too small because large RNNs tend to overfit. Existing regularization methods give relatively small improvements for RNNs Graves (2013). In this work, we show that dropout, when correctly used, greatly reduces overfitting in LSTMs, and evaluate it on three different problems.</p><p>The code for this work can be found in <a href="https://github.com/wojzaremba/lstm">https://github.com/wojzaremba/lstm</a>.</p><p>é€’å½’ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰æ˜¯ä¸€ç§ç¥ç»åºåˆ—æ¨¡å‹ï¼Œå¯åœ¨é‡è¦ä»»åŠ¡ä¸Šå®ç°æœ€å…ˆè¿›çš„æ€§èƒ½ï¼ŒåŒ…æ‹¬è¯­è¨€å»ºæ¨¡Mikolovï¼ˆ2012ï¼‰ï¼Œè¯­éŸ³è¯†åˆ«Gravesç­‰äººï¼ˆ2013ï¼‰å’Œæœºå™¨ç¿»è¯‘Kalchbrenner&amp;Blunsomï¼ˆ2013ï¼‰ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œç¥ç»ç½‘ç»œçš„æˆåŠŸåº”ç”¨éœ€è¦è‰¯å¥½çš„æ­£åˆ™åŒ–ã€‚ä¸å¹¸çš„æ˜¯ï¼Œdropout Srivastava ï¼ˆ2013ï¼‰ æ˜¯å‰é¦ˆç¥ç»ç½‘ç»œæœ€å¼ºå¤§çš„æ­£åˆ™åŒ–æ–¹æ³•ï¼Œä½†ä¸èƒ½å¾ˆå¥½åœ°ç”¨äº RNNã€‚å› æ­¤ï¼ŒRNN çš„å®é™…åº”ç”¨é€šå¸¸ä½¿ç”¨å¤ªå°çš„æ¨¡å‹ï¼Œå› ä¸ºå¤§å‹ RNN å¾€å¾€ä¼šè¿‡åº¦æ‹Ÿåˆã€‚ç°æœ‰çš„æ­£åˆ™åŒ–æ–¹æ³•å¯¹RNNs Gravesï¼ˆ2013ï¼‰è¿›è¡Œäº†ç›¸å¯¹è¾ƒå°çš„æ”¹è¿›ã€‚åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬è¡¨æ˜ï¼Œå¦‚æœæ­£ç¡®ä½¿ç”¨ï¼Œå‹å·®å¯ä»¥å¤§å¤§å‡å°‘LSTMä¸­çš„è¿‡æ‹Ÿåˆï¼Œå¹¶åœ¨ä¸‰ä¸ªä¸åŒçš„é—®é¢˜ä¸Šå¯¹å…¶è¿›è¡Œè¯„ä¼°ã€‚</p><p>æ­¤å·¥ä½œçš„ä»£ç å¯ä»¥åœ¨<a href="https://github.com/wojzaremba/lstm%E6%89%BE%E5%88%B0%E3%80%82">https://github.com/wojzaremba/lstm</a>æ‰¾åˆ°ã€‚</p><h1 id="2-related-work"><a href="#2-RELATED-WORK" class="headerlink" title="2 RELATED WORK"></a>2 RELATED WORK</h1><p>Dropout Srivastava (2013) is a recently introduced regularization method that has been very suc- cessful with feed-forward neural networks. While much work has extended dropout in various ways Wang &amp; Manning (2013); Wan et al. (2013), there has been relatively little research in applying it to RNNs. The only paper on this topic is by Bayer et al. (2013), who focuses on â€œmarginalized dropoutâ€ Wang &amp; Manning (2013), a noiseless deterministic approximation to standard dropout. Bayer et al. (2013) claim that conventional dropout does not work well with RNNs because the re- currence amplifies noise, which in turn hurts learning. In this work, we show that this problem can be fixed by applying dropout to a certain subset of the RNNsâ€™ connections. As a result, RNNs can now also benefit from dropout.<br>Dropout Srivastavaï¼ˆ2013ï¼‰æ˜¯ä¸€ç§æœ€è¿‘å¼•å…¥çš„æ­£åˆ™åŒ–æ–¹æ³•ï¼Œåœ¨å‰é¦ˆç¥ç»ç½‘ç»œä¸­éå¸¸æˆåŠŸã€‚å°½ç®¡å¾ˆå¤šå·¥ä½œä»¥å„ç§æ–¹å¼æ‰©å±•äº†Dropout Wang &amp; Manningï¼ˆ2013ï¼‰ï¼›Wanç­‰ï¼ˆ2013ï¼‰ï¼Œä½†åœ¨RNNä¸Šåº”ç”¨å®ƒçš„ç ”ç©¶ç›¸å¯¹è¾ƒå°‘ã€‚å…³äºè¿™ä¸ªä¸»é¢˜çš„å”¯ä¸€è®ºæ–‡æ˜¯Bayerç­‰äººï¼ˆ2013ï¼‰çš„ï¼Œä»–ä»¬ä¸“æ³¨äºâ€œè¾¹ç¼˜åŒ–Dropoutâ€ Wang &amp; Manningï¼ˆ2013ï¼‰ï¼Œè¿™æ˜¯æ ‡å‡†Dropoutçš„ä¸€ç§æ— å™ªå£°ç¡®å®šæ€§è¿‘ä¼¼ã€‚Bayerç­‰äººï¼ˆ2013ï¼‰è®¤ä¸ºä¼ ç»Ÿçš„Dropoutåœ¨RNNä¸Šæ•ˆæœä¸å¥½ï¼Œå› ä¸ºé€’å½’æ”¾å¤§äº†å™ªå£°ï¼Œè¿›è€Œå½±å“äº†å­¦ä¹ ã€‚åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†é€šè¿‡å°†Dropoutåº”ç”¨äºRNNè¿æ¥çš„æŸä¸ªå­é›†å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å› æ­¤ï¼ŒRNNç°åœ¨ä¹Ÿå¯ä»¥å—ç›ŠäºDropoutã€‚</p><p>Independently of our work, Pham et al. (2013) developed the very same RNN regularization method and applied it to handwriting recognition. We rediscovered this method and demonstrated strong empirical results over a wide range of problems. Other work that applied dropout to LSTMs is Pachitariu &amp; Sahani (2013).<br>ç‹¬ç«‹äºæˆ‘ä»¬çš„å·¥ä½œï¼ŒPhamç­‰äººï¼ˆ2013ï¼‰å¼€å‘äº†å®Œå…¨ç›¸åŒçš„RNNæ­£åˆ™åŒ–æ–¹æ³•å¹¶å°†å…¶åº”ç”¨äºæ‰‹å†™è¯†åˆ«ã€‚æˆ‘ä»¬é‡æ–°å‘ç°äº†è¿™ç§æ–¹æ³•ï¼Œå¹¶åœ¨å¹¿æ³›çš„é—®é¢˜ä¸Šå±•ç¤ºäº†å¼ºå¤§çš„å®è¯ç»“æœã€‚å…¶ä»–å°†Dropoutåº”ç”¨äºLSTMçš„å·¥ä½œåŒ…æ‹¬Pachitariu &amp; Sahaniï¼ˆ2013ï¼‰ã€‚</p><p>There have been a number of architectural variants of the RNN that perform better on problems with long term dependencies Hochreiter &amp; Schmidhuber (1997); Graves et al. (2009); Cho et al. (2014); Jaeger et al. (2007); KoutnÃ­k et al. (2014); Sundermeyer et al. (2012). In this work, we show how to correctly apply dropout to LSTMs, the most commonly-used RNN variant; this way of applying dropout is likely to work well with other RNN architectures as well. In this paper, we consider the following tasks: language modeling, speech recognition, and machine translation. Language modeling is the first task where RNNs have achieved substantial success Mikolov et al. (2010; 2011); Pascanu et al. (2013). RNNs have also been successfully used for speech recognition Robinson et al. (1996); Graves et al. (2013) and have recently been applied to machine translation, where they are used for language modeling, re-ranking, or phrase modeling Devlin et al. (2014); Kalchbrenner &amp; Blunsom (2013); Cho et al. (2014); Chow et al. (1987); Mikolov et al. (2013).<br>å·²ç»æœ‰è®¸å¤šRNNçš„æ¶æ„å˜ä½“åœ¨å¤„ç†é•¿æœŸä¾èµ–é—®é¢˜ä¸Šè¡¨ç°æ›´å¥½ï¼š Hochreiter &amp; Schmidhuber (1997); Gravesç­‰ï¼ˆ2009ï¼‰ï¼›Choç­‰ï¼ˆ2014ï¼‰ï¼›Jaegerç­‰ï¼ˆ2007ï¼‰ï¼›KoutnÃ­kç­‰ï¼ˆ2014ï¼‰ï¼›Sundermeyerç­‰ï¼ˆ2012ï¼‰ã€‚åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•æ­£ç¡®åœ°å°†dropoutåº”ç”¨äºLSTMï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„RNNå˜ä½“ï¼›è¿™ç§åº”ç”¨dropoutçš„æ–¹æ³•ä¹Ÿå¯èƒ½é€‚ç”¨äºå…¶ä»–RNNæ¶æ„ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è€ƒè™‘äº†ä»¥ä¸‹ä»»åŠ¡ï¼šè¯­è¨€å»ºæ¨¡ã€è¯­éŸ³è¯†åˆ«å’Œæœºå™¨ç¿»è¯‘ã€‚è¯­è¨€å»ºæ¨¡æ˜¯RNNé¦–æ¬¡å–å¾—æ˜¾è‘—æˆåŠŸçš„ä»»åŠ¡ Mikolovç­‰ï¼ˆ2010ï¼›2011ï¼‰ï¼›Pascanuç­‰ï¼ˆ2013ï¼‰ã€‚RNNä¹Ÿå·²æˆåŠŸåº”ç”¨äºè¯­éŸ³è¯†åˆ« Robinsonç­‰ï¼ˆ1996ï¼‰ï¼›Gravesç­‰ï¼ˆ2013ï¼‰ï¼Œå¹¶ä¸”æœ€è¿‘è¢«åº”ç”¨äºæœºå™¨ç¿»è¯‘ï¼Œåœ¨é‚£é‡Œå®ƒä»¬è¢«ç”¨äºè¯­è¨€å»ºæ¨¡ã€é‡æ’åºæˆ–çŸ­è¯­å»ºæ¨¡ Devlinç­‰ï¼ˆ2014ï¼‰ï¼›Kalchbrenner &amp; Blunsomï¼ˆ2013ï¼‰ï¼›Choç­‰ï¼ˆ2014ï¼‰ï¼›Chowç­‰ï¼ˆ1987ï¼‰ï¼›Mikolovç­‰ï¼ˆ2013ï¼‰ã€‚</p><h1 id="3-regularizing-rnns-with-lstm-cells-ä½¿ç”¨lstmå•å…ƒå¯¹rnnè¿›è¡Œæ­£åˆ™åŒ–"><a href="#3-REGULARIZING-RNNS-WITH-LSTM-CELLS-ä½¿ç”¨LSTMå•å…ƒå¯¹RNNè¿›è¡Œæ­£åˆ™åŒ–" class="headerlink" title="3 REGULARIZING RNNS WITH LSTM CELLS ä½¿ç”¨LSTMå•å…ƒå¯¹RNNè¿›è¡Œæ­£åˆ™åŒ–"></a>3 REGULARIZING RNNS WITH LSTM CELLS ä½¿ç”¨LSTMå•å…ƒå¯¹RNNè¿›è¡Œæ­£åˆ™åŒ–</h1><p>In this section we describe the deep LSTM (Section 3.1). Next, we show how to regularize them (Section 3.2), and explain why our regularization scheme works.<br>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬æè¿°äº†æ·±åº¦LSTMï¼ˆ3.1èŠ‚ï¼‰ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å±•ç¤ºå¦‚ä½•å¯¹å®ƒä»¬è¿›è¡Œæ­£åˆ™åŒ–ï¼ˆ3.2èŠ‚ï¼‰ï¼Œå¹¶è§£é‡Šæˆ‘ä»¬çš„æ­£åˆ™åŒ–æ–¹æ¡ˆä¸ºä½•æœ‰æ•ˆã€‚</p><p>We let subscripts denote timesteps and superscripts denote layers. All our states are n-dimensional. Let $h_t^l \in \mathbb{R}^n$ be a hidden state in layer$l$ in timestep $t$. Moreover, let $T_{n,m} : \mathbb{R}^n \to \mathbb{R}^m$be an affine transform ($Wx + b$ for some $W$ and $b$). Let $\odot$ be element-wise multiplication and let $h_t^0â€‹$ be an input word vector at timestep $k$. We use the activations $h_t^L$â€‹ to predict $y_t$â€‹, since $L$ is the number of layers in our deep LSTM.<br>æˆ‘ä»¬ç”¨ä¸‹æ ‡è¡¨ç¤ºæ—¶é—´æ­¥é•¿ï¼Œç”¨ä¸Šæ ‡è¡¨ç¤ºå±‚æ¬¡ã€‚æˆ‘ä»¬æ‰€æœ‰çš„çŠ¶æ€éƒ½æ˜¯nç»´çš„ã€‚ä»¤$h_t^l \in \mathbb{R}^n$ ä¸ºæ—¶é—´æ­¥$t$ä¸­å±‚$l$çš„éšè—çŠ¶æ€ã€‚æ­¤å¤–ï¼Œä»¤$T_{n,m} : \mathbb{R}^n \to \mathbb{R}^m$ä¸ºä»¿å°„å˜æ¢ï¼ˆæŸäº›$W$å’Œ$b$,$Wx + b$ï¼‰ã€‚ä»¤$\odot$ä¸ºé€å…ƒç´ ä¹˜æ³•ï¼Œå¹¶ä»¤$h_t^0$â€‹ä¸ºæ—¶é—´æ­¥$k$çš„è¾“å…¥è¯å‘é‡ã€‚æˆ‘ä»¬ä½¿ç”¨æ¿€æ´»å€¼$h_t^L$â€‹æ¥é¢„æµ‹$y_tâ€‹$ï¼Œå› ä¸º$L$æ˜¯æˆ‘ä»¬æ·±åº¦LSTMçš„å±‚æ•°ã€‚</p><h2 id="31-long-short-term-memory-units-é•¿çŸ­æœŸè®°å¿†å•å…ƒ"><a href="#3-1-LONG-SHORT-TERM-MEMORY-UNITS-é•¿çŸ­æœŸè®°å¿†å•å…ƒ" class="headerlink" title="3.1 LONG-SHORT TERM MEMORY UNITS é•¿çŸ­æœŸè®°å¿†å•å…ƒ"></a><strong>3.1 LONG-SHORT TERM MEMORY UNITS</strong> é•¿çŸ­æœŸè®°å¿†å•å…ƒ</h2><p>The RNN dynamics can be described using deterministic transitions from previous to current hidden states. The deterministic state transition is a function<br>RNNçš„åŠ¨æ€å¯ä»¥ç”¨ä»å…ˆå‰éšè—çŠ¶æ€åˆ°å½“å‰éšè—çŠ¶æ€çš„ç¡®å®šæ€§è½¬æ¢æ¥æè¿°ã€‚ç¡®å®šæ€§çŠ¶æ€è½¬æ¢æ˜¯ä¸€ä¸ªå‡½æ•°</p><p>RNN : $h_t^{l-1}â€‹$, $h_{t-1}^l \rightarrow h_t^l$</p><p>For classical RNNs, this function is given by<br>$h_t^l = f(T_{n,n} h_t^{l-1} + T_{n,n} h_{t-1}^l), where f \in \{\text{sigm, tanh}\}$</p><p>The LSTM has complicated dynamics that allow it to easily â€œmemorizeâ€ information for an extended number of timesteps. The â€œlong termâ€ memory is stored in a vector of memory cells $c_t^l \in \mathbb{R}^n$. Although many LSTM architectures that differ in their connectivity structure and activation functions, all LSTM architectures have explicit memory cells for storing information for long periods of time. The LSTM can decide to overwrite the memory cell, retrieve it, or keep it for the next time step. The LSTM architecture used in our experiments is given by the following equations Graves et al. (2013):<br>LSTMå…·æœ‰å¤æ‚çš„åŠ¨æ€ï¼Œå…è®¸å®ƒè½»æ¾åœ°â€œè®°ä½â€å¤šä¸ªæ—¶é—´æ­¥é•¿çš„ä¿¡æ¯ã€‚â€œé•¿æœŸâ€è®°å¿†å­˜å‚¨åœ¨è®°å¿†å•å…ƒå‘é‡$c_t^l \in \mathbb{R}^n$ä¸­ã€‚å°½ç®¡è®¸å¤šLSTMæ¶æ„åœ¨è¿æ¥ç»“æ„å’Œæ¿€æ´»å‡½æ•°ä¸Šæœ‰æ‰€ä¸åŒï¼Œä½†æ‰€æœ‰LSTMæ¶æ„éƒ½æœ‰æ˜ç¡®çš„è®°å¿†å•å…ƒç”¨äºé•¿æ—¶é—´å­˜å‚¨ä¿¡æ¯ã€‚LSTMå¯ä»¥å†³å®šè¦†ç›–è®°å¿†å•å…ƒã€æ£€ç´¢æˆ–è€…åœ¨ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥ä¸­ä¿ç•™å®ƒã€‚æˆ‘ä»¬å®éªŒä¸­ä½¿ç”¨çš„LSTMæ¶æ„ç”±ä»¥ä¸‹æ–¹ç¨‹ç»™å‡º Gravesç­‰ï¼ˆ2013ï¼‰ï¼š</p><p>LSTM : $h_t^{l-1}$, $h_{t-1}^l$, $c_{t-1}^l \rightarrow h_t^l$â€‹, $c_t^l$</p><p>$\left( \begin{array}{c} i \ f \ o \ g \end{array} \right) = \left( \begin{array}{c} \text{sigm} \ \text{sigm} \ \text{sigm} \ \text{tanh} \end{array} \right) T_{2n,4n} \left( \begin{array}{c} h_{t}^{l-1} \ h_{t-1}^{l} \end{array} \right)â€‹$</p><p>$c_t^l = f \odot c_{t-1}^l + i \odot g$</p><p>$h_t^l = o \odot \text{tanh}(c_t^l)$<br>In these equations, sigm and tanh are applied element-wise. Figure 1 illustrates the LSTM equations.<br>åœ¨è¿™äº›æ–¹ç¨‹ä¸­ï¼Œsigmå’Œtanhé€å…ƒç´ åº”ç”¨ã€‚å›¾1å±•ç¤ºäº†LSTMæ–¹ç¨‹</p><h2 id="32-regularization-with-dropout"><a href="#3-2-REGULARIZATION-WITH-DROPOUT" class="headerlink" title="3.2 REGULARIZATION WITH DROPOUT"></a>3.2 REGULARIZATION WITH DROPOUT</h2><p>The main contribution of this paper is a recipe for applying dropout to LSTMs in a way that success-fully reduces overfitting. The main idea is to apply the dropout operator only to the non-recurrent<br>æœ¬æ–‡çš„ä¸»è¦è´¡çŒ®æ˜¯æä¾›äº†ä¸€ç§å°†dropoutåº”ç”¨äºLSTMçš„æ–¹æ³•ï¼Œä»è€ŒæˆåŠŸåœ°å‡å°‘äº†è¿‡æ‹Ÿåˆã€‚ä¸»è¦æ€æƒ³æ˜¯ä»…å°†dropoutæ“ä½œç¬¦åº”ç”¨äºéé€’å½’è¿æ¥ã€‚<br><img src="/7057a5e3/1.png" class><br>Figure 1: A graphical representation of LSTM memory cells used in this paper (there are minor differences in comparison to Graves (2013)).<br>å›¾1ï¼šæœ¬æ–‡ä¸­ä½¿ç”¨çš„LSTMè®°å¿†å•å…ƒçš„å›¾å½¢è¡¨ç¤ºï¼ˆä¸Gravesï¼ˆ2013ï¼‰ç›¸æ¯”æœ‰ç»†å¾®å·®åˆ«ï¼‰ã€‚<br><img src="/7057a5e3/2.png" class></p><p>Figure 2: Regularized multilayer RNN. The dashed arrows indicate connections where dropout is applied, and the solid lines indicate connections where dropout is not applied.<br>å›¾2ï¼šæ­£åˆ™åŒ–çš„å¤šå±‚RNNã€‚è™šçº¿ç®­å¤´è¡¨ç¤ºåº”ç”¨äº†dropoutçš„è¿æ¥ï¼Œå®çº¿è¡¨ç¤ºæœªåº”ç”¨dropoutçš„è¿æ¥ã€‚<br>âš ï¸ï¼š x è¡¨ç¤ºè¾“å…¥å±‚ï¼Œ y è¡¨ç¤ºè¾“å‡ºå±‚</p><p>connections (Figure 2). The following equation describes it more precisely, where D is the dropoutoperator that sets a random subset of its argument to zero:<br>è¿æ¥ï¼ˆå›¾2ï¼‰ã€‚ä»¥ä¸‹æ–¹ç¨‹æ›´å‡†ç¡®åœ°æè¿°äº†è¿™ä¸€ç‚¹ï¼Œå…¶ä¸­ $D$ æ˜¯å°†å…¶å‚æ•°çš„éšæœºå­é›†è®¾ç½®ä¸ºé›¶çš„dropoutæ“ä½œç¬¦ï¼š</p><p>$\left( \begin{array}{c} i \ f \ o \ g \end{array} \right) = \left( \begin{array}{c} \text{sigm} \ \text{sigm} \ \text{sigm} \ \text{tanh} \end{array} \right) T_{2n,4n} \left( \begin{array}{c} {D}(h_{t}^{l-1}) \ h_{t-1}^{l} \end{array} \right)â€‹$</p><p>$c_t^l = f \odot c_{t-1}^l + i \odot g$</p><p>$h_t^l = o \odot \text{tanh}(c_t^l)$</p><p>Our method works as follows. The dropout operator corrupts the information carried by the units,forcing them to perform their intermediate computations more robustly. At the same time, we do not want to erase all the information from the units. It is especially important that the units remember<br>events that occurred many timesteps in the past. Figure 3 shows how information could flow from an event that occurred at timestep t âˆ’ 2 to the prediction in timestep t + 2 in our implementation of dropout. We can see that the information is corrupted by the dropout operator exactly L + 1 times,<br>æˆ‘ä»¬çš„æ–¹æ³•å¦‚ä¸‹ã€‚dropout è¿ç®—ç¬¦ä¼šç ´åå•å…ƒæºå¸¦çš„ä¿¡æ¯ï¼Œè¿«ä½¿å®ƒä»¬æ›´ç¨³å¥åœ°æ‰§è¡Œä¸­é—´è®¡ç®—ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¸æƒ³æŠ¹å»å•å…ƒçš„æ‰€æœ‰ä¿¡æ¯ã€‚ç‰¹åˆ«é‡è¦çš„æ˜¯ï¼Œå•å…ƒéœ€è¦è®°ä½è®¸å¤šæ—¶é—´æ­¥é•¿ä¹‹å‰å‘ç”Ÿçš„äº‹ä»¶ã€‚å›¾3æ˜¾ç¤ºäº†åœ¨æˆ‘ä»¬å®ç°çš„dropoutä¸­ï¼Œä¿¡æ¯å¦‚ä½•ä»æ—¶é—´æ­¥ $t-2$ ä¼ é€’åˆ°æ—¶é—´æ­¥ $t+2$ çš„é¢„æµ‹ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¿¡æ¯æ°å¥½è¢«dropoutæ“ä½œç¬¦ç ´åäº† $L+1$ æ¬¡ã€‚</p><img src="/7057a5e3/3.png" class><p>Figure 3: The thick line shows a typical path of information flow in the LSTM. The information is affected by dropout L + 1 times, where L is depth of network.<br>å›¾ 3ï¼šç²—çº¿æ˜¾ç¤ºäº† LSTM ä¸­ä¿¡æ¯æµçš„å…¸å‹è·¯å¾„ã€‚ä¿¡æ¯å— L + 1 æ¬¡çš„dropoutå½±å“ï¼Œå…¶ä¸­ L æ˜¯ç½‘ç»œæ·±åº¦ã€‚</p><img src="/7057a5e3/4.png" class><p>Figure 4: Some interesting samples drawn from a large regularized model conditioned on â€œThe meaning of life isâ€. We have removed â€œunkâ€, â€œNâ€, â€œ$â€ from the set of permissible words.<br>å›¾4ï¼šä»ä¸€ä¸ªä»¥â€œThe meaning of life isâ€ä¸ºæ¡ä»¶çš„å¤§å‹æ­£åˆ™åŒ–æ¨¡å‹ä¸­æŠ½å–çš„ä¸€äº›æœ‰è¶£æ ·æœ¬ã€‚æˆ‘ä»¬å·²ç»ä»å…è®¸çš„å•è¯é›†ä¸­ç§»é™¤äº†â€œunkâ€ã€â€œNâ€ã€â€œ$â€ã€‚</p><p>and this number is independent of the number of timesteps traversed by the information. Standard dropout perturbs the recurrent connections, which makes it difficult for the LSTM to learn to store information for long periods of time. By not using dropout on the recurrent connections, the LSTM can benefit from dropout regularization without sacrificing its valuable memorization ability.<br>è¿™ä¸ªæ•°å­—ä¸ä¿¡æ¯ç»è¿‡çš„æ—¶é—´æ­¥æ•°æ— å…³ã€‚æ ‡å‡†çš„dropoutä¼šæ‰°ä¹±é€’å½’è¿æ¥ï¼Œè¿™ä½¿å¾—LSTMéš¾ä»¥å­¦ä¹ é•¿æ—¶é—´å­˜å‚¨ä¿¡æ¯ã€‚é€šè¿‡ä¸åœ¨é€’å½’è¿æ¥ä¸Šä½¿ç”¨dropoutï¼ŒLSTMå¯ä»¥ä»dropoutæ­£åˆ™åŒ–ä¸­å—ç›Šï¼Œè€Œä¸ç‰ºç‰²å…¶å®è´µçš„è®°å¿†èƒ½åŠ›ã€‚</p><h1 id="4-experiments-å®éªŒ"><a href="#4-EXPERIMENTS-å®éªŒ" class="headerlink" title="4 EXPERIMENTS   å®éªŒ"></a>4 EXPERIMENTS   å®éªŒ</h1><p>We present results in three domains: language modeling (Section 4.1), speech recognition (Section 4.2), machine translation (Section 4.3), and image caption generation (Section 4.4).<br>æˆ‘ä»¬åœ¨ä¸‰ä¸ªé¢†åŸŸä¸­å±•ç¤ºäº†ç»“æœï¼šè¯­è¨€å»ºæ¨¡ï¼ˆç¬¬4.1èŠ‚ï¼‰ã€è¯­éŸ³è¯†åˆ«ï¼ˆç¬¬4.2èŠ‚ï¼‰ã€æœºå™¨ç¿»è¯‘ï¼ˆç¬¬4.3èŠ‚ï¼‰å’Œå›¾åƒæè¿°ç”Ÿæˆï¼ˆç¬¬4.4èŠ‚ï¼‰ã€‚</p><h2 id="41-language-modeling-è¯­è¨€å»ºæ¨¡"><a href="#4-1-LANGUAGE-MODELING-è¯­è¨€å»ºæ¨¡" class="headerlink" title="4.1 LANGUAGE MODELING   è¯­è¨€å»ºæ¨¡"></a>4.1 LANGUAGE MODELING   è¯­è¨€å»ºæ¨¡</h2><p>We conducted word-level prediction experiments on the Penn Tree Bank (PTB) dataset Marcus et al. (1993), which consists of 929k training words, 73k validation words, and 82k test words. It has 10k words in its vocabulary. We downloaded it from Tomas Mikolovâ€™s webpageâ€ . We trained regularized LSTMs of two sizes; these are denoted the medium LSTM and large LSTM. Both LSTMs have two layers and are unrolled for 35 steps. We initialize the hidden states to zero. We then use the final hidden states of the current minibatch as the initial hidden state of the subsequent minibatch (successive minibatches sequentially traverse the training set). The size of each minibatch is 20.<br>æˆ‘ä»¬åœ¨Penn Tree Bank (PTB)æ•°æ®é›†ä¸Šè¿›è¡Œäº†è¯çº§é¢„æµ‹å®éªŒï¼Œè¯¥æ•°æ®é›†åŒ…æ‹¬92.9ä¸‡ä¸ªè®­ç»ƒè¯ã€7.3ä¸‡ä¸ªéªŒè¯è¯å’Œ8.2ä¸‡ä¸ªæµ‹è¯•è¯ã€‚å…¶è¯æ±‡è¡¨æœ‰1ä¸‡ä¸ªå•è¯ã€‚æˆ‘ä»¬ä»Tomas Mikolovçš„ç½‘é¡µä¸‹è½½äº†è¯¥æ•°æ®é›†ã€‚æˆ‘ä»¬è®­ç»ƒäº†ä¸¤ç§è§„æ¨¡çš„æ­£åˆ™åŒ–LSTMï¼›å®ƒä»¬åˆ†åˆ«è¢«ç§°ä¸ºä¸­å‹LSTMå’Œå¤§å‹LSTMã€‚ä¸¤ä¸ªLSTMéƒ½æœ‰ä¸¤å±‚ï¼Œå±•å¼€35æ­¥ã€‚æˆ‘ä»¬å°†éšè—çŠ¶æ€åˆå§‹åŒ–ä¸ºé›¶ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨å½“å‰å°æ‰¹é‡çš„æœ€ç»ˆéšè—çŠ¶æ€ä½œä¸ºåç»­å°æ‰¹é‡çš„åˆå§‹éšè—çŠ¶æ€ï¼ˆè¿ç»­çš„å°æ‰¹é‡ä¾æ¬¡éå†è®­ç»ƒé›†ï¼‰ã€‚æ¯ä¸ªå°æ‰¹é‡çš„å¤§å°ä¸º20ã€‚<br><img src="/7057a5e3/5.png" class></p><p>The medium LSTM has 650 units per layer and its parameters are initialized uniformly in [âˆ’0.05, 0.05]. As described earlier, we apply 50% dropout on the non-recurrent connections. We train the LSTM for 39 epochs with a learning rate of 1, and after 6 epochs we decrease it by a factor of 1.2 after each epoch. We clip the norm of the gradients (normalized by minibatch size) at 5. Training this network takes about half a day on an NVIDIA K20 GPU.<br>ä¸­å‹LSTMæ¯å±‚æœ‰650ä¸ªå•å…ƒï¼Œå…¶å‚æ•°åœ¨[âˆ’0.05, 0.05]èŒƒå›´å†…å‡åŒ€åˆå§‹åŒ–ã€‚å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬åœ¨éé€’å½’è¿æ¥ä¸Šåº”ç”¨50%çš„dropoutã€‚æˆ‘ä»¬ç”¨å­¦ä¹ ç‡ä¸º1è®­ç»ƒLSTMå…±39ä¸ªå‘¨æœŸï¼Œåœ¨ç¬¬6ä¸ªå‘¨æœŸåï¼Œæ¯ä¸ªå‘¨æœŸå°†å­¦ä¹ ç‡æŒ‰1.2çš„å› å­é€’å‡ã€‚æˆ‘ä»¬å°†æ¢¯åº¦çš„èŒƒæ•°ï¼ˆæŒ‰å°æ‰¹é‡å¤§å°å½’ä¸€åŒ–ï¼‰å‰ªè£åˆ°5ã€‚è®­ç»ƒè¯¥ç½‘ç»œåœ¨NVIDIA K20 GPUä¸Šå¤§çº¦éœ€è¦åŠå¤©æ—¶é—´ã€‚</p><p>The large LSTM has 1500 units per layer and its parameters are initialized uniformly in [âˆ’0.04, 0.04]. We apply 65% dropout on the non-recurrent connections. We train the model for 55 epochs with a learning rate of 1; after 14 epochs we start to reduce the learning rate by a factor of 1.15 after each epoch. We clip the norm of the gradients (normalized by minibatch size) at 10 Mikolov et al. (2010). Training this network takes an entire day on an NVIDIA K20 GPU.<br>å¤§å‹LSTMæ¯å±‚æœ‰1500ä¸ªå•å…ƒï¼Œå…¶å‚æ•°åœ¨[âˆ’0.04, 0.04]èŒƒå›´å†…å‡åŒ€åˆå§‹åŒ–ã€‚æˆ‘ä»¬åœ¨éé€’å½’è¿æ¥ä¸Šåº”ç”¨65%çš„dropoutã€‚æˆ‘ä»¬ç”¨å­¦ä¹ ç‡ä¸º1è®­ç»ƒæ¨¡å‹å…±55ä¸ªå‘¨æœŸï¼›åœ¨ç¬¬14ä¸ªå‘¨æœŸåï¼Œæ¯ä¸ªå‘¨æœŸå¼€å§‹æŒ‰1.15çš„å› å­é€’å‡å­¦ä¹ ç‡ã€‚æˆ‘ä»¬å°†æ¢¯åº¦çš„èŒƒæ•°ï¼ˆæŒ‰å°æ‰¹é‡å¤§å°å½’ä¸€åŒ–ï¼‰å‰ªè£åˆ°10 Mikolovç­‰ï¼ˆ2010ï¼‰ã€‚è®­ç»ƒè¯¥ç½‘ç»œåœ¨NVIDIA K20 GPUä¸Šéœ€è¦æ•´æ•´ä¸€å¤©æ—¶é—´ã€‚</p><p>For comparison, we trained a non-regularized network. We optimized its parameters to get the best validation performance. The lack of regularization effectively constrains size of the network, forcing us to use small network because larger networks overfit. Our best performing non-regularized LSTM has two hidden layers with 200 units per layer, and its weights are initialized uniformly in [âˆ’0.1, 0.1]. We train it for 4 epochs with a learning rate of 1 and then we decrease the learning rate by a factor of 2 after each epoch, for a total of 13 training epochs. The size of each minibatch is 20, and we unroll the network for 20 steps. Training this network takes 2-3 hours on an NVIDIA K20 GPU.<br>ä¸ºäº†æ¯”è¾ƒï¼Œæˆ‘ä»¬è®­ç»ƒäº†ä¸€ä¸ªæœªæ­£åˆ™åŒ–çš„ç½‘ç»œã€‚æˆ‘ä»¬ä¼˜åŒ–å…¶å‚æ•°ä»¥è·å¾—æœ€ä½³éªŒè¯æ€§èƒ½ã€‚ç¼ºä¹æ­£åˆ™åŒ–æœ‰æ•ˆåœ°é™åˆ¶äº†ç½‘ç»œçš„å¤§å°ï¼Œè¿«ä½¿æˆ‘ä»¬ä½¿ç”¨å°å‹ç½‘ç»œï¼Œå› ä¸ºè¾ƒå¤§çš„ç½‘ç»œä¼šè¿‡æ‹Ÿåˆã€‚æˆ‘ä»¬è¡¨ç°æœ€å¥½çš„æœªæ­£åˆ™åŒ–LSTMæœ‰ä¸¤å±‚éšè—å±‚ï¼Œæ¯å±‚200ä¸ªå•å…ƒï¼Œå…¶æƒé‡åœ¨[âˆ’0.1, 0.1]èŒƒå›´å†…å‡åŒ€åˆå§‹åŒ–ã€‚æˆ‘ä»¬ç”¨å­¦ä¹ ç‡ä¸º1è®­ç»ƒäº†4ä¸ªå‘¨æœŸï¼Œç„¶åæ¯ä¸ªå‘¨æœŸå°†å­¦ä¹ ç‡æŒ‰2çš„å› å­é€’å‡ï¼Œæ€»å…±è®­ç»ƒ13ä¸ªå‘¨æœŸã€‚æ¯ä¸ªå°æ‰¹é‡çš„å¤§å°ä¸º20ï¼Œæˆ‘ä»¬å±•å¼€ç½‘ç»œ20æ­¥ã€‚è®­ç»ƒè¯¥ç½‘ç»œåœ¨NVIDIA K20 GPUä¸Šéœ€è¦2-3å°æ—¶ã€‚</p><p>Table 1 compares previous results with our LSTMs, and Figure 4 shows samples drawn from a single large regularized LSTM.<br>è¡¨1æ¯”è¾ƒäº†ä»¥å‰çš„ç»“æœå’Œæˆ‘ä»¬çš„LSTMï¼Œå›¾4æ˜¾ç¤ºäº†ä»å•ä¸ªå¤§å‹æ­£åˆ™åŒ–LSTMä¸­æŠ½å–çš„æ ·æœ¬ã€‚</p><h2 id="42-speech-recognition-è¯­éŸ³è¯†åˆ«"><a href="#4-2-SPEECH-RECOGNITION-è¯­éŸ³è¯†åˆ«" class="headerlink" title="4.2 SPEECH RECOGNITION   è¯­éŸ³è¯†åˆ«"></a>4.2 SPEECH RECOGNITION   è¯­éŸ³è¯†åˆ«</h2><p>Deep Neural Networks have been used for acoustic modeling for over half a century (see Bourlard &amp; Morgan (1993) for a good review). Acoustic modeling is a key component in mapping acoustic signals to sequences of words, as it models $p(s_t|X)$ where $s_t$â€‹ is the phonetic state at time $t$ and $X$ is the acoustic observation. Recent work has shown that LSTMs can achieve excellent performance on acoustic modeling Sak et al. (2014), yet relatively small LSTMs (in terms of the number of their parameters) can easily overfit the training set. A useful metric for measuring the performance of acoustic models is frame accuracy, which is measured at each sts_tstâ€‹ for all timesteps ttt. Generally, this metric correlates with the actual metric of interest, the Word Error Rate (WER).<br>æ·±åº¦ç¥ç»ç½‘ç»œå·²ç»è¢«ç”¨äºå£°å­¦å»ºæ¨¡è¶…è¿‡åŠä¸ªä¸–çºªï¼ˆå‚è§Bourlard &amp; Morgan (1993)çš„è‰¯å¥½ç»¼è¿°ï¼‰ã€‚å£°å­¦å»ºæ¨¡æ˜¯å°†å£°å­¦ä¿¡å·æ˜ å°„åˆ°å•è¯åºåˆ—ä¸­çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œå› ä¸ºå®ƒå¯¹p(stâˆ£X)p(s_t|X)p(stâ€‹âˆ£X)å»ºæ¨¡ï¼Œå…¶ä¸­sts_tstâ€‹æ˜¯æ—¶é—´tttçš„è¯­éŸ³çŠ¶æ€ï¼ŒXXXæ˜¯å£°å­¦è§‚æµ‹ã€‚æœ€è¿‘çš„å·¥ä½œè¡¨æ˜ï¼ŒLSTMåœ¨å£°å­¦å»ºæ¨¡ä¸Šå¯ä»¥å–å¾—ä¼˜å¼‚çš„æ€§èƒ½ Sakç­‰ï¼ˆ2014ï¼‰ï¼Œä½†ç›¸å¯¹è¾ƒå°çš„LSTMï¼ˆå°±å‚æ•°æ•°é‡è€Œè¨€ï¼‰å¾ˆå®¹æ˜“å¯¹è®­ç»ƒé›†è¿‡æ‹Ÿåˆã€‚è¡¡é‡å£°å­¦æ¨¡å‹æ€§èƒ½çš„ä¸€ä¸ªæœ‰ç”¨æŒ‡æ ‡æ˜¯å¸§å‡†ç¡®ç‡ï¼Œå®ƒåœ¨æ‰€æœ‰æ—¶é—´æ­¥é•¿tttå¤„æµ‹é‡æ¯ä¸ªsts_tstâ€‹çš„å‡†ç¡®ç‡ã€‚é€šå¸¸ï¼Œè¿™ä¸ªæŒ‡æ ‡ä¸å®é™…æ„Ÿå…´è¶£çš„æŒ‡æ ‡ï¼Œå³å•è¯é”™è¯¯ç‡ï¼ˆWERï¼‰ç›¸å…³ã€‚</p><img src="/7057a5e3/6.png" class><p>Since computing the WER involves using a language model and tuning the decoding parameters for every change in the acoustic model, we decided to focus on frame accuracy in these experiments. Table 2 shows that dropout improves the frame accuracy of the LSTM. Not surprisingly, the training frame accuracy drops due to the noise added during training, but as is often the case with dropout, this yields models that generalize better to unseen data. Note that the test set is easier than the training set, as its accuracy is higher. We report the performance of an LSTM on an internal Google Icelandic Speech dataset, which is relatively small (93k utterances), so overfitting is a great concern.<br>ç”±äºè®¡ç®—WERæ¶‰åŠä½¿ç”¨è¯­è¨€æ¨¡å‹å¹¶è°ƒæ•´å£°å­¦æ¨¡å‹æ¯æ¬¡å˜åŒ–çš„è§£ç å‚æ•°ï¼Œæˆ‘ä»¬å†³å®šåœ¨è¿™äº›å®éªŒä¸­ä¸“æ³¨äºå¸§å‡†ç¡®ç‡ã€‚è¡¨2æ˜¾ç¤ºäº†dropoutæé«˜äº†LSTMçš„å¸§å‡†ç¡®ç‡ã€‚ä¸å‡ºæ‰€æ–™ï¼Œç”±äºè®­ç»ƒè¿‡ç¨‹ä¸­åŠ å…¥çš„å™ªå£°ï¼Œè®­ç»ƒå¸§å‡†ç¡®ç‡ä¸‹é™äº†ï¼Œä½†ä¸dropoutç»å¸¸å‡ºç°çš„æƒ…å†µä¸€æ ·ï¼Œè¿™ä½¿å¾—æ¨¡å‹åœ¨æœªè§æ•°æ®ä¸Šçš„æ³›åŒ–èƒ½åŠ›æ›´å¼ºã€‚è¯·æ³¨æ„ï¼Œæµ‹è¯•é›†æ¯”è®­ç»ƒé›†æ›´å®¹æ˜“ï¼Œå› ä¸ºå®ƒçš„å‡†ç¡®ç‡æ›´é«˜ã€‚æˆ‘ä»¬æŠ¥å‘Šäº†LSTMåœ¨Googleå†…éƒ¨å†°å²›è¯­è¯­éŸ³æ•°æ®é›†ä¸Šçš„æ€§èƒ½ï¼Œè¯¥æ•°æ®é›†ç›¸å¯¹è¾ƒå°ï¼ˆ93kå¥å­ï¼‰ï¼Œå› æ­¤è¿‡æ‹Ÿåˆæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ã€‚</p><h2 id="43-machine-translation-æœºå™¨ç¿»è¯‘"><a href="#4-3-MACHINE-TRANSLATION-æœºå™¨ç¿»è¯‘" class="headerlink" title="4.3 MACHINE TRANSLATION  æœºå™¨ç¿»è¯‘"></a>4.3 MACHINE TRANSLATION  æœºå™¨ç¿»è¯‘</h2><p>We formulate a machine translation problem as a language modelling task, where an LSTM is trained to assign high probability to a correct translation of a source sentence. Thus, the LSTM is trained on concatenations of source sentences and their translations Sutskever et al. (2014) (see also Cho et al. (2014)). We compute a translation by approximating the most probable sequence of words using a simple beam search with a beam of size 12. We ran an LSTM on the WMTâ€™14 English to French dataset, on the â€œselectedâ€ subset from Schwenk (2014) which has 340M French words and 304M English words. Our LSTM has 4 hidden layers, and both its layers and word embeddings have 1000 units. Its English vocabulary has 160,000 words and its French vocabulary has 80,000 words. The optimal dropout probability was 0.2. Table 3 shows the performance of an LSTM trained with and without dropout. While our LSTM does not beat the phrase-based LIUM SMT system Schwenk et al. (2011), our results show that dropout improves the translation performance of the LSTM.<br>æˆ‘ä»¬å°†æœºå™¨ç¿»è¯‘é—®é¢˜è¡¨è¿°ä¸ºä¸€ä¸ªè¯­è¨€å»ºæ¨¡ä»»åŠ¡ï¼Œå…¶ä¸­LSTMè¢«è®­ç»ƒä¸ºå¯¹æºå¥å­çš„æ­£ç¡®ç¿»è¯‘èµ‹äºˆé«˜æ¦‚ç‡ã€‚å› æ­¤ï¼ŒLSTMåœ¨æºå¥å­åŠå…¶ç¿»è¯‘çš„ä¸²è”ä¸Šè¿›è¡Œè®­ç»ƒ Sutskeverç­‰ï¼ˆ2014ï¼‰ï¼ˆå¦è§Choç­‰ï¼ˆ2014ï¼‰ï¼‰ã€‚æˆ‘ä»¬é€šè¿‡ä½¿ç”¨å¤§å°ä¸º12çš„ç®€å•æŸæœç´¢æ¥è¿‘ä¼¼æœ€å¯èƒ½çš„å•è¯åºåˆ—æ¥è®¡ç®—ç¿»è¯‘ã€‚æˆ‘ä»¬åœ¨WMTâ€™14è‹±æ³•æ•°æ®é›†ä¸Šçš„â€œselectedâ€å­é›†ï¼ˆæ¥è‡ªSchwenkï¼ˆ2014ï¼‰ï¼ŒåŒ…å«3.4äº¿ä¸ªæ³•è¯­å•è¯å’Œ3.04äº¿ä¸ªè‹±è¯­å•è¯ï¼‰ä¸Šè¿è¡Œäº†ä¸€ä¸ªLSTMã€‚æˆ‘ä»¬çš„LSTMæœ‰4ä¸ªéšè—å±‚ï¼Œå…¶å±‚å’Œè¯åµŒå…¥éƒ½æœ‰1000ä¸ªå•å…ƒã€‚å®ƒçš„è‹±è¯­è¯æ±‡é‡æœ‰160,000ä¸ªå•è¯ï¼Œæ³•è¯­è¯æ±‡é‡æœ‰80,000ä¸ªå•è¯ã€‚æœ€ä½³çš„dropoutæ¦‚ç‡æ˜¯0.2ã€‚è¡¨3æ˜¾ç¤ºäº†ä½¿ç”¨å’Œä¸ä½¿ç”¨dropoutè®­ç»ƒçš„LSTMçš„æ€§èƒ½ã€‚è™½ç„¶æˆ‘ä»¬çš„LSTMæ²¡æœ‰å‡»è´¥åŸºäºçŸ­è¯­çš„LIUM SMTç³»ç»Ÿ Schwenkç­‰ï¼ˆ2011ï¼‰ï¼Œä½†æˆ‘ä»¬çš„ç»“æœè¡¨æ˜dropoutæé«˜äº†LSTMçš„ç¿»è¯‘æ€§èƒ½ã€‚</p><h2 id="44-image-caption-generationå›¾åƒæè¿°ç”Ÿæˆ"><a href="#4-4-IMAGE-CAPTION-GENERATIONå›¾åƒæè¿°ç”Ÿæˆ" class="headerlink" title="4.4 IMAGE CAPTION GENERATIONå›¾åƒæè¿°ç”Ÿæˆ"></a>4.4 IMAGE CAPTION GENERATIONå›¾åƒæè¿°ç”Ÿæˆ</h2><p>We applied the dropout variant to the image caption generation model of Vinyals et al. (2014). The image caption generation is similar to the sequence-to-sequence model of Sutskever et al. (2014), but where the input image is mapped onto a vector with a highly-accurate pre-trained convolutional neural network (Szegedy et al., 2014), which is converted into a caption with a single-layer LSTM (see Vinyals et al. (2014) for the details on the architecture). We test our dropout scheme on LSTM as the convolutional neural network is not trained on the image caption dataset because it is not large (MSCOCO (Lin et al., 2014)).<br>æˆ‘ä»¬å°†dropoutå˜ä½“åº”ç”¨äºVinyalsç­‰äººï¼ˆ2014ï¼‰çš„å›¾åƒæè¿°ç”Ÿæˆæ¨¡å‹ã€‚å›¾åƒæè¿°ç”Ÿæˆç±»ä¼¼äºSutskeverç­‰äººï¼ˆ2014ï¼‰çš„åºåˆ—åˆ°åºåˆ—æ¨¡å‹ï¼Œä½†è¾“å…¥å›¾åƒè¢«æ˜ å°„åˆ°ä¸€ä¸ªå…·æœ‰é«˜ç²¾åº¦çš„é¢„è®­ç»ƒå·ç§¯ç¥ç»ç½‘ç»œï¼ˆSzegedyç­‰äººï¼Œ2014ï¼‰çš„å‘é‡ï¼Œè¯¥å‘é‡é€šè¿‡å•å±‚LSTMè½¬æ¢ä¸ºæè¿°ï¼ˆæœ‰å…³æ¶æ„çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§Vinyalsç­‰äººï¼Œ2014ï¼‰ã€‚æˆ‘ä»¬åœ¨LSTMä¸Šæµ‹è¯•äº†æˆ‘ä»¬çš„dropoutæ–¹æ¡ˆï¼Œå› ä¸ºå·ç§¯ç¥ç»ç½‘ç»œå¹¶æœªåœ¨å›¾åƒæè¿°æ•°æ®é›†ä¸Šè¿›è¡Œè®­ç»ƒï¼Œå› ä¸ºå®ƒä¸æ˜¯å¾ˆå¤§ï¼ˆMSCOCOï¼ˆLinç­‰äººï¼Œ2014ï¼‰ï¼‰ã€‚</p><p>Our results are summarized in the following Table 4. In brief, dropout helps relative to not using dropout, but using an ensemble eliminates the gains attained by dropout. Thus, in this setting, the main effect of dropout is to produce a single model that is as good as an ensemble, which is a reasonable improvement given the simplicity of the technique.<br>æˆ‘ä»¬çš„ç»“æœæ€»ç»“åœ¨ä»¥ä¸‹è¡¨4ä¸­ã€‚ç®€è€Œè¨€ä¹‹ï¼Œdropoutç›¸å¯¹äºä¸ä½¿ç”¨dropoutæœ‰å¸®åŠ©ï¼Œä½†ä½¿ç”¨é›†æˆæ–¹æ³•æ¶ˆé™¤äº†é€šè¿‡dropoutè·å¾—çš„æ”¶ç›Šã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œdropoutçš„ä¸»è¦ä½œç”¨æ˜¯äº§ç”Ÿä¸€ä¸ªä¸é›†æˆä¸€æ ·å¥½çš„å•ä¸€æ¨¡å‹ï¼Œè€ƒè™‘åˆ°è¯¥æŠ€æœ¯çš„ç®€å•æ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆç†çš„æ”¹è¿›ã€‚</p><h1 id="5-conclusion"><a href="#5-CONCLUSION" class="headerlink" title="5 CONCLUSION"></a>5 CONCLUSION</h1><p>We presented a simple way of applying dropout to LSTMs that results in large performance increases on several problems in different domains. Our work makes dropout useful for RNNs, and our results suggest that our implementation of dropout could improve performance on a wide variety of applications.<br>æˆ‘ä»¬æå‡ºäº†ä¸€ç§å°†dropoutåº”ç”¨äºLSTMçš„ç®€å•æ–¹æ³•ï¼Œè¿™åœ¨ä¸åŒé¢†åŸŸçš„å‡ ä¸ªé—®é¢˜ä¸Šå¯¼è‡´äº†æ€§èƒ½çš„å¤§å¹…æå‡ã€‚æˆ‘ä»¬çš„å·¥ä½œä½¿dropoutå¯¹RNNæœ‰ç”¨ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„ç»“æœè¡¨æ˜ï¼Œæˆ‘ä»¬å®ç°çš„dropoutå¯ä»¥æé«˜å„ç§åº”ç”¨çš„æ€§èƒ½ã€‚<br><img src="/7057a5e3/7.png" class></p><h1 id="6-acknowledgments"><a href="#6-ACKNOWLEDGMENTS" class="headerlink" title="6 ACKNOWLEDGMENTS"></a>6 ACKNOWLEDGMENTS</h1><p>We wish to acknowledge Tomas Mikolov for useful comments on the first version of the paper.<br>æˆ‘ä»¬å¸Œæœ›æ„Ÿè°¢Tomas Mikolovå¯¹è®ºæ–‡ç¬¬ä¸€ç‰ˆæå‡ºçš„æœ‰ç›Šæ„è§ã€‚</p><h1 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h1><h2 id="1-å…ƒç´ ä¹˜æ³•"><a href="#1-å…ƒç´ ä¹˜æ³•" class="headerlink" title="1. å…ƒç´ ä¹˜æ³•"></a>1. å…ƒç´ ä¹˜æ³•</h2><p><strong>å…ƒç´ ä¹˜æ³•</strong>ï¼ˆElement-wise multiplicationï¼‰ï¼Œä¹Ÿç§°ä¸ºHadamardä¹˜ç§¯ï¼ˆHadamard productï¼‰ï¼Œæ˜¯å¯¹ä¸¤ä¸ªåŒå½¢çŸ©é˜µæˆ–å‘é‡çš„å¯¹åº”å…ƒç´ è¿›è¡Œé€ä¸€ç›¸ä¹˜çš„æ“ä½œï¼Œå¹¿æ³›åº”ç”¨äºå„ç§çº¿æ€§ä»£æ•°å’Œç¥ç»ç½‘ç»œè®¡ç®—ä¸­ã€‚ ç”¨ç¬¦å·â€œâŠ™â€è¡¨ç¤ºã€‚</p><h3 id="å…¬å¼è¡¨ç¤º"><a href="#å…¬å¼è¡¨ç¤º" class="headerlink" title="å…¬å¼è¡¨ç¤º"></a>å…¬å¼è¡¨ç¤º</h3><p>ç»™å®šä¸¤ä¸ªç›¸åŒå¤§å°çš„çŸ©é˜µæˆ–å‘é‡ $A$ å’Œ $B$ï¼Œå…¶å…ƒç´ ä¹˜æ³• $C$ è®¡ç®—å¦‚ä¸‹ï¼š<br>$C = A \odot B$</p><p>å…¶ä¸­ï¼š</p><ul><li>$A = [a_1, a_2, â€¦, a_n]$</li><li>$B = [b_1, b_2, â€¦, b_n]$</li><li>$C = [c_1, c_2, â€¦, c_n]$</li><li>$c_i = a_i \cdot b_i$<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3></li></ul><p>å‡è®¾æœ‰ä¸¤ä¸ªå‘é‡ $A$ å’Œ $B$ï¼š</p><p>$A=[1,2,3]$<br>$B=[4,5,6]$</p><p>å®ƒä»¬çš„å…ƒç´ ä¹˜æ³• $C$ ä¸ºï¼š<br>$C = A \odot B = [1 \cdot 4, 2 \cdot 5, 3 \cdot 6] = [4, 10, 18]$</p><h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><ol><li><strong>ç¥ç»ç½‘ç»œä¸­çš„LSTM</strong>ï¼š<ul><li>ç”¨äºæ›´æ–°å•å…ƒçŠ¶æ€ï¼Œå¦‚å…¬å¼ $c_t = f \odot c_{t-1} + i \odot \tilde{c}_t$ä¸­ã€‚</li></ul></li><li><strong>å›¾åƒå¤„ç†</strong>ï¼š<ul><li>ç”¨äºå›¾åƒæ»¤æ³¢ï¼Œå°†æ»¤æ³¢å™¨åº”ç”¨äºå›¾åƒçš„æ¯ä¸ªåƒç´ ã€‚</li></ul></li><li><strong>æ•°æ®å¤„ç†</strong>ï¼š<ul><li>åœ¨æ•°æ®é¢„å¤„ç†ä¸­ï¼Œç”¨äºæŒ‰å…ƒç´ ç¼©æ”¾æˆ–è°ƒæ•´æ•°æ®ã€‚</li></ul></li></ol><h2 id="2-å…¬å¼æ‹†è§£rnn"><a href="#2-å…¬å¼æ‹†è§£-RNN" class="headerlink" title="2. å…¬å¼æ‹†è§£:RNN"></a>2. å…¬å¼æ‹†è§£:RNN</h2><p>RNN : $h_t^{l-1}â€‹$, $h_{t-1}^l \rightarrow h_t^l$</p><p>è¡¨æ˜åœ¨RNNä¸­ï¼Œ éšè—çŠ¶æ€çš„è®¡ç®—ç»“æœä¾èµ–äºå½“å‰æ—¶é—´æ­¥çš„è¾“å…¥ $h_t$å’Œå‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ $h_{t-1}$ã€‚ å†ç»†åŒ–ä¸€ç‚¹ï¼Œ</p><ol><li>å½“å‰æ—¶é—´æ­¥çš„è¾“å…¥ $h_t$ åº”è¯¥æ¥æºäºä¸Šä¸€å±‚ï¼Œæ‰€ä»¥æ˜¯ $h_t^{l-1}â€‹$</li><li>å‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ $h_{t-1}$ ï¼Œåº”è¯¥æ˜¯åŒä¸€å±‚çš„å‰ä¸€ä¸ªæ—¶é—´æ­¥ï¼Œ æ‰€ä»¥æ˜¯$h_{t-1}^l$</li></ol><p>è¯¥çŠ¶æ€è½¬ç§»è¿‡ç¨‹ï¼Œå¦‚æœç”¨å…·ä½“çš„æ•°å­¦å…¬å¼è¡¨ç¤ºï¼Œå¯ä»¥å¦‚ä¸‹æ‰€ç¤º<br>$h_t^l = f(T_{n,n} h_t^{l-1} + T_{n,n} h_{t-1}^l), where f \in \{\text{sigm, tanh}\}$</p><h2 id="3-å…¬å¼æ‹†è§£lstm-çŠ¶æ€æ›´æ–°"><a href="#3-å…¬å¼æ‹†è§£-LSTM-çŠ¶æ€æ›´æ–°" class="headerlink" title="3. å…¬å¼æ‹†è§£:LSTM  çŠ¶æ€æ›´æ–°"></a>3. å…¬å¼æ‹†è§£:LSTM  çŠ¶æ€æ›´æ–°</h2><p>LSTM : $h_t^{l-1}$, $h_{t-1}^l$, $c_{t-1}^l \rightarrow h_t^l$â€‹, $c_t^l$<br>æè¿°äº†LSTMå¦‚ä½•é€šè¿‡å½“å‰å±‚çš„è¾“å…¥å‘é‡ $h_t^{l-1}$ã€å‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ $h_{t-1}^l$å’Œå•å…ƒçŠ¶æ€ $c_{t-1}^l$ æ¥ç”Ÿæˆæ–°çš„éšè—çŠ¶æ€ $h_t^l$ å’Œå•å…ƒçŠ¶æ€ $c_t^l$ã€‚</p><ol><li>$h_t^{l-1}$ï¼šè¡¨ç¤ºç¬¬ $lâˆ’1$ å±‚åœ¨æ—¶é—´æ­¥ $t$ çš„éšè—çŠ¶æ€å‘é‡ã€‚è¿™æ˜¯ç¬¬ $l$ å±‚çš„å½“å‰è¾“å…¥ã€‚</li><li>$h_{t-1}^l$ï¼šè¡¨ç¤ºç¬¬ $l$ å±‚åœ¨æ—¶é—´æ­¥ $tâˆ’1$ çš„éšè—çŠ¶æ€å‘é‡ã€‚è¿™æ˜¯ç¬¬ $l$ å±‚çš„å‰ä¸€ä¸ªæ—¶é—´æ­¥çš„çŠ¶æ€ã€‚</li><li>$c_{t-1}^l$ï¼šè¡¨ç¤ºç¬¬ $l$ å±‚åœ¨æ—¶é—´æ­¥ $tâˆ’1$çš„å•å…ƒçŠ¶æ€å‘é‡ã€‚è¿™æ˜¯ç¬¬ $l$ å±‚çš„å‰ä¸€ä¸ªæ—¶é—´æ­¥çš„å•å…ƒçŠ¶æ€ã€‚</li><li>$h_t^l$ï¼šè¡¨ç¤ºç¬¬ $l$ å±‚åœ¨æ—¶é—´æ­¥ $t$ çš„éšè—çŠ¶æ€å‘é‡ã€‚è¿™æ˜¯ç»è¿‡ç¬¬ $l$ å±‚è®¡ç®—åçš„æ–°çŠ¶æ€ã€‚</li><li>$c_t^l$ï¼šè¡¨ç¤ºç¬¬ $l$ å±‚åœ¨æ—¶é—´æ­¥ $t$ çš„æ–°çš„å•å…ƒçŠ¶æ€å‘é‡ã€‚è¿™æ˜¯æ›´æ–°åçš„å•å…ƒçŠ¶æ€ã€‚</li></ol><p>$\left( \begin{array}{c} i \ f \ o \ g \end{array} \right) = \left( \begin{array}{c} \text{sigm} \ \text{sigm} \ \text{sigm} \ \text{tanh} \end{array} \right) T_{2n,4n} \left( \begin{array}{c} h_{t}^{l-1} \ h_{t-1}^{l} \end{array} \right)â€‹$</p><p>æè¿°äº†è¾“å…¥é—¨ $i$ã€é—å¿˜é—¨ $f$ã€è¾“å‡ºé—¨ $o$ å’Œå€™é€‰è®°å¿†å•å…ƒ $g$ çš„è®¡ç®—ã€‚è¿™é‡Œï¼ŒçŸ©é˜µ $T_{2n,4n}$â€‹ åŒ…å«äº†ç›¸åº”çš„æƒé‡ï¼Œè¾“å…¥åŒ…æ‹¬å½“å‰è¾“å…¥ $h_t^{l-1}$å’Œå‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ $h_{t-1}^l$â€‹</p><ul><li><strong>è¾“å…¥é—¨ $i$</strong> å’Œ <strong>é—å¿˜é—¨ $f$</strong> æ§åˆ¶ä¿¡æ¯çš„æ›´æ–°å’Œé—å¿˜ï¼Œä½¿ç”¨$sigmoid$æ¿€æ´»å‡½æ•°ã€‚</li><li><strong>è¾“å‡ºé—¨ $o$</strong> æ§åˆ¶è¾“å‡ºä¿¡æ¯ï¼Œä½¿ç”¨$sigmoid$æ¿€æ´»å‡½æ•°ã€‚</li><li><strong>å€™é€‰è®°å¿†å•å…ƒ $g$</strong> æä¾›æ–°çš„ä¿¡æ¯å†…å®¹ï¼Œä½¿ç”¨$tanh$æ¿€æ´»å‡½æ•°ã€‚</li><li><strong>æƒé‡çŸ©é˜µ $T_{2n,4n}$</strong>  ä¸€ä¸ªå¤§å°ä¸º $2n \times 4n$ çš„çŸ©é˜µï¼Œå…¶ä¸­ $n$ æ˜¯éšè—çŠ¶æ€å‘é‡çš„ç»´åº¦ã€‚å°†è¾“å…¥å‘é‡ $h_t^{l-1}$â€‹ å’Œéšè—çŠ¶æ€å‘é‡ $h_{t-1}^l$ æ‹¼æ¥èµ·æ¥ï¼ˆå‘é‡é•¿åº¦ä¸º $2n$ï¼‰ï¼Œå¹¶é€šè¿‡çŸ©é˜µ $T_{2n,4n}$â€‹ è¿›è¡Œçº¿æ€§å˜æ¢ï¼Œç”Ÿæˆä¸€ä¸ªé•¿åº¦ä¸º $4n$ çš„è¾“å‡ºå‘é‡,å³ $i, f, o, g$ å››ä¸ªéƒ¨åˆ†<h3 id="1-é—å¿˜é—¨forget-gate"><a href="#1-é—å¿˜é—¨ï¼ˆForget-Gateï¼‰" class="headerlink" title="1. é—å¿˜é—¨ï¼ˆForget Gateï¼‰"></a>1. é—å¿˜é—¨ï¼ˆForget Gateï¼‰</h3></li></ul><p>$f_t^l = \sigma(W_f \cdot [h_{t-1}^l, h_t^{l-1}] + b_f)$</p><ul><li>$[h_t^{l-1}, h_{t-1}^l]$è¡¨ç¤ºå°†å½“å‰è¾“å…¥å’Œå‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€å‘é‡æ‹¼æ¥æˆä¸€ä¸ªå‘é‡ã€‚</li><li>$W_fâ€‹$ æ˜¯è¯¥æ‹¼æ¥å‘é‡çš„æƒé‡çŸ©é˜µã€‚</li><li>$b_f$â€‹ æ˜¯åç½®å‘é‡ã€‚</li><li>$\sigma$ æ˜¯$sigmoid$æ¿€æ´»å‡½æ•°ï¼Œè¾“å‡ºèŒƒå›´åœ¨0åˆ°1ä¹‹é—´ã€‚</li></ul><p>å‡è®¾ $n = 4$ï¼š</p><ul><li>å½“å‰è¾“å…¥å‘é‡ $h_t^{l-1}$ä¸º $[h_1â€‹,h_2â€‹,h_3â€‹,h_4â€‹]$ã€‚</li><li>å‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ $h_{t-1}^l$ ä¸º $[h_5, h_6, h_7, h_8]$</li></ul><p>æ‹¼æ¥åçš„å‘é‡ä¸ºï¼š$[h_1, h_2, h_3, h_4, h_5, h_6, h_7, h_8]$</p><p>æƒé‡çŸ©é˜µ $W_fâ€‹$ å°†æ­¤å‘é‡è¿›è¡Œçº¿æ€§å˜æ¢ï¼Œç”Ÿæˆä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„å‘é‡ã€‚</p><h4 id="çº¿æ€§å˜æ¢"><a href="#çº¿æ€§å˜æ¢" class="headerlink" title="çº¿æ€§å˜æ¢"></a>çº¿æ€§å˜æ¢</h4><p>è¿›è¡Œçº¿æ€§å˜æ¢çš„å…¬å¼ä¸ºï¼š<br>$z_f = W_f \cdot [h_t^{l-1}, h_{t-1}^l] + b_f$</p><p>å…·ä½“æ­¥éª¤ï¼š</p><ol><li><strong>çŸ©é˜µä¹˜æ³•</strong>ï¼š<ul><li>$W_f$æ˜¯ä¸€ä¸ª $n \times 2n$ çš„çŸ©é˜µï¼Œæ‹¼æ¥å‘é‡æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º $2n$ çš„å‘é‡ã€‚</li><li>é€šè¿‡çŸ©é˜µä¹˜æ³•ï¼Œç»“æœæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„å‘é‡ã€‚</li></ul></li><li><strong>åŠ åç½®</strong>ï¼š<ul><li>å°†å¾—åˆ°çš„å‘é‡ä¸åç½®å‘é‡ $b_f$ ç›¸åŠ ï¼Œä»ç„¶æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„å‘é‡ã€‚</li></ul></li></ol><p>ä¾‹å¦‚ï¼Œå‡è®¾ $W_f$â€‹ å’Œ $b_f$â€‹ ä¸ºï¼š<br>$W_f = \begin{pmatrix} w_{11} &amp; w_{12} &amp; w_{13} &amp; w_{14} &amp; w_{15} &amp; w_{16} &amp; w_{17} &amp; w_{18} \ w_{21} &amp; w_{22} &amp; w_{23} &amp; w_{24} &amp; w_{25} &amp; w_{26} &amp; w_{27} &amp; w_{28} \ w_{31} &amp; w_{32} &amp; w_{33} &amp; w_{34} &amp; w_{35} &amp; w_{36} &amp; w_{37} &amp; w_{38} \ w_{41} &amp; w_{42} &amp; w_{43} &amp; w_{44} &amp; w_{45} &amp; w_{46} &amp; w_{47} &amp; w_{48} \end{pmatrix}$</p><p>æ‹¼æ¥å‘é‡ä¸ºï¼š<br>$[h_1, h_2, h_3, h_4, h_5, h_6, h_7, h_8]$</p><p>çŸ©é˜µä¹˜æ³•ï¼š<br>$z_f = W_f \cdot [h_1, h_2, h_3, h_4, h_5, h_6, h_7, h_8]$</p><p>è®¡ç®—æ¯ä¸ªå…ƒç´ ï¼š<br>$\begin{aligned} z_{f1} &amp;= w_{11}h_1 + w_{12}h_2 + w_{13}h_3 + w_{14}h_4 + w_{15}h_5 + w_{16}h_6 + w_{17}h_7 + w_{18}h_8 \ z_{f2} &amp;= w_{21}h_1 + w_{22}h_2 + w_{23}h_3 + w_{24}h_4 + w_{25}h_5 + w_{26}h_6 + w_{27}h_7 + w_{28}h_8 \ z_{f3} &amp;= w_{31}h_1 + w_{32}h_2 + w_{33}h_3 + w_{34}h_4 + w_{35}h_5 + w_{36}h_6 + w_{37}h_7 + w_{38}h_8 \ z_{f4} &amp;= w_{41}h_1 + w_{42}h_2 + w_{43}h_3 + w_{44}h_4 + w_{45}h_5 + w_{46}h_6 + w_{47}h_7 + w_{48}h_8 \end{aligned}$</p><p>åŠ åç½®ï¼š<br>$z_f = \begin{pmatrix} z_{f1} + b_1 \ z_{f2} + b_2 \ z_{f3} + b_3 \ z_{f4} + b_4 \end{pmatrix}$</p><h4 id="sigmoid-éçº¿æ€§æ¿€æ´»"><a href="#sigmoid-éçº¿æ€§æ¿€æ´»" class="headerlink" title="sigmoid éçº¿æ€§æ¿€æ´»"></a>sigmoid éçº¿æ€§æ¿€æ´»</h4><p>é€šè¿‡$sigmoid$æ¿€æ´»å‡½æ•°å¾—åˆ°é—å¿˜é—¨çš„æ¿€æ´»å€¼ï¼š<br>$f_t^l = \sigma(z_f)$<br>é€šè¿‡ $sigmoid$ éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼Œå¾—åˆ°é—å¿˜é—¨çš„æ¿€æ´»å€¼ã€‚</p><h3 id="2-è¾“å…¥é—¨input-gate"><a href="#2-è¾“å…¥é—¨ï¼ˆInput-Gateï¼‰" class="headerlink" title="2. è¾“å…¥é—¨ï¼ˆInput Gateï¼‰"></a>2. è¾“å…¥é—¨ï¼ˆInput Gateï¼‰</h3><p>è®¡ç®—è¾“å…¥é—¨çš„æ¿€æ´»å€¼ï¼Œå†³å®šæ–°çš„è¾“å…¥ä¿¡æ¯çš„å“ªäº›éƒ¨åˆ†å°†æ›´æ–°å•å…ƒçŠ¶æ€ï¼š $i_t^l = \sigma(W_i \cdot [h_{t-1}^l, h_t^{l-1}] + b_i)$</p><p>è¾“å…¥è°ƒåˆ¶é—¨ï¼ˆInput Modulation Gateï¼‰è¾“å…¥è°ƒåˆ¶é—¨äº§ç”Ÿæ–°çš„å€™é€‰è®°å¿†å†…å®¹ï¼Œé€šè¿‡ tanh å‡½æ•°è¿›è¡Œæ¿€æ´»ã€‚<br>å®ƒçš„æ•°å­¦è¡¨ç¤ºä¸ºï¼š$g_t = \tanh(W_g \cdot [h_{t-1}, h_t] + b_g)$</p><h3 id="3-å•å…ƒçŠ¶æ€"><a href="#3-å•å…ƒçŠ¶æ€" class="headerlink" title="3. å•å…ƒçŠ¶æ€"></a>3. å•å…ƒçŠ¶æ€</h3><p>ç»“åˆé—å¿˜é—¨å’Œè¾“å…¥é—¨çš„ä¿¡æ¯ï¼Œæ›´æ–°å•å…ƒçŠ¶æ€ï¼š</p><p>$c_t^l = f \odot c_{t-1}^l + i \odot g$</p><p>æè¿°äº†å¦‚ä½•æ›´æ–°å•å…ƒçŠ¶æ€ã€‚è¿™é‡Œï¼Œ$\odot$ è¡¨ç¤ºå…ƒç´ ä¹˜æ³•ï¼ˆHadamardä¹˜ç§¯ï¼‰ã€‚</p><ul><li>é—å¿˜é—¨$f$å†³å®šäº†å‰ä¸€æ—¶é—´æ­¥çš„å•å…ƒçŠ¶æ€ $c_{t-1}^l$æœ‰å¤šå°‘è¢«ä¿ç•™ã€‚é—å¿˜é—¨çš„è¾“å‡ºå€¼åœ¨0å’Œ1ä¹‹é—´ï¼š<ul><li>å½“ $f$â€‹ æ¥è¿‘1æ—¶ï¼Œè¡¨ç¤ºå¤§éƒ¨åˆ†å•å…ƒçŠ¶æ€è¢«ä¿ç•™ã€‚</li><li>å½“ $f$æ¥è¿‘0æ—¶ï¼Œè¡¨ç¤ºå¤§éƒ¨åˆ†å•å…ƒçŠ¶æ€è¢«é—å¿˜ã€‚</li></ul></li><li>è¾“å…¥é—¨ $i$ å’Œå€™é€‰è®°å¿†å•å…ƒ $g$ å†³å®šäº†å¤šå°‘æ–°çš„ä¿¡æ¯è¢«æ·»åŠ åˆ°å½“å‰å•å…ƒçŠ¶æ€ $c_t^l$ã€‚</li></ul><h3 id="4-è¾“å‡ºé—¨"><a href="#4-è¾“å‡ºé—¨" class="headerlink" title="4. è¾“å‡ºé—¨"></a>4. è¾“å‡ºé—¨</h3><p>è®¡ç®—è¾“å‡ºé—¨çš„æ¿€æ´»å€¼ï¼Œå†³å®šéšè—çŠ¶æ€çš„æ›´æ–°ï¼š<br>è¾“å‡ºé—¨ï¼š$o_t^l = \sigma(W_o \cdot [h_{t-1}^l, h_t^{l-1}] + b_o)$<br>éšè—çŠ¶æ€ï¼š$h_t^l = o_t^l * \tanh(c_t^l)$<br>è¾“å‡ºé—¨ $o$ æ§åˆ¶äº†ä»å•å…ƒçŠ¶æ€ $c_t^l$ ä¼ é€’åˆ°éšè—çŠ¶æ€ $h_t^l$â€‹ çš„ä¿¡æ¯ï¼Œé€šè¿‡$tanh$å‡½æ•°è¿›è¡Œéçº¿æ€§å˜æ¢ã€‚</p><p>LSTMé€šè¿‡è¾“å…¥é—¨ã€é—å¿˜é—¨ã€è¾“å‡ºé—¨å’Œå€™é€‰è®°å¿†å•å…ƒçš„ååŒä½œç”¨ï¼Œæœ‰æ•ˆåœ°æ•æ‰åºåˆ—æ•°æ®ä¸­çš„é•¿çŸ­æœŸä¾èµ–å…³ç³»ï¼Œè§£å†³äº†ä¼ ç»ŸRNNä¸­æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜ã€‚è¿™ä¸ªæ›´æ–°æœºåˆ¶ä½¿å¾—LSTMåœ¨å¤„ç†é•¿åºåˆ—æ•°æ®æ—¶è¡¨ç°å‡ºè‰²ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°ä¿ç•™é‡è¦ä¿¡æ¯å¹¶è¿‡æ»¤æ— å…³ä¿¡æ¯ã€‚</p><h3 id="5-æ›´æ–°éšè—çŠ¶æ€hidden-state-update"><a href="#5-æ›´æ–°éšè—çŠ¶æ€ï¼ˆHidden-State-Updateï¼‰" class="headerlink" title="5. æ›´æ–°éšè—çŠ¶æ€ï¼ˆHidden State Updateï¼‰"></a>5. æ›´æ–°éšè—çŠ¶æ€ï¼ˆHidden State Updateï¼‰</h3><p>ç»“åˆæ–°çš„å•å…ƒçŠ¶æ€å’Œè¾“å‡ºé—¨çš„æ¿€æ´»å€¼ï¼Œæ›´æ–°éšè—çŠ¶æ€ï¼š $h_t^l = o_t^l * \tanh(c_t^l)$</p><h2 id="4-åº”ç”¨äº†dropout-çš„lstm"><a href="#4-åº”ç”¨äº†dropout-çš„LSTM" class="headerlink" title="4. åº”ç”¨äº†dropout çš„LSTM"></a>4. åº”ç”¨äº†dropout çš„LSTM</h2><p>ä»æ­£æ–‡ä¸­å¯ä»¥çœ‹å‡ºï¼Œå’Œæ ‡å‡†çš„LSTM çŠ¶æ€æ›´æ–°è¿‡ç¨‹ç›¸æ¯”ï¼Œ å…¶å˜åŒ–åªæ˜¯å¢åŠ äº†ä¸€ä¸ª$D$ã€‚<br>$D$ æ˜¯å°†å…¶å‚æ•°çš„éšæœºå­é›†è®¾ç½®ä¸ºé›¶çš„dropoutæ“ä½œç¬¦ã€‚</p><p>$\left( \begin{array}{c} i \ f \ o \ g \end{array} \right) = \left( \begin{array}{c} \text{sigm} \ \text{sigm} \ \text{sigm} \ \text{tanh} \end{array} \right) T_{2n,4n} \left( \begin{array}{c} {D}(h_{t}^{l-1}) \ h_{t-1}^{l} \end{array} \right)â€‹$</p><p>å¦‚ä½•ç†è§£å…¶ä¸»è¦æ€æƒ³æ˜¯ä»…å°†dropoutæ“ä½œç¬¦åº”ç”¨äºéé€’å½’è¿æ¥ã€‚<br>ç”±äºï¼š</p><ol><li>$h_t^{l-1}$ï¼šè¡¨ç¤ºç¬¬ $lâˆ’1$ å±‚åœ¨æ—¶é—´æ­¥ $t$ çš„éšè—çŠ¶æ€å‘é‡ã€‚è¿™æ˜¯ç¬¬ $l$ å±‚çš„å½“å‰è¾“å…¥ã€‚</li><li>$h_{t-1}^l$ï¼šè¡¨ç¤ºç¬¬ $l$ å±‚åœ¨æ—¶é—´æ­¥ $tâˆ’1$ çš„éšè—çŠ¶æ€å‘é‡ã€‚è¿™æ˜¯ç¬¬ $l$ å±‚çš„å‰ä¸€ä¸ªæ—¶é—´æ­¥çš„çŠ¶æ€ã€‚<br>åŒä¸€å±‚å‰åæ—¶é—´æ­¥ä¹‹é—´çš„æ•°æ®æµè½¬ å°±æ˜¯é€’å½’æ“ä½œï¼Œ ä¸åŒå±‚ä¹‹é—´çš„æ•°æ®æµè½¬æ˜¯éé€’å½’æ“ä½œï¼Œ æ ¹æ®å…¬å¼ï¼Œ$D$ åº”ç”¨åœ¨äº†$h_t^{l-1}$ä¸Šï¼Œ æ‰€ä»¥è¯´$D$ æ˜¯åº”ç”¨åœ¨éé€’å½’è¿æ¥ä¸Šçš„æ“ä½œç¬¦åˆ</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://arxiv.org/pdf/1409.2329&quot;&gt;RECURRENT NEURAL NETWORK REGULARIZATION&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;abstract-æ‘˜è¦&quot;&gt;&lt;a href=&quot;#ABSTRACT-æ‘˜è¦&quot; cla</summary>
      
    
    
    
    
    <category term="AI" scheme="http://example.com/tags/AI/"/>
    
    <category term="ç¥ç»ç½‘ç»œ" scheme="http://example.com/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
    
    <category term="Ilya sutskeverâ€˜s 30  papers" scheme="http://example.com/tags/Ilya-sutskever%E2%80%98s-30-papers/"/>
    
  </entry>
  
  <entry>
    <title>The Unreasonable Effectiveness of Recurrent Neural Networks</title>
    <link href="http://example.com/2472be8a/"/>
    <id>http://example.com/2472be8a/</id>
    <published>2024-06-11T09:59:43.000Z</published>
    <updated>2024-06-16T14:23:22.626Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://karpathy.github.io/2015/05/21/rnn-effectiveness/">Andrej Karpathy blog:# The Unreasonable Effectiveness of Recurrent Neural Networks</a></p><p>Thereâ€™s something magical about Recurrent Neural Networks (RNNs). I still remember when I trained my first recurrent network for <a href="http://cs.stanford.edu/people/karpathy/deepimagesent/">Image Captioning</a>. Within a few dozen minutes of training my first baby model (with rather arbitrarily-chosen hyperparameters) started to generate very nice looking descriptions of images that were on the edge of making sense. Sometimes the ratio of how simple your model is to the quality of the results you get out of it blows past your expectations, and this was one of those times. What made this result so shocking at the time was that the common wisdom was that RNNs were supposed to be difficult to train (with more experience Iâ€™ve in fact reached the opposite conclusion). Fast forward about a year: Iâ€™m training RNNs all the time and Iâ€™ve witnessed their power and robustness many times, and yet their magical outputs still find ways of amusing me. This post is about sharing some of that magic with you.<br>å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰æœ‰å…¶ç‹¬ç‰¹çš„é­…åŠ›ã€‚æˆ‘è¿˜è®°å¾—ç¬¬ä¸€æ¬¡è®­ç»ƒç”¨äºå›¾åƒæè¿°ç”Ÿæˆçš„å¾ªç¯ç¥ç»ç½‘ç»œæ—¶çš„æƒ…æ™¯ã€‚åªç”¨äº†çŸ­çŸ­å‡ ååˆ†é’Ÿï¼Œå³ä½¿æ˜¯éšæ„é€‰æ‹©çš„è¶…å‚æ•°ï¼Œè¿™ä¸ªåˆæ­¥æ¨¡å‹å·²ç»å¼€å§‹ç”Ÿæˆçœ‹èµ·æ¥éå¸¸ä¸é”™çš„å›¾åƒæè¿°ï¼Œå°½ç®¡è¿™äº›æè¿°æœ‰æ—¶åªæ˜¯å‹‰å¼ºåˆç†ã€‚æœ‰æ—¶ï¼Œæ¨¡å‹çš„ç®€å•ç¨‹åº¦ä¸å…¶è¾“å‡ºç»“æœçš„è´¨é‡ä¹‹é—´çš„æ¯”ä¾‹ä¼šè¿œè¿œè¶…å‡ºé¢„æœŸï¼Œè¿™æ¬¡å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ã€‚è¿™æ¬¡ç»“æœå¦‚æ­¤ä»¤äººéœ‡æƒŠçš„åŸå› åœ¨äºï¼Œå½“æ—¶çš„æ™®éè®¤çŸ¥æ˜¯ï¼ŒRNNå¾ˆéš¾è®­ç»ƒï¼ˆéšç€ç»éªŒçš„å¢åŠ ï¼Œæˆ‘å®é™…ä¸Šå¾—å‡ºäº†ç›¸åçš„ç»“è®ºï¼‰ã€‚æ—¶é—´å¿«è¿›å¤§çº¦ä¸€å¹´ï¼šæˆ‘ä¸€ç›´åœ¨è®­ç»ƒRNNï¼Œç›®ç¹äº†å®ƒä»¬çš„å¼ºå¤§å’Œç¨³å¥ï¼Œå°½ç®¡å¦‚æ­¤ï¼Œå®ƒä»¬ç¥å¥‡çš„è¾“å‡ºä¾ç„¶èƒ½ä¸æ–­å¸¦ç»™æˆ‘æƒŠå–œã€‚è¿™ç¯‡æ–‡ç« æ—¨åœ¨ä¸å¤§å®¶åˆ†äº«è¿™ç§é­”åŠ›ã€‚</p><p>Weâ€™ll train RNNs to generate text character by character and ponder the question â€œhow is that even possible?â€<br>æˆ‘ä»¬å°†è®­ç»ƒå¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰é€å­—ç¬¦åœ°ç”Ÿæˆæ–‡æœ¬ï¼Œå¹¶æ€è€ƒè¿™ä¸ªé—®é¢˜ï¼šâ€œè¿™åˆ°åº•æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿâ€</p><p>By the way, together with this post I am also releasing <a href="https://github.com/karpathy/char-rnn">code on Github</a> that allows you to train character-level language models based on multi-layer LSTMs. You give it a large chunk of text and it will learn to generate text like it one character at a time. You can also use it to reproduce my experiments below. But weâ€™re getting ahead of ourselves; What are RNNs anyway?<br>é¡ºä¾¿æä¸€ä¸‹ï¼Œä¸è¿™ç¯‡æ–‡ç« ä¸€èµ·ï¼Œæˆ‘è¿˜åœ¨Githubä¸Šå‘å¸ƒäº†ä»£ç ï¼Œè¿™äº›ä»£ç å¯ä»¥ç”¨æ¥è®­ç»ƒåŸºäºå¤šå±‚LSTMçš„å­—ç¬¦çº§è¯­è¨€æ¨¡å‹ã€‚ä½ åªéœ€æä¾›ä¸€å¤§æ®µæ–‡æœ¬ï¼Œå®ƒå°±ä¼šé€å­—ç¬¦åœ°å­¦ä¹ ç”Ÿæˆç±»ä¼¼çš„æ–‡æœ¬ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨å®ƒæ¥é‡ç°æˆ‘ä¸‹é¢çš„å®éªŒã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆå›åˆ°æ­£é¢˜ä¸Šæ¥ï¼šæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹RNNåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</p><h1 id="recurrent-neural-networks-é€’å½’ç¥ç»ç½‘ç»œ"><a href="#Recurrent-Neural-Networks-é€’å½’ç¥ç»ç½‘ç»œ" class="headerlink" title="Recurrent Neural Networks  é€’å½’ç¥ç»ç½‘ç»œ"></a>Recurrent Neural Networks  é€’å½’ç¥ç»ç½‘ç»œ</h1><h2 id="sequences"><a href="#Sequences" class="headerlink" title="Sequences"></a>Sequences</h2><p><strong>Sequences</strong>. Depending on your background you might be wondering: _What makes Recurrent Networks so special_? A glaring limitation of Vanilla Neural Networks (and also Convolutional Networks) is that their API is too constrained: they accept a fixed-sized vector as input (e.g. an image) and produce a fixed-sized vector as output (e.g. probabilities of different classes). Not only that: These models perform this mapping using a fixed amount of computational steps (e.g. the number of layers in the model). The core reason that recurrent nets are more exciting is that they allow us to operate over _sequences_ of vectors: Sequences in the input, the output, or in the most general case both. A few examples may make this more concrete:<br>åºåˆ—ã€‚æ ¹æ®ä½ çš„èƒŒæ™¯ï¼Œä½ å¯èƒ½ä¼šé—®ï¼šå¾ªç¯ç¥ç»ç½‘ç»œæœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ï¼Ÿä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„é™åˆ¶æ˜¯Vanilla ç¥ç»ç½‘ç»œï¼ˆä»¥åŠå·ç§¯ç¥ç»ç½‘ç»œï¼‰çš„APIè¿‡äºå—é™ï¼šå®ƒä»¬æ¥å—å›ºå®šå¤§å°çš„å‘é‡ä½œä¸ºè¾“å…¥ï¼ˆä¾‹å¦‚ï¼Œä¸€å¼ å›¾ç‰‡ï¼‰ï¼Œå¹¶äº§ç”Ÿå›ºå®šå¤§å°çš„å‘é‡ä½œä¸ºè¾“å‡ºï¼ˆä¾‹å¦‚ï¼Œä¸åŒç±»åˆ«çš„æ¦‚ç‡ï¼‰ã€‚ä¸ä»…å¦‚æ­¤ï¼Œè¿™äº›æ¨¡å‹ä½¿ç”¨å›ºå®šæ•°é‡çš„è®¡ç®—æ­¥éª¤æ¥å®Œæˆè¿™ä¸ªæ˜ å°„ï¼ˆä¾‹å¦‚ï¼Œæ¨¡å‹ä¸­çš„å±‚æ•°ï¼‰ã€‚å¾ªç¯ç¥ç»ç½‘ç»œæ›´ä»¤äººå…´å¥‹çš„æ ¸å¿ƒåŸå› åœ¨äºå®ƒä»¬å…è®¸æˆ‘ä»¬å¯¹å‘é‡åºåˆ—è¿›è¡Œæ“ä½œï¼šè¾“å…¥ä¸­çš„åºåˆ—ï¼Œè¾“å‡ºä¸­çš„åºåˆ—ï¼Œæˆ–è€…åœ¨æœ€ä¸€èˆ¬çš„æƒ…å†µä¸‹ï¼Œä¸¤è€…éƒ½æ˜¯åºåˆ—ã€‚å‡ ä¸ªä¾‹å­å¯ä»¥è®©è¿™ä¸€ç‚¹æ›´åŠ å…·ä½“ï¼š</p><img src="/2472be8a/1.png" class><p>Each rectangle is a vector and arrows represent functions (e.g. matrix multiply). Input vectors are in red, output vectors are in blue and green vectors hold the RNNâ€™s state (more on this soon). From left to right: <strong>(1)</strong> Vanilla mode of processing without RNN, from fixed-sized input to fixed-sized output (e.g. image classification). <strong>(2)</strong> Sequence output (e.g. image captioning takes an image and outputs a sentence of words). <strong>(3)</strong> Sequence input (e.g. sentiment analysis where a given sentence is classified as expressing positive or negative sentiment). <strong>(4)</strong> Sequence input and sequence output (e.g. Machine Translation: an RNN reads a sentence in English and then outputs a sentence in French). <strong>(5)</strong> Synced sequence input and output (e.g. video classification where we wish to label each frame of the video). Notice that in every case are no pre-specified constraints on the lengths sequences because the recurrent transformation (green) is fixed and can be applied as many times as we like.<br>æ¯ä¸ªçŸ©å½¢ä»£è¡¨ä¸€ä¸ªå‘é‡ï¼Œç®­å¤´ä»£è¡¨å‡½æ•°ï¼ˆä¾‹å¦‚çŸ©é˜µä¹˜æ³•ï¼‰ã€‚è¾“å…¥å‘é‡ç”¨çº¢è‰²è¡¨ç¤ºï¼Œè¾“å‡ºå‘é‡ç”¨è“è‰²è¡¨ç¤ºï¼Œç»¿è‰²å‘é‡è¡¨ç¤ºRNNçš„çŠ¶æ€ï¼ˆç¨åä¼šè¯¦ç»†è¯´æ˜ï¼‰ã€‚ä»å·¦åˆ°å³ä¾æ¬¡æ˜¯ï¼š</p><p><strong>(1)</strong> æ™®é€šæ¨¡å¼çš„å¤„ç†ï¼Œæ²¡æœ‰ä½¿ç”¨RNNï¼Œä»å›ºå®šå¤§å°çš„è¾“å…¥åˆ°å›ºå®šå¤§å°çš„è¾“å‡ºï¼ˆä¾‹å¦‚å›¾åƒåˆ†ç±»ï¼‰ã€‚</p><p><strong>(2)</strong> åºåˆ—è¾“å‡ºï¼ˆä¾‹å¦‚å›¾åƒæè¿°ç”Ÿæˆï¼Œè¾“å…¥ä¸€å¼ å›¾ç‰‡ï¼Œè¾“å‡ºä¸€ä¸ªå•è¯å¥å­ï¼‰ã€‚</p><p><strong>(3)</strong> åºåˆ—è¾“å…¥ï¼ˆä¾‹å¦‚æƒ…æ„Ÿåˆ†æï¼Œå°†ç»™å®šçš„å¥å­åˆ†ç±»ä¸ºè¡¨è¾¾æ­£é¢æˆ–è´Ÿé¢æƒ…æ„Ÿï¼‰ã€‚</p><p><strong>(4)</strong> åºåˆ—è¾“å…¥å’Œåºåˆ—è¾“å‡ºï¼ˆä¾‹å¦‚æœºå™¨ç¿»è¯‘ï¼šRNNè¯»å–ä¸€æ®µè‹±æ–‡å¥å­ï¼Œç„¶åè¾“å‡ºä¸€æ®µæ³•æ–‡å¥å­ï¼‰ã€‚</p><p><strong>(5)</strong> åŒæ­¥çš„åºåˆ—è¾“å…¥å’Œè¾“å‡ºï¼ˆä¾‹å¦‚è§†é¢‘åˆ†ç±»ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹è§†é¢‘çš„æ¯ä¸€å¸§è¿›è¡Œæ ‡ç­¾ï¼‰ã€‚</p><p>æ³¨æ„ï¼Œåœ¨æ¯ç§æƒ…å†µä¸‹ï¼Œåºåˆ—é•¿åº¦éƒ½æ²¡æœ‰é¢„å…ˆæŒ‡å®šçš„é™åˆ¶ï¼Œå› ä¸ºå¾ªç¯å˜æ¢ï¼ˆç»¿è‰²ï¼‰æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥æ ¹æ®éœ€è¦åº”ç”¨å¤šæ¬¡ã€‚</p><p>As you might expect, the sequence regime of operation is much more powerful compared to fixed networks that are doomed from the get-go by a fixed number of computational steps, and hence also much more appealing for those of us who aspire to build more intelligent systems. Moreover, as weâ€™ll see in a bit, RNNs combine the input vector with their state vector with a fixed (but learned) function to produce a new state vector. This can in programming terms be interpreted as running a fixed program with certain inputs and some internal variables. Viewed this way, RNNs essentially describe programs. In fact, it is known that <a href="http://binds.cs.umass.edu/papers/1995_Siegelmann_Science.pdf">RNNs are Turing-Complete</a> in the sense that they can to simulate arbitrary programs (with proper weights). But similar to universal approximation theorems for neural nets you shouldnâ€™t read too much into this. In fact, forget I said anything.<br>æ­£å¦‚ä½ æ‰€é¢„æ–™çš„é‚£æ ·ï¼Œç›¸è¾ƒäºå—é™äºå›ºå®šè®¡ç®—æ­¥éª¤çš„å›ºå®šç½‘ç»œï¼Œåºåˆ—æ“ä½œæ¨¡å¼è¦å¼ºå¤§å¾—å¤šï¼Œå› æ­¤å¯¹äºé‚£äº›å¸Œæœ›æ„å»ºæ›´æ™ºèƒ½ç³»ç»Ÿçš„äººæ¥è¯´ä¹Ÿæ›´å…·å¸å¼•åŠ›ã€‚æ­¤å¤–ï¼Œæ­£å¦‚æˆ‘ä»¬ç¨åä¼šçœ‹åˆ°çš„ï¼ŒRNNé€šè¿‡å›ºå®šï¼ˆä½†å¯å­¦ä¹ ï¼‰çš„å‡½æ•°å°†è¾“å…¥å‘é‡ä¸å…¶çŠ¶æ€å‘é‡ç»“åˆï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„çŠ¶æ€å‘é‡ã€‚è¿™åœ¨ç¼–ç¨‹æœ¯è¯­ä¸­å¯ä»¥ç†è§£ä¸ºè¿è¡Œä¸€ä¸ªå…·æœ‰ç‰¹å®šè¾“å…¥å’Œä¸€äº›å†…éƒ¨å˜é‡çš„å›ºå®šç¨‹åºã€‚ä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼ŒRNNæœ¬è´¨ä¸Šæ˜¯åœ¨æè¿°ç¨‹åºã€‚äº‹å®ä¸Šï¼ŒRNNè¢«è®¤ä¸ºæ˜¯å›¾çµå®Œå¤‡çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥æ¨¡æ‹Ÿä»»æ„ç¨‹åºï¼ˆåœ¨é€‚å½“çš„æƒé‡ä¸‹ï¼‰ã€‚ä½†æ˜¯ï¼Œä¸ç¥ç»ç½‘ç»œçš„é€šç”¨è¿‘ä¼¼å®šç†ç±»ä¼¼ï¼Œä½ ä¸åº”è¯¥å¯¹æ­¤è¿‡äºè§£è¯»ã€‚å®é™…ä¸Šï¼Œå¿˜æ‰æˆ‘åˆšæ‰è¯´çš„è¯å§ã€‚</p><blockquote><p>If training vanilla neural nets is optimization over functions, training recurrent nets is optimization over programs.<br>å¦‚æœè¯´è®­ç»ƒæ™®é€šç¥ç»ç½‘ç»œæ˜¯å¯¹å‡½æ•°çš„ä¼˜åŒ–ï¼Œé‚£ä¹ˆè®­ç»ƒå¾ªç¯ç½‘ç»œå°±æ˜¯å¯¹ç¨‹åºçš„ä¼˜åŒ–ã€‚</p></blockquote><p><strong>Sequential processing in absence of sequences</strong>. You might be thinking that having sequences as inputs or outputs could be relatively rare, but an important point to realize is that even if your inputs/outputs are fixed vectors, it is still possible to use this powerful formalism to _process_ them in a sequential manner. For instance, the figure below shows results from two very nice papers from <a href="http://deepmind.com/">DeepMind</a>. On the left, an algorithm learns a recurrent network policy that steers its attention around an image; In particular, it learns to read out house numbers from left to right (<a href="http://arxiv.org/abs/1412.7755">Ba et al.</a>). On the right, a recurrent network _generates_ images of digits by learning to sequentially add color to a canvas (<a href="http://arxiv.org/abs/1502.04623">Gregor et al.</a>):<br>åœ¨æ²¡æœ‰åºåˆ—çš„æƒ…å†µä¸‹è¿›è¡Œé¡ºåºå¤„ç†ã€‚æ‚¨å¯èƒ½è®¤ä¸ºå°†åºåˆ—ä½œä¸ºè¾“å…¥æˆ–è¾“å‡ºå¯èƒ½ç›¸å¯¹ç½•è§ï¼Œä½†éœ€è¦æ„è¯†åˆ°çš„é‡è¦ä¸€ç‚¹æ˜¯ï¼Œå³ä½¿ä½ çš„è¾“å…¥/è¾“å‡ºæ˜¯å›ºå®šå‘é‡ï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨è¿™ç§å¼ºå¤§çš„å½¢å¼ä¸»ä¹‰ä»¥é¡ºåºæ–¹å¼å¤„ç†å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œä¸‹å›¾æ˜¾ç¤ºäº† DeepMind çš„ä¸¤ç¯‡éå¸¸å¥½çš„è®ºæ–‡çš„ç»“æœã€‚åœ¨å·¦è¾¹ï¼Œç®—æ³•å­¦ä¹ ä¸€ä¸ªå¾ªç¯ç½‘ç»œç­–ç•¥ï¼Œå°†å…¶æ³¨æ„åŠ›å¼•å¯¼åˆ°å›¾åƒå‘¨å›´;ç‰¹åˆ«æ˜¯ï¼Œå®ƒå­¦ä¼šäº†ä»å·¦åˆ°å³è¯»å‡ºé—¨ç‰Œå·ï¼ˆBaç­‰äººï¼‰ã€‚åœ¨å³è¾¹ï¼Œä¸€ä¸ªå¾ªç¯ç½‘ç»œé€šè¿‡å­¦ä¹ ä¾æ¬¡å‘ç”»å¸ƒæ·»åŠ é¢œè‰²æ¥ç”Ÿæˆæ•°å­—å›¾åƒï¼š<br><img src="https://karpathy.github.io/assets/rnn/house_read.gif" alt> <img src="https://karpathy.github.io/assets/rnn/house_generate.gif" alt></p><p>The takeaway is that even if your data is not in form of sequences, you can still formulate and train powerful models that learn to process it sequentially. Youâ€™re learning stateful programs that process your fixed-sized data.<br>è¦ç‚¹æ˜¯ï¼Œå³ä½¿ä½ çš„æ•°æ®ä¸æ˜¯ä»¥åºåˆ—å½¢å¼å­˜åœ¨ï¼Œä½ ä»ç„¶å¯ä»¥è®¾è®¡å’Œè®­ç»ƒå¼ºå¤§çš„æ¨¡å‹ï¼Œä½¿å…¶å­¦ä¼šä»¥é¡ºåºæ–¹å¼å¤„ç†è¿™äº›æ•°æ®ã€‚ä½ æ­£åœ¨å­¦ä¹ çš„æ˜¯å¤„ç†å›ºå®šå¤§å°æ•°æ®çš„æœ‰çŠ¶æ€ç¨‹åºã€‚</p><h2 id="rnn-computation"><a href="#RNN-computation" class="headerlink" title="RNN computation"></a>RNN computation</h2><p><strong>RNN computation.</strong> So how do these things work? At the core, RNNs have a deceptively simple API: They accept an input vector <code>x</code> and give you an output vector <code>y</code>. However, crucially this output vectorâ€™s contents are influenced not only by the input you just fed in, but also on the entire history of inputs youâ€™ve fed in in the past. Written as a class, the RNNâ€™s API consists of a single <code>step</code> function:<br>RNN è®¡ç®—ã€‚é‚£ä¹ˆè¿™äº›ä¸œè¥¿æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿåœ¨æ ¸å¿ƒä¸Šï¼ŒRNN æœ‰ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„ APIï¼šå®ƒä»¬æ¥å—ä¸€ä¸ªè¾“å…¥å‘é‡ <code>x</code> å¹¶ç»™ä½ ä¸€ä¸ªè¾“å‡ºå‘é‡ <code>y</code> ã€‚ç„¶è€Œï¼Œè‡³å…³é‡è¦çš„æ˜¯ï¼Œè¿™ä¸ªè¾“å‡ºå‘é‡çš„å†…å®¹ä¸ä»…å—åˆ°ä½ åˆšåˆšè¾“å…¥çš„è¾“å…¥çš„å½±å“ï¼Œè¿˜å—åˆ°ä½ è¿‡å»è¾“å…¥çš„æ•´ä¸ªè¾“å…¥å†å²çš„å½±å“ã€‚RNN çš„ API ç¼–å†™ä¸ºä¸€ä¸ªç±»ï¼Œç”±ä¸€ä¸ª <code>step</code> å‡½æ•°ç»„æˆï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rnn = RNN()</span><br><span class="line">y = rnn.step(x) # x is an input vector, y is the RNN&#x27;s output vector</span><br></pre></td></tr></table></figure><br>The RNN class has some internal state that it gets to update every time <code>step</code> is called. In the simplest case this state consists of a single _hidden_ vector <code>h</code>. Here is an implementation of the step function in a Vanilla RNN:<br>RNN ç±»å…·æœ‰ä¸€äº›å†…éƒ¨çŠ¶æ€ï¼Œæ¯æ¬¡è°ƒç”¨æ—¶ <code>step</code> éƒ½ä¼šæ›´æ–°ã€‚åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œæ­¤çŠ¶æ€ç”±å•ä¸ªéšè—å‘é‡ç»„æˆ <code>h</code> ã€‚ä»¥ä¸‹æ˜¯ Vanilla RNN ä¸­ step å‡½æ•°çš„å®ç°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class RNN:</span><br><span class="line">  # ...</span><br><span class="line">  def step(self, x):</span><br><span class="line">    # update the hidden state</span><br><span class="line">    self.h = np.tanh(np.dot(self.W_hh, self.h) + np.dot(self.W_xh, x))</span><br><span class="line">    # compute the output vector</span><br><span class="line">    y = np.dot(self.W_hy, self.h)</span><br><span class="line">    return y</span><br></pre></td></tr></table></figure><p>The above specifies the forward pass of a vanilla RNN. This RNNâ€™s parameters are the three matrices <code>W_hh, W_xh, W_hy</code>. The hidden state <code>self.h</code> is initialized with the zero vector. The <code>np.tanh</code> function implements a non-linearity that squashes the activations to the range <code>[-1, 1]</code>. Notice briefly how this works: There are two terms inside of the tanh: one is based on the previous hidden state and one is based on the current input. In numpy <code>np.dot</code> is matrix multiplication. The two intermediates interact with addition, and then get squashed by the tanh into the new state vector. If youâ€™re more comfortable with math notation, we can also write the hidden state update as $â„_ğ‘¡=tanhâ¡(ğ‘Š_{â„â„}â„_{ğ‘¡âˆ’1}+ğ‘Š_{ğ‘¥â„}ğ‘¥_ğ‘¡)$, where tanh is applied elementwise.<br>ä¸Šè¿°å†…å®¹æè¿°äº†ä¸€ä¸ªåŸºç¡€RNNçš„å‰å‘ä¼ æ’­è¿‡ç¨‹ã€‚è¿™ä¸ªRNNçš„å‚æ•°æ˜¯ä¸‰ä¸ªçŸ©é˜µW_hhã€W_xhå’ŒW_hyã€‚éšè—çŠ¶æ€self.håˆå§‹åŒ–ä¸ºé›¶å‘é‡ã€‚np.tanhå‡½æ•°å®ç°äº†ä¸€ç§éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼Œå°†æ¿€æ´»å€¼å‹ç¼©åˆ°[-1, 1]èŒƒå›´å†…ã€‚ç®€è¦è¯´æ˜å…¶å·¥ä½œåŸç†ï¼štanhå†…éƒ¨æœ‰ä¸¤ä¸ªé¡¹ï¼Œä¸€ä¸ªåŸºäºå‰ä¸€ä¸ªæ—¶é—´æ­¥éšè—çŠ¶æ€ï¼Œå¦ä¸€ä¸ªåŸºäºå½“å‰æ—¶é—´æ­¥è¾“å…¥ã€‚åœ¨numpyä¸­ï¼Œnp.dotè¡¨ç¤ºçŸ©é˜µä¹˜æ³•ã€‚è¿™ä¸¤ä¸ªä¸­é—´ç»“æœé€šè¿‡åŠ æ³•ç›¸äº’ä½œç”¨ï¼Œç„¶åé€šè¿‡tanhå‡½æ•°å‹ç¼©ä¸ºæ–°çš„çŠ¶æ€å‘é‡ã€‚å¦‚æœä½ å¯¹æ•°å­¦è¡¨ç¤ºæ³•æ›´ç†Ÿæ‚‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†éšè—çŠ¶æ€çš„æ›´æ–°å†™æˆ $â„_ğ‘¡=tanhâ¡(ğ‘Š_{â„â„}â„_{ğ‘¡âˆ’1}+ğ‘Š_{ğ‘¥â„}ğ‘¥_ğ‘¡)$ï¼Œå…¶ä¸­tanhé€å…ƒç´ åº”ç”¨ã€‚</p><p>âš ï¸ï¼šnumpyæ˜¯Pythonä¸­ä¸€ä¸ªéå¸¸æµè¡Œçš„æ•°å€¼è®¡ç®—åº“ã€‚np.tanhå‡½æ•°å’Œnp.dotå‡½æ•°éƒ½æ˜¯numpyåº“ä¸­çš„å‡½æ•°ã€‚np.tanhå‡½æ•°ç”¨äºè®¡ç®—å…ƒç´ çº§çš„åŒæ›²æ­£åˆ‡ï¼Œè€Œnp.dotå‡½æ•°ç”¨äºæ‰§è¡ŒçŸ©é˜µä¹˜æ³•ã€‚</p><p>We initialize the matrices of the RNN with random numbers and the bulk of work during training goes into finding the matrices that give rise to desirable behavior, as measured with some loss function that expresses your preference to what kinds of outputs $y$ youâ€™d like to see in response to your input sequences $x$.<br>æˆ‘ä»¬ç”¨éšæœºæ•°åˆå§‹åŒ–RNNçš„çŸ©é˜µï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå¤§éƒ¨åˆ†å·¥ä½œæ˜¯æ‰¾åˆ°èƒ½å¤Ÿäº§ç”Ÿç†æƒ³è¡Œä¸ºçš„çŸ©é˜µï¼Œè¿™é€šè¿‡æŸç§æŸå¤±å‡½æ•°æ¥è¡¡é‡ï¼Œè¯¥æŸå¤±å‡½æ•°è¡¨è¾¾äº†ä½ å¯¹è¾“å…¥åºåˆ—$x$å¯¹åº”è¾“å‡º$y$çš„æœŸæœ›ã€‚</p><h2 id="going-deep"><a href="#Going-deep" class="headerlink" title="Going deep"></a>Going deep</h2><p><strong>Going deep</strong>. RNNs are neural networks and everything works monotonically better (if done right) if you put on your deep learning hat and start stacking models up like pancakes. For instance, we can form a 2-layer recurrent network as follows:<br>æ·±å…¥ç ”ç©¶ã€‚RNNæ˜¯ç¥ç»ç½‘ç»œçš„ä¸€ç§ï¼Œå¦‚æœæ–¹æ³•å¾—å½“ï¼Œé‡‡ç”¨æ·±åº¦å­¦ä¹ çš„æ–¹æ³•å¹¶åƒå ç…é¥¼ä¸€æ ·å°†æ¨¡å‹å †å èµ·æ¥ï¼Œä¸€åˆ‡éƒ½ä¼šå•è°ƒåœ°å˜å¾—æ›´å¥½ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä¸‹æ„å»ºä¸€ä¸ªä¸¤å±‚çš„å¾ªç¯ç¥ç»ç½‘ç»œï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y1 = rnn1.step(x)</span><br><span class="line">y = rnn2.step(y1)</span><br></pre></td></tr></table></figure></p><p>In other words we have two separate RNNs: One RNN is receiving the input vectors and the second RNN is receiving the output of the first RNN as its input. Except neither of these RNNs know or care - itâ€™s all just vectors coming in and going out, and some gradients flowing through each module during backpropagation.<br>æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„ RNNï¼šä¸€ä¸ª RNN æ¥æ”¶è¾“å…¥å‘é‡ï¼Œç¬¬äºŒä¸ª RNN æ¥æ”¶ç¬¬ä¸€ä¸ª RNN çš„è¾“å‡ºä½œä¸ºå…¶è¾“å…¥ã€‚é™¤äº†è¿™äº› RNN éƒ½ä¸çŸ¥é“æˆ–ä¸å…³å¿ƒä¹‹å¤–â€”â€”å®ƒä»¬éƒ½åªæ˜¯è¿›å‡ºçš„å‘é‡ï¼Œä»¥åŠåœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­æµè¿‡æ¯ä¸ªæ¨¡å—çš„ä¸€äº›æ¢¯åº¦ã€‚</p><h2 id="getting-fancy"><a href="#Getting-fancy" class="headerlink" title="Getting fancy"></a>Getting fancy</h2><p><strong>Getting fancy</strong>. Iâ€™d like to briefly mention that in practice most of us use a slightly different formulation than what I presented above called a _Long Short-Term Memory_ (LSTM) network. The LSTM is a particular type of recurrent network that works slightly better in practice, owing to its more powerful update equation and some appealing backpropagation dynamics. I wonâ€™t go into details, but everything Iâ€™ve said about RNNs stays exactly the same, except the mathematical form for computing the update (the line <code>self.h = ...</code> ) gets a little more complicated. From here on I will use the terms â€œRNN/LSTMâ€ interchangeably but all experiments in this post use an LSTM.<br>æ›´å¤æ‚çš„æ¨¡å‹ã€‚åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å¤§å¤šæ•°äººä½¿ç”¨çš„å…¬å¼ä¸æˆ‘ä¸Šé¢æåˆ°çš„ç¨æœ‰ä¸åŒï¼Œè¢«ç§°ä¸ºé•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼‰ã€‚LSTMæ˜¯ä¸€ç§ç‰¹å®šç±»å‹çš„å¾ªç¯ç¥ç»ç½‘ç»œï¼Œå®é™…ä¸Šæ•ˆæœæ›´å¥½ï¼Œå› ä¸ºå®ƒå…·æœ‰æ›´å¼ºå¤§çš„æ›´æ–°æ–¹ç¨‹å’Œä¸€äº›æ›´å…·å¸å¼•åŠ›çš„åå‘ä¼ æ’­åŠ¨æ€ã€‚æˆ‘ä¸ä¼šæ·±å…¥è®¨è®ºç»†èŠ‚ï¼Œä½†æˆ‘æ‰€è¯´çš„å…³äºRNNçš„ä¸€åˆ‡éƒ½å®Œå…¨ç›¸åŒï¼Œé™¤äº†è®¡ç®—æ›´æ–°çš„æ•°å­¦å½¢å¼ï¼ˆå³self.h = â€¦è¿™ä¸€è¡Œï¼‰å˜å¾—ç¨å¾®å¤æ‚äº†ä¸€äº›ã€‚ä»ç°åœ¨å¼€å§‹ï¼Œæˆ‘ä¼šäº¤æ›¿ä½¿ç”¨â€œRNN/LSTMâ€è¿™ä¸¤ä¸ªæœ¯è¯­ï¼Œä½†æœ¬æ–‡ä¸­çš„æ‰€æœ‰å®éªŒéƒ½ä½¿ç”¨LSTMã€‚</p><h1 id="character-level-language-models"><a href="#Character-Level-Language-Models" class="headerlink" title="Character-Level Language Models"></a>Character-Level Language Models</h1><p>å­—ç¬¦çº§è¯­è¨€æ¨¡å‹</p><p>Okay, so we have an idea about what RNNs are, why they are super exciting, and how they work. Weâ€™ll now ground this in a fun application: Weâ€™ll train RNN character-level language models. That is, weâ€™ll give the RNN a huge chunk of text and ask it to model the probability distribution of the next character in the sequence given a sequence of previous characters. This will then allow us to generate new text one character at a time.<br>å¥½çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å·²ç»å¯¹RNNæ˜¯ä»€ä¹ˆã€ä¸ºä»€ä¹ˆå®ƒä»¬éå¸¸ä»¤äººå…´å¥‹ä»¥åŠå®ƒä»¬å¦‚ä½•å·¥ä½œæœ‰äº†ä¸€å®šçš„äº†è§£ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†æŠŠè¿™äº›çŸ¥è¯†åº”ç”¨åˆ°ä¸€ä¸ªæœ‰è¶£çš„å®é™…åº”ç”¨ä¸­ï¼šæˆ‘ä»¬å°†è®­ç»ƒRNNå­—ç¬¦çº§åˆ«çš„è¯­è¨€æ¨¡å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¼šç»™RNNæä¾›ä¸€å¤§æ®µæ–‡æœ¬ï¼Œå¹¶è®©å®ƒæ ¹æ®å‰é¢å­—ç¬¦çš„åºåˆ—æ¥å»ºæ¨¡ä¸‹ä¸€ä¸ªå­—ç¬¦çš„æ¦‚ç‡åˆ†å¸ƒã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸€æ¬¡ç”Ÿæˆä¸€ä¸ªå­—ç¬¦çš„æ–°æ–‡æœ¬ã€‚</p><p>As a working example, suppose we only had a vocabulary of four possible letters â€œheloâ€, and wanted to train an RNN on the training sequence â€œhelloâ€. This training sequence is in fact a source of 4 separate training examples: 1. The probability of â€œeâ€ should be likely given the context of â€œhâ€, 2. â€œlâ€ should be likely in the context of â€œheâ€, 3. â€œlâ€ should also be likely given the context of â€œhelâ€, and finally 4. â€œoâ€ should be likely given the context of â€œhellâ€.<br>ä½œä¸ºä¸€ä¸ªå®é™…ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬åªæœ‰å››ä¸ªå¯èƒ½çš„å­—æ¯â€œheloâ€çš„è¯æ±‡è¡¨ï¼Œå¹¶ä¸”æƒ³è¦åœ¨è®­ç»ƒåºåˆ—â€œhelloâ€ä¸Šè®­ç»ƒä¸€ä¸ªRNNã€‚è¿™ä¸ªè®­ç»ƒåºåˆ—å®é™…ä¸Šæ˜¯å››ä¸ªç‹¬ç«‹çš„è®­ç»ƒç¤ºä¾‹çš„æ¥æºï¼š</p><ol><li>åœ¨â€œhâ€çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œâ€œeâ€çš„æ¦‚ç‡åº”è¯¥å¾ˆå¤§ã€‚</li><li>åœ¨â€œheâ€çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œâ€œlâ€çš„æ¦‚ç‡åº”è¯¥å¾ˆå¤§ã€‚</li><li>åœ¨â€œhelâ€çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œâ€œlâ€çš„æ¦‚ç‡ä¹Ÿåº”è¯¥å¾ˆå¤§ã€‚</li><li>æœ€åï¼Œåœ¨â€œhellâ€çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œâ€œoâ€çš„æ¦‚ç‡åº”è¯¥å¾ˆå¤§ã€‚</li></ol><p>Concretely, we will encode each character into a vector using 1-of-k encoding (i.e. all zero except for a single one at the index of the character in the vocabulary), and feed them into the RNN one at a time with the <code>step</code> function. We will then observe a sequence of 4-dimensional output vectors (one dimension per character), which we interpret as the confidence the RNN currently assigns to each character coming next in the sequence. Hereâ€™s a diagram:<br>å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨1-of-kç¼–ç å°†æ¯ä¸ªå­—ç¬¦ç¼–ç æˆä¸€ä¸ªå‘é‡ï¼ˆå³ï¼Œé™¤äº†åœ¨è¯æ±‡è¡¨ä¸­å­—ç¬¦ç´¢å¼•å¤„ä¸º1ï¼Œå…¶ä½™å…¨ä¸º0ï¼‰ï¼Œç„¶åç”¨stepå‡½æ•°å°†å®ƒä»¬é€ä¸€è¾“å…¥RNNã€‚éšåï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ç³»åˆ—4ç»´è¾“å‡ºå‘é‡ï¼ˆæ¯ä¸ªå­—ç¬¦ä¸€ä¸ªç»´åº¦ï¼‰ï¼Œæˆ‘ä»¬å°†è¿™äº›è¾“å‡ºå‘é‡è§£é‡Šä¸ºRNNå½“å‰å¯¹åºåˆ—ä¸­ä¸‹ä¸€ä¸ªå­—ç¬¦çš„ç½®ä¿¡åº¦ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºæ„å›¾ï¼š</p><img src="/2472be8a/2.png" class><p>An example RNN with 4-dimensional input and output layers, and a hidden layer of 3 units (neurons). This diagram shows the activations in the forward pass when the RNN is fed the characters â€œhellâ€ as input. The output layer contains confidences the RNN assigns for the next character (vocabulary is â€œh,e,l,oâ€); We want the green numbers to be high and red numbers to be low.<br>å…·æœ‰ 4 ç»´è¾“å…¥å’Œè¾“å‡ºå±‚çš„ç¤ºä¾‹ RNNï¼Œä»¥åŠ 3 ä¸ªå•å…ƒï¼ˆç¥ç»å…ƒï¼‰çš„éšè—å±‚ã€‚æ­¤å›¾æ˜¾ç¤ºäº†å°†å­—ç¬¦â€œhellâ€ä½œä¸ºè¾“å…¥é¦ˆé€ RNN æ—¶å‰å‘ä¼ é€’ä¸­çš„æ¿€æ´»ã€‚è¾“å‡ºå±‚åŒ…å« RNN ä¸ºä¸‹ä¸€ä¸ªå­—ç¬¦åˆ†é…çš„ç½®ä¿¡åº¦ï¼ˆè¯æ±‡ä¸ºâ€œhï¼Œeï¼Œlï¼Œoâ€ï¼‰;æˆ‘ä»¬å¸Œæœ›ç»¿è‰²æ•°å­—é«˜ï¼Œçº¢è‰²æ•°å­—ä½ã€‚</p><p>âš ï¸ï¼š W_xh æŒ‡è¾“å…¥å±‚å’Œéšè—å±‚ä¹‹é—´çš„æƒé‡çŸ©é˜µï¼Œ W_hh æŒ‡éšè—å±‚ä¹‹é—´çš„æƒé‡çŸ©é˜µï¼Œ W_hy æŒ‡éšè—å±‚å’Œè¾“å‡ºå±‚ä¹‹é—´çš„æƒé‡çŸ©é˜µ</p><p>For example, we see that in the first time step when the RNN saw the character â€œhâ€ it assigned confidence of 1.0 to the next letter being â€œhâ€, 2.2 to letter â€œeâ€, -3.0 to â€œlâ€, and 4.1 to â€œoâ€. Since in our training data (the string â€œhelloâ€) the next correct character is â€œeâ€, we would like to increase its confidence (green) and decrease the confidence of all other letters (red). Similarly, we have a desired target character at every one of the 4 time steps that weâ€™d like the network to assign a greater confidence to. Since the RNN consists entirely of differentiable operations we can run the backpropagation algorithm (this is just a recursive application of the chain rule from calculus) to figure out in what direction we should adjust every one of its weights to increase the scores of the correct targets (green bold numbers). We can then perform a _parameter update_, which nudges every weight a tiny amount in this gradient direction. If we were to feed the same inputs to the RNN after the parameter update we would find that the scores of the correct characters (e.g. â€œeâ€ in the first time step) would be slightly higher (e.g. 2.3 instead of 2.2), and the scores of incorrect characters would be slightly lower. We then repeat this process over and over many times until the network converges and its predictions are eventually consistent with the training data in that correct characters are always predicted next.<br>ä¾‹å¦‚ï¼Œæˆ‘ä»¬çœ‹åˆ°åœ¨ç¬¬ä¸€ä¸ªæ—¶é—´æ­¥ä¸­ï¼Œå½“RNNçœ‹åˆ°å­—ç¬¦â€œhâ€æ—¶ï¼Œå®ƒå¯¹ä¸‹ä¸€ä¸ªå­—ç¬¦çš„ç½®ä¿¡åº¦åˆ†é…ä¸ºï¼šå­—ç¬¦â€œhâ€æ˜¯1.0ï¼Œå­—ç¬¦â€œeâ€æ˜¯2.2ï¼Œå­—ç¬¦â€œlâ€æ˜¯-3.0ï¼Œå­—ç¬¦â€œoâ€æ˜¯4.1ã€‚ç”±äºåœ¨æˆ‘ä»¬çš„è®­ç»ƒæ•°æ®ï¼ˆå­—ç¬¦ä¸²â€œhelloâ€ï¼‰ä¸­ï¼Œä¸‹ä¸€ä¸ªæ­£ç¡®å­—ç¬¦æ˜¯â€œeâ€ï¼Œæˆ‘ä»¬å¸Œæœ›å¢åŠ â€œeâ€çš„ç½®ä¿¡åº¦ï¼ˆç”¨ç»¿è‰²è¡¨ç¤ºï¼‰ï¼Œå¹¶é™ä½æ‰€æœ‰å…¶ä»–å­—ç¬¦çš„ç½®ä¿¡åº¦ï¼ˆç”¨çº¢è‰²è¡¨ç¤ºï¼‰ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨æ¯ä¸€ä¸ªæ—¶é—´æ­¥ä¸Šï¼Œæˆ‘ä»¬éƒ½æœ‰ä¸€ä¸ªæœŸæœ›çš„ç›®æ ‡å­—ç¬¦ï¼Œå¸Œæœ›ç½‘ç»œèƒ½å¯¹å…¶åˆ†é…æ›´é«˜çš„ç½®ä¿¡åº¦ã€‚ç”±äºRNNå®Œå…¨ç”±å¯å¾®æ“ä½œç»„æˆï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œåå‘ä¼ æ’­ç®—æ³•ï¼ˆè¿™åªæ˜¯å¾®ç§¯åˆ†ä¸­é“¾å¼æ³•åˆ™çš„é€’å½’åº”ç”¨ï¼‰æ¥ç¡®å®šåº”è°ƒæ•´æ¯ä¸ªæƒé‡çš„æ–¹å‘ï¼Œä»¥æé«˜æ­£ç¡®ç›®æ ‡çš„å¾—åˆ†ï¼ˆç»¿è‰²åŠ ç²—æ•°å­—ï¼‰ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œå‚æ•°æ›´æ–°ï¼Œå°†æ¯ä¸ªæƒé‡åœ¨è¯¥æ¢¯åº¦æ–¹å‘ä¸Šå¾®è°ƒä¸€ä¸ªå°é‡ã€‚å¦‚æœåœ¨å‚æ•°æ›´æ–°åå†æ¬¡å°†ç›¸åŒçš„è¾“å…¥æä¾›ç»™RNNï¼Œæˆ‘ä»¬ä¼šå‘ç°æ­£ç¡®å­—ç¬¦çš„å¾—åˆ†ï¼ˆä¾‹å¦‚ï¼Œç¬¬ä¸€ä¸ªæ—¶é—´æ­¥ä¸­çš„â€œeâ€ï¼‰ä¼šç•¥æœ‰æé«˜ï¼ˆä¾‹å¦‚ï¼Œä»2.2æé«˜åˆ°2.3ï¼‰ï¼Œè€Œé”™è¯¯å­—ç¬¦çš„å¾—åˆ†ä¼šç•¥æœ‰é™ä½ã€‚ç„¶åï¼Œæˆ‘ä»¬åå¤è¿›è¡Œè¿™ä¸ªè¿‡ç¨‹å¤šæ¬¡ï¼Œç›´åˆ°ç½‘ç»œæ”¶æ•›ï¼Œå…¶é¢„æµ‹æœ€ç»ˆä¸è®­ç»ƒæ•°æ®ä¸€è‡´ï¼Œå³æ€»æ˜¯é¢„æµ‹å‡ºæ­£ç¡®çš„ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚</p><p>âš ï¸ï¼šå›¾ä¸­output å±‚ æ•°å­—å¹¶ä¸æ˜¯ç½®ä¿¡åº¦ï¼Œè€Œæ˜¯logits, è¿™äº›logitså¹¶ä¸ç›´æ¥è¡¨ç¤ºæ¦‚ç‡/ç½®ä¿¡åº¦,è¦å°†è¿™äº›logitsè½¬åŒ–ä¸ºæ¦‚ç‡ï¼ˆç½®ä¿¡åº¦ï¼‰ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨Softmaxå‡½æ•°ã€‚</p><p>A more technical explanation is that we use the standard Softmax classifier (also commonly referred to as the cross-entropy loss) on every output vector simultaneously. The RNN is trained with mini-batch Stochastic Gradient Descent and I like to use <a href="http://arxiv.org/abs/1502.04390">RMSProp</a> or Adam (per-parameter adaptive learning rate methods) to stablilize the updates.<br>æ›´æŠ€æœ¯æ€§çš„è§£é‡Šæ˜¯ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªè¾“å‡ºå‘é‡ä¸Š åŒæ—¶ä½¿ç”¨æ ‡å‡†çš„Softmaxåˆ†ç±»å™¨ï¼ˆä¹Ÿå¸¸è¢«ç§°ä¸ºäº¤å‰ç†µæŸå¤±ï¼‰ã€‚RNNä½¿ç”¨å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™æ³•è¿›è¡Œè®­ç»ƒï¼Œæˆ‘å–œæ¬¢ä½¿ç”¨RMSPropæˆ–Adamï¼ˆæ¯ä¸ªå‚æ•°çš„è‡ªé€‚åº”å­¦ä¹ ç‡æ–¹æ³•ï¼‰æ¥ç¨³å®šæ›´æ–°ã€‚</p><p>Notice also that the first time the character â€œlâ€ is input, the target is â€œlâ€, but the second time the target is â€œoâ€. The RNN therefore cannot rely on the input alone and must use its recurrent connection to keep track of the context to achieve this task.<br>å¦è¯·æ³¨æ„ï¼Œç¬¬ä¸€æ¬¡è¾“å…¥å­—ç¬¦â€œlâ€æ—¶ï¼Œç›®æ ‡æ˜¯â€œlâ€ï¼Œä½†ç¬¬äºŒæ¬¡ç›®æ ‡æ˜¯â€œoâ€ã€‚å› æ­¤ï¼ŒRNN ä¸èƒ½å•ç‹¬ä¾èµ–è¾“å…¥ï¼Œå¿…é¡»ä½¿ç”¨å…¶å¾ªç¯è¿æ¥æ¥è·Ÿè¸ªä¸Šä¸‹æ–‡ä»¥å®ç°æ­¤ä»»åŠ¡ã€‚</p><p>At <strong>test time</strong>, we feed a character into the RNN and get a distribution over what characters are likely to come next. We sample from this distribution, and feed it right back in to get the next letter. Repeat this process and youâ€™re sampling text! Lets now train an RNN on different datasets and see what happens.<br>åœ¨æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªå­—ç¬¦è¾“å…¥RNNï¼Œå¹¶è·å¾—ä¸‹ä¸€ä¸ªå­—ç¬¦å¯èƒ½å‡ºç°çš„æ¦‚ç‡åˆ†å¸ƒã€‚æˆ‘ä»¬ä»è¿™ä¸ªåˆ†å¸ƒä¸­é‡‡æ ·ï¼Œå¹¶å°†é‡‡æ ·å¾—åˆ°çš„å­—ç¬¦å†æ¬¡è¾“å…¥RNNä»¥è·å–ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œå°±å¯ä»¥ç”Ÿæˆæ–‡æœ¬äº†ï¼ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨ä¸åŒçš„æ•°æ®é›†ä¸Šè®­ç»ƒä¸€ä¸ªRNNï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><p>To further clarify, for educational purposes I also wrote a <a href="https://gist.github.com/karpathy/d4dee566867f8291f086">minimal character-level RNN language model in Python/numpy</a>. It is only about 100 lines long and hopefully it gives a concise, concrete and useful summary of the above if youâ€™re better at reading code than text. Weâ€™ll now dive into example results, produced with the much more efficient Lua/Torch codebase.<br>ä¸ºäº†è¿›ä¸€æ­¥è¯´æ˜ï¼Œæˆ‘è¿˜ç”¨Pythonå’Œnumpyç¼–å†™äº†ä¸€ä¸ªæœ€å°çš„å­—ç¬¦çº§RNNè¯­è¨€æ¨¡å‹ã€‚å®ƒåªæœ‰å¤§çº¦100è¡Œä»£ç ï¼Œå¸Œæœ›èƒ½ä¸ºä½ æä¾›ä¸€ä¸ªç®€æ´ã€å…·ä½“ä¸”æœ‰ç”¨çš„æ€»ç»“ï¼Œå¦‚æœä½ æ›´æ“…é•¿é˜…è¯»ä»£ç è€Œä¸æ˜¯æ–‡å­—ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ä½¿ç”¨æ›´åŠ é«˜æ•ˆçš„Lua/Torchä»£ç åº“ç”Ÿæˆçš„ç¤ºä¾‹ç»“æœã€‚</p><h1 id="fun-with-rnns"><a href="#Fun-with-RNNs" class="headerlink" title="Fun with RNNs"></a>Fun with RNNs</h1><p>All 5 example character models below were trained with the <a href="https://github.com/karpathy/char-rnn">code</a> Iâ€™m releasing on Github. The input in each case is a single file with some text, and weâ€™re training an RNN to predict the next character in the sequence.<br>ä¸‹é¢çš„æ‰€æœ‰ 5 ä¸ªç¤ºä¾‹å­—ç¬¦æ¨¡å‹éƒ½æ˜¯ä½¿ç”¨æˆ‘åœ¨ Github ä¸Šå‘å¸ƒçš„ä»£ç è®­ç»ƒçš„ã€‚æ¯ç§æƒ…å†µä¸‹çš„è¾“å…¥éƒ½æ˜¯ä¸€ä¸ªåŒ…å«ä¸€äº›æ–‡æœ¬çš„å•ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬æ­£åœ¨è®­ç»ƒä¸€ä¸ª RNN æ¥é¢„æµ‹åºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚</p><h3 id="paul-graham-generator-ä¿ç½—æ ¼é›·å„å§†å‘ç”µæœº"><a href="#Paul-Graham-generator-ä¿ç½—Â·æ ¼é›·å„å§†å‘ç”µæœº" class="headerlink" title="Paul Graham generator ä¿ç½—Â·æ ¼é›·å„å§†å‘ç”µæœº"></a>Paul Graham generator ä¿ç½—Â·æ ¼é›·å„å§†å‘ç”µæœº</h3><p>Lets first try a small dataset of English as a sanity check. My favorite fun dataset is the concatenation of <a href="http://www.paulgraham.com/articles.html">Paul Grahamâ€™s essays</a>. The basic idea is that thereâ€™s a lot of wisdom in these essays, but unfortunately Paul Graham is a relatively slow generator. Wouldnâ€™t it be great if we could sample startup wisdom on demand? Thatâ€™s where an RNN comes in.<br>è®©æˆ‘ä»¬é¦–å…ˆå°è¯•ä¸€ä¸ªå°å‹çš„è‹±æ–‡æ•°æ®é›†æ¥è¿›è¡ŒåŸºæœ¬æ£€æŸ¥ã€‚æˆ‘æœ€å–œæ¬¢çš„æœ‰è¶£æ•°æ®é›†æ˜¯ä¿ç½—Â·æ ¼é›·å„å§†ï¼ˆPaul Grahamï¼‰çš„æ–‡ç« åˆé›†ã€‚åŸºæœ¬æƒ³æ³•æ˜¯ï¼Œè¿™äº›æ–‡ç« ä¸­æœ‰å¾ˆå¤šæ™ºæ…§ï¼Œä½†é—æ†¾çš„æ˜¯ï¼Œä¿ç½—Â·æ ¼é›·å„å§†çš„å†™ä½œé€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ã€‚å¦‚æœæˆ‘ä»¬èƒ½æŒ‰éœ€é‡‡æ ·åˆ›ä¸šæ™ºæ…§ï¼Œé‚£ä¸æ˜¯å¾ˆæ£’å—ï¼Ÿè¿™æ­£æ˜¯RNNçš„ç”¨æ­¦ä¹‹åœ°ã€‚</p><p>Concatenating all pg essays over the last ~5 years we get approximately 1MB text file, or about 1 million characters (this is considered a very small dataset by the way). _Technical:_ Lets train a 2-layer LSTM with 512 hidden nodes (approx. 3.5 million parameters), and with dropout of 0.5 after each layer. Weâ€™ll train with batches of 100 examples and truncated backpropagation through time of length 100 characters. With these settings one batch on a TITAN Z GPU takes about 0.46 seconds (this can be cut in half with 50 character BPTT at negligible cost in performance). Without further ado, lets see a sample from the RNN:<br>å°†è¿‡å»å¤§çº¦5å¹´é—´çš„æ‰€æœ‰ä¿ç½—Â·æ ¼é›·å„å§†çš„æ–‡ç« åˆå¹¶èµ·æ¥ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå¤§çº¦1MBçš„æ–‡æœ¬æ–‡ä»¶ï¼Œçº¦100ä¸‡ä¸ªå­—ç¬¦ï¼ˆé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œè¿™è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªéå¸¸å°çš„æ•°æ®é›†ï¼‰ã€‚æŠ€æœ¯ç»†èŠ‚ï¼šè®©æˆ‘ä»¬è®­ç»ƒä¸€ä¸ªå…·æœ‰2å±‚ã€æ¯å±‚512ä¸ªéšè—èŠ‚ç‚¹çš„LSTMï¼ˆå¤§çº¦350ä¸‡ä¸ªå‚æ•°ï¼‰ï¼Œå¹¶åœ¨æ¯å±‚ä¹‹åä½¿ç”¨0.5çš„dropoutã€‚æˆ‘ä»¬å°†ä½¿ç”¨100ä¸ªæ ·æœ¬çš„æ‰¹æ¬¡å’Œé•¿åº¦ä¸º100å­—ç¬¦çš„æˆªæ–­æ—¶é—´åå‘ä¼ æ’­è¿›è¡Œè®­ç»ƒã€‚åœ¨è¿™äº›è®¾ç½®ä¸‹ï¼Œåœ¨TITAN Z GPUä¸Šå¤„ç†ä¸€ä¸ªæ‰¹æ¬¡å¤§çº¦éœ€è¦0.46ç§’ï¼ˆä½¿ç”¨50å­—ç¬¦çš„æˆªæ–­æ—¶é—´åå‘ä¼ æ’­ï¼Œå‡ ä¹ä¸ä¼šå½±å“æ€§èƒ½ï¼Œå¯ä»¥å°†æ—¶é—´å‡åŠï¼‰ã€‚äº‹ä¸å®œè¿Ÿï¼Œè®©æˆ‘ä»¬çœ‹çœ‹RNNç”Ÿæˆçš„ä¸€ä¸ªæ ·æœ¬ï¼š</p><p>_â€œThe surprised in investors werenâ€™t going to raise money. Iâ€™m not the company with the time there are all interesting quickly, donâ€™t have to get off the same programmers. Thereâ€™s a super-angel round fundraising, why do you can do. If you have a different physical investment are become in people who reduced in a startup with the way to argument the acquirer could see them just that youâ€™re also the founders will part of usersâ€™ affords that and an alternation to the idea. [2] Donâ€™t work at first member to see the way kids will seem in advance of a bad successful startup. And if you have to act the big company too.â€_<br>_â€œæŠ•èµ„è€…çš„æƒŠè®¶æ˜¯ï¼Œä»–ä»¬å¹¶ä¸æ‰“ç®—ç­¹é›†èµ„é‡‘ã€‚æˆ‘ä¸æ˜¯é‚£ä¸ªæœ‰æ—¶é—´çš„å…¬å¸ï¼Œæœ‰è¶£çš„äº‹æƒ…å¾ˆå¿«å°±ä¼šå‡ºç°ï¼Œä¸éœ€è¦è®©ç›¸åŒçš„ç¨‹åºå‘˜ç¦»å¼€ã€‚æœ‰ä¸€ä¸ªè¶…çº§å¤©ä½¿è½®çš„èèµ„ï¼Œä½ ä¸ºä»€ä¹ˆè¦è¿™æ ·åšã€‚å¦‚æœä½ æœ‰ä¸åŒçš„å®ä½“æŠ•èµ„ï¼Œä¼šæˆä¸ºé‚£äº›åœ¨åˆåˆ›å…¬å¸é‡Œå‡å°‘çš„äººä¸­äº‰è®ºçš„æ–¹å¼ï¼Œæ”¶è´­è€…å¯èƒ½ä¼šçœ‹åˆ°ä»–ä»¬åªæ˜¯åˆ›å§‹äººå°†æˆä¸ºç”¨æˆ·åŠªåŠ›çš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ˜¯å¯¹æƒ³æ³•çš„ä¸€ç§æ›¿ä»£ã€‚[2] ä¸€å¼€å§‹ä¸è¦åœ¨æˆå‘˜èº«ä¸Šå·¥ä½œï¼Œçœ‹å­©å­ä»¬å°†å¦‚ä½•æå‰åœ¨ä¸€ä¸ªå¤±è´¥çš„æˆåŠŸåˆåˆ›å…¬å¸ä¸­è¡¨ç°å‡ºæ¥ã€‚è€Œä¸”ï¼Œå¦‚æœä½ å¿…é¡»è¡ŒåŠ¨ï¼Œé‚£ä¹ˆå¤§å…¬å¸ä¹Ÿä¸€æ ·ã€‚â€_</p><p>Okay, clearly the above is unfortunately not going to replace Paul Graham anytime soon, but remember that the RNN had to learn English completely from scratch and with a small dataset (including where you put commas, apostrophes and spaces). I also like that it learns to support its own arguments (e.g. [2], above). Sometimes it says something that offers a glimmer of insight, such as _â€œa company is a meeting to think to investorsâ€_. <a href="http://cs.stanford.edu/people/karpathy/char-rnn/pg.txt">Hereâ€™s</a> a link to 50K character sample if youâ€™d like to see more.<br>å¥½çš„ï¼Œå¾ˆæ˜æ˜¾ï¼Œä»¥ä¸Šå†…å®¹æš‚æ—¶è¿˜æ— æ³•æ›¿ä»£ä¿ç½—Â·æ ¼é›·å„å§†ï¼Œä½†è¯·è®°ä½ï¼ŒRNNå¿…é¡»ä»é›¶å¼€å§‹å­¦ä¹ è‹±è¯­ï¼Œè€Œä¸”æ˜¯ç”¨ä¸€ä¸ªå°æ•°æ®é›†ï¼ˆåŒ…æ‹¬é€—å·ã€æ’‡å·å’Œç©ºæ ¼çš„ä½ç½®ï¼‰ã€‚æˆ‘ä¹Ÿå–œæ¬¢å®ƒå­¦ä¼šäº†æ”¯æŒè‡ªå·±çš„è®ºç‚¹ï¼ˆä¾‹å¦‚ï¼Œä¸Šæ–‡ä¸­çš„[2]ï¼‰ã€‚æœ‰æ—¶ï¼Œå®ƒä¼šè¯´å‡ºä¸€äº›ç•¥å¸¦å¯å‘æ€§çš„è¯ï¼Œæ¯”å¦‚â€œa company is a meeting to think to investorsâ€ï¼ˆå…¬å¸æ˜¯ä¸æŠ•èµ„è€…æ€è€ƒçš„ä¼šè®®ï¼‰ã€‚å¦‚æœä½ æƒ³æŸ¥çœ‹æ›´å¤šï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª50Kå­—ç¬¦çš„æ ·æœ¬é“¾æ¥ã€‚</p><p><strong>Temperature.</strong> We can also play with the temperature of the Softmax during sampling. Decreasing the temperature from 1 to some lower number (e.g. 0.5) makes the RNN more confident, but also more conservative in its samples. Conversely, higher temperatures will give more diversity but at cost of more mistakes (e.g. spelling mistakes, etc). In particular, setting temperature very near zero will give the most likely thing that Paul Graham might say:<br>æ¸©åº¦ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨é‡‡æ ·è¿‡ç¨‹ä¸­è°ƒæ•´Softmaxçš„æ¸©åº¦ã€‚å°†æ¸©åº¦ä»1é™ä½åˆ°æŸä¸ªè¾ƒä½çš„æ•°å€¼ï¼ˆä¾‹å¦‚0.5ï¼‰ï¼Œä¼šä½¿RNNæ›´æœ‰ä¿¡å¿ƒï¼Œä½†ä¹Ÿæ›´ä¿å®ˆäºå…¶é‡‡æ ·ç»“æœã€‚ç›¸åï¼Œè¾ƒé«˜çš„æ¸©åº¦ä¼šå¸¦æ¥æ›´å¤šçš„å¤šæ ·æ€§ï¼Œä½†ä»£ä»·æ˜¯ä¼šæœ‰æ›´å¤šçš„é”™è¯¯ï¼ˆä¾‹å¦‚æ‹¼å†™é”™è¯¯ç­‰ï¼‰ã€‚ç‰¹åˆ«æ˜¯ï¼Œå°†æ¸©åº¦è®¾ç½®å¾—éå¸¸æ¥è¿‘é›¶ï¼Œä¼šäº§ç”Ÿæœ€æœ‰å¯èƒ½æ˜¯ä¿ç½—Â·æ ¼é›·å„å§†ä¼šè¯´çš„è¯ï¼š</p><p>_â€œis that they were all the same thing that was a startup is that they were all the same thing that was a startup is that they were all the same thing that was a startup is that they were all the sameâ€<br>â€œä»–ä»¬éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåˆ›ä¸šå…¬å¸æ˜¯ï¼Œä»–ä»¬éƒ½æ˜¯åˆ›ä¸šå…¬å¸ï¼Œä»–ä»¬éƒ½æ˜¯ä¸€æ ·çš„åˆ›ä¸šå…¬å¸ï¼Œä»–ä»¬éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåˆ›ä¸šå…¬å¸æ˜¯ä¸€æ ·çš„â€_</p><p>looks like weâ€™ve reached an infinite loop about startups.<br>çœ‹èµ·æ¥æˆ‘ä»¬å·²ç»è¾¾åˆ°äº†ä¸€ä¸ªå…³äºåˆåˆ›å…¬å¸çš„æ— é™å¾ªç¯ã€‚</p><h3 id="shakespeare-èå£«æ¯”äºš"><a href="#Shakespeare-èå£«æ¯”äºš" class="headerlink" title="Shakespeare èå£«æ¯”äºš"></a>Shakespeare èå£«æ¯”äºš</h3><p>It looks like we can learn to spell English words. But how about if there is more structure and style in the data? To examine this I downloaded all the works of Shakespeare and concatenated them into a single (4.4MB) file. We can now afford to train a larger network, in this case lets try a 3-layer RNN with 512 hidden nodes on each layer. After we train the network for a few hours we obtain samples such as:<br>çœ‹èµ·æ¥æˆ‘ä»¬å¯ä»¥å­¦ä¼šæ‹¼å†™è‹±è¯­å•è¯ã€‚ä½†å¦‚æœæ•°æ®ä¸­æœ‰æ›´å¤šçš„ç»“æ„å’Œé£æ ¼å‘¢ï¼Ÿä¸ºæ­¤ï¼Œæˆ‘ä¸‹è½½äº†èå£«æ¯”äºšçš„æ‰€æœ‰ä½œå“ï¼Œå¹¶å°†å®ƒä»¬åˆå¹¶æˆä¸€ä¸ªå•ä¸€çš„ï¼ˆ4.4MBï¼‰æ–‡ä»¶ã€‚æˆ‘ä»¬ç°åœ¨æœ‰èƒ½åŠ›è®­ç»ƒä¸€ä¸ªæ›´å¤§çš„ç½‘ç»œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®©æˆ‘ä»¬å°è¯•ä¸€ä¸ª3å±‚çš„RNNï¼Œæ¯å±‚æœ‰512ä¸ªéšè—èŠ‚ç‚¹ã€‚ç»è¿‡å‡ ä¸ªå°æ—¶çš„è®­ç»ƒï¼Œæˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹æ ·æœ¬ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">PANDARUS:</span><br><span class="line">Alas, I think he shall be come approached and the day</span><br><span class="line">When little srain would be attain&#x27;d into being never fed,</span><br><span class="line">And who is but a chain and subjects of his death,</span><br><span class="line">I should not sleep.</span><br><span class="line"></span><br><span class="line">Second Senator:</span><br><span class="line">They are away this miseries, produced upon my soul,</span><br><span class="line">Breaking and strongly should be buried, when I perish</span><br><span class="line">The earth and thoughts of many states.</span><br><span class="line"></span><br><span class="line">DUKE VINCENTIO:</span><br><span class="line">Well, your wit is in the care of side and that.</span><br><span class="line"></span><br><span class="line">Second Lord:</span><br><span class="line">They would be ruled after this chamber, and</span><br><span class="line">my fair nues begun out of the fact, to be conveyed,</span><br><span class="line">Whose noble souls I&#x27;ll have the heart of the wars.</span><br><span class="line"></span><br><span class="line">Clown:</span><br><span class="line">Come, sir, I will make did behold your worship.</span><br><span class="line"></span><br><span class="line">VIOLA:</span><br><span class="line">I&#x27;ll drink it.</span><br></pre></td></tr></table></figure></p><p>Remember, all the RNN knows are characters, so in particular it samples both speakerâ€™s names and the contents. Sometimes we also get relatively extented monologue passages, such as:<br>è¯·è®°ä½ï¼ŒRNNæ‰€çŸ¥é“çš„åªæœ‰å­—ç¬¦ï¼Œå› æ­¤å®ƒæ—¢é‡‡æ ·è¯´è¯è€…çš„åå­—ï¼Œä¹Ÿé‡‡æ ·å†…å®¹ã€‚æœ‰æ—¶æˆ‘ä»¬è¿˜ä¼šå¾—åˆ°ç›¸å¯¹è¾ƒé•¿çš„ç‹¬ç™½æ®µè½ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">VIOLA:</span><br><span class="line">Why, Salisbury must find his flesh and thought</span><br><span class="line">That which I am not aps, not a man and in fire,</span><br><span class="line">To show the reining of the raven and the wars</span><br><span class="line">To grace my hand reproach within, and not a fair are hand,</span><br><span class="line">That Caesar and my goodly father&#x27;s world;</span><br><span class="line">When I was heaven of presence and our fleets,</span><br><span class="line">We spare with hours, but cut thy council I am great,</span><br><span class="line">Murdered and by thy master&#x27;s ready there</span><br><span class="line">My power to give thee but so much as hell:</span><br><span class="line">Some service in the noble bondman here,</span><br><span class="line">Would show him to her wine.</span><br><span class="line"></span><br><span class="line">KING LEAR:</span><br><span class="line">O, if you were a feeble sight, the courtesy of your law,</span><br><span class="line">Your sight and several breath, will wear the gods</span><br><span class="line">With his heads, and my hands are wonder&#x27;d at the deeds,</span><br><span class="line">So drop upon your lordship&#x27;s head, and your opinion</span><br><span class="line">Shall be against your honour.</span><br></pre></td></tr></table></figure></p><p>I can barely recognize these samples from actual Shakespeare :) If you like Shakespeare, you might appreciate this 100,000 character sample. Of course, you can also generate an infinite amount of your own samples at different temperatures with the provided code.<br>æˆ‘å‡ ä¹æ— æ³•è¾¨è®¤è¿™äº›æ ·æœ¬æ˜¯å¦çœŸçš„æ˜¯èå£«æ¯”äºšçš„ä½œå“ :) å¦‚æœä½ å–œæ¬¢èå£«æ¯”äºšï¼Œä½ å¯èƒ½ä¼šå–œæ¬¢è¿™ä¸ª10ä¸‡å­—ç¬¦çš„æ ·æœ¬ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æä¾›çš„ä»£ç åœ¨ä¸åŒæ¸©åº¦ä¸‹ç”Ÿæˆæ— é™é‡çš„æ ·æœ¬ã€‚</p><h3 id="wikipedia-ç»´åŸºç™¾ç§‘"><a href="#Wikipedia-ç»´åŸºç™¾ç§‘" class="headerlink" title="Wikipedia ç»´åŸºç™¾ç§‘"></a>Wikipedia ç»´åŸºç™¾ç§‘</h3><p>We saw that the LSTM can learn to spell words and copy general syntactic structures. Lets further increase the difficulty and train on structured markdown. In particular, lets take the <a href="http://prize.hutter1.net/">Hutter Prize</a> 100MB dataset of raw Wikipedia and train an LSTM. Following <a href="http://arxiv.org/abs/1308.0850">Graves et al.</a>, I used the first 96MB for training, the rest for validation and ran a few models overnight. We can now sample Wikipedia articles! Below are a few fun excerpts. First, some basic markdown output:<br>æˆ‘ä»¬å·²ç»çœ‹åˆ°LSTMå¯ä»¥å­¦ä¼šæ‹¼å†™å•è¯å’Œå¤åˆ¶ä¸€èˆ¬çš„å¥æ³•ç»“æ„ã€‚è®©æˆ‘ä»¬è¿›ä¸€æ­¥å¢åŠ éš¾åº¦ï¼Œè®­ç»ƒåœ¨ç»“æ„åŒ–çš„Markdownä¸Šã€‚ç‰¹åˆ«æ˜¯ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨Hutter Prizeçš„100MBåŸå§‹ç»´åŸºç™¾ç§‘æ•°æ®é›†æ¥è®­ç»ƒä¸€ä¸ªLSTMã€‚æŒ‰ç…§Gravesç­‰äººçš„æ–¹æ³•ï¼Œæˆ‘ä½¿ç”¨å‰96MBè¿›è¡Œè®­ç»ƒï¼Œå‰©ä½™çš„ç”¨äºéªŒè¯ï¼Œå¹¶åœ¨ä¸€å¤œä¹‹é—´è¿è¡Œäº†å‡ ä¸ªæ¨¡å‹ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥é‡‡æ ·ç”Ÿæˆç»´åŸºç™¾ç§‘æ–‡ç« äº†ï¼ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰è¶£çš„æ‘˜å½•ã€‚é¦–å…ˆï¼Œæ˜¯ä¸€äº›åŸºæœ¬çš„Markdownè¾“å‡ºï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Naturalism and decision for the majority of Arab countries&#x27; capitalide was grounded</span><br><span class="line">by the Irish language by [[John Clair]], [[An Imperial Japanese Revolt]], associated </span><br><span class="line">with Guangzham&#x27;s sovereignty. His generals were the powerful ruler of the Portugal </span><br><span class="line">in the [[Protestant Immineners]], which could be said to be directly in Cantonese </span><br><span class="line">Communication, which followed a ceremony and set inspired prison, training. The </span><br><span class="line">emperor travelled back to [[Antioch, Perth, October 25|21]] to note, the Kingdom </span><br><span class="line">of Costa Rica, unsuccessful fashioned the [[Thrales]], [[Cynth&#x27;s Dajoard]], known </span><br><span class="line">in western [[Scotland]], near Italy to the conquest of India with the conflict. </span><br><span class="line">Copyright was the succession of independence in the slop of Syrian influence that </span><br><span class="line">was a famous German movement based on a more popular servicious, non-doctrinal </span><br><span class="line">and sexual power post. Many governments recognize the military housing of the </span><br><span class="line">[[Civil Liberalization and Infantry Resolution 265 National Party in Hungary]], </span><br><span class="line">that is sympathetic to be to the [[Punjab Resolution]]</span><br><span class="line">(PJS)[http://www.humah.yahoo.com/guardian.</span><br><span class="line">cfm/7754800786d17551963s89.htm Official economics Adjoint for the Nazism, Montgomery </span><br><span class="line">was swear to advance to the resources for those Socialism&#x27;s rule, </span><br><span class="line">was starting to signing a major tripad of aid exile.]]</span><br></pre></td></tr></table></figure></p><p>In case you were wondering, the yahoo url above doesnâ€™t actually exist, the model just hallucinated it. Also, note that the model learns to open and close the parenthesis correctly. Thereâ€™s also quite a lot of structured markdown that the model learns, for example sometimes it creates headings, lists, etc.:<br>å¦‚æœä½ åœ¨å¥½å¥‡ï¼Œä¸Šè¿°çš„Yahooç½‘å€å®é™…ä¸Šå¹¶ä¸å­˜åœ¨ï¼Œè¿™æ˜¯æ¨¡å‹è‡†æƒ³å‡ºæ¥çš„ã€‚æ­¤å¤–ï¼Œè¯·æ³¨æ„ï¼Œæ¨¡å‹å­¦ä¼šäº†æ­£ç¡®åœ°æ‰“å¼€å’Œå…³é—­æ‹¬å·ã€‚æ¨¡å‹è¿˜å­¦ä¹ äº†å¤§é‡çš„ç»“æ„åŒ–Markdownï¼Œä¾‹å¦‚ï¼Œæœ‰æ—¶å®ƒä¼šåˆ›å»ºæ ‡é¢˜ã€åˆ—è¡¨ç­‰å†…å®¹ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123; &#123; cite journal | id=Cerling Nonforest Department|format=Newlymeslated|none &#125; &#125;</span><br><span class="line">&#x27;&#x27;www.e-complete&#x27;&#x27;.</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;See also&#x27;&#x27;&#x27;: [[List of ethical consent processing]]</span><br><span class="line"></span><br><span class="line">== See also ==</span><br><span class="line">*[[Iender dome of the ED]]</span><br><span class="line">*[[Anti-autism]]</span><br><span class="line"></span><br><span class="line">===[[Religion|Religion]]===</span><br><span class="line">*[[French Writings]]</span><br><span class="line">*[[Maria]]</span><br><span class="line">*[[Revelation]]</span><br><span class="line">*[[Mount Agamul]]</span><br><span class="line"></span><br><span class="line">== External links==</span><br><span class="line">* [http://www.biblegateway.nih.gov/entrepre/ Website of the World Festival. The labour of India-county defeats at the Ripper of California Road.]</span><br><span class="line"></span><br><span class="line">==External links==</span><br><span class="line">* [http://www.romanology.com/ Constitution of the Netherlands and Hispanic Competition for Bilabial and Commonwealth Industry (Republican Constitution of the Extent of the Netherlands)]</span><br></pre></td></tr></table></figure><br>Sometimes the model snaps into a mode of generating random but valid XML:<br>æœ‰æ—¶ï¼Œæ¨¡å‹ä¼šè¿›å…¥ç”Ÿæˆéšæœºä½†æœ‰æ•ˆçš„ XML çš„æ¨¡å¼ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;page&gt;</span><br><span class="line">  &lt;title&gt;Antichrist&lt;/title&gt;</span><br><span class="line">  &lt;id&gt;865&lt;/id&gt;</span><br><span class="line">  &lt;revision&gt;</span><br><span class="line">    &lt;id&gt;15900676&lt;/id&gt;</span><br><span class="line">    &lt;timestamp&gt;2002-08-03T18:14:12Z&lt;/timestamp&gt;</span><br><span class="line">    &lt;contributor&gt;</span><br><span class="line">      &lt;username&gt;Paris&lt;/username&gt;</span><br><span class="line">      &lt;id&gt;23&lt;/id&gt;</span><br><span class="line">    &lt;/contributor&gt;</span><br><span class="line">    &lt;minor /&gt;</span><br><span class="line">    &lt;comment&gt;Automated conversion&lt;/comment&gt;</span><br><span class="line">    &lt;text xml:space=&quot;preserve&quot;&gt;#REDIRECT [[Christianity]]&lt;/text&gt;</span><br><span class="line">  &lt;/revision&gt;</span><br><span class="line">&lt;/page&gt;</span><br></pre></td></tr></table></figure></p><p>The model completely makes up the timestamp, id, and so on. Also, note that it closes the correct tags appropriately and in the correct nested order. Here are <a href="http://cs.stanford.edu/people/karpathy/char-rnn/wiki.txt">100,000 characters of sampled wikipedia</a> if youâ€™re interested to see more.<br>è¯¥æ¨¡å‹å®Œå…¨ç”±æ—¶é—´æˆ³ã€id ç­‰ç»„æˆã€‚å¦å¤–ï¼Œè¯·æ³¨æ„ï¼Œå®ƒæ­£ç¡®åœ°å…³é—­äº†æ ‡ç­¾ï¼Œå¹¶ä¸”æŒ‰ç…§æ­£ç¡®çš„åµŒå¥—é¡ºåºã€‚è¿™é‡Œæœ‰ 100,000 ä¸ªå­—ç¬¦çš„æ ·æœ¬ç»´åŸºç™¾ç§‘ï¼Œå¦‚æœæ‚¨æœ‰å…´è¶£æŸ¥çœ‹æ›´å¤šã€‚</p><h3 id="algebraic-geometry-latex-ä»£æ•°å‡ ä½•latex"><a href="#Algebraic-Geometry-Latex-ä»£æ•°å‡ ä½•ï¼ˆLatexï¼‰" class="headerlink" title="Algebraic Geometry (Latex)  ä»£æ•°å‡ ä½•ï¼ˆLatexï¼‰"></a>Algebraic Geometry (Latex)  ä»£æ•°å‡ ä½•ï¼ˆLatexï¼‰</h3><p>The results above suggest that the model is actually quite good at learning complex syntactic structures. Impressed by these results, my labmate (<a href="http://cs.stanford.edu/people/jcjohns/">Justin Johnson</a>) and I decided to push even further into structured territories and got a hold of <a href="http://stacks.math.columbia.edu/">this book</a> on algebraic stacks/geometry. We downloaded the raw Latex source file (a 16MB file) and trained a multilayer LSTM. Amazingly, the resulting sampled Latex _almost_ compiles. We had to step in and fix a few issues manually but then you get plausible looking math, itâ€™s quite astonishing:<br>ä¸Šè¿°ç»“æœè¡¨æ˜ï¼Œæ¨¡å‹åœ¨å­¦ä¹ å¤æ‚å¥æ³•ç»“æ„æ–¹é¢å®é™…ä¸Šç›¸å½“ä¸é”™ã€‚è¿™äº›ç»“æœç»™æˆ‘ç•™ä¸‹äº†æ·±åˆ»çš„å°è±¡ï¼Œæˆ‘çš„å®éªŒå®¤åŒäº‹Justin Johnsonå’Œæˆ‘å†³å®šè¿›ä¸€æ­¥æ¢ç´¢ç»“æ„åŒ–é¢†åŸŸï¼Œå¹¶æ‰¾åˆ°äº†ä¸€æœ¬å…³äºä»£æ•°å /å‡ ä½•çš„ä¹¦ã€‚æˆ‘ä»¬ä¸‹è½½äº†åŸå§‹çš„Latexæºæ–‡ä»¶ï¼ˆä¸€ä¸ª16MBçš„æ–‡ä»¶ï¼‰å¹¶è®­ç»ƒäº†ä¸€ä¸ªå¤šå±‚LSTMã€‚ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œç”Ÿæˆçš„Latexå‡ ä¹å¯ä»¥ç¼–è¯‘ã€‚æˆ‘ä»¬ä¸å¾—ä¸æ‰‹åŠ¨ä¿®å¤ä¸€äº›é—®é¢˜ï¼Œä½†æœ€ç»ˆå¾—åˆ°äº†çœ‹èµ·æ¥å¾ˆåˆç†çš„æ•°å­¦è¡¨è¾¾ï¼Œè¿™çœŸæ˜¯ä»¤äººæƒŠå¹ï¼š<br><img src="/2472be8a/3.png" class><br>Sampled (fake) algebraic geometry. <a href="http://cs.stanford.edu/people/jcjohns/fake-math/4.pdf">Hereâ€™s the actual pdf.</a><br>é‡‡æ ·ï¼ˆå‡ï¼‰ä»£æ•°å‡ ä½•ã€‚è¿™æ˜¯å®é™…çš„pdfã€‚</p><p>Hereâ€™s another sample: ä¸‹é¢æ˜¯å¦ä¸€ä¸ªç¤ºä¾‹ï¼š<br><img src="/2472be8a/4.png" class><br>More hallucinated algebraic geometry. Nice try on the diagram (right).<br>æ›´å¤šå¹»è§‰çš„ä»£æ•°å‡ ä½•ã€‚ä¸é”™çš„å°è¯•å›¾ï¼ˆå³ï¼‰ã€‚</p><p>As you can see above, sometimes the model tries to generate latex diagrams, but clearly it hasnâ€™t really figured them out. I also like the part where it chooses to skip a proof (_â€œProof omitted.â€_, top left). Of course, keep in mind that latex has a relatively difficult structured syntactic format that I havenâ€™t even fully mastered myself. For instance, here is a raw sample from the model (unedited):<br>æ­£å¦‚ä½ åœ¨ä¸Šé¢çœ‹åˆ°çš„ï¼Œæœ‰æ—¶æ¨¡å‹å°è¯•ç”ŸæˆLatexå›¾è¡¨ï¼Œä½†æ˜¾ç„¶å®ƒè¿˜æ²¡æœ‰çœŸæ­£æŒæ¡è¿™ç§æŠ€èƒ½ã€‚æˆ‘ä¹Ÿå–œæ¬¢å®ƒé€‰æ‹©è·³è¿‡è¯æ˜çš„éƒ¨åˆ†ï¼ˆâ€œProof omitted.â€ï¼Œå·¦ä¸Šè§’ï¼‰ã€‚å½“ç„¶ï¼Œè¯·è®°ä½ï¼ŒLatexæœ‰ä¸€ä¸ªç›¸å¯¹å¤æ‚çš„ç»“æ„åŒ–å¥æ³•æ ¼å¼ï¼Œæˆ‘è‡ªå·±éƒ½è¿˜æ²¡æœ‰å®Œå…¨æŒæ¡ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯æ¨¡å‹ç”Ÿæˆçš„ä¸€ä¸ªåŸå§‹æ ·æœ¬ï¼ˆæœªç¼–è¾‘ï¼‰ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">\begin&#123;proof&#125;</span><br><span class="line">We may assume that $\mathcal&#123;I&#125;$ is an abelian sheaf on $\mathcal&#123;C&#125;$.</span><br><span class="line">\item Given a morphism $\Delta : \mathcal&#123;F&#125; \to \mathcal&#123;I&#125;$</span><br><span class="line">is an injective and let $\mathfrak q$ be an abelian sheaf on $X$.</span><br><span class="line">Let $\mathcal&#123;F&#125;$ be a fibered complex. Let $\mathcal&#123;F&#125;$ be a category.</span><br><span class="line">\begin&#123;enumerate&#125;</span><br><span class="line">\item \hyperref[setain-construction-phantom]&#123;Lemma&#125;</span><br><span class="line">\label&#123;lemma-characterize-quasi-finite&#125;</span><br><span class="line">Let $\mathcal&#123;F&#125;$ be an abelian quasi-coherent sheaf on $\mathcal&#123;C&#125;$.</span><br><span class="line">Let $\mathcal&#123;F&#125;$ be a coherent $\mathcal&#123;O&#125;_X$-module. Then</span><br><span class="line">$\mathcal&#123;F&#125;$ is an abelian catenary over $\mathcal&#123;C&#125;$.</span><br><span class="line">\item The following are equivalent</span><br><span class="line">\begin&#123;enumerate&#125;</span><br><span class="line">\item $\mathcal&#123;F&#125;$ is an $\mathcal&#123;O&#125;_X$-module.</span><br><span class="line">\end&#123;lemma&#125;</span><br></pre></td></tr></table></figure></p><p>This sample from a relatively decent model illustrates a few common mistakes. For example, the model opens a <code>\begin&#123;proof&#125;</code> environment but then ends it with a <code>\end&#123;lemma&#125;</code>. This is an example of a problem weâ€™d have to fix manually, and is likely due to the fact that the dependency is too long-term: By the time the model is done with the proof it has forgotten whether it was doing a proof or a lemma. Similarly, it opens an <code>\begin&#123;enumerate&#125;</code> but then forgets to close it. We observed that these became less common with larger/better models, but nonetheless, these are the kinds of mistakes that come up.<br>è¿™ä¸ªæ¥è‡ªç›¸å¯¹ä¸é”™æ¨¡å‹çš„æ ·æœ¬å±•ç¤ºäº†ä¸€äº›å¸¸è§çš„é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œæ¨¡å‹æ‰“å¼€äº†ä¸€ä¸ª \begin{proof} ç¯å¢ƒï¼Œä½†éšåå´ä»¥ \end{lemma} ç»“æŸã€‚è¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨ä¿®å¤çš„é—®é¢˜çš„ä¾‹å­ï¼Œå¯èƒ½æ˜¯ç”±äºä¾èµ–å…³ç³»è¿‡äºé•¿æœŸï¼šåˆ°æ¨¡å‹å®Œæˆè¯æ˜æ—¶ï¼Œå®ƒå·²ç»å¿˜è®°äº†è‡ªå·±æ˜¯åœ¨è¿›è¡Œè¯æ˜è¿˜æ˜¯å¼•ç†ã€‚ç±»ä¼¼åœ°ï¼Œå®ƒæ‰“å¼€äº†ä¸€ä¸ª \begin{enumerate}ï¼Œä½†éšåå¿˜è®°äº†å…³é—­å®ƒã€‚æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œè¿™äº›é”™è¯¯åœ¨è¾ƒå¤§/æ›´å¥½çš„æ¨¡å‹ä¸­å˜å¾—ä¸é‚£ä¹ˆå¸¸è§ï¼Œä½†è¿™äº›éƒ½æ˜¯å¯èƒ½å‡ºç°çš„é”™è¯¯ç±»å‹ã€‚</p><h3 id="linux-source-code-linux-æºä»£ç "><a href="#Linux-Source-Code-Linux-æºä»£ç " class="headerlink" title="Linux Source Code Linux æºä»£ç "></a>Linux Source Code Linux æºä»£ç </h3><p>I wanted to push structured data to its limit, so for the final challenge I decided to use code. In particular, I took all the source and header files found in the <a href="https://github.com/torvalds/linux">Linux repo on Github</a>, concatenated all of them in a single giant file (474MB of C code) (I was originally going to train only on the kernel but that by itself is only ~16MB). Then I trained several as-large-as-fits-on-my-GPU 3-layer LSTMs over a period of a few days. These models have about 10 million parameters, which is still on the lower end for RNN models. The results are superfun:<br>æˆ‘æƒ³å°†ç»“æ„åŒ–æ•°æ®æ¨å‘æé™ï¼Œå› æ­¤åœ¨æœ€åçš„æŒ‘æˆ˜ä¸­æˆ‘å†³å®šä½¿ç”¨ä»£ç ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘æ”¶é›†äº†Githubä¸ŠLinuxä»“åº“ä¸­çš„æ‰€æœ‰æºæ–‡ä»¶å’Œå¤´æ–‡ä»¶ï¼Œå°†å®ƒä»¬åˆå¹¶æˆä¸€ä¸ªå·¨å¤§çš„æ–‡ä»¶ï¼ˆ474MBçš„Cä»£ç ï¼‰ï¼ˆæˆ‘æœ¬æ¥æ‰“ç®—åªè®­ç»ƒå†…æ ¸ä»£ç ï¼Œä½†å®ƒæœ¬èº«åªæœ‰å¤§çº¦16MBï¼‰ã€‚ç„¶åï¼Œæˆ‘åœ¨å‡ å¤©å†…è®­ç»ƒäº†å¤šä¸ªå°½å¯èƒ½é€‚åº”GPUå®¹é‡çš„ä¸‰å±‚LSTMæ¨¡å‹ã€‚è¿™äº›æ¨¡å‹å¤§çº¦æœ‰1000ä¸‡ä¸ªå‚æ•°ï¼Œè¿™åœ¨RNNæ¨¡å‹ä¸­ä»ç„¶ç®—æ˜¯è¾ƒå°‘çš„ã€‚ç»“æœéå¸¸æœ‰è¶£ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * Increment the size file of the new incorrect UI_FILTER group information</span><br><span class="line"> * of the size generatively.</span><br><span class="line"> */</span><br><span class="line">static int indicate_policy(void)</span><br><span class="line">&#123;</span><br><span class="line">  int error;</span><br><span class="line">  if (fd == MARN_EPT) &#123;</span><br><span class="line">    /*</span><br><span class="line">     * The kernel blank will coeld it to userspace.</span><br><span class="line">     */</span><br><span class="line">    if (ss-&gt;segment &lt; mem_total)</span><br><span class="line">      unblock_graph_and_set_blocked();</span><br><span class="line">    else</span><br><span class="line">      ret = 1;</span><br><span class="line">    goto bail;</span><br><span class="line">  &#125;</span><br><span class="line">  segaddr = in_SB(in.addr);</span><br><span class="line">  selector = seg / 16;</span><br><span class="line">  setup_works = true;</span><br><span class="line">  for (i = 0; i &lt; blocks; i++) &#123;</span><br><span class="line">    seq = buf[i++];</span><br><span class="line">    bpf = bd-&gt;bd.next + i * search;</span><br><span class="line">    if (fd) &#123;</span><br><span class="line">      current = blocked;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  rw-&gt;name = &quot;Getjbbregs&quot;;</span><br><span class="line">  bprm_self_clearl(&amp;iv-&gt;version);</span><br><span class="line">  regs-&gt;new = blocks[(BPF_STATS &lt;&lt; info-&gt;historidac)] | PFMR_CLOBATHINC_SECONDS &lt;&lt; 12;</span><br><span class="line">  return segtable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>The code looks really quite great overall. Of course, I donâ€™t think it compiles but when you scroll through the generate code it feels very much like a giant C code base. Notice that the RNN peppers its code with comments here and there at random. It is also very good at making very few syntactic errors. For example, it uses strings properly, pointer notation, etc. It also opens and closes brackets {   correctly and learns to indent its code very well. A common error is that it canâ€™t keep track of variable names: It often uses undefined variables (e.g. rw above), declares variables it never uses (e.g. int error), or returns non-existing variables. Lets see a few more examples. Hereâ€™s another snippet that shows a wider array of operations that the RNN learns:</p><p>æ€»ä½“æ¥è¯´ï¼Œè¿™äº›ä»£ç çœ‹èµ·æ¥éå¸¸ä¸é”™ã€‚å½“ç„¶ï¼Œæˆ‘ä¸è®¤ä¸ºå®ƒèƒ½ç¼–è¯‘ï¼Œä½†å½“ä½ æ»šåŠ¨æŸ¥çœ‹ç”Ÿæˆçš„ä»£ç æ—¶ï¼Œå®ƒç¡®å®ç»™äººä¸€ç§å·¨å¤§çš„Cä»£ç åº“çš„æ„Ÿè§‰ã€‚æ³¨æ„ï¼ŒRNNä¼šéšæœºåœ¨ä»£ç ä¸­æ’å…¥æ³¨é‡Šï¼Œå¹¶ä¸”åœ¨è¯­æ³•é”™è¯¯æ–¹é¢è¡¨ç°å¾—éå¸¸å‡ºè‰²ã€‚ä¾‹å¦‚ï¼Œå®ƒèƒ½æ­£ç¡®ä½¿ç”¨å­—ç¬¦ä¸²ã€æŒ‡é’ˆç¬¦å·ç­‰ï¼Œè¿˜èƒ½æ­£ç¡®åœ°æ‰“å¼€å’Œå…³é—­å¤§æ‹¬å·{}ï¼Œå¹¶å¾ˆå¥½åœ°å­¦ä¹ ä»£ç ç¼©è¿›ã€‚<br>ä¸€ä¸ªå¸¸è§çš„é”™è¯¯æ˜¯å®ƒæ— æ³•è·Ÿè¸ªå˜é‡åï¼šå®ƒç»å¸¸ä½¿ç”¨æœªå®šä¹‰çš„å˜é‡ï¼ˆä¾‹å¦‚ä¸Šé¢çš„rwï¼‰ï¼Œå£°æ˜ä»æœªä½¿ç”¨çš„å˜é‡ï¼ˆä¾‹å¦‚int errorï¼‰ï¼Œæˆ–è€…è¿”å›ä¸å­˜åœ¨çš„å˜é‡ã€‚è®©æˆ‘ä»¬å†çœ‹ä¸€äº›ä¾‹å­ã€‚ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä»£ç ç‰‡æ®µï¼Œå±•ç¤ºäº†RNNå­¦åˆ°çš„æ›´å¹¿æ³›çš„æ“ä½œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * If this error is set, we will need anything right after that BSD.</span><br><span class="line"> */</span><br><span class="line">static void action_new_function(struct s_stat_info *wb)</span><br><span class="line">&#123;</span><br><span class="line">  unsigned long flags;</span><br><span class="line">  int lel_idx_bit = e-&gt;edd, *sys &amp; ~((unsigned long) *FIRST_COMPAT);</span><br><span class="line">  buf[0] = 0xFFFFFFFF &amp; (bit &lt;&lt; 4);</span><br><span class="line">  min(inc, slist-&gt;bytes);</span><br><span class="line">  printk(KERN_WARNING &quot;Memory allocated %02x/%02x, &quot;</span><br><span class="line">    &quot;original MLL instead\n&quot;),</span><br><span class="line">    min(min(multi_run - s-&gt;len, max) * num_data_in),</span><br><span class="line">    frame_pos, sz + first_seg);</span><br><span class="line">  div_u64_w(val, inb_p);</span><br><span class="line">  spin_unlock(&amp;disk-&gt;queue_lock);</span><br><span class="line">  mutex_unlock(&amp;s-&gt;sock-&gt;mutex);</span><br><span class="line">  mutex_unlock(&amp;func-&gt;mutex);</span><br><span class="line">  return disassemble(info-&gt;pending_bh);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void num_serial_settings(struct tty_struct *tty)</span><br><span class="line">&#123;</span><br><span class="line">  if (tty == tty)</span><br><span class="line">    disable_single_st_p(dev);</span><br><span class="line">  pci_disable_spool(port);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void do_command(struct seq_file *m, void *v)</span><br><span class="line">&#123;</span><br><span class="line">  int column = 32 &lt;&lt; (cmd[2] &amp; 0x80);</span><br><span class="line">  if (state)</span><br><span class="line">    cmd = (int)(int_state ^ (in_8(&amp;ch-&gt;ch_flags) &amp; Cmd) ? 2 : 1);</span><br><span class="line">  else</span><br><span class="line">    seq = 1;</span><br><span class="line">  for (i = 0; i &lt; 16; i++) &#123;</span><br><span class="line">    if (k &amp; (1 &lt;&lt; 1))</span><br><span class="line">      pipe = (in_use &amp; UMXTHREAD_UNCCA) +</span><br><span class="line">        ((count &amp; 0x00000000fffffff8) &amp; 0x000000f) &lt;&lt; 8;</span><br><span class="line">    if (count == 0)</span><br><span class="line">      sub(pid, ppc_md.kexec_handle, 0x20000000);</span><br><span class="line">    pipe_set_bytes(i, 0);</span><br><span class="line">  &#125;</span><br><span class="line">  /* Free our user pages pointer to place camera if all dash */</span><br><span class="line">  subsystem_info = &amp;of_changes[PAGE_SIZE];</span><br><span class="line">  rek_controls(offset, idx, &amp;soffset);</span><br><span class="line">  /* Now we want to deliberately put it to device */</span><br><span class="line">  control_check_polarity(&amp;context, val, 0);</span><br><span class="line">  for (i = 0; i &lt; COUNTER; i++)</span><br><span class="line">    seq_puts(s, &quot;policy &quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Notice that in the second function the model compares tty == tty, which is vacuously true. On the other hand, at least the variable tty exists in the scope this time! In the last function, notice that the code does not return anything, which happens to be correct since the function signature is void. However, the first two functions were also declared void and did return values. This is again a form of a common mistake due to long-term interactions.<br>æ³¨æ„åœ¨ç¬¬äºŒä¸ªå‡½æ•°ä¸­ï¼Œæ¨¡å‹æ¯”è¾ƒäº†tty == ttyï¼Œè¿™æ˜¯æ˜¾ç„¶ä¸ºçœŸçš„ã€‚å¦ä¸€æ–¹é¢ï¼Œè‡³å°‘è¿™æ¬¡å˜é‡ttyå­˜åœ¨äºä½œç”¨åŸŸä¸­ï¼åœ¨æœ€åä¸€ä¸ªå‡½æ•°ä¸­ï¼Œæ³¨æ„ä»£ç æ²¡æœ‰è¿”å›ä»»ä½•ä¸œè¥¿ï¼Œè¿™æ­£å¥½æ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºå‡½æ•°ç­¾åæ˜¯voidã€‚ç„¶è€Œï¼Œå‰ä¸¤ä¸ªå‡½æ•°ä¹Ÿå£°æ˜ä¸ºvoidï¼Œä½†å´è¿”å›äº†å€¼ã€‚è¿™å†æ¬¡æ˜¯ä¸€ç§ç”±äºé•¿æ—¶é—´äº¤äº’è€Œå¯¼è‡´çš„å¸¸è§é”™è¯¯å½¢å¼ã€‚</p><p>Sometimes the model decides that itâ€™s time to sample a new file. This is usually a very amusing part: The model first recites the GNU license character by character, samples a few includes, generates some macros and then dives into the code:<br>æœ‰æ—¶ï¼Œæ¨¡å‹ä¼šå†³å®šæ˜¯æ—¶å€™é‡‡æ ·ä¸€ä¸ªæ–°æ–‡ä»¶äº†ã€‚è¿™é€šå¸¸æ˜¯éå¸¸æœ‰è¶£çš„éƒ¨åˆ†ï¼šæ¨¡å‹é¦–å…ˆé€å­—ç¬¦åœ°èƒŒè¯µGNUè®¸å¯è¯ï¼Œé‡‡æ ·å‡ ä¸ªincludeè¯­å¥ï¼Œç”Ÿæˆä¸€äº›å®ï¼Œç„¶åæ·±å…¥åˆ°ä»£ç ä¸­ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> *  Copyright (c) 2006-2010, Intel Mobile Communications.  All rights reserved.</span><br><span class="line"> *</span><br><span class="line"> *   This program is free software; you can redistribute it and/or modify it</span><br><span class="line"> * under the terms of the GNU General Public License version 2 as published by</span><br><span class="line"> * the Free Software Foundation.</span><br><span class="line"> *</span><br><span class="line"> *        This program is distributed in the hope that it will be useful,</span><br><span class="line"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br><span class="line"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><br><span class="line"> *</span><br><span class="line"> *  GNU General Public License for more details.</span><br><span class="line"> *</span><br><span class="line"> *   You should have received a copy of the GNU General Public License</span><br><span class="line"> *    along with this program; if not, write to the Free Software Foundation,</span><br><span class="line"> *  Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#include &lt;linux/kexec.h&gt;</span><br><span class="line">#include &lt;linux/errno.h&gt;</span><br><span class="line">#include &lt;linux/io.h&gt;</span><br><span class="line">#include &lt;linux/platform_device.h&gt;</span><br><span class="line">#include &lt;linux/multi.h&gt;</span><br><span class="line">#include &lt;linux/ckevent.h&gt;</span><br><span class="line"></span><br><span class="line">#include &lt;asm/io.h&gt;</span><br><span class="line">#include &lt;asm/prom.h&gt;</span><br><span class="line">#include &lt;asm/e820.h&gt;</span><br><span class="line">#include &lt;asm/system_info.h&gt;</span><br><span class="line">#include &lt;asm/setew.h&gt;</span><br><span class="line">#include &lt;asm/pgproto.h&gt;</span><br><span class="line"></span><br><span class="line">#define REG_PG    vesa_slot_addr_pack</span><br><span class="line">#define PFM_NOCOMP  AFSR(0, load)</span><br><span class="line">#define STACK_DDR(type)     (func)</span><br><span class="line"></span><br><span class="line">#define SWAP_ALLOCATE(nr)     (e)</span><br><span class="line">#define emulate_sigs()  arch_get_unaligned_child()</span><br><span class="line">#define access_rw(TST)  asm volatile(&quot;movd %%esp, %0, %3&quot; : : &quot;r&quot; (0));   \</span><br><span class="line">  if (__type &amp; DO_READ)</span><br><span class="line"></span><br><span class="line">static void stat_PC_SEC __read_mostly offsetof(struct seq_argsqueue, \</span><br><span class="line">          pC&gt;[1]);</span><br><span class="line"></span><br><span class="line">static void</span><br><span class="line">os_prefix(unsigned long sys)</span><br><span class="line">&#123;</span><br><span class="line">#ifdef CONFIG_PREEMPT</span><br><span class="line">  PUT_PARAM_RAID(2, sel) = get_state_state();</span><br><span class="line">  set_pid_sum((unsigned long)state, current_state_str(),</span><br><span class="line">           (unsigned long)-1-&gt;lr_full; low;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>There are too many fun parts to cover- I could probably write an entire blog post on just this part. Iâ€™ll cut it short for now, but here is <a href="http://cs.stanford.edu/people/karpathy/char-rnn/linux.txt">1MB of sampled Linux code</a> for your viewing pleasure.<br>æœ‰å¤ªå¤šæœ‰è¶£çš„éƒ¨åˆ†è¦æ¶µç›– - æˆ‘å¯èƒ½ä¼šå†™ä¸€æ•´ç¯‡å…³äºè¿™éƒ¨åˆ†çš„åšå®¢æ–‡ç« ã€‚æˆ‘ç°åœ¨ä¼šç¼©çŸ­å®ƒï¼Œä½†è¿™é‡Œæœ‰ 1MB çš„ Linux ä»£ç æ ·æœ¬ä¾›æ‚¨æŸ¥çœ‹ã€‚</p><h3 id="generating-baby-names-ç”Ÿæˆå©´å„¿åå­—"><a href="#Generating-Baby-Names-ç”Ÿæˆå©´å„¿åå­—" class="headerlink" title="Generating Baby Names ç”Ÿæˆå©´å„¿åå­—"></a>Generating Baby Names ç”Ÿæˆå©´å„¿åå­—</h3><p>Lets try one more for fun. Lets feed the RNN a large text file that contains 8000 baby names listed out, one per line (names obtained from <a href="http://www.cs.cmu.edu/afs/cs/project/ai-repository/ai/areas/nlp/corpora/names/">here</a>). We can feed this to the RNN and then generate new names! Here are some example names, only showing the ones that do not occur in the training data (90% donâ€™t):<br>å†æ¥è¯•ä¸€ä¸ªæœ‰è¶£çš„å®éªŒã€‚æˆ‘ä»¬å‘RNNè¾“å…¥ä¸€ä¸ªåŒ…å«8000ä¸ªå©´å„¿åå­—çš„å¤§æ–‡æœ¬æ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ªåå­—ï¼ˆåå­—ä»è¿™é‡Œè·å¾—ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶è¾“å…¥RNNï¼Œç„¶åç”Ÿæˆæ–°çš„åå­—ï¼ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹åå­—ï¼Œåªå±•ç¤ºé‚£äº›æ²¡æœ‰å‡ºç°åœ¨è®­ç»ƒæ•°æ®ä¸­çš„åå­—ï¼ˆ90%éƒ½ä¸åœ¨è®­ç»ƒæ•°æ®ä¸­ï¼‰ï¼š<br>_Rudi Levette Berice Lussa Hany Mareanne Chrestina Carissy Marylen Hammine Janye Marlise Jacacrie Hendred Romand Charienna Nenotto Ette Dorane Wallen Marly Darine Salina Elvyn Ersia Maralena Minoria Ellia Charmin Antley Nerille Chelon Walmor Evena Jeryly Stachon Charisa Allisa Anatha Cathanie Geetra Alexie Jerin Cassen Herbett Cossie Velen Daurenge Robester Shermond Terisa Licia Roselen Ferine Jayn Lusine Charyanne Sales Sanny Resa Wallon Martine Merus Jelen Candica Wallin Tel Rachene Tarine Ozila Ketia Shanne Arnande Karella Roselina Alessia Chasty Deland Berther Geamar Jackein Mellisand Sagdy Nenc Lessie Rasemy Guen Gavi Milea Anneda Margoris Janin Rodelin Zeanna Elyne Janah Ferzina Susta Pey Castina_</p><p>You can see many more <a href="http://cs.stanford.edu/people/karpathy/namesGenUnique.txt">here</a>. Some of my favorites include â€œBabyâ€ (haha), â€œKillieâ€, â€œCharâ€, â€œRâ€, â€œMoreâ€, â€œMarsâ€, â€œHiâ€, â€œSaddieâ€, â€œWithâ€ and â€œAhbortâ€. Well that was fun.ï»¿ Of course, you can imagine this being quite useful inspiration when writing a novel, or naming a new startup :)<br>ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°æ›´å¤šã€‚æˆ‘æœ€å–œæ¬¢çš„ä¸€äº›åŒ…æ‹¬â€œå®è´â€ï¼ˆhahaï¼‰ã€â€œKillieâ€ã€â€œCharâ€ã€â€œRâ€ã€â€œMoreâ€ã€â€œMarsâ€ã€â€œHiâ€ã€â€œSaddieâ€ã€â€œWithâ€å’Œâ€œAhbortâ€ã€‚å—¯ï¼Œè¿™å¾ˆæœ‰è¶£ã€‚å½“ç„¶ï¼Œä½ å¯ä»¥æƒ³è±¡è¿™åœ¨å†™å°è¯´æˆ–å‘½åæ–°çš„åˆ›ä¸šå…¬å¸æ—¶æ˜¯éå¸¸æœ‰ç”¨çš„çµæ„Ÿ:)</p><h1 id="understanding-whats-going-on"><a href="#Understanding-whatâ€™s-going-on" class="headerlink" title="Understanding whatâ€™s going on"></a>Understanding whatâ€™s going on</h1><p>We saw that the results at the end of training can be impressive, but how does any of this work? Lets run two quick experiments to briefly peek under the hood.<br>æˆ‘ä»¬çœ‹åˆ°è®­ç»ƒç»“æŸæ—¶çš„ç»“æœä»¤äººå°è±¡æ·±åˆ»ï¼Œä½†è¿™äº›æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿè®©æˆ‘ä»¬è¿›è¡Œä¸¤ä¸ªå¿«é€Ÿå®éªŒï¼Œç®€è¦æ¢ç©¶ä¸€ä¸‹å…¶å†…éƒ¨å·¥ä½œåŸç†ã€‚</p><h2 id="the-evolution-of-samples-while-training"><a href="#The-evolution-of-samples-while-training" class="headerlink" title="The evolution of samples while training"></a>The evolution of samples while training</h2><p>è®­ç»ƒæ—¶æ ·æœ¬çš„æ¼”å˜<br>First, itâ€™s fun to look at how the sampled text evolves while the model trains. For example, I trained an LSTM of Leo Tolstoyâ€™s War and Peace and then generated samples every 100 iterations of training. At iteration 100 the model samples random jumbles:<br>é¦–å…ˆï¼Œè§‚å¯Ÿæ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­ç”Ÿæˆæ–‡æœ¬çš„æ¼”å˜æ˜¯å¾ˆæœ‰è¶£çš„ã€‚ä¾‹å¦‚ï¼Œæˆ‘è®­ç»ƒäº†ä¸€ä¸ªåŸºäºåˆ—å¤«Â·æ‰˜å°”æ–¯æ³°çš„ã€Šæˆ˜äº‰ä¸å’Œå¹³ã€‹çš„LSTMï¼Œå¹¶åœ¨æ¯100æ¬¡è¿­ä»£è®­ç»ƒåç”Ÿæˆæ ·æœ¬ã€‚åœ¨ç¬¬100æ¬¡è¿­ä»£æ—¶ï¼Œæ¨¡å‹ç”Ÿæˆçš„æ ·æœ¬æ˜¯éšæœºæ··æ‚çš„å­—ç¬¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tyntd-iafhatawiaoihrdemot  lytdws  e ,tfti, astai f ogoh eoase rrranbyne &#x27;nhthnee e </span><br><span class="line">plia tklrgd t o idoe ns,smtt   h ne etie h,hregtrs nigtike,aoaenns lng</span><br></pre></td></tr></table></figure><p>However, notice that at least it is starting to get an idea about words separated by spaces. Except sometimes it inserts two spaces. It also doesnâ€™t know that comma is amost always followed by a space. At 300 iterations we see that the model starts to get an idea about quotes and periods:<br>ç„¶è€Œï¼Œè¯·æ³¨æ„è‡³å°‘æ¨¡å‹å¼€å§‹æœ‰äº†å…³äºå•è¯ç”±ç©ºæ ¼åˆ†éš”çš„æ¦‚å¿µã€‚å°½ç®¡æœ‰æ—¶å®ƒä¼šæ’å…¥ä¸¤ä¸ªç©ºæ ¼ã€‚å®ƒè¿˜ä¸çŸ¥é“é€—å·åå‡ ä¹æ€»æ˜¯è·Ÿç€ä¸€ä¸ªç©ºæ ¼ã€‚åœ¨è®­ç»ƒ300æ¬¡è¿­ä»£æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°æ¨¡å‹å¼€å§‹äº†è§£å¼•å·å’Œå¥å·çš„ç”¨æ³•ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;Tmont thithey&quot; fomesscerliund</span><br><span class="line">Keushey. Thom here</span><br><span class="line">sheulke, anmerenith ol sivh I lalterthend Bleipile shuwy fil on aseterlome</span><br><span class="line">coaniogennc Phe lism thond hon at. MeiDimorotion in ther thize.&quot;</span><br></pre></td></tr></table></figure><br>The words are now also separated with spaces and the model starts to get the idea about periods at the end of a sentence. At iteration 500:<br>ç°åœ¨ï¼Œå•è¯ä¹‹é—´ä¹Ÿç”¨ç©ºæ ¼åˆ†éš”ï¼Œæ¨¡å‹å¼€å§‹ç†è§£å¥æœ«çš„å¥å·ã€‚åœ¨ç¬¬500æ¬¡è¿­ä»£æ—¶ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">we counter. He stutn co des. His stanted out one ofler that concossions and was </span><br><span class="line">to gearang reay Jotrets and with fre colt otf paitt thin wall. Which das stimn </span><br></pre></td></tr></table></figure><br>the model has now learned to spell the shortest and most common words such as â€œweâ€, â€œHeâ€, â€œHisâ€, â€œWhichâ€, â€œandâ€, etc. At iteration 700 weâ€™re starting to see more and more English-like text emerge:<br>æ¨¡å‹ç°åœ¨å·²ç»å­¦ä¼šäº†æ‹¼å†™æœ€çŸ­å’Œæœ€å¸¸è§çš„å•è¯ï¼Œæ¯”å¦‚â€œweâ€ã€â€œHeâ€ã€â€œHisâ€ã€â€œWhichâ€ã€â€œandâ€ç­‰ã€‚åœ¨ç¬¬700æ¬¡è¿­ä»£æ—¶ï¼Œæˆ‘ä»¬å¼€å§‹çœ‹åˆ°è¶Šæ¥è¶Šå¤šç±»ä¼¼è‹±è¯­çš„æ–‡æœ¬å‡ºç°ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Aftair fall unsuch that the hall for Prince Velzonski&#x27;s that me of</span><br><span class="line">her hearly, and behs to so arwage fiving were to it beloge, pavu say falling misfort </span><br><span class="line">how, and Gogition is so overelical and ofter.</span><br></pre></td></tr></table></figure></p><p>At iteration 1200 weâ€™re now seeing use of quotations and question/exclamation marks. Longer words have now been learned as well:<br>åœ¨ç¬¬1200æ¬¡è¿­ä»£æ—¶ï¼Œæˆ‘ä»¬ç°åœ¨çœ‹åˆ°äº†å¼•å·å’Œé—®å·/æ„Ÿå¹å·çš„ä½¿ç”¨ã€‚æ›´é•¿çš„å•è¯ä¹Ÿå·²ç»è¢«å­¦ä¼šäº†ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;Kite vouch!&quot; he repeated by her</span><br><span class="line">door. &quot;But I would be done and quarts, feeling, then, son is people....&quot;</span><br></pre></td></tr></table></figure><br>Until at last we start to get properly spelled words, quotations, names, and so on by about iteration 2000:<br>ç›´åˆ°æœ€åï¼Œåœ¨å¤§çº¦ç¬¬2000æ¬¡è¿­ä»£æ—¶ï¼Œæˆ‘ä»¬å¼€å§‹å¾—åˆ°æ­£ç¡®æ‹¼å†™çš„å•è¯ã€å¼•å·ã€åå­—ç­‰ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;Why do what that day,&quot; replied Natasha, and wishing to himself the fact the</span><br><span class="line">princess, Princess Mary was easier, fed in had oftened him.</span><br><span class="line">Pierre aking his soul came to the packs and drove up his father-in-law women.</span><br></pre></td></tr></table></figure></p><p>The picture that emerges is that the model first discovers the general word-space structure and then rapidly starts to learn the words; First starting with the short words and then eventually the longer ones. Topics and themes that span multiple words (and in general longer-term dependencies) start to emerge only much later.<br>å‡ºç°çš„æƒ…å†µæ˜¯ï¼Œæ¨¡å‹é¦–å…ˆå‘ç°äº†æ•´ä½“çš„å•è¯-ç©ºæ ¼ç»“æ„ï¼Œç„¶åè¿…é€Ÿå¼€å§‹å­¦ä¹ å•è¯ï¼›å…ˆæ˜¯çŸ­å•è¯ï¼Œç„¶åé€æ¸å­¦ä¹ é•¿å•è¯ã€‚è·¨è¶Šå¤šä¸ªå•è¯çš„ä¸»é¢˜å’Œä¸»é¢˜ï¼ˆä»¥åŠä¸€èˆ¬çš„é•¿æœŸä¾èµ–å…³ç³»ï¼‰è¦åˆ°å¾ˆä¹…ä»¥åæ‰ä¼šå¼€å§‹å‡ºç°ã€‚</p><h2 id="visualizing-the-predictions-and-the-neuron-firings-in-the-rnn"><a href="#Visualizing-the-predictions-and-the-â€œneuronâ€-firings-in-the-RNN" class="headerlink" title="Visualizing the predictions and the â€œneuronâ€ firings in the RNN"></a>Visualizing the predictions and the â€œneuronâ€ firings in the RNN</h2><p>å¯è§†åŒ– RNN ä¸­çš„é¢„æµ‹å’Œâ€œç¥ç»å…ƒâ€æ”¾ç”µ</p><p>Another fun visualization is to look at the predicted distributions over characters. In the visualizations below we feed a Wikipedia RNN model character data from the validation set (shown along the blue/green rows) and under every character we visualize (in red) the top 5 guesses that the model assigns for the next character. The guesses are colored by their probability (so dark red = judged as very likely, white = not very likely). For example, notice that there are stretches of characters where the model is extremely confident about the next letter (e.g., the model is very confident about characters during the _<a href="http://www._">http://www._</a> sequence).<br>å¦ä¸€ä¸ªæœ‰è¶£çš„å¯è§†åŒ–æ˜¯æŸ¥çœ‹æ¨¡å‹å¯¹å­—ç¬¦çš„é¢„æµ‹åˆ†å¸ƒã€‚åœ¨ä¸‹é¢çš„å¯è§†åŒ–ä¸­ï¼Œæˆ‘ä»¬å‘ä¸€ä¸ªè®­ç»ƒå¥½çš„Wikipedia RNNæ¨¡å‹ï¼Œæä¾›éªŒè¯é›†çš„å­—ç¬¦æ•°æ®ï¼ˆæ˜¾ç¤ºåœ¨è“è‰²/ç»¿è‰²è¡Œä¸Šï¼‰ï¼Œå¹¶åœ¨æ¯ä¸ªå­—ç¬¦ä¸‹æ–¹å¯è§†åŒ–ï¼ˆç”¨çº¢è‰²è¡¨ç¤ºï¼‰æ¨¡å‹å¯¹ä¸‹ä¸€ä¸ªå­—ç¬¦çš„å‰5ä¸ªçŒœæµ‹ã€‚çŒœæµ‹æ ¹æ®å…¶æ¦‚ç‡è¿›è¡Œç€è‰²ï¼ˆæ·±çº¢è‰²=è¢«è®¤ä¸ºéå¸¸å¯èƒ½ï¼Œç™½è‰²=ä¸å¤ªå¯èƒ½ï¼‰ã€‚ä¾‹å¦‚ï¼Œè¯·æ³¨æ„åœ¨æŸäº›å­—ç¬¦åºåˆ—ä¸­ï¼Œæ¨¡å‹å¯¹ä¸‹ä¸€ä¸ªå­—ç¬¦æä¸ºè‡ªä¿¡(ä¾‹å¦‚ï¼Œæ¨¡å‹å¯¹ <a href="http://www">http://www</a> åºåˆ—ä¸­çš„å­—ç¬¦éå¸¸æœ‰ä¿¡å¿ƒï¼‰</p><p>The input character sequence (blue/green) is colored based on the _firing_ of a randomly chosen neuron in the hidden representation of the RNN. Think about it as green = very excited and blue = not very excited (for those familiar with details of LSTMs, these are values between [-1,1] in the hidden state vector, which is just the gated and tanhâ€™d LSTM cell state). Intuitively, this is visualizing the firing rate of some neuron in the â€œbrainâ€ of the RNN while it reads the input sequence. Different neurons might be looking for different patterns; Below weâ€™ll look at 4 different ones that I found and thought were interesting or interpretable (many also arenâ€™t):<br>è¾“å…¥å­—ç¬¦åºåˆ—ï¼ˆè“è‰²/ç»¿è‰²ï¼‰æ˜¯æ ¹æ®RNNéšè—è¡¨ç¤ºä¸­éšæœºé€‰æ‹©çš„ä¸€ä¸ªç¥ç»å…ƒçš„æ¿€æ´»æƒ…å†µè¿›è¡Œç€è‰²çš„ã€‚å¯ä»¥ç†è§£ä¸ºç»¿è‰²=éå¸¸æ¿€åŠ¨ï¼Œè“è‰²=ä¸å¤ªæ¿€åŠ¨ï¼ˆå¯¹äºç†Ÿæ‚‰LSTMç»†èŠ‚çš„äººæ¥è¯´ï¼Œè¿™äº›å€¼åœ¨éšè—çŠ¶æ€å‘é‡ä¸­ä»‹äº[-1,1]ä¹‹é—´ï¼Œè¿™æ˜¯ç»è¿‡é—¨æ§å’Œtanhå‡½æ•°å¤„ç†çš„LSTMå•å…ƒçŠ¶æ€ï¼‰ã€‚ç›´è§‚åœ°è¯´ï¼Œè¿™æ˜¯åœ¨å¯è§†åŒ–RNNâ€œè„‘ä¸­â€æŸä¸ªç¥ç»å…ƒåœ¨è¯»å–è¾“å…¥åºåˆ—æ—¶çš„æ¿€æ´»ç‡ã€‚ä¸åŒçš„ç¥ç»å…ƒå¯èƒ½åœ¨å¯»æ‰¾ä¸åŒçš„æ¨¡å¼ï¼›ä¸‹é¢æˆ‘ä»¬å°†æŸ¥çœ‹4ä¸ªæˆ‘å‘ç°æœ‰è¶£æˆ–å¯è§£é‡Šçš„ç¥ç»å…ƒï¼ˆä¹Ÿæœ‰å¾ˆå¤šæ˜¯æ— æ³•è§£é‡Šçš„ï¼‰ï¼š</p><img src="/2472be8a/5.png" class><p>The neuron highlighted in this image seems to get very excited about URLs and turns off outside of the URLs. The LSTM is likely using this neuron to remember if it is inside a URL or not.<br>æ­¤å›¾åƒä¸­çªå‡ºæ˜¾ç¤ºçš„ç¥ç»å…ƒä¼¼ä¹å¯¹ URL éå¸¸å…´å¥‹ï¼Œå¹¶åœ¨ URL ä¹‹å¤–å…³é—­ã€‚LSTM å¯èƒ½ä½¿ç”¨è¿™ä¸ªç¥ç»å…ƒæ¥è®°ä½å®ƒæ˜¯å¦åœ¨ URL å†…ã€‚</p><img src="/2472be8a/6.png" class><p>The highlighted neuron here gets very excited when the RNN is inside the [[ ]] markdown environment and turns off outside of it. Interestingly, the neuron canâ€™t turn on right after it sees the character â€œ[â€œ, it must wait for the second â€œ[â€œ and then activate. This task of counting whether the model has seen one or two â€œ[â€œ is likely done with a different neuron.<br>å½“ RNN ä½äº [[ ]] markdown ç¯å¢ƒå†…éƒ¨å¹¶åœ¨å…¶å¤–éƒ¨å…³é—­æ—¶ï¼Œæ­¤å¤„çªå‡ºæ˜¾ç¤ºçš„ç¥ç»å…ƒä¼šéå¸¸å…´å¥‹ã€‚æœ‰è¶£çš„æ˜¯ï¼Œç¥ç»å…ƒåœ¨çœ‹åˆ°å­—ç¬¦â€œ[â€åæ— æ³•ç«‹å³æ‰“å¼€ï¼Œå®ƒå¿…é¡»ç­‰å¾…ç¬¬äºŒä¸ªâ€œ[â€ç„¶åæ¿€æ´»ã€‚è®¡ç®—æ¨¡å‹æ˜¯å¦çœ‹åˆ°ä¸€ä¸ªæˆ–ä¸¤ä¸ªâ€œ[â€çš„ä»»åŠ¡å¯èƒ½æ˜¯ç”¨ä¸åŒçš„ç¥ç»å…ƒå®Œæˆçš„ã€‚</p><img src="/2472be8a/7.png" class><p>Here we see a neuron that varies seemingly linearly across the [[ ]] environment. In other words its activation is giving the RNN a time-aligned coordinate system across the [[ ]] scope. The RNN can use this information to make different characters more or less likely depending on how early/late it is in the [[ ]] scope (perhaps?).<br>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªç¥ç»å…ƒï¼Œå®ƒåœ¨[[ ]]ç¯å¢ƒä¸­ä¼¼ä¹å‘ˆçº¿æ€§å˜åŒ–ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒçš„æ¿€æ´»ä¸º RNN æä¾›äº†ä¸€ä¸ªè·¨ [[ ]] èŒƒå›´çš„æ—¶é—´å¯¹é½åæ ‡ç³»ã€‚RNN å¯ä»¥ä½¿ç”¨æ­¤ä¿¡æ¯æˆ–å¤šæˆ–å°‘åœ°ä½¿ä¸åŒçš„å­—ç¬¦æ›´æœ‰å¯èƒ½ï¼Œå…·ä½“å–å†³äºå®ƒåœ¨ [[ ]] èŒƒå›´å†…çš„æ—©/æ™šï¼ˆä¹Ÿè®¸ï¼Ÿ</p><img src="/2472be8a/8.png" class><p>Here is another neuron that has very local behavior: it is relatively silent but sharply turns off right after the first â€œwâ€ in the â€œwwwâ€ sequence. The RNN might be using this neuron to count up how far in the â€œwwwâ€ sequence it is, so that it can know whether it should emit another â€œwâ€, or if it should start the URL.<br>è¿™æ˜¯å¦ä¸€ä¸ªå…·æœ‰éå¸¸å±€éƒ¨è¡Œä¸ºçš„ç¥ç»å…ƒï¼šå®ƒç›¸å¯¹å®‰é™ï¼Œä½†åœ¨â€œwwwâ€åºåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªâ€œwâ€ä¹‹åæ€¥å‰§å…³é—­ã€‚RNN å¯èƒ½æ­£åœ¨ä½¿ç”¨è¿™ä¸ªç¥ç»å…ƒæ¥è®¡ç®—å®ƒåœ¨â€œwwwâ€åºåˆ—ä¸­çš„è·ç¦»ï¼Œä»¥ä¾¿å®ƒå¯ä»¥çŸ¥é“å®ƒæ˜¯å¦åº”è¯¥å‘å‡ºå¦ä¸€ä¸ªâ€œwâ€ï¼Œæˆ–è€…å®ƒæ˜¯å¦åº”è¯¥å¯åŠ¨ URLã€‚</p><p>Of course, a lot of these conclusions are slightly hand-wavy as the hidden state of the RNN is a huge, high-dimensional and largely distributed representation. These visualizations were produced with custom HTML/CSS/Javascript, you can see a sketch of whatâ€™s involved <a href="http://cs.stanford.edu/people/karpathy/viscode.zip">here</a> if youâ€™d like to create something similar.<br>å½“ç„¶ï¼Œå¾ˆå¤šè¿™äº›ç»“è®ºéƒ½æœ‰äº›ç¬¼ç»Ÿï¼Œå› ä¸ºRNNçš„éšè—çŠ¶æ€æ˜¯ä¸€ä¸ªå·¨å¤§çš„ã€é«˜ç»´çš„ã€å¹¿æ³›åˆ†å¸ƒçš„è¡¨ç¤ºã€‚è¿™äº›å¯è§†åŒ–æ˜¯ä½¿ç”¨è‡ªå®šä¹‰çš„HTML/CSS/Javascriptç”Ÿæˆçš„ï¼Œå¦‚æœä½ æƒ³åˆ›å»ºç±»ä¼¼çš„ä¸œè¥¿ï¼Œå¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°æ¶‰åŠçš„å†…å®¹ç¤ºä¾‹ã€‚</p><p>We can also condense this visualization by excluding the most likely predictions and only visualize the text, colored by activations of a cell. We can see that in addition to a large portion of cells that do not do anything interpretible, about 5% of them turn out to have learned quite interesting and interpretible algorithms:<br>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡æ’é™¤æœ€å¯èƒ½çš„é¢„æµ‹å¹¶ä»…æ ¹æ®å•å…ƒæ¿€æ´»æƒ…å†µå¯¹æ–‡æœ¬è¿›è¡Œç€è‰²æ¥ç®€åŒ–è¿™ç§å¯è§†åŒ–ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†å¤§éƒ¨åˆ†ä¸å¯è§£é‡Šçš„å•å…ƒå¤–ï¼Œå¤§çº¦æœ‰5%çš„å•å…ƒå­¦ä¼šäº†ç›¸å½“æœ‰è¶£ä¸”å¯è§£é‡Šçš„ç®—æ³•ï¼š<br><img src="/2472be8a/9.png" class><br><img src="/2472be8a/10.png" class><br>Again, what is beautiful about this is that we didnâ€™t have to hardcode at any point that if youâ€™re trying to predict the next character it might, for example, be useful to keep track of whether or not you are currently inside or outside of quote. We just trained the LSTM on raw data and it decided that this is a useful quantitity to keep track of. In other words one of its cells gradually tuned itself during training to become a quote detection cell, since this helps it better perform the final task. This is one of the cleanest and most compelling examples of where the power in Deep Learning models (and more generally end-to-end training) is coming from.<br>å†æ¬¡å¼ºè°ƒï¼Œè¿™å…¶ä¸­çš„ç¾å¦™ä¹‹å¤„åœ¨äºï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨ä»»ä½•æ—¶å€™ç¡¬ç¼–ç ï¼Œä¾‹å¦‚åœ¨é¢„æµ‹ä¸‹ä¸€ä¸ªå­—ç¬¦æ—¶éœ€è¦è·Ÿè¸ªå½“å‰æ˜¯å¦åœ¨å¼•å·å†…æˆ–å¼•å·å¤–ã€‚æˆ‘ä»¬åªæ˜¯å¯¹LSTMè¿›è¡ŒåŸå§‹æ•°æ®çš„è®­ç»ƒï¼Œå®ƒè‡ªå·±å†³å®šè·Ÿè¸ªè¿™ä¸ªä¿¡æ¯æ˜¯æœ‰ç”¨çš„ã€‚æ¢å¥è¯è¯´ï¼Œå…¶ä¸­ä¸€ä¸ªå•å…ƒåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­é€æ¸è°ƒæ•´è‡ªå·±ï¼Œå˜æˆäº†ä¸€ä¸ªå¼•å·æ£€æµ‹å•å…ƒï¼Œå› ä¸ºè¿™æœ‰åŠ©äºå®ƒæ›´å¥½åœ°å®Œæˆæœ€ç»ˆä»»åŠ¡ã€‚è¿™æ˜¯æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ˆæ›´å¹¿æ³›åœ°è¯´ï¼Œç«¯åˆ°ç«¯è®­ç»ƒï¼‰åŠ›é‡çš„æœ€æ¸…æ™°å’Œæœ€æœ‰è¯´æœåŠ›çš„ä¾‹å­ä¹‹ä¸€ã€‚</p><h1 id="source-code-æºä»£ç "><a href="#Source-Code-æºä»£ç " class="headerlink" title="Source Code æºä»£ç "></a>Source Code æºä»£ç </h1><p>I hope Iâ€™ve convinced you that training character-level language models is a very fun exercise. You can train your own models using the <a href="https://github.com/karpathy/char-rnn">char-rnn code</a> I released on Github (under MIT license). It takes one large text file and trains a character-level model that you can then sample from. Also, it helps if you have a GPU or otherwise training on CPU will be about a factor of 10x slower. In any case, if you end up training on some data and getting fun results let me know! And if you get lost in the Torch/Lua codebase remember that all it is is just a more fancy version of this <a href="https://gist.github.com/karpathy/d4dee566867f8291f086">100-line gist</a>.<br>æˆ‘å¸Œæœ›æˆ‘å·²ç»è®©ä½ ç›¸ä¿¡ï¼Œè®­ç»ƒå­—ç¬¦çº§è¯­è¨€æ¨¡å‹æ˜¯ä¸€ä¸ªéå¸¸æœ‰è¶£çš„ç»ƒä¹ ã€‚ä½ å¯ä»¥ä½¿ç”¨æˆ‘åœ¨Githubä¸Šå‘å¸ƒçš„char-rnnä»£ç ï¼ˆåŸºäºMITè®¸å¯è¯ï¼‰æ¥è®­ç»ƒä½ è‡ªå·±çš„æ¨¡å‹ã€‚å®ƒéœ€è¦ä¸€ä¸ªå¤§å‹æ–‡æœ¬æ–‡ä»¶ï¼Œå¹¶è®­ç»ƒä¸€ä¸ªå­—ç¬¦çº§æ¨¡å‹ï¼Œä½ å¯ä»¥ä»ä¸­è¿›è¡Œé‡‡æ ·ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ æœ‰GPUï¼Œè¿™ä¼šæ›´æœ‰å¸®åŠ©ï¼Œå¦åˆ™åœ¨CPUä¸Šè®­ç»ƒçš„é€Ÿåº¦å¤§çº¦ä¼šæ…¢10å€ã€‚ä¸ç®¡æ€æ ·ï¼Œå¦‚æœä½ åœ¨ä¸€äº›æ•°æ®ä¸Šè®­ç»ƒå¹¶å¾—åˆ°äº†æœ‰è¶£çš„ç»“æœï¼Œè¯·å‘Šè¯‰æˆ‘ï¼å¦‚æœä½ åœ¨Torch/Luaä»£ç åº“ä¸­è¿·å¤±äº†æ–¹å‘ï¼Œè¯·è®°ä½ï¼Œè¿™åªæ˜¯è¿™ä¸ª100è¡Œä»£ç ç¤ºä¾‹çš„æ›´å¤æ‚ç‰ˆæœ¬ã€‚</p><p>_Brief digression._ The code is written in <a href="http://torch.ch/">Torch 7</a>, which has recently become my favorite deep learning framework. Iâ€™ve only started working with Torch/LUA over the last few months and it hasnâ€™t been easy (I spent a good amount of time digging through the raw Torch code on Github and asking questions on their _gitter_ to get things done), but once you get a hang of things it offers a lot of flexibility and speed. Iâ€™ve also worked with Caffe and Theano in the past and I believe Torch, while not perfect, gets its levels of abstraction and philosophy right better than others. In my view the desirable features of an effective framework are:<br>ç®€å•æ’æ›²ä¸€ä¸‹ã€‚è¿™æ®µä»£ç æ˜¯ç”¨Torch 7ç¼–å†™çš„ï¼Œå®ƒæœ€è¿‘æˆä¸ºäº†æˆ‘æœ€å–œæ¬¢çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ã€‚æˆ‘åªæ˜¯è¿‡å»å‡ ä¸ªæœˆæ‰å¼€å§‹ä½¿ç”¨Torch/LUAï¼Œè¿‡ç¨‹å¹¶ä¸å®¹æ˜“ï¼ˆæˆ‘èŠ±äº†å¤§é‡æ—¶é—´åœ¨Githubä¸ŠæŒ–æ˜Torchçš„æºä»£ç ï¼Œå¹¶åœ¨ä»–ä»¬çš„gitterä¸Šæé—®ä»¥è§£å†³é—®é¢˜ï¼‰ï¼Œä½†ä¸€æ—¦ä½ æŒæ¡äº†å®ƒï¼Œå®ƒå°±èƒ½æä¾›å¾ˆå¤§çš„çµæ´»æ€§å’Œé€Ÿåº¦ã€‚æˆ‘è¿‡å»ä¹Ÿä½¿ç”¨è¿‡Caffeå’ŒTheanoï¼Œæˆ‘è®¤ä¸ºTorchè™½ç„¶ä¸å®Œç¾ï¼Œä½†å®ƒåœ¨æŠ½è±¡å±‚æ¬¡å’Œç†å¿µä¸Šåšå¾—æ¯”å…¶ä»–æ¡†æ¶æ›´å¥½ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œä¸€ä¸ªæœ‰æ•ˆæ¡†æ¶çš„ç†æƒ³ç‰¹æ€§æ˜¯ï¼š</p><ol><li>CPU/GPU transparent Tensor library with a lot of functionality (slicing, array/matrix operations, etc. )<br><strong>CPU/GPUé€æ˜çš„å¼ é‡åº“</strong>ï¼šå…·æœ‰ä¸°å¯Œçš„åŠŸèƒ½ï¼ˆåˆ‡ç‰‡ã€æ•°ç»„/çŸ©é˜µæ“ä½œç­‰ï¼‰ã€‚ï¼‰</li><li>An entirely separate code base in a scripting language (ideally Python) that operates over Tensors and implements all Deep Learning stuff (forward/backward, computation graphs, etc)<br><strong>å®Œå…¨ç‹¬ç«‹çš„è„šæœ¬è¯­è¨€ä»£ç åº“</strong>ï¼šç†æƒ³æƒ…å†µä¸‹æ˜¯Pythonï¼Œæ“ä½œå¼ é‡å¹¶å®ç°æ‰€æœ‰æ·±åº¦å­¦ä¹ ç›¸å…³åŠŸèƒ½ï¼ˆå‰å‘/åå‘ä¼ æ’­ã€è®¡ç®—å›¾ç­‰ï¼‰ã€‚</li><li>It should be possible to easily share pretrained models (Caffe does this well, others donâ€™t), and crucially<br><strong>èƒ½å¤Ÿè½»æ¾å…±äº«é¢„è®­ç»ƒæ¨¡å‹</strong>ï¼šCaffeåœ¨è¿™æ–¹é¢åšå¾—å¾ˆå¥½ï¼Œå…¶ä»–æ¡†æ¶åˆ™ä¸å°½å¦‚äººæ„ã€‚</li><li>NO compilation step (or at least not as currently done in Theano). The trend in Deep Learning is towards larger, more complex networks that are are time-unrolled in complex graphs. It is critical that these do not compile for a long time or development time greatly suffers. Second, by compiling one gives up interpretability and the ability to log/debug effectively. If there is an _option_ to compile the graph once it has been developed for efficiency in prod thatâ€™s fine.<br><strong>æ²¡æœ‰ç¼–è¯‘æ­¥éª¤</strong>ï¼šæˆ–è‡³å°‘ä¸åƒTheanoç›®å‰é‚£æ ·ã€‚æ·±åº¦å­¦ä¹ çš„å‘å±•è¶‹åŠ¿æ˜¯ä½¿ç”¨æ›´å¤§ã€æ›´å¤æ‚çš„ç½‘ç»œï¼Œè¿™äº›ç½‘ç»œåœ¨å¤æ‚çš„è®¡ç®—å›¾ä¸­è¿›è¡Œæ—¶é—´å±•å¼€ã€‚å…³é”®æ˜¯è¿™äº›å›¾ä¸åº”é•¿æ—¶é—´ç¼–è¯‘ï¼Œå¦åˆ™ä¼šä¸¥é‡å½±å“å¼€å‘æ—¶é—´ã€‚å…¶æ¬¡ï¼Œé€šè¿‡ç¼–è¯‘ï¼Œä¼šå¤±å»å¯è§£é‡Šæ€§å’Œæœ‰æ•ˆè®°å½•/è°ƒè¯•çš„èƒ½åŠ›ã€‚å¦‚æœæœ‰é€‰é¡¹å¯ä»¥åœ¨å¼€å‘å®Œæˆåç¼–è¯‘å›¾ä»¥æé«˜ç”Ÿäº§æ•ˆç‡ï¼Œé‚£ä¹Ÿå¾ˆå¥½ã€‚</li></ol><h1 id="further-reading-å»¶ä¼¸é˜…è¯»"><a href="#Further-Reading-å»¶ä¼¸é˜…è¯»" class="headerlink" title="Further Reading å»¶ä¼¸é˜…è¯»"></a>Further Reading å»¶ä¼¸é˜…è¯»</h1><p>Before the end of the post I also wanted to position RNNs in a wider context and provide a sketch of the current research directions. RNNs have recently generated a significant amount of buzz and excitement in the field of Deep Learning. Similar to Convolutional Networks they have been around for decades but their full potential has only recently started to get widely recognized, in large part due to our growing computational resources. Hereâ€™s a brief sketch of a few recent developments (definitely not complete list, and a lot of this work draws from research back to 1990s, see related work sections):<br>åœ¨æ–‡ç« çš„ç»“å°¾ï¼Œæˆ‘è¿˜æƒ³æŠŠRNNæ”¾åœ¨æ›´å¹¿æ³›çš„èƒŒæ™¯ä¸­ï¼Œå¹¶æä¾›å½“å‰ç ”ç©¶æ–¹å‘çš„æ¦‚è¿°ã€‚æœ€è¿‘ï¼ŒRNNåœ¨æ·±åº¦å­¦ä¹ é¢†åŸŸå¼•èµ·äº†å¤§é‡å…³æ³¨å’Œå…´å¥‹ã€‚ç±»ä¼¼äºå·ç§¯ç½‘ç»œï¼ŒRNNå·²ç»å­˜åœ¨äº†å‡ åå¹´ï¼Œä½†å®ƒä»¬çš„å…¨éƒ¨æ½œåŠ›ç›´åˆ°æœ€è¿‘æ‰å¼€å§‹è¢«å¹¿æ³›è®¤å¯ï¼Œè¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šè¦å½’åŠŸäºæˆ‘ä»¬ä¸æ–­å¢é•¿çš„è®¡ç®—èµ„æºã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æœ€è¿‘å‘å±•çš„ç®€è¦æ¦‚è¿°ï¼ˆç»ä¸æ˜¯å®Œæ•´çš„åˆ—è¡¨ï¼Œå…¶ä¸­å¾ˆå¤šå·¥ä½œå¯ä»¥è¿½æº¯åˆ°1990å¹´ä»£ï¼Œè¯¦è§ç›¸å…³ç ”ç©¶éƒ¨åˆ†ï¼‰ï¼š</p><p>In the domain of <strong>NLP/Speech</strong>, RNNs <a href="http://www.jmlr.org/proceedings/papers/v32/graves14.pdf">transcribe speech to text</a>, perform <a href="http://arxiv.org/abs/1409.3215">machine translation</a>, <a href="http://www.cs.toronto.edu/~graves/handwriting.html">generate handwritten text</a>, and of course, they have been used as powerful language models <a href="http://www.cs.utoronto.ca/~ilya/pubs/2011/LANG-RNN.pdf">(Sutskever et al.)</a> <a href="http://arxiv.org/abs/1308.0850">(Graves)</a> <a href="http://www.rnnlm.org/">(Mikolov et al.)</a> (both on the level of characters and words). Currently it seems that word-level models work better than character-level models, but this is surely a temporary thing.<br>åœ¨NLP/Speeché¢†åŸŸï¼ŒRNNç”¨äºå°†è¯­éŸ³è½¬å½•ä¸ºæ–‡æœ¬ã€æ‰§è¡Œæœºå™¨ç¿»è¯‘ã€ç”Ÿæˆæ‰‹å†™æ–‡æœ¬ï¼Œå½“ç„¶ï¼Œå®ƒä»¬ä¹Ÿè¢«ç”¨ä½œå¼ºå¤§çš„è¯­è¨€æ¨¡å‹ï¼ˆSutskeverç­‰äººï¼‰ï¼ˆGravesï¼‰ï¼ˆMikolovç­‰äººï¼‰ï¼ˆåŒ…æ‹¬å­—ç¬¦çº§å’Œå•è¯çº§ï¼‰ã€‚ç›®å‰çœ‹æ¥ï¼Œå•è¯çº§æ¨¡å‹æ¯”å­—ç¬¦çº§æ¨¡å‹æ•ˆæœæ›´å¥½ï¼Œä½†è¿™è‚¯å®šåªæ˜¯æš‚æ—¶çš„ã€‚</p><p><strong>Computer Vision.</strong> RNNs are also quickly becoming pervasive in Computer Vision. For example, weâ€™re seeing RNNs in frame-level <a href="http://arxiv.org/abs/1411.4389">video classification</a>, <a href="http://arxiv.org/abs/1411.4555">image captioning</a> (also including my own work and many others), <a href="http://arxiv.org/abs/1505.00487">video captioning</a> and very recently <a href="http://arxiv.org/abs/1505.02074">visual question answering</a>. My personal favorite RNNs in Computer Vision paper is <a href="http://arxiv.org/abs/1406.6247">Recurrent Models of Visual Attention</a>, both due to its high-level direction (sequential processing of images with glances) and the low-level modeling (REINFORCE learning rule that is a special case of policy gradient methods in Reinforcement Learning, which allows one to train models that perform non-differentiable computation (taking glances around the image in this case)). Iâ€™m confident that this type of hybrid model that consists of a blend of CNN for raw perception coupled with an RNN glance policy on top will become pervasive in perception, especially for more complex tasks that go beyond classifying some objects in plain view.<br>è®¡ç®—æœºè§†è§‰ã€‚RNNä¹Ÿè¿…é€Ÿåœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸæ™®åŠã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çœ‹åˆ°RNNç”¨äºå¸§çº§è§†é¢‘åˆ†ç±»ã€å›¾åƒæè¿°ç”Ÿæˆï¼ˆåŒ…æ‹¬æˆ‘è‡ªå·±çš„å·¥ä½œå’Œè®¸å¤šå…¶ä»–äººçš„å·¥ä½œï¼‰ã€è§†é¢‘æè¿°ç”Ÿæˆä»¥åŠæœ€è¿‘çš„è§†è§‰é—®ç­”ã€‚æˆ‘ä¸ªäººæœ€å–œæ¬¢çš„è®¡ç®—æœºè§†è§‰é¢†åŸŸçš„RNNè®ºæ–‡æ˜¯ã€Šè§†è§‰æ³¨æ„åŠ›çš„é€’å½’æ¨¡å‹ã€‹ï¼Œå› ä¸ºå®ƒåœ¨é«˜å±‚æ¬¡æ–¹å‘ï¼ˆé€šè¿‡æ‰«è§†å¯¹å›¾åƒè¿›è¡Œé¡ºåºå¤„ç†ï¼‰å’Œä½å±‚æ¬¡å»ºæ¨¡ï¼ˆREINFORCEå­¦ä¹ è§„åˆ™ï¼Œè¿™æ˜¯å¼ºåŒ–å­¦ä¹ ä¸­ç­–ç•¥æ¢¯åº¦æ–¹æ³•çš„ç‰¹ä¾‹ï¼Œå…è®¸è®­ç»ƒæ‰§è¡Œä¸å¯å¾®è®¡ç®—çš„æ¨¡å‹ï¼ˆåœ¨æœ¬ä¾‹ä¸­æ˜¯ç¯é¡¾å›¾åƒï¼‰ï¼‰ä¸Šéƒ½å¾ˆå‡ºè‰²ã€‚æˆ‘ç›¸ä¿¡è¿™ç§æ··åˆæ¨¡å‹ï¼Œå³ç»“åˆäº†ç”¨äºåŸå§‹æ„ŸçŸ¥çš„CNNå’Œç”¨äºæ‰«è§†ç­–ç•¥çš„RNNçš„æ¨¡å‹ï¼Œå°†åœ¨æ„ŸçŸ¥é¢†åŸŸæ™®åŠï¼Œç‰¹åˆ«æ˜¯åœ¨è¶…è¶Šç®€å•å¯¹è±¡åˆ†ç±»çš„å¤æ‚ä»»åŠ¡ä¸­ã€‚</p><p><strong>Inductive Reasoning, Memories and Attention.</strong> Another extremely exciting direction of research is oriented towards addressing the limitations of vanilla recurrent networks. One problem is that RNNs are not inductive: They memorize sequences extremely well, but they donâ€™t necessarily always show convincing signs of generalizing in the _correct_ way (Iâ€™ll provide pointers in a bit that make this more concrete). A second issue is they unnecessarily couple their representation size to the amount of computation per step. For instance, if you double the size of the hidden state vector youâ€™d quadruple the amount of FLOPS at each step due to the matrix multiplication. Ideally, weâ€™d like to maintain a huge representation/memory (e.g. containing all of Wikipedia or many intermediate state variables), while maintaining the ability to keep computation per time step fixed.<br>å½’çº³æ¨ç†ã€è®°å¿†å’Œæ³¨æ„åŠ›ã€‚å¦ä¸€ä¸ªæå…¶ä»¤äººå…´å¥‹çš„ç ”ç©¶æ–¹å‘æ˜¯è§£å†³æ™®é€šå¾ªç¯ç½‘ç»œçš„å±€é™æ€§ã€‚ä¸€ä¸ªé—®é¢˜æ˜¯RNNä¸å…·å¤‡å½’çº³èƒ½åŠ›ï¼šå®ƒä»¬éå¸¸æ“…é•¿è®°å¿†åºåˆ—ï¼Œä½†ä¸ä¸€å®šæ€»æ˜¯èƒ½ä»¥æ­£ç¡®çš„æ–¹å¼è¡¨ç°å‡ºä»¤äººä¿¡æœçš„æ³›åŒ–èƒ½åŠ›ï¼ˆç¨åæˆ‘ä¼šæä¾›ä¸€äº›å…·ä½“çš„ä¾‹å­ï¼‰ã€‚ç¬¬äºŒä¸ªé—®é¢˜æ˜¯å®ƒä»¬ä¸å¿…è¦åœ°å°†è¡¨ç¤ºå¤§å°ä¸æ¯æ­¥è®¡ç®—é‡è€¦åˆåœ¨ä¸€èµ·ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å°†éšè—çŠ¶æ€å‘é‡çš„å¤§å°åŠ å€ï¼Œé‚£ä¹ˆç”±äºçŸ©é˜µä¹˜æ³•ï¼Œæ¯æ­¥çš„æµ®ç‚¹è¿ç®—é‡ï¼ˆFLOPSï¼‰å°†å¢åŠ å››å€ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä¿æŒä¸€ä¸ªå·¨å¤§çš„è¡¨ç¤º/è®°å¿†ï¼ˆä¾‹å¦‚åŒ…å«æ•´ä¸ªç»´åŸºç™¾ç§‘æˆ–è®¸å¤šä¸­é—´çŠ¶æ€å˜é‡ï¼‰ï¼ŒåŒæ—¶ä¿æŒæ¯ä¸ªæ—¶é—´æ­¥çš„è®¡ç®—é‡å›ºå®šã€‚</p><p>The first convincing example of moving towards these directions was developed in DeepMindâ€™s <a href="http://arxiv.org/abs/1410.5401">Neural Turing Machines</a> paper. This paper sketched a path towards models that can perform read/write operations between large, external memory arrays and a smaller set of memory registers (think of these as our working memory) where the computation happens. Crucially, the NTM paper also featured very interesting memory addressing mechanisms that were implemented with a (soft, and fully-differentiable) attention model. The concept of <strong>soft attention</strong> has turned out to be a powerful modeling feature and was also featured in <a href="http://arxiv.org/abs/1409.0473">Neural Machine Translation by Jointly Learning to Align and Translate</a> for Machine Translation and <a href="http://arxiv.org/abs/1503.08895">Memory Networks</a> for (toy) Question Answering. In fact, Iâ€™d go as far as to say that<br>ç¬¬ä¸€ä¸ªæœç€è¿™äº›æ–¹å‘å‰è¿›çš„ä»¤äººä¿¡æœçš„ä¾‹å­æ˜¯DeepMindçš„ã€Šç¥ç»å›¾çµæœºã€‹ï¼ˆNeural Turing Machinesï¼‰è®ºæ–‡ã€‚è¿™ç¯‡è®ºæ–‡å‹¾ç”»äº†ä¸€ä¸ªæ¨¡å‹çš„è·¯å¾„ï¼Œè¿™äº›æ¨¡å‹å¯ä»¥åœ¨å¤§å‹å¤–éƒ¨å­˜å‚¨é˜µåˆ—å’Œä¸€å°ç»„è®¡ç®—å‘ç”Ÿçš„å­˜å‚¨å¯„å­˜å™¨ï¼ˆå¯ä»¥å°†è¿™äº›è§†ä¸ºæˆ‘ä»¬çš„å·¥ä½œè®°å¿†ï¼‰ä¹‹é—´æ‰§è¡Œè¯»/å†™æ“ä½œã€‚è‡³å…³é‡è¦çš„æ˜¯ï¼ŒNTMè®ºæ–‡è¿˜å±•ç¤ºäº†éå¸¸æœ‰è¶£çš„è®°å¿†å¯»å€æœºåˆ¶ï¼Œè¿™äº›æœºåˆ¶é€šè¿‡ä¸€ä¸ªï¼ˆè½¯ä¸”å®Œå…¨å¯å¾®åˆ†çš„ï¼‰æ³¨æ„åŠ›æ¨¡å‹å®ç°ã€‚è½¯æ³¨æ„åŠ›çš„æ¦‚å¿µè¢«è¯æ˜æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å»ºæ¨¡ç‰¹æ€§ï¼Œå®ƒä¹Ÿå‡ºç°åœ¨ã€Šé€šè¿‡è”åˆå­¦ä¹ å¯¹é½å’Œç¿»è¯‘çš„ç¥ç»æœºå™¨ç¿»è¯‘ã€‹å’Œã€Šè®°å¿†ç½‘ç»œç”¨äºï¼ˆç©å…·ï¼‰é—®ç­”ã€‹ä¸­ã€‚å®é™…ä¸Šï¼Œæˆ‘ç”šè‡³å¯ä»¥è¯´</p><p>The concept of <strong>attention</strong> is the most interesting recent architectural innovation in neural networks.<br>æ³¨æ„åŠ›çš„æ¦‚å¿µæ˜¯ç¥ç»ç½‘ç»œä¸­æœ€è¿‘æœ€æœ‰è¶£çš„æ¶æ„åˆ›æ–°ã€‚</p><p>Now, I donâ€™t want to dive into too many details but a soft attention scheme for memory addressing is convenient because it keeps the model fully-differentiable, but unfortunately one sacrifices efficiency because everything that can be attended to is attended to (but softly). Think of this as declaring a pointer in C that doesnâ€™t point to a specific address but instead defines an entire distribution over all addresses in the entire memory, and dereferencing the pointer returns a weighted sum of the pointed content (that would be an expensive operation!). This has motivated multiple authors to swap soft attention models for <strong>hard attention</strong> where one samples a particular chunk of memory to attend to (e.g. a read/write action for some memory cell instead of reading/writing from all cells to some degree). This model is significantly more philosophically appealing, scalable and efficient, but unfortunately it is also non-differentiable. This then calls for use of techniques from the Reinforcement Learning literature (e.g. REINFORCE) where people are perfectly used to the concept of non-differentiable interactions. This is very much ongoing work but these hard attention models have been explored, for example, in <a href="http://arxiv.org/abs/1503.01007">Inferring Algorithmic Patterns with Stack-Augmented Recurrent Nets</a>, <a href="http://arxiv.org/abs/1505.00521">Reinforcement Learning Neural Turing Machines</a>, and <a href="http://arxiv.org/abs/1502.03044">Show Attend and Tell</a>.<br>ç°åœ¨ï¼Œæˆ‘ä¸æƒ³æ·±å…¥ç ”ç©¶å¤ªå¤šç»†èŠ‚ï¼Œä½†ç”¨äºå†…å­˜å¯»å€çš„è½¯æ³¨æ„åŠ›æ–¹æ¡ˆå¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºå®ƒä½¿æ¨¡å‹ä¿æŒå®Œå…¨å¯å¾®åˆ†ï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œäººä»¬ç‰ºç‰²äº†æ•ˆç‡ï¼Œå› ä¸ºæ‰€æœ‰å¯ä»¥å¤„ç†çš„ä¸œè¥¿éƒ½è¢«å¤„ç†äº†ï¼ˆä½†å¾ˆè½¯ï¼‰ã€‚å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆåœ¨ C è¯­è¨€ä¸­å£°æ˜ä¸€ä¸ªæŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆä¸æŒ‡å‘ç‰¹å®šåœ°å€ï¼Œè€Œæ˜¯åœ¨æ•´ä¸ªå†…å­˜ä¸­çš„æ‰€æœ‰åœ°å€ä¸Šå®šä¹‰æ•´ä¸ªåˆ†å¸ƒï¼Œå¹¶ä¸”å–æ¶ˆå¼•ç”¨æŒ‡é’ˆä¼šè¿”å›æŒ‡å‘å†…å®¹çš„åŠ æƒæ€»å’Œï¼ˆè¿™å°†æ˜¯ä¸€ä¸ªæ˜‚è´µçš„æ“ä½œï¼è¿™ä¿ƒä½¿å¤šä½ä½œè€…å°†è½¯æ³¨æ„åŠ›æ¨¡å‹æ¢æˆç¡¬æ³¨æ„åŠ›æ¨¡å‹ï¼Œå…¶ä¸­ä¸€ä¸ªäººå¯¹è¦å…³æ³¨çš„ç‰¹å®šå†…å­˜å—è¿›è¡Œé‡‡æ ·ï¼ˆä¾‹å¦‚ï¼Œå¯¹æŸäº›è®°å¿†å•å…ƒè¿›è¡Œè¯»/å†™æ“ä½œï¼Œè€Œä¸æ˜¯åœ¨æŸç§ç¨‹åº¦ä¸Šä»æ‰€æœ‰å•å…ƒè¯»å–/å†™å…¥ï¼‰ã€‚è¿™ä¸ªæ¨¡å‹åœ¨å“²å­¦ä¸Šæ›´å…·å¸å¼•åŠ›ã€å¯æ‰©å±•æ€§å’Œæ•ˆç‡ï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä¹Ÿæ˜¯ä¸å¯å¾®åˆ†çš„ã€‚ç„¶åï¼Œè¿™éœ€è¦ä½¿ç”¨å¼ºåŒ–å­¦ä¹ æ–‡çŒ®ä¸­çš„æŠ€æœ¯ï¼ˆä¾‹å¦‚REINFORCEï¼‰ï¼Œåœ¨è¿™äº›æŠ€æœ¯ä¸­ï¼Œäººä»¬å®Œå…¨ä¹ æƒ¯äº†ä¸å¯å¾®åˆ†äº¤äº’çš„æ¦‚å¿µã€‚è¿™æ˜¯ä¸€é¡¹æ­£åœ¨è¿›è¡Œçš„å·¥ä½œï¼Œä½†è¿™äº›ç¡¬æ³¨æ„åŠ›æ¨¡å‹å·²ç»è¢«æ¢ç´¢è¿‡ï¼Œä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨å †æ ˆå¢å¼ºçš„å¾ªç¯ç½‘ç»œæ¨æ–­ç®—æ³•æ¨¡å¼ã€å¼ºåŒ–å­¦ä¹ ç¥ç»å›¾çµæœºå’Œæ˜¾ç¤ºã€å‡ºå¸­å’Œè®²è¿°ä¸­ã€‚</p><p><strong>People</strong>. If youâ€™d like to read up on RNNs I recommend theses from <a href="http://www.cs.toronto.edu/~graves/">Alex Graves</a>, <a href="http://www.cs.toronto.edu/~ilya/">Ilya Sutskever</a> and <a href="http://www.rnnlm.org/">Tomas Mikolov</a>. For more about REINFORCE and more generally Reinforcement Learning and policy gradient methods (which REINFORCE is a special case of) <a href="http://www0.cs.ucl.ac.uk/staff/d.silver/web/Home.html">David Silver</a>â€™s class, or one of <a href="http://www.cs.berkeley.edu/~pabbeel/">Pieter Abbeel</a>â€™s classes.<br>äººã€‚å¦‚æœä½ æƒ³æ·±å…¥äº†è§£RNNï¼Œæˆ‘æ¨èé˜…è¯»Alex Gravesã€Ilya Sutskeverå’ŒTomas Mikolovçš„è®ºæ–‡ã€‚å…³äºREINFORCEå’Œæ›´å¹¿æ³›çš„å¼ºåŒ–å­¦ä¹ åŠç­–ç•¥æ¢¯åº¦æ–¹æ³•ï¼ˆREINFORCEæ˜¯å…¶ç‰¹ä¾‹ï¼‰ï¼Œå¯ä»¥å‚è€ƒDavid Silverçš„è¯¾ç¨‹ï¼Œæˆ–Pieter Abbeelçš„è¯¾ç¨‹ä¹‹ä¸€ã€‚</p><p><strong>Code</strong>. If youâ€™d like to play with training RNNs I hear good things about <a href="https://github.com/fchollet/keras">keras</a> or <a href="https://github.com/IndicoDataSolutions/Passage">passage</a> for Theano, the <a href="https://github.com/karpathy/char-rnn">code</a> released with this post for Torch, or <a href="https://gist.github.com/karpathy/587454dc0146a6ae21fc">this gist</a> for raw numpy code I wrote a while ago that implements an efficient, batched LSTM forward and backward pass. You can also have a look at my numpy-based <a href="https://github.com/karpathy/neuraltalk">NeuralTalk</a> which uses an RNN/LSTM to caption images, or maybe this <a href="http://jeffdonahue.com/lrcn/">Caffe</a> implementation by Jeff Donahue.<br>ä»£ç ã€‚å¦‚æœä½ æƒ³å°è¯•è®­ç»ƒRNNï¼Œæˆ‘å¬è¯´kerasæˆ–passage for Theanoçš„è¯„ä»·å¾ˆå¥½ï¼Œå¯ä»¥å‚è€ƒæœ¬æ–‡å‘å¸ƒçš„ç”¨äºTorchçš„ä»£ç ï¼Œæˆ–è€…æˆ‘ä¹‹å‰ç¼–å†™çš„è¿™ä¸ªå®ç°äº†é«˜æ•ˆæ‰¹é‡LSTMå‰å‘å’Œåå‘ä¼ é€’çš„çº¯numpyä»£ç ã€‚ä½ ä¹Ÿå¯ä»¥çœ‹çœ‹æˆ‘åŸºäºnumpyçš„NeuralTalkï¼Œå®ƒä½¿ç”¨RNN/LSTMç”Ÿæˆå›¾åƒæè¿°ï¼Œæˆ–è€…çœ‹çœ‹Jeff Donahueçš„è¿™ä¸ªCaffeå®ç°ã€‚</p><h1 id="conclusion-ç»“è®º"><a href="#Conclusion-ç»“è®º" class="headerlink" title="Conclusion ç»“è®º"></a>Conclusion ç»“è®º</h1><p>Weâ€™ve learned about RNNs, how they work, why they have become a big deal, weâ€™ve trained an RNN character-level language model on several fun datasets, and weâ€™ve seen where RNNs are going. You can confidently expect a large amount of innovation in the space of RNNs, and I believe they will become a pervasive and critical component to intelligent systems.<br>æˆ‘ä»¬å·²ç»äº†è§£äº†RNNï¼Œå®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä¸ºä»€ä¹ˆå®ƒä»¬å˜å¾—å¦‚æ­¤é‡è¦ã€‚æˆ‘ä»¬åœ¨å‡ ä¸ªæœ‰è¶£çš„æ•°æ®é›†ä¸Šè®­ç»ƒäº†ä¸€ä¸ªRNNå­—ç¬¦çº§è¯­è¨€æ¨¡å‹ï¼Œå¹¶ä¸”çœ‹åˆ°äº†RNNçš„å‘å±•æ–¹å‘ã€‚ä½ å¯ä»¥è‡ªä¿¡åœ°æœŸå¾…åœ¨RNNé¢†åŸŸå‡ºç°å¤§é‡çš„åˆ›æ–°ï¼Œæˆ‘ç›¸ä¿¡å®ƒä»¬å°†æˆä¸ºæ™ºèƒ½ç³»ç»Ÿä¸­æ™®éä¸”å…³é”®çš„ç»„æˆéƒ¨åˆ†ã€‚</p><p>Lastly, to add some <strong>meta</strong> to this post, I trained an RNN on the source file of this blog post. Unfortunately, at about 46K characters I havenâ€™t written enough data to properly feed the RNN, but the returned sample (generated with low temperature to get a more typical sample) is:<br>æœ€åï¼Œä¸ºäº†ç»™è¿™ç¯‡æ–‡ç« å¢åŠ ä¸€äº›å…ƒå†…å®¹ï¼Œæˆ‘ç”¨è¿™ç¯‡åšå®¢æ–‡ç« çš„æºæ–‡ä»¶è®­ç»ƒäº†ä¸€ä¸ªRNNã€‚ä¸å¹¸çš„æ˜¯ï¼Œå¤§çº¦46Kå­—ç¬¦çš„æ•°æ®é‡è¿˜ä¸è¶³ä»¥å……åˆ†è®­ç»ƒRNNï¼Œä½†ç”Ÿæˆçš„æ ·æœ¬ï¼ˆåœ¨ä½æ¸©ä¸‹ç”Ÿæˆï¼Œä»¥è·å¾—æ›´å…¸å‹çš„æ ·æœ¬ï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">I&#x27;ve the RNN with and works, but the computed with program of the </span><br><span class="line">RNN with and the computed of the RNN with with and the code</span><br></pre></td></tr></table></figure><p>Yes, the post was about RNN and how well it works, so clearly this works :). See you next time!<br>æ˜¯çš„ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯å…³äº RNN åŠå…¶å·¥ä½œæƒ…å†µçš„ï¼Œæ‰€ä»¥å¾ˆæ˜æ˜¾è¿™:)å·¥ä½œã€‚ä¸‹æ¬¡å†è§ï¼</p><h1 id="edit-extra-links-ç¼–è¾‘é¢å¤–é“¾æ¥"><a href="#EDIT-extra-links-ç¼–è¾‘ï¼ˆé¢å¤–é“¾æ¥ï¼‰" class="headerlink" title="EDIT (extra links): ç¼–è¾‘ï¼ˆé¢å¤–é“¾æ¥ï¼‰"></a>EDIT (extra links): ç¼–è¾‘ï¼ˆé¢å¤–é“¾æ¥ï¼‰</h1><p>Videos: è§†é¢‘ï¼š</p><ul><li>I gave a talk on this work at the <a href="https://skillsmatter.com/skillscasts/6611-visualizing-and-understanding-recurrent-networks">London Deep Learning meetup (video)</a>.<br>æˆ‘åœ¨ä¼¦æ•¦æ·±åº¦å­¦ä¹ èšä¼šä¸Šå°±è¿™é¡¹å·¥ä½œå‘è¡¨äº†æ¼”è®²ï¼ˆè§†é¢‘ï¼‰ã€‚</li></ul><p>Discussions: è®¨è®ºï¼š</p><ul><li><a href="https://news.ycombinator.com/item?id=9584325">HN discussion HN è®¨è®º</a></li><li>Reddit discussion on <a href="http://www.reddit.com/r/MachineLearning/comments/36s673/the_unreasonable_effectiveness_of_recurrent/">r/machinelearning</a><br>Reddit å…³äº r/machinelearning çš„è®¨è®º</li><li>Reddit discussion on <a href="http://www.reddit.com/r/programming/comments/36su8d/the_unreasonable_effectiveness_of_recurrent/">r/programming</a><br>Reddit ä¸Šå…³äº r/programming çš„è®¨è®º</li></ul><p>Replies: ç­”å¤ï¼š</p><ul><li><a href="https://twitter.com/yoavgo">Yoav Goldberg</a> compared these RNN results to <a href="http://nbviewer.ipython.org/gist/yoavg/d76121dfde2618422139">n-gram maximum likelihood (counting) baseline</a><br>Yoav Goldberg å°†è¿™äº› RNN ç»“æœä¸ n-gram æœ€å¤§ä¼¼ç„¶ï¼ˆè®¡æ•°ï¼‰åŸºçº¿è¿›è¡Œäº†æ¯”è¾ƒ</li><li><a href="https://twitter.com/nylk">@nylk</a> trained char-rnn on <a href="https://gist.github.com/nylki/1efbaa36635956d35bcc">cooking recipes</a>. They look great!<br>@nylkåŸ¹è®­äº†char-rnnçš„çƒ¹é¥ªé£Ÿè°±ã€‚å®ƒä»¬çœ‹èµ·æ¥å¾ˆæ£’ï¼</li><li><a href="https://twitter.com/MrChrisJohnson">@MrChrisJohnson</a> trained char-rnn on Eminem lyrics and then synthesized a rap song with robotic voice reading it out. Hilarious :)<br>@MrChrisJohnsonç”¨ Eminem çš„æ­Œè¯è®­ç»ƒäº† char-rnnï¼Œç„¶ååˆæˆäº†ä¸€é¦–å¸¦æœ‰æœºå™¨äººå£°éŸ³çš„è¯´å”±æ­Œæ›²ã€‚æç¬‘:)</li><li><a href="https://twitter.com/samim">@samim</a> trained char-rnn on <a href="https://medium.com/@samim/obama-rnn-machine-generated-political-speeches-c8abd18a2ea0">Obama Speeches</a>. They look fun!<br>@samimåŸ¹è®­äº†å¥¥å·´é©¬æ¼”è®²çš„char-rnnã€‚ä»–ä»¬çœ‹èµ·æ¥å¾ˆæœ‰è¶£ï¼</li><li><a href="https://twitter.com/seaandsailor">JoÃ£o Felipe</a> trained char-rnn irish folk music and <a href="https://soundcloud.com/seaandsailor/sets/char-rnn-composes-irish-folk-music">sampled music</a><br>è‹¥æ˜‚Â·è´¹åˆ©ä½©ï¼ˆJoÃ£o Felipeï¼‰è®­ç»ƒäº†char-rnnçˆ±å°”å…°æ°‘é—´éŸ³ä¹å¹¶é‡‡æ ·äº†éŸ³ä¹</li><li><a href="https://twitter.com/boblsturm">Bob Sturm</a> also trained char-rnn on <a href="https://highnoongmt.wordpress.com/2015/05/22/lisls-stis-recurrent-neural-networks-for-folk-music-generation/">music in ABC notation</a><br>é²å‹ƒÂ·æ–¯ç‰¹å§†ï¼ˆBob Sturmï¼‰è¿˜å¯¹char-rnnè¿›è¡Œäº†ABCè®°è°±æ³•çš„éŸ³ä¹åŸ¹è®­</li><li><a href="https://twitter.com/RNN_Bible">RNN Bible bot</a> by <a href="https://twitter.com/the__glu/with_replies">Maximilien</a><br>RNN Bible bot çš„ Maximilien</li><li><a href="http://cpury.github.io/learning-holiness/">Learning Holiness</a> learning the Bible<br>å­¦ä¹ åœ£æ´ å­¦ä¹ åœ£ç»</li><li><a href="https://www.terminal.com/tiny/ZMcqdkWGOM">Terminal.com snapshot</a> that has char-rnn set up and ready to go in a browser-based virtual machine (thanks <a href="https://www.twitter.com/samim">@samim</a>)<br>Terminal.com å·²è®¾ç½® char-rnn å¹¶å‡†å¤‡åœ¨åŸºäºæµè§ˆå™¨çš„è™šæ‹Ÿæœºä¸­ä½¿ç”¨çš„å¿«ç…§ï¼ˆæ„Ÿè°¢ @samimï¼‰</li></ul><h1 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h1><h2 id="1vanilla-ç¥ç»ç½‘ç»œ"><a href="#1-Vanilla-ç¥ç»ç½‘ç»œ" class="headerlink" title="1.Vanilla ç¥ç»ç½‘ç»œ"></a>1.Vanilla ç¥ç»ç½‘ç»œ</h2><p>â€œVanilla ç¥ç»ç½‘ç»œâ€é€šå¸¸æŒ‡çš„æ˜¯æœ€åŸºæœ¬ã€æœ€ç®€å•çš„ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œæ²¡æœ‰ä½¿ç”¨ä»»ä½•ç‰¹æ®Šçš„å±‚æˆ–å¤æ‚çš„æ¶æ„ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒä¸€èˆ¬æŒ‡çš„æ˜¯ç®€å•çš„å‰é¦ˆç¥ç»ç½‘ç»œï¼ˆFeedforward Neural Network, FNNï¼‰</p><h2 id="2-å‘é‡vectorvs-åºåˆ—sequence"><a href="#2-å‘é‡ï¼ˆVectorï¼‰vs-åºåˆ—ï¼ˆSequenceï¼‰" class="headerlink" title="2. å‘é‡ï¼ˆVectorï¼‰vs åºåˆ—ï¼ˆSequenceï¼‰"></a>2. å‘é‡ï¼ˆVectorï¼‰vs åºåˆ—ï¼ˆSequenceï¼‰</h2><p><strong>å‘é‡ï¼ˆVectorï¼‰</strong>ï¼š</p><ul><li><strong>å®šä¹‰</strong>ï¼šåœ¨æ•°å­¦å’Œè®¡ç®—æœºç§‘å­¦ä¸­ï¼Œå‘é‡æ˜¯ä¸€ç»„æœ‰åºçš„æ•°å€¼ã€‚è¿™äº›æ•°å€¼å¯ä»¥è¡¨ç¤ºå¤šç»´ç©ºé—´ä¸­çš„ä¸€ä¸ªç‚¹æˆ–æŸä¸ªç‰¹å®šçš„æ•°æ®ç»“æ„ã€‚</li><li><strong>ç‰¹æ€§</strong>ï¼š<ul><li>å›ºå®šé•¿åº¦ï¼šå‘é‡çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œä¾‹å¦‚ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªæ•°å€¼çš„å‘é‡$x_1, x_2, x_3$ã€‚ è¿™ç§å¤„ç†æ–¹å¼å¯¹äºå›¾åƒåˆ†ç±»ã€å›ºå®šé•¿åº¦çš„æ–‡æœ¬åˆ†ç±»ç­‰ä»»åŠ¡éå¸¸æœ‰æ•ˆã€‚</li><li>æ— æ—¶é—´ä¾èµ–ï¼šå‘é‡ä¸­çš„å…ƒç´ æ²¡æœ‰æ—¶é—´æˆ–é¡ºåºä¸Šçš„ä¾èµ–å…³ç³»ã€‚ä¾‹å¦‚ï¼Œä¸€å¼ å›¾ç‰‡çš„åƒç´ æ•°æ®å¯ä»¥ä½œä¸ºè¾“å…¥å‘é‡ï¼Œä½†è¿™äº›åƒç´ ä¹‹é—´æ²¡æœ‰æ—¶é—´é¡ºåºä¸Šçš„å…³ç³»ã€‚</li></ul></li><li><strong>ç¤ºä¾‹</strong>ï¼š<ul><li>å›¾åƒå¤„ç†ä¸­çš„åƒç´ å€¼å‘é‡ã€‚</li><li>é™æ€æ–‡æœ¬åˆ†ç±»ä¸­çš„å•è¯å‘é‡ã€‚</li></ul></li><li><strong>å‘é‡è¾“å…¥è¾“å‡º</strong>ï¼šå‘é‡è¾“å…¥è¾“å‡ºé€šå¸¸æŒ‡çš„æ˜¯ç¥ç»ç½‘ç»œå¤„ç†å›ºå®šé•¿åº¦çš„å‘é‡ï¼Œå³ä¸€ç»„å›ºå®šå¤§å°çš„æ•°å€¼è¾“å…¥å’Œè¾“å‡ºã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼š<ul><li>å›¾åƒåˆ†ç±»ï¼šè¾“å…¥æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„å›¾åƒå‘é‡ï¼Œè¾“å‡ºæ˜¯ä¸€ä¸ªç±»åˆ«æ ‡ç­¾å‘é‡ã€‚</li><li>é™æ€æ–‡æœ¬åˆ†ç±»ï¼šè¾“å…¥æ˜¯ä¸€ä¸ªè¡¨ç¤ºå•ä¸ªæ–‡æ¡£çš„å‘é‡ï¼Œè¾“å‡ºæ˜¯åˆ†ç±»æ ‡ç­¾ã€‚</li></ul></li></ul><p><strong>åºåˆ—ï¼ˆSequenceï¼‰</strong>ï¼š</p><ul><li><strong>å®šä¹‰</strong>ï¼šåºåˆ—æ˜¯ä¸€ç»„æŒ‰ç‰¹å®šé¡ºåºæ’åˆ—çš„æ•°æ®ï¼Œé€šå¸¸æ˜¯æ—¶é—´æˆ–é¡ºåºç›¸å…³çš„ã€‚</li><li><strong>ç‰¹æ€§</strong>ï¼š<ul><li>å˜é•¿ï¼šåºåˆ—çš„é•¿åº¦å¯ä»¥å˜åŒ–ï¼Œä¾‹å¦‚ä¸€æ®µæ–‡æœ¬å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦åºåˆ—$c_1, c_2, â€¦, c_t$</li><li>æœ‰æ—¶é—´ä¾èµ–ï¼šåºåˆ—ä¸­çš„å…ƒç´ æœ‰æ—¶é—´æˆ–é¡ºåºä¸Šçš„ä¾èµ–å…³ç³»ã€‚åç»­å…ƒç´ ä¾èµ–äºå‰é¢å‡ºç°çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œåœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸­ï¼Œä¸€ä¸ªå¥å­çš„å•è¯é¡ºåºå†³å®šäº†å¥å­çš„æ„ä¹‰ã€‚</li></ul></li><li><strong>ç¤ºä¾‹</strong>ï¼š<ul><li>æ—¶é—´åºåˆ—æ•°æ®ï¼Œå¦‚è‚¡ç¥¨ä»·æ ¼çš„æ¯æ—¥è®°å½•ã€‚</li><li>æ–‡æœ¬æ•°æ®ï¼Œå¦‚ä¸€æ®µå¥å­ä¸­çš„å•è¯åºåˆ—ã€‚</li></ul></li><li><strong>åºåˆ—è¾“å…¥è¾“å‡º</strong>ï¼šåºåˆ—è¾“å…¥è¾“å‡ºæŒ‡çš„æ˜¯ç¥ç»ç½‘ç»œå¤„ç†ä¸€ç³»åˆ—çš„è¾“å…¥æ•°æ®ï¼Œè¿™äº›æ•°æ®æœ‰æ—¶é—´æˆ–é¡ºåºä¸Šçš„ä¾èµ–å…³ç³»ã€‚RNNï¼ˆå¾ªç¯ç¥ç»ç½‘ç»œï¼‰å°±æ˜¯å¤„ç†åºåˆ—æ•°æ®çš„å…¸å‹æ¨¡å‹ã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼š<ul><li>è¯­è¨€æ¨¡å‹å’Œæ–‡æœ¬ç”Ÿæˆï¼šè¾“å…¥æ˜¯ä¸€ä¸ªæ–‡æœ¬åºåˆ—ï¼Œè¾“å‡ºæ˜¯ä¸‹ä¸€ä¸ªå­—ç¬¦æˆ–å•è¯çš„é¢„æµ‹åºåˆ—ã€‚</li><li>æœºå™¨ç¿»è¯‘ï¼šè¾“å…¥æ˜¯æºè¯­è¨€çš„å¥å­åºåˆ—ï¼Œè¾“å‡ºæ˜¯ç›®æ ‡è¯­è¨€çš„å¥å­åºåˆ—ã€‚</li><li>è¯­éŸ³è¯†åˆ«ï¼šè¾“å…¥æ˜¯è¯­éŸ³ä¿¡å·çš„æ—¶é—´åºåˆ—ï¼Œè¾“å‡ºæ˜¯å¯¹åº”çš„æ–‡æœ¬åºåˆ—ã€‚</li></ul></li></ul><h2 id="3-rnn-computation"><a href="#3-RNN-computation" class="headerlink" title="3. RNN computation"></a>3. RNN computation</h2><p>è®ºæ–‡æ­£æ–‡ä¸­å¯¹è¯¥è¿‡ç¨‹çš„æè¿°æ–‡å­—è¾ƒå¤šï¼Œæˆ‘åå€’è§‰å¾—ç»“åˆæ•°å­¦å…¬å¼åæ›´å¥½ç†è§£ã€‚<br>è¿™é‡Œæè¿°å°±æ˜¯ RNN çš„å‰å‘ä¼ æ’­è¿‡ç¨‹ï¼Œ å¦‚æœä½ äº†è§£äº†åŸºç¡€ç¥ç»ç½‘ç»œçš„å‰å‘ä¼ æ’­è¿‡ç¨‹ï¼Œé‚£ä¹ˆRNNä¹Ÿéå¸¸å¥½ç†è§£ã€‚</p><p>ç®€å•ç†è§£å°±æ˜¯ ç›¸æ¯”åœ¨ç¥ç»ç½‘ç»œä¸€æ–‡ä¸­è®²è¿°çš„åŸºç¡€ å‰å‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œé€’å½’ç¥ç»ç½‘ç»œåœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ªéšè—å±‚åˆ°éšè—å±‚çš„æƒé‡çŸ©é˜µå‚ä¸è®¡ç®—ã€‚</p><p>è¿™3ä¸ªæƒé‡çŸ©é˜µåˆ†åˆ«å¯¹åº”æ–‡ä¸­W_hhï¼ˆéšè—å±‚åˆ°éšè—å±‚ï¼‰ã€W_xhï¼ˆè¾“å…¥å±‚åˆ°éšè—å±‚ï¼‰å’ŒW_hyï¼ˆéšè—å±‚åˆ°è¾“å‡ºå±‚ï¼‰,ä¸‹é¢ä»¥$â„_ğ‘¡=tanhâ¡(ğ‘Š_{â„â„}â„_{ğ‘¡âˆ’1}+ğ‘Š_{ğ‘¥â„}ğ‘¥_ğ‘¡)$ æ¥æ‹†è§£æ•´ä¸ªè¿‡ç¨‹</p><p>å‡è®¾ç½‘ç»œç»“æ„å’Œå‚æ•°å¦‚ä¸‹</p><ol><li><strong>è¾“å…¥å±‚</strong>ï¼š2ä¸ªèŠ‚ç‚¹ï¼Œè¡¨ç¤ºè¾“å…¥ç‰¹å¾ $x_1$ å’Œ $x_2$ã€‚</li><li><strong>éšè—å±‚</strong>ï¼š2ä¸ªèŠ‚ç‚¹ï¼Œè¡¨ç¤ºéšè—çŠ¶æ€ $h_1$ å’Œ $h_2$â€‹ï¼Œ,ä½¿ç”¨tanhæ¿€æ´»å‡½æ•°ã€‚</li><li><strong>è¾“å‡ºå±‚</strong>ï¼š1ä¸ªèŠ‚ç‚¹ï¼Œè¡¨ç¤ºè¾“å‡º $y$ï¼Œä½¿ç”¨çº¿æ€§æ¿€æ´»å‡½æ•°ã€‚</li></ol><h4 id="æƒé‡çŸ©é˜µ"><a href="#æƒé‡çŸ©é˜µ" class="headerlink" title="æƒé‡çŸ©é˜µ"></a>æƒé‡çŸ©é˜µ</h4><ol><li><p><strong>è¾“å…¥å±‚åˆ°éšè—å±‚çš„æƒé‡</strong>ï¼š $W_{xh} = \begin{bmatrix} W_{11} &amp; W_{12} \ W_{21} &amp; W_{22} \end{bmatrix}$</p><p>$W_{11}$ã€$W_{12}$â€‹ è¿æ¥ $x_1$â€‹ åˆ° $h_1$â€‹ å’Œ $h_2$â€‹ï¼Œ$W_{21}$ã€$W_{22}$â€‹ è¿æ¥ $x_2$â€‹ åˆ° $h_1$â€‹ å’Œ $h_2$ã€‚</p></li><li><p><strong>éšè—å±‚åˆ°éšè—å±‚çš„æƒé‡</strong>ï¼š$W_{hh} = \begin{bmatrix} U_{11} &amp; U_{12} \ U_{21} &amp; U_{22} \end{bmatrix}$</p><ul><li>$U_{11}$å’Œ $U_{12}$ è¿æ¥ $h_1(t-1)$åˆ° $h_1(t)$ å’Œ $h_2(t)$ã€‚</li><li>$U_{21}$ å’Œ $U_{22}$ è¿æ¥ $h_2(t-1)$ åˆ° $h_1(t)$ å’Œ $h_2(t)$ã€‚<br>[[#5. åºåˆ—æ•°æ®çš„å¤„ç†]]</li></ul></li><li><p><strong>éšè—å±‚åˆ°è¾“å‡ºå±‚çš„æƒé‡</strong>ï¼š $W_{hy} = \begin{bmatrix} W_{31} &amp; W_{32} \end{bmatrix}$</p><ul><li>$W_{31}$â€‹ å’Œ $W_{32}$åˆ†åˆ«è¿æ¥$h_1$ å’Œ$h_2$åˆ° $y$ã€‚</li></ul></li></ol><h3 id="å‰å‘ä¼ æ’­è¿‡ç¨‹"><a href="#å‰å‘ä¼ æ’­è¿‡ç¨‹" class="headerlink" title="å‰å‘ä¼ æ’­è¿‡ç¨‹"></a>å‰å‘ä¼ æ’­è¿‡ç¨‹</h3><p>å¯¹äºæ¯ä¸ªæ—¶é—´æ­¥ $t$ï¼Œå‰å‘ä¼ æ’­çš„è®¡ç®—æ­¥éª¤å¦‚ä¸‹ï¼š</p><h4 id="1-è¾“å…¥å±‚åˆ°éšè—å±‚"><a href="#1-è¾“å…¥å±‚åˆ°éšè—å±‚" class="headerlink" title="1. è¾“å…¥å±‚åˆ°éšè—å±‚"></a>1. <strong>è¾“å…¥å±‚åˆ°éšè—å±‚</strong></h4><p>è®¡ç®—å½“å‰æ—¶é—´æ­¥çš„éšè—çŠ¶æ€, å³æ­£æ–‡ä¸­çš„â€œéšè—çŠ¶æ€çš„æ›´æ–°â€<br>$â„_ğ‘¡=tanhâ¡(ğ‘Š_{â„â„}â„_{ğ‘¡âˆ’1}+ğ‘Š_{ğ‘¥â„}ğ‘¥_ğ‘¡)$<br>å…¶ä¸­ï¼Œ$\mathbf{x}_t$â€‹ æ˜¯å½“å‰æ—¶é—´æ­¥çš„è¾“å…¥å‘é‡ï¼Œ$\mathbf{h}_{t-1}$æ˜¯å‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ã€‚<br>å…·ä½“å±•å¼€å¦‚ä¸‹ï¼š</p><p>$\begin{bmatrix} h_{1t} \ h_{2t} \end{bmatrix} = \text{tanh} \left( \begin{bmatrix} W_{11} &amp; W_{12} \ W_{21} &amp; W_{22} \end{bmatrix} \begin{bmatrix} x_{1t} \ x_{2t} \end{bmatrix} + \begin{bmatrix} U_{11} &amp; U_{12} \ U_{21} &amp; U_{22} \end{bmatrix} \begin{bmatrix} h_{1(t-1)} \ h_{2(t-1)} \end{bmatrix} + \begin{bmatrix} b_1 \ b_2 \end{bmatrix} \right)$</p><p>åˆ†å¼€è®¡ç®—ï¼š<br>$h_{1t} = \text{tanh}(W_{11} x_{1t} + W_{12} x_{2t} + U_{11} h_{1(t-1)} + U_{12} h_{2(t-1)} )$</p><p>$h_{2t} = \text{tanh}(W_{21} x_{1t} + W_{22} x_{2t} + U_{21} h_{1(t-1)} + U_{22} h_{2(t-1)})$</p><h4 id="2-éšè—å±‚åˆ°è¾“å‡ºå±‚"><a href="#2-éšè—å±‚åˆ°è¾“å‡ºå±‚" class="headerlink" title="2.  éšè—å±‚åˆ°è¾“å‡ºå±‚"></a>2.  <strong>éšè—å±‚åˆ°è¾“å‡ºå±‚</strong></h4><p>è®¡ç®—å½“å‰æ—¶é—´æ­¥çš„è¾“å‡ºã€‚ $y_t = W_{hy} \mathbf{h}_t$<br>å…·ä½“å±•å¼€å¦‚ä¸‹ï¼š<br>$y_t = \begin{bmatrix} W_{31} &amp; W_{32} \end{bmatrix} \begin{bmatrix} h_{1t} \ h_{2t} \end{bmatrix}$</p><p>åˆ†å¼€è®¡ç®—ï¼š</p><p>$y_t = W_{31} h_{1t} + W_{32} h_{2t}$</p><p>âš ï¸ï¼š tanh æ˜¯éçº¿æ€§æ¿€æ´»å‡½æ•°</p><h2 id="4-1-of-kç¼–ç "><a href="#4-1-of-kç¼–ç " class="headerlink" title="4. 1-of-kç¼–ç "></a>4. 1-of-kç¼–ç </h2><p>1-of-kç¼–ç ï¼Œä¹Ÿç§°ä¸ºç‹¬çƒ­ç¼–ç ï¼ˆOne-Hot Encodingï¼‰ï¼Œæ˜¯ä¸€ç§å°†åˆ†ç±»æ•°æ®è½¬æ¢ä¸ºäºŒè¿›åˆ¶å‘é‡çš„æ–¹æ³•ã€‚å®ƒçš„ç›®çš„æ˜¯å°†éæ•°å€¼å‹çš„ç±»åˆ«å˜é‡è½¬åŒ–ä¸ºé€‚åˆäºæœºå™¨å­¦ä¹ ç®—æ³•å¤„ç†çš„æ•°å€¼å‹æ•°æ®ã€‚</p><h4 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h4><p>å‡è®¾æœ‰ä¸€ä¸ªç±»åˆ«å˜é‡ï¼Œå®ƒæœ‰ $k$ ä¸ªä¸åŒçš„ç±»åˆ«ã€‚1-of-kç¼–ç å°†æ¯ä¸ªç±»åˆ«è¡¨ç¤ºä¸ºä¸€ä¸ªé•¿åº¦ä¸º $k$ çš„äºŒè¿›åˆ¶å‘é‡ï¼Œå…¶ä¸­åªæœ‰ä¸€ä¸ªä½ç½®ä¸º1ï¼Œå…¶ä»–ä½ç½®ä¸º0ã€‚</p><p>ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªæœ‰å››ä¸ªç±»åˆ«çš„å˜é‡ï¼šâ€Aâ€, â€œBâ€, â€œCâ€, â€œDâ€ã€‚å…¶1-of-kç¼–ç å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th>ç±»åˆ«</th><th>1-of-kç¼–ç </th></tr></thead><tbody><tr><td>A</td><td>[1, 0, 0, 0]</td></tr><tr><td>B</td><td>[0, 1, 0, 0]</td></tr><tr><td>C</td><td>[0, 0, 1, 0]</td></tr><tr><td>D</td><td>[0, 0, 0, 1]</td></tr></tbody></table></div><h4 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><ul><li><strong>æ¶ˆé™¤æ’åºå…³ç³»</strong>ï¼šç‹¬çƒ­ç¼–ç å°†åˆ†ç±»å˜é‡è½¬åŒ–ä¸ºäºŒè¿›åˆ¶å‘é‡ï¼Œé¿å…äº†å¯¹åˆ†ç±»å˜é‡çš„è¯¯è§£ï¼Œå³è®¤ä¸ºå®ƒä»¬ä¹‹é—´å­˜åœ¨æ’åºå…³ç³»ã€‚</li><li><strong>é€‚åˆæ¨¡å‹å¤„ç†</strong>ï¼šè®¸å¤šæœºå™¨å­¦ä¹ ç®—æ³•ï¼ˆå¦‚çº¿æ€§å›å½’ã€é€»è¾‘å›å½’ç­‰ï¼‰æ— æ³•ç›´æ¥å¤„ç†éæ•°å€¼å‹æ•°æ®ï¼Œ1-of-kç¼–ç ä½¿è¿™äº›æ•°æ®é€‚åˆäºè¿™äº›ç®—æ³•ã€‚</li></ul><h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ul><li><strong>é«˜ç»´åº¦é—®é¢˜</strong>ï¼šå½“ç±»åˆ«æ•°é‡è¾ƒå¤šæ—¶ï¼Œç¼–ç åçš„å‘é‡é•¿åº¦ä¼šå˜å¾—å¾ˆé•¿ï¼Œå¯¼è‡´é«˜ç»´åº¦é—®é¢˜ï¼Œå¢åŠ è®¡ç®—å’Œå­˜å‚¨æˆæœ¬ã€‚</li></ul><h4 id="å®é™…åº”ç”¨"><a href="#å®é™…åº”ç”¨" class="headerlink" title="å®é™…åº”ç”¨"></a>å®é™…åº”ç”¨</h4><ul><li><strong>æ–‡æœ¬å¤„ç†</strong>ï¼šåœ¨è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä»»åŠ¡ä¸­ï¼Œ1-of-kç¼–ç å¸¸ç”¨äºå°†å•è¯è½¬åŒ–ä¸ºäºŒè¿›åˆ¶å‘é‡ã€‚</li><li><strong>åˆ†ç±»ä»»åŠ¡</strong>ï¼šåœ¨åˆ†ç±»ä»»åŠ¡ä¸­ï¼Œç”¨äºå°†ç±»åˆ«æ ‡ç­¾è½¬åŒ–ä¸ºæ¨¡å‹å¯ä»¥å¤„ç†çš„æ•°å€¼å‹æ•°æ®ã€‚</li></ul><p>1-of-kç¼–ç æ˜¯æ•°æ®é¢„å¤„ç†ä¸­çš„ä¸€ç§é‡è¦æŠ€æœ¯ï¼Œå¹¿æ³›åº”ç”¨äºå„ç§æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ ä»»åŠ¡ä¸­ã€‚å®ƒå¸®åŠ©å°†åˆ†ç±»æ•°æ®è½¬åŒ–ä¸ºæ•°å€¼æ•°æ®ï¼Œä½¿å¾—å„ç§æ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†è¿™äº›æ•°æ®ã€‚</p><h2 id="5-ç½®ä¿¡åº¦"><a href="#5-ç½®ä¿¡åº¦" class="headerlink" title="5. ç½®ä¿¡åº¦"></a>5. ç½®ä¿¡åº¦</h2><p>åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œç½®ä¿¡åº¦ï¼ˆconfidenceï¼‰æ˜¯è¡¡é‡æ¨¡å‹é¢„æµ‹ç»“æœç¡®å®šæ€§çš„ä¸€ä¸ªæŒ‡æ ‡ã€‚ç½®ä¿¡åº¦å¯ä»¥ç†è§£ä¸ºæ¨¡å‹å¯¹å…¶é¢„æµ‹çš„æŸä¸ªç»“æœæ˜¯æ­£ç¡®çš„ä¿¡å¿ƒç¨‹åº¦ã€‚</p><p>åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œç½®ä¿¡åº¦é€šå¸¸ä»¥æ¦‚ç‡å€¼çš„å½¢å¼è¡¨ç¤ºï¼Œåæ˜ äº†æ¨¡å‹å¯¹æŸä¸ªé¢„æµ‹çš„ç¡®å®šæ€§ã€‚ä¾‹å¦‚ï¼Œåœ¨åˆ†ç±»ä»»åŠ¡ä¸­ï¼Œæ¨¡å‹å¯¹æŸä¸ªæ ·æœ¬å±äºæŸä¸€ç±»çš„ç½®ä¿¡åº¦å¯èƒ½æ˜¯80%ï¼Œè¡¨ç¤ºæ¨¡å‹è®¤ä¸ºè¯¥æ ·æœ¬å±äºè¯¥ç±»çš„æ¦‚ç‡ä¸º80%ã€‚<br>å…·ä½“åº”ç”¨ï¼š</p><ul><li><strong>åˆ†ç±»ä»»åŠ¡</strong>ï¼šå¦‚å›¾åƒåˆ†ç±»ï¼Œæ¨¡å‹è¾“å‡ºæ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡åˆ†å¸ƒã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€å¼ å›¾ç‰‡ï¼Œæ¨¡å‹å¯èƒ½è¾“å‡ºï¼š[çŒ«: 0.7, ç‹—: 0.2, å…”å­: 0.1]ï¼Œå…¶ä¸­çŒ«çš„ç½®ä¿¡åº¦æœ€é«˜ã€‚</li><li><p><strong>ç½®ä¿¡åº¦é˜ˆå€¼</strong>ï¼šåœ¨æŸäº›åº”ç”¨ä¸­ï¼Œå¯èƒ½ä¼šè®¾ç½®ä¸€ä¸ªç½®ä¿¡åº¦é˜ˆå€¼ï¼Œåªæœ‰å½“é¢„æµ‹çš„ç½®ä¿¡åº¦è¶…è¿‡æŸä¸ªå€¼æ—¶ï¼Œæ‰è®¤ä¸ºé¢„æµ‹æœ‰æ•ˆã€‚</p><h4 id="ç½®ä¿¡åº¦çš„è®¡ç®—"><a href="#ç½®ä¿¡åº¦çš„è®¡ç®—" class="headerlink" title="ç½®ä¿¡åº¦çš„è®¡ç®—"></a>ç½®ä¿¡åº¦çš„è®¡ç®—</h4></li><li><p><strong>æ¦‚ç‡åˆ†å¸ƒ</strong>ï¼šä½¿ç”¨Softmaxå‡½æ•°å°†æ¨¡å‹è¾“å‡ºçš„logitsè½¬åŒ–ä¸ºæ¦‚ç‡åˆ†å¸ƒï¼Œè¿™äº›æ¦‚ç‡å€¼å³ä¸ºç½®ä¿¡åº¦ã€‚</p></li><li><strong>Softmaxå…¬å¼</strong>ï¼šå¯¹äºç¬¬ $i$ ä¸ªè¾“å‡ºèŠ‚ç‚¹ï¼Œç½®ä¿¡åº¦ $P(y_i)$ ä¸ºï¼š $P(y_i) = \frac{e^{z_i}}{\sum_{j} e^{z_j}}$ å…¶ä¸­ï¼Œ $z_i$ æ˜¯ç¬¬ $i$ ä¸ªèŠ‚ç‚¹çš„logitã€‚<h3 id="logits"><a href="#Logits" class="headerlink" title="Logits"></a>Logits</h3></li></ul><p>Logits æ˜¯ç¥ç»ç½‘ç»œåœ¨åˆ†ç±»ä»»åŠ¡ä¸­çš„è¾“å‡ºå±‚çš„åŸå§‹å¾—åˆ†ã€‚å®ƒä»¬æ˜¯æœªç»è¿‡å½’ä¸€åŒ–çš„æ•°å€¼ï¼Œç”¨äºè¡¨ç¤ºæ¯ä¸ªç±»åˆ«çš„ç›¸å¯¹ç½®ä¿¡åº¦ã€‚Logits æ˜¯é€šè¿‡å‰å‘ä¼ æ’­è®¡ç®—å¾—åˆ°çš„ï¼Œè¡¨ç¤ºæ¨¡å‹å¯¹æ¯ä¸ªå¯èƒ½çš„ç±»åˆ«çš„åˆå§‹ä¼°è®¡ã€‚</p><h4 id="å…·ä½“ç†è§£"><a href="#å…·ä½“ç†è§£" class="headerlink" title="å…·ä½“ç†è§£"></a>å…·ä½“ç†è§£</h4><ol><li><strong>åŸå§‹å¾—åˆ†</strong>ï¼šLogits æ˜¯ç¥ç»ç½‘ç»œæœ€åä¸€å±‚è¾“å‡ºçš„åŸå§‹åˆ†æ•°ï¼Œè¿™äº›åˆ†æ•°è¿˜æ²¡æœ‰è¢«è½¬æ¢ä¸ºæ¦‚ç‡ã€‚</li><li><strong>ç”¨é€”</strong>ï¼šåœ¨åˆ†ç±»ä»»åŠ¡ä¸­ï¼ŒLogits è¢«ç”¨æ¥è®¡ç®—æ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡ï¼Œè¿™é€šå¸¸é€šè¿‡ Softmax å‡½æ•°å®Œæˆã€‚</li><li><strong>Softmax è½¬æ¢</strong>ï¼šSoftmax å‡½æ•°å°† Logits è½¬æ¢ä¸ºæ¦‚ç‡åˆ†å¸ƒï¼Œä½¿å¾—è¿™äº›æ¦‚ç‡çš„å’Œä¸º1ã€‚å…¬å¼å¦‚ä¸Š</li></ol><h2 id="6-softmax"><a href="#6-Softmax" class="headerlink" title="6. Softmax"></a>6. Softmax</h2><p>[[0-ç¥ç»ç½‘ç»œï¼ˆNeural Networksï¼‰#^cfe178]]</p><h1 id="7-è¶…å‚æ•°-temperature-æ¸©åº¦"><a href="#7-è¶…å‚æ•°-Temperature-æ¸©åº¦" class="headerlink" title="7. è¶…å‚æ•° Temperature æ¸©åº¦"></a>7. è¶…å‚æ•° Temperature æ¸©åº¦</h1><p>Temperatureæ˜¯åœ¨æ¨¡å‹ä½¿ç”¨æˆ–è°ƒä¼˜è¿‡ç¨‹ä¸­è®¾å®šçš„å‚æ•°ï¼Œå¹¶ä¸é€šè¿‡æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­çš„ä¼˜åŒ–ç®—æ³•æ¥æ›´æ–°ï¼Œå› æ­¤å®ƒå±äºè¶…å‚æ•°ã€‚<br>Temperatureä½œä¸ºè¶…å‚æ•°ï¼Œåœ¨ç¥ç»ç½‘ç»œä¸­ç”¨æ¥æ§åˆ¶Softmaxè¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒå¹³æ»‘ç¨‹åº¦ï¼Œå®ƒçš„ä½œç”¨æ˜¯è°ƒèŠ‚æ¨¡å‹ç”Ÿæˆæ ·æœ¬çš„å¤šæ ·æ€§å’Œç¡®å®šæ€§ã€‚</p><h4 id="temperatureçš„å…¬å¼"><a href="#Temperatureçš„å…¬å¼" class="headerlink" title="Temperatureçš„å…¬å¼"></a>Temperatureçš„å…¬å¼</h4><p>Softmaxå‡½æ•°å¸¦æœ‰Temperatureçš„å…¬å¼å¦‚ä¸‹ï¼š</p><p>$P(y_i) = \frac{e^{z_i / T}}{\sum_{j} e^{z_j / T}}$</p><p>å…¶ä¸­ï¼Œ$z_i$ æ˜¯logitså€¼ï¼Œ$T$ æ˜¯Temperatureå‚æ•°ã€‚</p><h4 id="temperatureçš„å½±å“"><a href="#Temperatureçš„å½±å“" class="headerlink" title="Temperatureçš„å½±å“"></a>Temperatureçš„å½±å“</h4><ol><li><p><strong>é«˜Temperatureï¼ˆT &gt; 1ï¼‰</strong>ï¼š</p><ul><li><strong>å¹³æ»‘åˆ†å¸ƒ</strong>ï¼šä½¿æ¦‚ç‡åˆ†å¸ƒæ›´åŠ å¹³æ»‘ï¼Œå¢åŠ ç”Ÿæˆæ ·æœ¬çš„å¤šæ ·æ€§ã€‚</li><li><strong>å¢åŠ éšæœºæ€§</strong>ï¼šè¾“å‡ºç±»åˆ«ä¹‹é—´çš„æ¦‚ç‡å·®è·ç¼©å°ï¼Œä½¿å¾—é€‰æ‹©æ›´éšæœºã€‚</li></ul><p>ç¤ºä¾‹ï¼šå‡è®¾ logits ä¸º $[2.0,1.0,0.1]$ï¼Œä½¿ç”¨ $T = 2$ æ—¶ï¼Œæ¦‚ç‡å¯èƒ½å˜å¾—æ›´æ¥è¿‘ï¼Œå¦‚ $[0.4,0.35,0.25]$ã€‚</p></li><li><p><strong>ä½Temperatureï¼ˆ0 &lt; T &lt; 1ï¼‰</strong>ï¼š</p><ul><li><strong>å°–é”åˆ†å¸ƒ</strong>ï¼šä½¿æ¦‚ç‡åˆ†å¸ƒæ›´åŠ å°–é”ï¼Œå¢åŠ ç”Ÿæˆæ ·æœ¬çš„ç¡®å®šæ€§ã€‚</li><li><strong>å‡å°‘éšæœºæ€§</strong>ï¼šè¾“å‡ºç±»åˆ«ä¹‹é—´çš„æ¦‚ç‡å·®è·åŠ å¤§ï¼Œä½¿å¾—é€‰æ‹©æ›´ç¡®å®šã€‚</li></ul><p>ç¤ºä¾‹ï¼šå‡è®¾ logits ä¸º $[2.0,1.0,0.1]$ï¼Œä½¿ç”¨ $T = 0.5$ æ—¶ï¼Œæ¦‚ç‡å¯èƒ½å˜å¾—æ›´å°–é”ï¼Œå¦‚ $[0.7,0.25,0.05]$ã€‚</p></li><li><p><strong>Temperatureç­‰äº1</strong>ï¼š</p><ul><li><strong>æ ‡å‡†Softmax</strong>ï¼šæ¦‚ç‡åˆ†å¸ƒä¿æŒåŸæ ·ï¼Œä¸åšä»»ä½•è°ƒæ•´ã€‚</li></ul></li></ol><h4 id="ä½œç”¨åŠåº”ç”¨åœºæ™¯"><a href="#ä½œç”¨åŠåº”ç”¨åœºæ™¯" class="headerlink" title="ä½œç”¨åŠåº”ç”¨åœºæ™¯"></a>ä½œç”¨åŠåº”ç”¨åœºæ™¯</h4><ol><li><strong>æ–‡æœ¬ç”Ÿæˆ</strong>ï¼š<ul><li>æ§åˆ¶ç”Ÿæˆæ–‡æœ¬çš„å¤šæ ·æ€§å’Œåˆ›é€ æ€§ã€‚åœ¨æ–‡æœ¬ç”Ÿæˆä»»åŠ¡ä¸­ï¼Œé«˜Temperatureå¯èƒ½ç”Ÿæˆæ›´æœ‰åˆ›æ„ä½†ä¸ä¸€å®šåˆç†çš„å¥å­ï¼Œè€Œä½Temperatureå¯èƒ½ç”Ÿæˆæ›´åˆç†ä½†ç¼ºä¹å¤šæ ·æ€§çš„å¥å­ã€‚</li></ul></li><li><strong>æ¢ç´¢ä¸åˆ©ç”¨</strong>ï¼š<ul><li>åœ¨å¼ºåŒ–å­¦ä¹ ä¸­ï¼Œé«˜Temperatureç”¨äºæ¢ç´¢å¤šæ ·æ€§ç­–ç•¥ï¼Œä½Temperatureç”¨äºåˆ©ç”¨å·²çŸ¥çš„æœ€ä½³ç­–ç•¥ã€‚</li></ul></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://karpathy.github.io/2015/05/21/rnn-effectiveness/&quot;&gt;Andrej Karpathy blog:# The Unreasonable Effectiveness of Recurrent Neu</summary>
      
    
    
    
    
    <category term="AI" scheme="http://example.com/tags/AI/"/>
    
    <category term="ç¥ç»ç½‘ç»œ" scheme="http://example.com/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
    
    <category term="Ilya sutskeverâ€˜s 30  papers" scheme="http://example.com/tags/Ilya-sutskever%E2%80%98s-30-papers/"/>
    
  </entry>
  
  <entry>
    <title>é€’å½’ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural Networks, RNNsï¼‰</title>
    <link href="http://example.com/6ac941eb/"/>
    <id>http://example.com/6ac941eb/</id>
    <published>2024-06-07T14:03:29.000Z</published>
    <updated>2024-06-16T14:25:26.622Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰ç½®æ¦‚å¿µ"><a href="#å‰ç½®æ¦‚å¿µ" class="headerlink" title="å‰ç½®æ¦‚å¿µ"></a>å‰ç½®æ¦‚å¿µ</h1><h2 id="1-æ—¶é—´æ­¥time-stepå’Œåºåˆ—æ•°æ®sequential-data"><a href="#1-æ—¶é—´æ­¥ï¼ˆTime-Stepï¼‰å’Œåºåˆ—æ•°æ®ï¼ˆSequential-Dataï¼‰" class="headerlink" title="1. æ—¶é—´æ­¥ï¼ˆTime Stepï¼‰å’Œåºåˆ—æ•°æ®ï¼ˆSequential Dataï¼‰"></a>1. æ—¶é—´æ­¥ï¼ˆTime Stepï¼‰å’Œåºåˆ—æ•°æ®ï¼ˆSequential Dataï¼‰</h2><h3 id="11-åºåˆ—æ•°æ®sequential-data"><a href="#1-1-åºåˆ—æ•°æ®ï¼ˆSequential-Dataï¼‰" class="headerlink" title="1.1 åºåˆ—æ•°æ®ï¼ˆSequential Dataï¼‰"></a>1.1 åºåˆ—æ•°æ®ï¼ˆSequential Dataï¼‰</h3><p>åºåˆ—æ•°æ®ï¼ˆSequential Dataï¼‰æ˜¯æŒ‡æŒ‰ç…§æ—¶é—´æˆ–å…¶ä»–é¡ºåºæ’åˆ—çš„æ•°æ®ï¼Œå…¶ä¸­æ¯ä¸ªæ•°æ®ç‚¹çš„æ„ä¹‰å’Œä»·å€¼éƒ½ä¾èµ–äºå®ƒåœ¨åºåˆ—ä¸­çš„ä½ç½®å’Œå‰åæ•°æ®ç‚¹çš„å…³ç³»ã€‚åºåˆ—æ•°æ®å¹¿æ³›å­˜åœ¨äºè®¸å¤šå®é™…åº”ç”¨ä¸­ï¼Œå¦‚æ—¶é—´åºåˆ—ã€è‡ªç„¶è¯­è¨€å¤„ç†ã€è¯­éŸ³è¯†åˆ«ç­‰ã€‚</p><p><strong>åºåˆ—æ•°æ®çš„ç‰¹ç‚¹</strong></p><ol><li><strong>æ—¶é—´ä¾èµ–æ€§</strong>ï¼šåºåˆ—æ•°æ®ä¸­çš„æ¯ä¸ªæ•°æ®ç‚¹ä¸å…¶å‰åæ•°æ®ç‚¹å­˜åœ¨ä¾èµ–å…³ç³»ã€‚è¿™ç§ä¾èµ–æ€§å¯ä»¥æ˜¯çŸ­æœŸçš„ï¼ˆä»…ä¾èµ–äºæœ€è¿‘çš„æ•°æ®ç‚¹ï¼‰æˆ–é•¿æœŸçš„ï¼ˆä¾èµ–äºè¾ƒæ—©çš„æ•°æ®ç‚¹ï¼‰ã€‚</li><li><strong>é¡ºåºå…³ç³»</strong>ï¼šåºåˆ—æ•°æ®çš„é¡ºåºæ˜¯è‡³å…³é‡è¦çš„ï¼Œæ•°æ®ç‚¹çš„é¡ºåºå…³ç³»å†³å®šäº†å…¶å®é™…æ„ä¹‰ã€‚ä¾‹å¦‚ï¼Œåœ¨è¯­éŸ³ä¿¡å·ä¸­ï¼ŒéŸ³é¢‘å¸§çš„é¡ºåºå†³å®šäº†æœ€ç»ˆè¯­éŸ³çš„å†…å®¹ã€‚</li><li><strong>åŠ¨æ€æ€§</strong>ï¼šåºåˆ—æ•°æ®å¾€å¾€æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œæ•°æ®ç‚¹çš„å€¼éšæ—¶é—´æˆ–å…¶ä»–é¡ºåºå˜åŒ–è€Œå˜åŒ–ã€‚</li></ol><h3 id="12-æ—¶é—´æ­¥"><a href="#1-2-æ—¶é—´æ­¥" class="headerlink" title="1.2 æ—¶é—´æ­¥"></a>1.2 æ—¶é—´æ­¥</h3><p>æ—¶é—´æ­¥æŒ‡çš„æ˜¯åºåˆ—æ•°æ®ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ åœ¨æ—¶é—´ç»´åº¦ä¸Šçš„ä½ç½®ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæ—¶é—´åºåˆ—ä¸­ï¼Œæ¯ä¸ªæ—¶é—´ç‚¹ä¸Šçš„æ•°æ®ç§°ä¸ºä¸€ä¸ªæ—¶é—´æ­¥ã€‚åœ¨é€’å½’ç¥ç»ç½‘ç»œä¸­ï¼Œè¾“å…¥åºåˆ—æŒ‰æ—¶é—´æ­¥é€æ­¥å¤„ç†ï¼Œæ¯ä¸ªæ—¶é—´æ­¥çš„è¾“å…¥ä¸ä»…å½±å“å½“å‰æ—¶é—´æ­¥çš„è¾“å‡ºï¼Œè¿˜å½±å“åç»­æ—¶é—´æ­¥çš„è®¡ç®—ã€‚</p><h3 id="13-åºåˆ—æ•°æ®ä¸æ—¶é—´æ­¥çš„å®é™…ä¾‹å­"><a href="#1-3-åºåˆ—æ•°æ®ä¸æ—¶é—´æ­¥çš„å®é™…ä¾‹å­" class="headerlink" title="1.3  åºåˆ—æ•°æ®ä¸æ—¶é—´æ­¥çš„å®é™…ä¾‹å­"></a>1.3  åºåˆ—æ•°æ®ä¸æ—¶é—´æ­¥çš„å®é™…ä¾‹å­</h3><p>åºåˆ—æ•°æ®å¯ä»¥åˆ†ä¸ºå¤šç§ç±»å‹ï¼Œå…·ä½“åŒ…æ‹¬ï¼š</p><h4 id="1-æ—¶é—´åºåˆ—æ•°æ®"><a href="#1-æ—¶é—´åºåˆ—æ•°æ®" class="headerlink" title="1. æ—¶é—´åºåˆ—æ•°æ®"></a>1. æ—¶é—´åºåˆ—æ•°æ®</h4><p>æ—¶é—´åºåˆ—æ•°æ®æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºæ’åˆ—çš„æ•°æ®ï¼Œå¸¸ç”¨äºé‡‘èå¸‚åœºåˆ†æã€æ°”è±¡é¢„æŠ¥ç­‰é¢†åŸŸã€‚<br><strong>ç¤ºä¾‹</strong>ï¼šè‚¡ç¥¨ä»·æ ¼ã€æ¸©åº¦è®°å½•ç­‰ã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ—¶é—´ï¼š    t1   t2   t3   t4   t5</span><br><span class="line">è‚¡ç¥¨ä»·æ ¼ï¼š 100  102  101  103  104</span><br></pre></td></tr></table></figure></p><h4 id="2-è‡ªç„¶è¯­è¨€å¤„ç†æ•°æ®"><a href="#2-è‡ªç„¶è¯­è¨€å¤„ç†æ•°æ®" class="headerlink" title="2. è‡ªç„¶è¯­è¨€å¤„ç†æ•°æ®"></a>2. è‡ªç„¶è¯­è¨€å¤„ç†æ•°æ®</h4><p>è‡ªç„¶è¯­è¨€å¤„ç†ä¸­çš„æ•°æ®æ˜¯æŒ‰ç…§æ–‡æœ¬ä¸­çš„é¡ºåºæ’åˆ—çš„å•è¯æˆ–å­—ç¬¦ï¼Œå¸¸ç”¨äºæ–‡æœ¬åˆ†ç±»ã€æœºå™¨ç¿»è¯‘ç­‰ä»»åŠ¡ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼šä¸€æ®µæ–‡æœ¬ã€ä¸€å¥è¯ç­‰ã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ—¶é—´ï¼š t1   t2    t3    t4     t5</span><br><span class="line">å¥å­ï¼š æˆ‘   å–œæ¬¢   å­¦ä¹    æœºå™¨   å­¦ä¹ </span><br></pre></td></tr></table></figure></p><h4 id="3-è¯­éŸ³ä¿¡å·æ•°æ®"><a href="#3-è¯­éŸ³ä¿¡å·æ•°æ®" class="headerlink" title="3. è¯­éŸ³ä¿¡å·æ•°æ®"></a>3. è¯­éŸ³ä¿¡å·æ•°æ®</h4><p>è¯­éŸ³ä¿¡å·æ˜¯è¿ç»­çš„éŸ³é¢‘å¸§åºåˆ—ï¼Œæ¯ä¸ªéŸ³é¢‘å¸§è¡¨ç¤ºä¸€å°æ®µæ—¶é—´å†…çš„å£°éŸ³ç‰¹å¾ï¼Œå¸¸ç”¨äºè¯­éŸ³è¯†åˆ«ã€è¯­éŸ³åˆæˆç­‰ä»»åŠ¡ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼šä¸€æ®µè¯­éŸ³ä¿¡å·ã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ—¶é—´æ­¥ï¼š  t1    t2    t3    t4    t5</span><br><span class="line">éŸ³é¢‘å¸§ï¼š  F1    F2    F3    F4    F5</span><br></pre></td></tr></table></figure></p><h4 id="4-è§†é¢‘æ•°æ®"><a href="#4-è§†é¢‘æ•°æ®" class="headerlink" title="4. è§†é¢‘æ•°æ®"></a>4. è§†é¢‘æ•°æ®</h4><p>è§†é¢‘æ•°æ®æ˜¯ç”±ä¸€ç³»åˆ—æŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„å›¾åƒå¸§ç»„æˆï¼Œå¸¸ç”¨äºè§†é¢‘åˆ†ç±»ã€ç›®æ ‡æ£€æµ‹ç­‰ä»»åŠ¡ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼šä¸€æ®µè§†é¢‘ã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ—¶é—´æ­¥ï¼š  t1    t2    t3    t4    t5</span><br><span class="line">è§†é¢‘å¸§ï¼š  F1    F2    F3    F4    F5</span><br></pre></td></tr></table></figure></p><h3 id="14-åºåˆ—æ•°æ®çš„å®é™…åº”ç”¨åœºæ™¯"><a href="#1-4-åºåˆ—æ•°æ®çš„å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="1.4 åºåˆ—æ•°æ®çš„å®é™…åº”ç”¨åœºæ™¯"></a>1.4 åºåˆ—æ•°æ®çš„å®é™…åº”ç”¨åœºæ™¯</h3><ol><li><p>æ—¶é—´åºåˆ—é¢„æµ‹ï¼šé€šè¿‡åˆ†æå†å²æ•°æ®ï¼Œé¢„æµ‹æœªæ¥çš„å€¼ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼šè‚¡ç¥¨ä»·æ ¼é¢„æµ‹ã€å¤©æ°”é¢„æŠ¥ã€é”€å”®é‡é¢„æµ‹ç­‰ã€‚</p></li><li><p>è‡ªç„¶è¯­è¨€å¤„ç†ï¼šå¤„ç†å’Œç†è§£äººç±»è¯­è¨€ï¼Œæ‰§è¡Œå„ç§è¯­è¨€ç›¸å…³ä»»åŠ¡ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼šæ–‡æœ¬åˆ†ç±»ã€æƒ…æ„Ÿåˆ†æã€æœºå™¨ç¿»è¯‘ã€æ–‡æœ¬ç”Ÿæˆç­‰ã€‚</p></li><li><p>è¯­éŸ³è¯†åˆ«ï¼šå°†è¯­éŸ³ä¿¡å·è½¬æ¢ä¸ºæ–‡æœ¬ï¼Œæˆ–è€…è¯†åˆ«è¯­éŸ³ä¸­çš„æƒ…æ„Ÿã€è¯­ç§ç­‰ä¿¡æ¯ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼šè¯­éŸ³åˆ°æ–‡æœ¬è½¬æ¢ã€è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ã€è¯­éŸ³ç¿»è¯‘ç­‰ã€‚</p></li><li><p>è§†é¢‘å¤„ç†ï¼šå¤„ç†å’Œåˆ†æè§†é¢‘æ•°æ®ï¼Œæ‰§è¡Œå„ç§è§†é¢‘ç›¸å…³ä»»åŠ¡ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼šè§†é¢‘åˆ†ç±»ã€ç›®æ ‡æ£€æµ‹ã€è¡Œä¸ºè¯†åˆ«ç­‰</p></li></ol><h3 id="15-åºåˆ—æ•°æ®çš„å¤„ç†"><a href="#1-5-åºåˆ—æ•°æ®çš„å¤„ç†" class="headerlink" title="1.5 åºåˆ—æ•°æ®çš„å¤„ç†"></a>1.5 åºåˆ—æ•°æ®çš„å¤„ç†</h3><p>å¤„ç†åºåˆ—æ•°æ®æ—¶ï¼Œéœ€è¦è€ƒè™‘æ•°æ®çš„é¡ºåºå’Œæ—¶é—´ä¾èµ–æ€§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å¤„ç†æ–¹æ³•å’Œæ¨¡å‹ï¼š</p><h4 id="1-é€’å½’ç¥ç»ç½‘ç»œrecurrent-neural-networks-rnns"><a href="#1-é€’å½’ç¥ç»ç½‘ç»œï¼ˆRecurrent-Neural-Networks-RNNsï¼‰" class="headerlink" title="1. é€’å½’ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural Networks, RNNsï¼‰"></a>1. é€’å½’ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural Networks, RNNsï¼‰</h4><p>RNNsé€šè¿‡å¾ªç¯ç»“æ„èƒ½å¤Ÿè®°ä½å’Œåˆ©ç”¨åºåˆ—æ•°æ®ä¸­çš„æ—¶é—´ä¾èµ–æ€§ï¼Œé€‚ç”¨äºå¤„ç†å„ç§åºåˆ—æ•°æ®ã€‚</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>èƒ½å¤Ÿå¤„ç†å˜é•¿åºåˆ—æ•°æ®ã€‚</li><li>èƒ½å¤Ÿæ•æ‰çŸ­æœŸå’Œé•¿æœŸä¾èµ–å…³ç³»ã€‚</li></ul><h4 id="2-é•¿çŸ­æœŸè®°å¿†ç½‘ç»œlong-short-term-memory-lstm"><a href="#2-é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLong-Short-Term-Memory-LSTMï¼‰" class="headerlink" title="2. é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLong Short-Term Memory, LSTMï¼‰"></a>2. é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLong Short-Term Memory, LSTMï¼‰</h4><p>LSTMæ˜¯RNNçš„ä¸€ç§å˜ä½“ï¼Œä¸“é—¨ç”¨äºè§£å†³RNNä¸­çš„æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°æ•æ‰é•¿åºåˆ—ä¸­çš„ä¾èµ–å…³ç³»ã€‚</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>é€šè¿‡å¼•å…¥é—å¿˜é—¨ã€è¾“å…¥é—¨å’Œè¾“å‡ºé—¨æ§åˆ¶ä¿¡æ¯æµåŠ¨ã€‚</li><li>èƒ½å¤Ÿè®°ä½é•¿æ—¶é—´çš„ä¾èµ–å…³ç³»ã€‚</li></ul><h4 id="3-é—¨æ§å¾ªç¯å•å…ƒgated-recurrent-unit-gru"><a href="#3-é—¨æ§å¾ªç¯å•å…ƒï¼ˆGated-Recurrent-Unit-GRUï¼‰" class="headerlink" title="3. é—¨æ§å¾ªç¯å•å…ƒï¼ˆGated Recurrent Unit, GRUï¼‰"></a>3. é—¨æ§å¾ªç¯å•å…ƒï¼ˆGated Recurrent Unit, GRUï¼‰</h4><p>GRUæ˜¯LSTMçš„ç®€åŒ–ç‰ˆæœ¬ï¼Œå…·æœ‰ç±»ä¼¼çš„é—¨æ§æœºåˆ¶ï¼Œä½†å‚æ•°æ›´å°‘ï¼Œè®¡ç®—æ•ˆç‡æ›´é«˜ã€‚</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>é€šè¿‡æ›´æ–°é—¨å’Œé‡ç½®é—¨æ§åˆ¶ä¿¡æ¯æµåŠ¨ã€‚</li><li>è®¡ç®—æ•ˆç‡æ›´é«˜ï¼Œé€‚åˆå¤„ç†é•¿åºåˆ—æ•°æ®ã€‚</li></ul><h4 id="4-transformeræ¨¡å‹"><a href="#4-Transformeræ¨¡å‹" class="headerlink" title="4. Transformeræ¨¡å‹"></a>4. Transformeræ¨¡å‹</h4><p>Transformeræ¨¡å‹é€šè¿‡è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆSelf-Attentionï¼‰å¤„ç†åºåˆ—æ•°æ®ï¼Œèƒ½å¤Ÿå¹¶è¡Œå¤„ç†åºåˆ—ä¸­çš„æ¯ä¸ªä½ç½®ï¼Œè§£å†³äº†ä¼ ç»ŸRNNçš„è®¡ç®—ç“¶é¢ˆé—®é¢˜ã€‚</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>é€šè¿‡æ³¨æ„åŠ›æœºåˆ¶æ•æ‰åºåˆ—ä¸­ä»»æ„ä½ç½®ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</li><li>è®¡ç®—æ•ˆç‡é«˜ï¼Œé€‚åˆå¤„ç†é•¿åºåˆ—æ•°æ®ã€‚</li></ul><h1 id="2-ä»€ä¹ˆæ˜¯rnn"><a href="#2-ä»€ä¹ˆæ˜¯RNN" class="headerlink" title="2. ä»€ä¹ˆæ˜¯RNN"></a>2. ä»€ä¹ˆæ˜¯RNN</h1><p>é€’å½’ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural Networks, RNNsï¼‰æ˜¯ä¸€ç±»ä¸“é—¨ç”¨äºå¤„ç†åºåˆ—æ•°æ®çš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚RNNsé€šè¿‡å¾ªç¯ç»“æ„ä½¿å¾—ç½‘ç»œèƒ½å¤Ÿæ•æ‰å’Œè®°å¿†è¾“å…¥æ•°æ®ä¸­çš„æ—¶é—´ä¾èµ–æ€§ï¼Œé€‚ç”¨äºå„ç§åºåˆ—æ•°æ®å¤„ç†ä»»åŠ¡ï¼Œå¦‚æ—¶é—´åºåˆ—é¢„æµ‹ã€è‡ªç„¶è¯­è¨€å¤„ç†ã€è¯­éŸ³è¯†åˆ«ç­‰ã€‚</p><p>å¦‚æœä½ å·²ç»å¯¹<a href="obsidian://open?vault=Documents&amp;file=second-brain%2F0-projects%2Filya%2027%E4%BE%BF%E8%AE%BA%E6%96%87%E8%A7%A3%E8%AF%BB%2F0-%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%88Neural%20Networks%EF%BC%89">åŸºç¡€ç¥ç»ç½‘ç»œçš„å±‚æ¬¡ç»“æ„å’Œå‰å‘ä¼ æ’­è¿‡ç¨‹</a>äº†è§£äº†ï¼Œ é‚£ä¹ˆRNN ä¸å®ƒçš„åŒºåˆ«å°±æ˜¯å…¶éšè—å±‚å…·æœ‰å¾ªç¯è¿æ¥ï¼Œä½¿å¾—å½“å‰æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ä¸ä»…ä¾èµ–äºå½“å‰è¾“å…¥ï¼Œè¿˜ä¾èµ–äºå‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ã€‚</p><p>ä¸‹é¢åœ¨ åŸºç¡€ç¥ç»ç½‘ç»œä¸­çš„å±‚æ¬¡ç»“æ„çš„åŸºç¡€ä¸Šè¯´æ˜ RNN</p><h2 id="ç½‘ç»œç»“æ„å’Œå‚æ•°"><a href="#ç½‘ç»œç»“æ„å’Œå‚æ•°" class="headerlink" title="ç½‘ç»œç»“æ„å’Œå‚æ•°"></a>ç½‘ç»œç»“æ„å’Œå‚æ•°</h2><ol><li><strong>è¾“å…¥å±‚</strong>ï¼š2ä¸ªèŠ‚ç‚¹ï¼Œè¡¨ç¤ºè¾“å…¥ç‰¹å¾ $x_1$ å’Œ $x_2â€‹$ã€‚</li><li><strong>éšè—å±‚</strong>ï¼š2ä¸ªèŠ‚ç‚¹ï¼Œè¡¨ç¤ºéšè—çŠ¶æ€ $h_1$ å’Œ $h_2$â€‹ï¼Œåç½®å‘é‡åˆ†åˆ«ä¸º$b_1$ã€$b_2$,ä½¿ç”¨ReLUæ¿€æ´»å‡½æ•°ã€‚</li><li><strong>è¾“å‡ºå±‚</strong>ï¼š1ä¸ªèŠ‚ç‚¹ï¼Œè¡¨ç¤ºè¾“å‡º $y$ï¼Œåç½®å‘é‡åˆ†åˆ«ä¸º$b_3$,ä½¿ç”¨çº¿æ€§æ¿€æ´»å‡½æ•°ã€‚</li><li><p><strong>æƒé‡çŸ©é˜µ</strong></p><ol><li><strong>è¾“å…¥å±‚åˆ°éšè—å±‚çš„æƒé‡</strong>ï¼š $W_{xh} = \begin{bmatrix} W_{11} &amp; W_{12} \ W_{21} &amp; W_{22} \end{bmatrix}$</li></ol><p>$W_{11}â€‹$ã€$W_{12}$â€‹ è¿æ¥ $x_1$â€‹ åˆ° $h_1$â€‹ å’Œ $h_2$â€‹ï¼Œ$W_{21}â€‹$ã€$W_{22}$â€‹ è¿æ¥ $x_2$â€‹ åˆ° $h_1$â€‹ å’Œ $h_2â€‹$ã€‚</p><ol><li><p><strong>éšè—å±‚åˆ°éšè—å±‚çš„æƒé‡</strong>ï¼š$W_{hh} = \begin{bmatrix} U_{11} &amp; U_{12} \ U_{21} &amp; U_{22} \end{bmatrix}$</p><ul><li>$U_{11}â€‹$å’Œ $U_{12}â€‹$ è¿æ¥ $h_1(t-1)$åˆ° $h_1(t)$ å’Œ $h_2(t)$ã€‚</li><li>$U_{21}â€‹$ å’Œ $U_{22}$ è¿æ¥ $h_2(t-1)$ åˆ° $h_1(t)$ å’Œ $h_2(t)$ã€‚</li></ul></li><li><strong>éšè—å±‚åˆ°è¾“å‡ºå±‚çš„æƒé‡</strong>ï¼š $W_{hy} = \begin{bmatrix} W_{31} &amp; W_{32} \end{bmatrix}$<ul><li>$W_{31}$â€‹ å’Œ $W_{32}$åˆ†åˆ«è¿æ¥$h_1$ å’Œ$h_2â€‹$åˆ° $y$ã€‚</li></ul></li></ol></li><li><p>åç½®å‘é‡</p><ul><li><strong>éšè—å±‚çš„åç½®</strong>ï¼š$\mathbf{b}_h = \begin{bmatrix} b_1 \ b_2 \end{bmatrix}$</li><li><strong>è¾“å‡ºå±‚çš„åç½®</strong>ï¼š$b_3$<h2 id="å‰å‘ä¼ æ’­è¿‡ç¨‹"><a href="#å‰å‘ä¼ æ’­è¿‡ç¨‹" class="headerlink" title="å‰å‘ä¼ æ’­è¿‡ç¨‹"></a>å‰å‘ä¼ æ’­è¿‡ç¨‹</h2></li></ul></li></ol><p>å¯¹äºæ¯ä¸ªæ—¶é—´æ­¥ $t$ï¼Œå‰å‘ä¼ æ’­çš„è®¡ç®—æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><strong>è¾“å…¥å±‚åˆ°éšè—å±‚</strong>ï¼šè®¡ç®—å½“å‰æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ã€‚$\mathbf{h}_t = \text{ReLU}(W_{xh} \mathbf{x}_t + W_{hh} \mathbf{h}_{t-1} + \mathbf{b}_h)$ å…¶ä¸­ï¼Œ$\mathbf{x}_t$â€‹ æ˜¯å½“å‰æ—¶é—´æ­¥çš„è¾“å…¥å‘é‡ï¼Œ$\mathbf{h}_{t-1}â€‹$æ˜¯å‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ã€‚<br>å…·ä½“å±•å¼€å¦‚ä¸‹ï¼š</li></ol><p>$\begin{bmatrix} h_{1t} \ h_{2t} \end{bmatrix} = \text{ReLU} \left( \begin{bmatrix} W_{11} &amp; W_{12} \ W_{21} &amp; W_{22} \end{bmatrix} \begin{bmatrix} x_{1t} \ x_{2t} \end{bmatrix} + \begin{bmatrix} U_{11} &amp; U_{12} \ U_{21} &amp; U_{22} \end{bmatrix} \begin{bmatrix} h_{1(t-1)} \ h_{2(t-1)} \end{bmatrix} + \begin{bmatrix} b_1 \ b_2 \end{bmatrix} \right)$</p><p>åˆ†å¼€è®¡ç®—ï¼š</p><p>$h_{1t} = \text{ReLU}(W_{11} x_{1t} + W_{12} x_{2t} + U_{11} h_{1(t-1)} + U_{12} h_{2(t-1)} + b_1)$</p><p>$h_{2t} = \text{ReLU}(W_{21} x_{1t} + W_{22} x_{2t} + U_{21} h_{1(t-1)} + U_{22} h_{2(t-1)} + b_2)$</p><ol><li><strong>éšè—å±‚åˆ°è¾“å‡ºå±‚</strong>ï¼šè®¡ç®—å½“å‰æ—¶é—´æ­¥çš„è¾“å‡ºã€‚ $y_t = W_{hy} \mathbf{h}_t + b_3$<br>å…·ä½“å±•å¼€å¦‚ä¸‹ï¼š</li></ol><p>$y_t = \begin{bmatrix} W_{31} &amp; W_{32} \end{bmatrix} \begin{bmatrix} h_{1t} \ h_{2t} \end{bmatrix} + b_3$</p><p>åˆ†å¼€è®¡ç®—ï¼š</p><p>$y_t = W_{31} h_{1t} + W_{32} h_{2t} + b_3$</p><h3 id="dropoutåœ¨rnnä¸­çš„è¡¨ç°"><a href="#Dropoutåœ¨RNNä¸­çš„è¡¨ç°" class="headerlink" title="Dropoutåœ¨RNNä¸­çš„è¡¨ç°"></a>Dropoutåœ¨RNNä¸­çš„è¡¨ç°</h3><p>åœ¨ä¼ ç»Ÿçš„å‰é¦ˆç¥ç»ç½‘ç»œä¸­ï¼ŒDropoutè¢«è¯æ˜æ˜¯éå¸¸æœ‰æ•ˆçš„æ­£åˆ™åŒ–æ–¹æ³•ã€‚ç„¶è€Œï¼Œç›´æ¥å°†è¿™ç§æ–¹æ³•åº”ç”¨äºRNNæ—¶ï¼Œä¼šç ´åæ—¶é—´æ­¥ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¯¼è‡´æ¨¡å‹æ€§èƒ½ä¸‹é™ã€‚</p><p>åœ¨RNNä¸­ï¼ŒDropoutçš„æ•ˆæœç¡®å®æ²¡æœ‰åœ¨å‰é¦ˆç¥ç»ç½‘ç»œä¸­é‚£ä¹ˆæ˜æ˜¾ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p><ol><li><strong>æ—¶é—´æ­¥ä¹‹é—´çš„ä¾èµ–æ€§</strong>ï¼šRNNä¸­çš„éšè—å±‚å…·æœ‰æ—¶é—´æ­¥ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå³å½“å‰æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ä¾èµ–äºå‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ã€‚ä¼ ç»Ÿçš„Dropoutæ–¹æ³•åœ¨RNNä¸­ä¼šç ´åè¿™ç§æ—¶é—´æ­¥ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä»è€Œå½±å“æ¨¡å‹çš„å­¦ä¹ æ•ˆæœã€‚</li><li><strong>æ¢¯åº¦ä¼ æ’­çš„å½±å“</strong>ï¼šRNNé€šè¿‡åå‘ä¼ æ’­é€šè¿‡æ—¶é—´ï¼ˆBackpropagation Through Time, BPTTï¼‰æ¥æ›´æ–°æƒé‡ï¼ŒDropoutä¼šåœ¨æ—¶é—´æ­¥ä¹‹é—´å¼•å…¥ä¸ç¨³å®šæ€§ï¼Œå¯èƒ½å¯¼è‡´æ¢¯åº¦ä¼ æ’­è¿‡ç¨‹ä¸­çš„é—®é¢˜ï¼Œå¦‚æ¢¯åº¦æ¶ˆå¤±æˆ–æ¢¯åº¦çˆ†ç‚¸ã€‚</li></ol><h1 id="3-rnnä¸­çš„æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸"><a href="#3-RNNä¸­çš„æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸" class="headerlink" title="3. RNNä¸­çš„æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸"></a>3. RNNä¸­çš„æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸</h1><p>åœ¨è®­ç»ƒå¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰æ—¶ï¼Œå¸¸å¸¸ä¼šé‡åˆ°æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œè¿™ä¸¤è€…éƒ½æ˜¯ç”±RNNçš„åå‘ä¼ æ’­ç®—æ³•ï¼ˆBPTT, Backpropagation Through Timeï¼‰å¼•èµ·çš„ã€‚</p><h4 id="1-æ¢¯åº¦æ¶ˆå¤±vanishing-gradient"><a href="#1-æ¢¯åº¦æ¶ˆå¤±ï¼ˆVanishing-Gradientï¼‰" class="headerlink" title="1. æ¢¯åº¦æ¶ˆå¤±ï¼ˆVanishing Gradientï¼‰"></a>1. æ¢¯åº¦æ¶ˆå¤±ï¼ˆVanishing Gradientï¼‰</h4><p><strong>ç°è±¡</strong>ï¼š</p><ul><li>å½“æ¢¯åº¦åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­é€å±‚ä¼ é€’æ—¶ï¼Œå®ƒçš„æ•°å€¼ä¼šé€æ¸å˜å°ï¼Œæœ€ç»ˆè¶‹è¿‘äºé›¶ã€‚</li><li>è¿™å¯¼è‡´å‰é¢å±‚çš„æƒé‡æ›´æ–°å‡ ä¹åœæ­¢ï¼Œä½¿ç½‘ç»œéš¾ä»¥è®­ç»ƒã€‚</li></ul><p><strong>åŸå› </strong>ï¼š</p><ul><li>åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œæ¢¯åº¦æ˜¯é€šè¿‡é“¾å¼æ³•åˆ™é€å±‚ç›¸ä¹˜çš„ã€‚å¦‚æœæŸäº›å±‚çš„æ¢¯åº¦å°äº1ï¼ˆä¾‹å¦‚å°äº1çš„æ¿€æ´»å‡½æ•°å¯¼æ•°ï¼‰ï¼Œåˆ™ä¹˜ç§¯ä¼šå¿«é€Ÿç¼©å°ã€‚</li><li>å¸¸è§çš„æ¿€æ´»å‡½æ•°å¦‚tanhå’Œsigmoidåœ¨è¾“å…¥å€¼è¾ƒå¤§æˆ–è¾ƒå°æ—¶ï¼Œå…¶å¯¼æ•°æ¥è¿‘é›¶ï¼Œä»è€ŒåŠ å‰§äº†æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚</li></ul><h4 id="2-æ¢¯åº¦çˆ†ç‚¸exploding-gradient"><a href="#2-æ¢¯åº¦çˆ†ç‚¸ï¼ˆExploding-Gradientï¼‰" class="headerlink" title="2. æ¢¯åº¦çˆ†ç‚¸ï¼ˆExploding Gradientï¼‰"></a>2. æ¢¯åº¦çˆ†ç‚¸ï¼ˆExploding Gradientï¼‰</h4><p><strong>ç°è±¡</strong>ï¼š</p><ul><li>å½“æ¢¯åº¦åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­é€å±‚ä¼ é€’æ—¶ï¼Œå®ƒçš„æ•°å€¼ä¼šé€æ¸å˜å¤§ï¼Œæœ€ç»ˆå˜å¾—éå¸¸å¤§ã€‚</li><li>è¿™å¯¼è‡´å‰é¢å±‚çš„æƒé‡æ›´æ–°è¿‡å¤§ï¼Œä½¿ç½‘ç»œå‚æ•°å˜å¾—ä¸ç¨³å®šï¼Œç”šè‡³å¯¼è‡´æº¢å‡ºã€‚</li></ul><p><strong>åŸå› </strong>ï¼š</p><ul><li>åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæŸäº›å±‚çš„æ¢¯åº¦å¤§äº1ï¼ˆä¾‹å¦‚å¤§äº1çš„æ¿€æ´»å‡½æ•°å¯¼æ•°ï¼‰ï¼Œåˆ™ä¹˜ç§¯ä¼šå¿«é€Ÿå¢å¤§ã€‚</li><li>å¸¸è§çš„åŸå› åŒ…æ‹¬ä¸åˆç†çš„åˆå§‹åŒ–æƒé‡å’Œæœªå¤„ç†çš„æ•°å€¼ä¸ç¨³å®šé—®é¢˜ã€‚</li></ul><h3 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h3><ol><li><strong>æ¢¯åº¦è£å‰ªï¼ˆGradient Clippingï¼‰</strong>ï¼š<ul><li>å½“æ¢¯åº¦çš„èŒƒæ•°è¶…è¿‡æŸä¸ªé˜ˆå€¼æ—¶ï¼Œå°†å…¶ç¼©æ”¾åˆ°è¯¥é˜ˆå€¼ã€‚</li><li>è¿™å¯ä»¥æœ‰æ•ˆé˜²æ­¢æ¢¯åº¦çˆ†ç‚¸ã€‚</li></ul></li><li><strong>é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼‰å’Œé—¨æ§å¾ªç¯å•å…ƒï¼ˆGRUï¼‰</strong>ï¼š<ul><li>è¿™äº›æ˜¯ä¸“é—¨è®¾è®¡ç”¨äºç¼“è§£æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸é—®é¢˜çš„RNNå˜ç§ã€‚</li><li>é€šè¿‡å¼•å…¥é—¨æœºåˆ¶ï¼Œå®ƒä»¬èƒ½å¤Ÿæ›´å¥½åœ°ä¿æŒé•¿æ—¶é—´ä¾èµ–ã€‚</li></ul></li><li><strong>é€‚å½“çš„æƒé‡åˆå§‹åŒ–</strong>ï¼š<ul><li>ä½¿ç”¨å¦‚Xavieråˆå§‹åŒ–æˆ–Heåˆå§‹åŒ–æ¥è®¾ç½®åˆå§‹æƒé‡ï¼Œå¯ä»¥å‡å°‘æ¢¯åº¦æ¶ˆå¤±å’Œçˆ†ç‚¸çš„é£é™©ã€‚</li></ul></li><li><strong>ä½¿ç”¨ä¸åŒçš„æ¿€æ´»å‡½æ•°</strong>ï¼š<ul><li>ReLUç­‰æ¿€æ´»å‡½æ•°åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥ç¼“è§£æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚</li></ul></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰ç½®æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#å‰ç½®æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;å‰ç½®æ¦‚å¿µ&quot;&gt;&lt;/a&gt;å‰ç½®æ¦‚å¿µ&lt;/h1&gt;&lt;h2 id=&quot;1-æ—¶é—´æ­¥time-stepå’Œåºåˆ—æ•°æ®sequential-data&quot;&gt;&lt;a href=&quot;#1-æ—¶é—´æ­¥ï¼ˆTime-</summary>
      
    
    
    
    
    <category term="AI" scheme="http://example.com/tags/AI/"/>
    
    <category term="ç¥ç»ç½‘ç»œ" scheme="http://example.com/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
    
    <category term="Ilya sutskeverâ€˜s 30  papers" scheme="http://example.com/tags/Ilya-sutskever%E2%80%98s-30-papers/"/>
    
  </entry>
  
  <entry>
    <title>ç¥ç»ç½‘ç»œï¼ˆNeural Networksï¼‰</title>
    <link href="http://example.com/f27811be/"/>
    <id>http://example.com/f27811be/</id>
    <published>2024-06-07T09:16:16.000Z</published>
    <updated>2024-06-16T14:23:22.639Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0-ä»€ä¹ˆæ˜¯ç¥ç»ç½‘ç»œ-neural-networks"><a href="#0-ä»€ä¹ˆæ˜¯ç¥ç»ç½‘ç»œ-Neural-Networks" class="headerlink" title="0. ä»€ä¹ˆæ˜¯ç¥ç»ç½‘ç»œ (Neural Networks)"></a>0. ä»€ä¹ˆæ˜¯ç¥ç»ç½‘ç»œ (Neural Networks)</h1><p>ç¥ç»ç½‘ç»œæ˜¯å®ç°AI çš„ä¸€ç§æŠ€æœ¯æ‰‹æ®µï¼Œä¸€ç§å¹¿æ³›ç”¨äºæœºå™¨å­¦ä¹ ï¼ˆMachine Learningï¼‰å’Œæ·±åº¦å­¦ä¹ ï¼ˆDeep Learningï¼‰é¢†åŸŸçš„è®¡ç®—æ¨¡å‹/ç®—æ³•æ¶æ„ã€‚</p><p>å®ƒå—åˆ°äººç±»å¤§è„‘ç¥ç»å…ƒï¼ˆNeuronsï¼‰å’Œå®ƒä»¬çš„äº’åŠ¨æ–¹å¼çš„å¯å‘ï¼Œå®ƒç”±å¤šä¸ªå±‚ï¼ˆLayersï¼‰ç»„æˆï¼Œæ¯å±‚åŒ…å«å¤šä¸ªç¥ç»å…ƒï¼Œè¿™äº›ç¥ç»å…ƒé€šè¿‡æƒé‡ï¼ˆWeightsï¼‰è¿æ¥ä¼ é€’ä¿¡æ¯ã€‚</p><p>ç¥ç»ç½‘ç»œçš„è®­ç»ƒè¿‡ç¨‹åŸºäºæœºå™¨å­¦ä¹ çš„åŸºæœ¬å‰æï¼Œå³èƒ½å¤Ÿä»æ•°æ®ä¸­å­¦ä¹ ã€‚é€šè¿‡å‘ç½‘ç»œæä¾›å¤§é‡çš„æ•°æ®æ ·æœ¬ï¼ˆåŒ…æ‹¬è¾“å…¥å’ŒæœŸæœ›çš„è¾“å‡ºï¼‰ï¼Œç¥ç»ç½‘ç»œå¯ä»¥å­¦ä¹ åˆ°å¦‚ä½•æ˜ å°„è¾“å…¥åˆ°è¾“å‡ºï¼Œè¿™ç§èƒ½åŠ›æ˜¯é€šè¿‡è°ƒæ•´å†…éƒ¨ç»“æ„ï¼ˆå³æƒé‡ï¼‰æ¥å®ç°çš„ã€‚</p><p>è¿™ä¸€å­¦ä¹ è¿‡ç¨‹ä½¿ç”¨äº†æœºå™¨å­¦ä¹ ä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå¦‚æŸå¤±å‡½æ•°ï¼ˆLoss Functionsï¼‰ã€æ¢¯åº¦ä¸‹é™ï¼ˆGradient Descentï¼‰å’Œåå‘ä¼ æ’­ç®—æ³•ï¼ˆBackpropagation Algorithmsï¼‰ã€‚è¿™äº›éƒ½æ˜¯æœºå™¨å­¦ä¹ é¢†åŸŸçš„åŸºæœ¬å·¥å…·ï¼Œç”¨äºè®­ç»ƒæ¨¡å‹ä»¥æ”¹è¿›å…¶æ€§èƒ½ã€‚</p><h1 id="1-ç¥ç»ç½‘ç»œçš„å±‚æ¬¡ç»“æ„"><a href="#1-ç¥ç»ç½‘ç»œçš„å±‚æ¬¡ç»“æ„" class="headerlink" title="1. ç¥ç»ç½‘ç»œçš„å±‚æ¬¡ç»“æ„"></a>1. ç¥ç»ç½‘ç»œçš„å±‚æ¬¡ç»“æ„</h1><h2 id="11-èŠ‚ç‚¹nodesæˆ–ç¥ç»å…ƒneurons"><a href="#1-1-èŠ‚ç‚¹ï¼ˆNodesï¼‰æˆ–ç¥ç»å…ƒï¼ˆNeuronsï¼‰" class="headerlink" title="1.1  èŠ‚ç‚¹ï¼ˆNodesï¼‰æˆ–ç¥ç»å…ƒï¼ˆNeuronsï¼‰"></a>1.1  èŠ‚ç‚¹ï¼ˆNodesï¼‰æˆ–ç¥ç»å…ƒï¼ˆNeuronsï¼‰</h2><p>èŠ‚ç‚¹æ˜¯ç¥ç»ç½‘ç»œçš„åŸºæœ¬å•ä½ï¼Œä¹Ÿç§°ä¸ºç¥ç»å…ƒã€‚æ¯ä¸ªèŠ‚ç‚¹æ¥æ”¶è¾“å…¥ä¿¡å·ï¼Œè¿›è¡ŒåŠ æƒæ±‚å’Œå’Œéçº¿æ€§å˜æ¢ï¼Œç„¶åå°†ç»“æœä¼ é€’ç»™ä¸‹ä¸€å±‚çš„èŠ‚ç‚¹ã€‚èŠ‚ç‚¹çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p><ol><li><strong>æ¥æ”¶è¾“å…¥</strong>ï¼šä»å‰ä¸€å±‚çš„æ‰€æœ‰èŠ‚ç‚¹æ¥æ”¶è¾“å…¥ä¿¡å·ã€‚</li><li><strong>åŠ æƒæ±‚å’Œ</strong>ï¼šå¯¹æ¥æ”¶åˆ°çš„è¾“å…¥ä¿¡å·ä¹˜ä»¥ç›¸åº”çš„æƒé‡å¹¶æ±‚å’Œã€‚</li><li><strong>åº”ç”¨æ¿€æ´»å‡½æ•°</strong>ï¼šå¯¹åŠ æƒæ±‚å’Œçš„ç»“æœåº”ç”¨æ¿€æ´»å‡½æ•°ï¼Œç”ŸæˆèŠ‚ç‚¹çš„è¾“å‡ºã€‚</li><li><strong>ä¼ é€’è¾“å‡º</strong>ï¼šå°†è¾“å‡ºä¿¡å·ä¼ é€’ç»™ä¸‹ä¸€å±‚çš„èŠ‚ç‚¹ã€‚</li></ol><h2 id="12-å±‚layers"><a href="#1-2-å±‚ï¼ˆLayersï¼‰" class="headerlink" title="1.2  å±‚ï¼ˆLayersï¼‰"></a>1.2  å±‚ï¼ˆLayersï¼‰</h2><p>å±‚æ˜¯ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„ä¸€ä¸ªé›†åˆï¼Œåœ¨ç¥ç»ç½‘ç»œä¸­èµ·ç€åˆ†å±‚å¤„ç†è¾“å…¥æ•°æ®çš„ä½œç”¨ã€‚æ¯ä¸€å±‚ä¸­çš„èŠ‚ç‚¹æ‰§è¡Œç›¸åŒç±»å‹çš„è®¡ç®—ï¼Œä½†æ¯ä¸ªèŠ‚ç‚¹æœ‰å„è‡ªçš„æƒé‡å’Œåç½®ã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„ç¥ç»ç½‘ç»œç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><ul><li><strong>è¾“å…¥å±‚ï¼ˆInput Layerï¼‰</strong>ï¼šæ¥æ”¶å¤–éƒ¨è¾“å…¥æ•°æ®ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªè¾“å…¥ç‰¹å¾ã€‚</li><li><strong>éšè—å±‚ï¼ˆHidden Layersï¼‰</strong>ï¼šä½äºè¾“å…¥å±‚å’Œè¾“å‡ºå±‚ä¹‹é—´ï¼Œç”¨äºç‰¹å¾æå–å’Œæ•°æ®å˜æ¢ã€‚ä¸€ä¸ªç¥ç»ç½‘ç»œå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªéšè—å±‚ã€‚</li><li><strong>è¾“å‡ºå±‚ï¼ˆOutput Layerï¼‰</strong>ï¼šç”Ÿæˆæœ€ç»ˆçš„é¢„æµ‹ç»“æœï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªè¾“å‡ºã€‚</li></ul><h2 id="13-èŠ‚ç‚¹å’Œå±‚çš„å…³ç³»"><a href="#1-3-èŠ‚ç‚¹å’Œå±‚çš„å…³ç³»" class="headerlink" title="1.3  èŠ‚ç‚¹å’Œå±‚çš„å…³ç³»"></a>1.3  èŠ‚ç‚¹å’Œå±‚çš„å…³ç³»</h2><p>èŠ‚ç‚¹å’Œå±‚ä¹‹é—´çš„å…³ç³»å¯ä»¥æ¦‚æ‹¬å¦‚ä¸‹ï¼š</p><ol><li><strong>å±‚æ˜¯èŠ‚ç‚¹çš„é›†åˆ</strong>ï¼šæ¯ä¸€å±‚ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆï¼Œè¿™äº›èŠ‚ç‚¹åœ¨åŒä¸€å±‚å†…è¿›è¡Œç›¸åŒç±»å‹çš„è®¡ç®—ã€‚</li><li><strong>æ•°æ®ä¼ é€’å’Œå¤„ç†</strong>ï¼šæ•°æ®åœ¨ç¥ç»ç½‘ç»œä¸­é€å±‚ä¼ é€’ï¼Œæ¯ä¸€å±‚çš„èŠ‚ç‚¹æ¥æ”¶å‰ä¸€å±‚çš„è¾“å‡ºï¼Œè¿›è¡Œè®¡ç®—åå°†ç»“æœä¼ é€’ç»™ä¸‹ä¸€å±‚çš„èŠ‚ç‚¹ã€‚</li><li><strong>å±‚æ¬¡ç»“æ„</strong>ï¼šç¥ç»ç½‘ç»œçš„å±‚æ¬¡ç»“æ„å†³å®šäº†æ•°æ®å¤„ç†çš„é¡ºåºå’Œæ–¹å¼ã€‚è¾“å…¥æ•°æ®ç»è¿‡è¾“å…¥å±‚åï¼Œä¾æ¬¡é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªéšè—å±‚è¿›è¡Œå¤æ‚çš„ç‰¹å¾æå–ï¼Œæœ€ç»ˆé€šè¿‡è¾“å‡ºå±‚ç”Ÿæˆé¢„æµ‹ç»“æœã€‚</li></ol><h2 id="14-å±‚ä¸å±‚ä¹‹é—´çš„è¿æ¥"><a href="#1-4-å±‚ä¸å±‚ä¹‹é—´çš„è¿æ¥" class="headerlink" title="1.4 å±‚ä¸å±‚ä¹‹é—´çš„è¿æ¥"></a>1.4 å±‚ä¸å±‚ä¹‹é—´çš„è¿æ¥</h2><p>å±‚ä¸å±‚ä¹‹é—´çš„è¿æ¥ç”±æƒé‡çŸ©é˜µå†³å®šã€‚æ¯ä¸€å±‚çš„èŠ‚ç‚¹ä¸ä¸‹ä¸€å±‚çš„æ¯ä¸ªèŠ‚ç‚¹ç›¸è¿ï¼Œè¿æ¥çš„å¼ºåº¦ç”±æƒé‡å€¼å†³å®šã€‚åœ¨å‰å‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œè¾“å…¥å±‚çš„èŠ‚ç‚¹å°†è¾“å…¥æ•°æ®ä¼ é€’ç»™ç¬¬ä¸€ä¸ªéšè—å±‚çš„èŠ‚ç‚¹ï¼Œåè€…å†å°†å¤„ç†åçš„æ•°æ®ä¼ é€’ç»™ä¸‹ä¸€ä¸ªéšè—å±‚ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°è¾“å‡ºå±‚ã€‚</p><h1 id="2-æƒé‡"><a href="#2-æƒé‡" class="headerlink" title="2. æƒé‡"></a>2. æƒé‡</h1><p>æƒé‡æ˜¯è¿æ¥ç¥ç»ç½‘ç»œä¸­ä¸åŒå±‚èŠ‚ç‚¹çš„å‚æ•°ï¼Œç”¨äºè°ƒèŠ‚è¾“å…¥ä¿¡å·åœ¨ç½‘ç»œä¸­çš„ä¼ é€’å’Œå˜æ¢å¼ºåº¦ã€‚æ¯ä¸ªè¿æ¥éƒ½æœ‰ä¸€ä¸ªæƒé‡ï¼Œè¡¨ç¤ºè¾“å…¥ä¿¡å·å¯¹è¾“å‡ºä¿¡å·çš„å½±å“åŠ›ã€‚</p><ul><li><strong>è°ƒèŠ‚ä¿¡å·å¼ºåº¦</strong>ï¼šæƒé‡ä¹˜ä»¥è¾“å…¥ä¿¡å·åï¼Œå†é€šè¿‡æ±‚å’Œå’Œæ¿€æ´»å‡½æ•°çš„å˜æ¢ï¼Œå†³å®šäº†è¾“å‡ºä¿¡å·çš„å€¼ã€‚ä¸åŒçš„æƒé‡å€¼ä»£è¡¨è¾“å…¥ä¿¡å·çš„é‡è¦ç¨‹åº¦ã€‚</li><li><strong>ç‰¹å¾å­¦ä¹ </strong>ï¼šé€šè¿‡å­¦ä¹ å’Œè°ƒæ•´æƒé‡ï¼Œç¥ç»ç½‘ç»œèƒ½å¤Ÿè¯†åˆ«å’Œæå–è¾“å…¥æ•°æ®ä¸­çš„é‡è¦ç‰¹å¾ã€‚</li><li><strong>ä¼˜åŒ–</strong>ï¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæƒé‡è¢«è°ƒæ•´ä»¥æœ€å°åŒ–é¢„æµ‹è¯¯å·®ã€‚é€šè¿‡åå‘ä¼ æ’­ç®—æ³•ï¼Œæƒé‡çš„å€¼ä¸æ–­æ›´æ–°ï¼Œä½¿å¾—æ¨¡å‹çš„é¢„æµ‹æ›´åŠ å‡†ç¡®ã€‚</li></ul><h2 id="21-æƒé‡çš„å­˜åœ¨å½¢å¼"><a href="#2-1-æƒé‡çš„å­˜åœ¨å½¢å¼" class="headerlink" title="2.1 æƒé‡çš„å­˜åœ¨å½¢å¼"></a>2.1 æƒé‡çš„å­˜åœ¨å½¢å¼</h2><p>æƒé‡å¹¶ä¸å­˜åœ¨äºå•ç‹¬çš„èŠ‚ç‚¹å†…ï¼Œè€Œæ˜¯å­˜åœ¨äºèŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥ä¸Šã€‚å…·ä½“æ¥è¯´ï¼Œæ¯ä¸€å±‚çš„èŠ‚ç‚¹ä¸ä¸‹ä¸€å±‚çš„èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥ç”±ä¸€ç»„æƒé‡å‚æ•°è¡¨ç¤ºã€‚æƒé‡çŸ©é˜µè¡¨ç¤ºäº†ä¸¤ä¸ªå±‚ä¹‹é—´æ‰€æœ‰èŠ‚ç‚¹è¿æ¥çš„æƒé‡å€¼ã€‚</p><h2 id="22-æƒé‡çš„åˆå§‹åŒ–å’Œè°ƒæ•´"><a href="#2-2-æƒé‡çš„åˆå§‹åŒ–å’Œè°ƒæ•´" class="headerlink" title="2.2 æƒé‡çš„åˆå§‹åŒ–å’Œè°ƒæ•´"></a>2.2 æƒé‡çš„åˆå§‹åŒ–å’Œè°ƒæ•´</h2><p>æƒé‡çš„åˆå§‹åŒ–æ–¹æ³•æœ‰å¤šç§ï¼ŒåŒ…æ‹¬é›¶åˆå§‹åŒ–ã€éšæœºåˆå§‹åŒ–ã€Xavieråˆå§‹åŒ–å’ŒHeåˆå§‹åŒ–ç­‰ã€‚è¿™äº›æ–¹æ³•æ—¨åœ¨ä¸ºæ¨¡å‹æä¾›ä¸€ä¸ªè‰¯å¥½çš„èµ·ç‚¹ï¼Œä»¥ä¾¿æ›´å¥½åœ°è¿›è¡Œè®­ç»ƒã€‚</p><h2 id="23-æƒé‡çš„è®­ç»ƒè°ƒæ•´"><a href="#2-3-æƒé‡çš„è®­ç»ƒè°ƒæ•´" class="headerlink" title="2.3 æƒé‡çš„è®­ç»ƒè°ƒæ•´"></a>2.3 æƒé‡çš„è®­ç»ƒè°ƒæ•´</h2><p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæƒé‡é€šè¿‡ä¼˜åŒ–ç®—æ³•è¿›è¡Œè°ƒæ•´ã€‚æœ€å¸¸ç”¨çš„ä¼˜åŒ–ç®—æ³•æ˜¯æ¢¯åº¦ä¸‹é™ï¼ˆGradient Descentï¼‰åŠå…¶å˜ç§ï¼ˆå¦‚éšæœºæ¢¯åº¦ä¸‹é™ã€Adamä¼˜åŒ–ç®—æ³•ç­‰ï¼‰ã€‚è®­ç»ƒæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><strong>å‰å‘ä¼ æ’­</strong>ï¼šè®¡ç®—ç½‘ç»œçš„é¢„æµ‹è¾“å‡ºã€‚</li><li><strong>è®¡ç®—æŸå¤±</strong>ï¼šé€šè¿‡æŸå¤±å‡½æ•°è¡¡é‡é¢„æµ‹è¾“å‡ºä¸çœŸå®æ ‡ç­¾ä¹‹é—´çš„å·®è·ã€‚</li><li><strong>åå‘ä¼ æ’­</strong>ï¼šè®¡ç®—æŸå¤±å‡½æ•°å¯¹æ¯ä¸ªæƒé‡çš„æ¢¯åº¦ã€‚</li><li><strong>æ›´æ–°æƒé‡</strong>ï¼šä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•æ›´æ–°æƒé‡ï¼Œä»¥æœ€å°åŒ–æŸå¤±å‡½æ•°ã€‚</li></ol><h2 id="24-ä¼˜åŒ–ç®—æ³•"><a href="#2-4-ä¼˜åŒ–ç®—æ³•" class="headerlink" title="2.4 ä¼˜åŒ–ç®—æ³•"></a>2.4 ä¼˜åŒ–ç®—æ³•</h2><p>ä¸ºäº†æé«˜è®­ç»ƒæ•ˆç‡å’Œç¨³å®šæ€§ï¼Œå¯ä»¥ä½¿ç”¨å„ç§ä¼˜åŒ–ç®—æ³•ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><strong>åŠ¨é‡ï¼ˆMomentumï¼‰</strong>ï¼šç»“åˆå½“å‰æ¢¯åº¦å’Œä¹‹å‰æ›´æ–°çš„æ–¹å‘ï¼ŒåŠ é€Ÿæ”¶æ•›ã€‚</li><li><strong>AdaGrad</strong>ï¼šæ ¹æ®è¿‡å»çš„æ¢¯åº¦è°ƒæ•´å­¦ä¹ ç‡ï¼Œé€‚åº”æ€§åœ°è¿›è¡Œå‚æ•°æ›´æ–°ã€‚</li><li><strong>RMSProp</strong>ï¼šæ”¹è¿›AdaGradï¼Œä½¿ç”¨æŒ‡æ•°åŠ æƒå¹³å‡è®¡ç®—æ¢¯åº¦å¹³æ–¹å’Œï¼Œé¿å…å­¦ä¹ ç‡è¿‡å¿«å‡å°ã€‚</li><li><strong>Adam</strong>ï¼šç»“åˆåŠ¨é‡å’ŒRMSPropçš„ä¼˜ç‚¹ï¼Œé€‚åº”æ€§åœ°è°ƒæ•´å­¦ä¹ ç‡å’ŒåŠ¨é‡ï¼Œå¹¿æ³›åº”ç”¨äºå„ç§ç¥ç»ç½‘ç»œè®­ç»ƒã€‚</li></ul><h2 id="25-æƒé‡åœ¨ä¸åŒç±»å‹ç¥ç»ç½‘ç»œä¸­çš„è§’è‰²"><a href="#2-5-æƒé‡åœ¨ä¸åŒç±»å‹ç¥ç»ç½‘ç»œä¸­çš„è§’è‰²" class="headerlink" title="2.5 æƒé‡åœ¨ä¸åŒç±»å‹ç¥ç»ç½‘ç»œä¸­çš„è§’è‰²"></a>2.5 æƒé‡åœ¨ä¸åŒç±»å‹ç¥ç»ç½‘ç»œä¸­çš„è§’è‰²</h2><p>ä¸åŒç±»å‹çš„ç¥ç»ç½‘ç»œä¸­ï¼Œæƒé‡çš„å…·ä½“ä½œç”¨å¯èƒ½æœ‰æ‰€ä¸åŒï¼š</p><ul><li><strong>å‰é¦ˆç¥ç»ç½‘ç»œï¼ˆFeedforward Neural Networks, FNNsï¼‰</strong>ï¼šæƒé‡è¿æ¥æ¯ä¸€å±‚çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œè´Ÿè´£å°†è¾“å…¥æ•°æ®é€å±‚ä¼ é€’å’Œå˜æ¢ã€‚</li><li><strong>å·ç§¯ç¥ç»ç½‘ç»œï¼ˆConvolutional Neural Networks, CNNsï¼‰</strong>ï¼šæƒé‡æ˜¯å·ç§¯æ ¸çš„å‚æ•°ï¼Œè´Ÿè´£åœ¨å±€éƒ¨æ„ŸçŸ¥é‡ä¸Šæå–ç‰¹å¾ã€‚</li><li><strong>é€’å½’ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural Networks, RNNsï¼‰</strong>ï¼šæƒé‡ç”¨äºå¤„ç†åºåˆ—æ•°æ®ï¼ŒåŒ…æ‹¬å½“å‰æ—¶é—´æ­¥çš„è¾“å…¥ä¸å‰ä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ä¹‹é—´çš„å…³ç³»ã€‚</li></ul><h1 id="3-åç½®biases"><a href="#3-åç½®ï¼ˆBiasesï¼‰" class="headerlink" title="3. åç½®ï¼ˆBiasesï¼‰"></a>3. åç½®ï¼ˆBiasesï¼‰</h1><p>åç½®æ˜¯æ¯ä¸ªèŠ‚ç‚¹é™„åŠ çš„ä¸€ä¸ªå‚æ•°ï¼Œç”¨äºè°ƒæ•´èŠ‚ç‚¹çš„è¾“å‡ºç‹¬ç«‹äºè¾“å…¥ä¿¡å·ã€‚åç½®å¸®åŠ©ç¥ç»ç½‘ç»œå­¦åˆ°æ›´çµæ´»çš„å†³ç­–è¾¹ç•Œã€‚</p><p><strong>ä½œç”¨</strong></p><ul><li><strong>è°ƒèŠ‚è¾“å‡º</strong>ï¼šåç½®æä¾›ä¸€ä¸ªé¢å¤–çš„è‡ªç”±åº¦ï¼Œä½¿å¾—ç¥ç»ç½‘ç»œèƒ½å¤Ÿæ›´å¥½åœ°æ‹Ÿåˆæ•°æ®ã€‚</li><li><strong>é¿å…é›¶è¾“å‡º</strong>ï¼šåœ¨è¾“å…¥ä¿¡å·ä¸ºé›¶çš„æƒ…å†µä¸‹ï¼Œåç½®ç¡®ä¿èŠ‚ç‚¹ä»ç„¶èƒ½å¤Ÿäº§ç”Ÿéé›¶è¾“å‡ºã€‚</li></ul><h1 id="4-æ¿€æ´»å‡½æ•°activation-function"><a href="#4-æ¿€æ´»å‡½æ•°ï¼ˆActivation-Functionï¼‰" class="headerlink" title="4. æ¿€æ´»å‡½æ•°ï¼ˆActivation Functionï¼‰"></a>4. æ¿€æ´»å‡½æ•°ï¼ˆActivation Functionï¼‰</h1><p>æ¿€æ´»å‡½æ•°ï¼ˆActivation Functionï¼‰æ˜¯ç¥ç»ç½‘ç»œä¸­çš„ä¸€ä¸ªå…³é”®ç»„ä»¶ï¼Œå®ƒå¼•å…¥äº†éçº¿æ€§å˜æ¢ï¼Œä½¿å¾—ç¥ç»ç½‘ç»œèƒ½å¤Ÿå­¦ä¹ å’Œè¡¨ç¤ºå¤æ‚çš„éçº¿æ€§å…³ç³»ã€‚å¦‚æœæ²¡æœ‰æ¿€æ´»å‡½æ•°ï¼Œç¥ç»ç½‘ç»œçš„æ¯ä¸€å±‚åªè¿›è¡Œçº¿æ€§å˜æ¢ï¼Œé‚£ä¹ˆæ— è®ºå¤šå°‘å±‚çš„å †å ï¼Œæ•´ä½“ä»ç„¶æ˜¯ä¸€ä¸ªçº¿æ€§å˜æ¢ã€‚è¿™å°†æå¤§é™åˆ¶ç¥ç»ç½‘ç»œçš„è¡¨ç¤ºèƒ½åŠ›ã€‚å› æ­¤ï¼Œæ¿€æ´»å‡½æ•°å¯¹äºç¥ç»ç½‘ç»œçš„æ€§èƒ½å’Œèƒ½åŠ›è‡³å…³é‡è¦ã€‚</p><p>çº¿æ€§ï¼ˆLinearï¼‰å’Œéçº¿æ€§ï¼ˆNonlinearï¼‰æ˜¯æ•°å­¦å’Œä¿¡å·å¤„ç†ä¸­ä¸¤ä¸ªåŸºæœ¬çš„æ¦‚å¿µï¼Œè¿™äº›æ¦‚å¿µåœ¨ç¥ç»ç½‘ç»œå’Œæœºå™¨å­¦ä¹ ä¸­ä¹Ÿå…·æœ‰é‡è¦æ„ä¹‰ã€‚ç†è§£è¿™ä¸¤ä¸ªæ¦‚å¿µæœ‰åŠ©äºæŒæ¡ä¸ºä»€ä¹ˆæ¿€æ´»å‡½æ•°å¯¹ç¥ç»ç½‘ç»œçš„æ€§èƒ½å¦‚æ­¤é‡è¦ã€‚</p><h2 id="41-çº¿æ€§linearvs-éçº¿æ€§nonlinear"><a href="#4-1-çº¿æ€§ï¼ˆLinearï¼‰vs-éçº¿æ€§ï¼ˆNonlinearï¼‰" class="headerlink" title="4.1 çº¿æ€§ï¼ˆLinearï¼‰vs  éçº¿æ€§ï¼ˆNonlinearï¼‰"></a>4.1 çº¿æ€§ï¼ˆLinearï¼‰vs  éçº¿æ€§ï¼ˆNonlinearï¼‰</h2><h3 id="411-çº¿æ€§linear"><a href="#4-1-1-çº¿æ€§ï¼ˆLinearï¼‰" class="headerlink" title="4.1.1 çº¿æ€§ï¼ˆLinearï¼‰"></a>4.1.1 çº¿æ€§ï¼ˆLinearï¼‰</h3><p>çº¿æ€§å…³ç³»æ˜¯æŒ‡ä¸¤ä¸ªå˜é‡ä¹‹é—´çš„å…³ç³»å¯ä»¥ç”¨ä¸€ä¸ªçº¿æ€§æ–¹ç¨‹è¡¨ç¤ºã€‚å¯¹äºä¸€ä¸ªå˜é‡ $x$ å’Œå…¶å¯¹åº”çš„è¾“å‡º $y$ï¼Œçº¿æ€§å…³ç³»å¯ä»¥è¡¨ç¤ºä¸ºï¼š<br>$y = mx + b$<br>å…¶ä¸­ï¼Œ$m$ æ˜¯æ–œç‡ï¼Œ$b$ æ˜¯æˆªè·ã€‚è¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬ç»˜åˆ¶ $y$ å¯¹ $x$ çš„å›¾åƒï¼Œå®ƒå°†æ˜¯ä¸€æ¡ç›´çº¿ã€‚</p><p><strong>ç‰¹ç‚¹</strong></p><ul><li><strong>å åŠ æ€§</strong>ï¼šçº¿æ€§ç³»ç»Ÿæ»¡è¶³å åŠ åŸç†ï¼Œå³è¾“å…¥çš„çº¿æ€§ç»„åˆä¼šäº§ç”Ÿè¾“å‡ºçš„çº¿æ€§ç»„åˆã€‚å¦‚æœ $f(x_1) = y_1$â€‹ å’Œ$f(x_2) = y_2$ï¼Œé‚£ä¹ˆå¯¹äºä»»ä½•å¸¸æ•° $a$å’Œ $b$ï¼Œæœ‰ $f(ax_1 + bx_2) = ay_1 + by_2$â€‹ã€‚</li><li><strong>åŒè´¨æ€§</strong>ï¼šçº¿æ€§ç³»ç»Ÿæ»¡è¶³åŒè´¨æ€§ï¼Œå³è¾“å…¥çš„æ”¾å¤§ä¼šå¯¼è‡´è¾“å‡ºçš„ç›¸åº”æ”¾å¤§ã€‚å¦‚æœ $f(x) = y$ï¼Œé‚£ä¹ˆå¯¹äºä»»ä½•å¸¸æ•° $k$ï¼Œæœ‰ $f(kx) = ky$ã€‚</li></ul><p><strong>åœ¨ç¥ç»ç½‘ç»œä¸­çš„åº”ç”¨</strong><br>åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œçº¿æ€§å˜æ¢é€šå¸¸é€šè¿‡çŸ©é˜µä¹˜æ³•å’ŒåŠ æ³•å®ç°ï¼Œä¾‹å¦‚è¾“å…¥ä¸æƒé‡çŸ©é˜µçš„ä¹˜ç§¯åŠ ä¸Šåç½®ï¼š<br>$z = W \cdot x + b$</p><h3 id="412-éçº¿æ€§nonlinear"><a href="#4-1-2-éçº¿æ€§ï¼ˆNonlinearï¼‰" class="headerlink" title="4.1.2 éçº¿æ€§ï¼ˆNonlinearï¼‰"></a>4.1.2 éçº¿æ€§ï¼ˆNonlinearï¼‰</h3><p>éçº¿æ€§å…³ç³»æ˜¯æŒ‡ä¸¤ä¸ªå˜é‡ä¹‹é—´çš„å…³ç³»ä¸èƒ½ç”¨ä¸€ä¸ªç®€å•çš„çº¿æ€§æ–¹ç¨‹è¡¨ç¤ºã€‚éçº¿æ€§å…³ç³»çš„æ•°å­¦è¡¨ç¤ºå½¢å¼å¯ä»¥éå¸¸å¤šæ ·ï¼Œå¸¸è§çš„å½¢å¼åŒ…æ‹¬å¤šé¡¹å¼ã€æŒ‡æ•°å‡½æ•°ã€å¯¹æ•°å‡½æ•°ã€ä¸‰è§’å‡½æ•°ç­‰ã€‚<br>ä¾‹å¦‚ï¼Œå¯¹äºå˜é‡ $x$ å’Œ $y$ï¼Œéçº¿æ€§å…³ç³»å¯ä»¥è¡¨ç¤ºä¸ºï¼š<br>$y=ax^2+bx+c$<br>å…¶ä¸­ï¼Œ$a$ã€$b$ã€$c$ æ˜¯å¸¸æ•°ã€‚è¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬ç»˜åˆ¶ $y$ å¯¹ $x$ çš„å›¾åƒï¼Œå®ƒå°†ä¸æ˜¯ä¸€æ¡ç›´çº¿ï¼Œè€Œæ˜¯ä¸€ä¸ªæ›²çº¿ã€‚<br><strong>ç‰¹ç‚¹</strong></p><ul><li><strong>éå åŠ æ€§</strong>ï¼šéçº¿æ€§ç³»ç»Ÿä¸æ»¡è¶³å åŠ åŸç†ã€‚å¦‚æœ $f(x_1) = y_1â€‹$ å’Œ $f(x_2) = y_2â€‹$ï¼Œé‚£ä¹ˆ $f(ax_1 + bx_2) \neq ay_1 + by_2$â€‹ã€‚</li><li><strong>å¤æ‚æ€§</strong>ï¼šéçº¿æ€§ç³»ç»Ÿå¯ä»¥è¡¨ç¤ºå¤æ‚çš„å…³ç³»å’Œæ¨¡å¼ï¼Œèƒ½å¤Ÿæ•æ‰åˆ°æ•°æ®ä¸­çš„å¤æ‚ç»“æ„å’ŒåŠ¨æ€ã€‚</li></ul><p><strong>ä¸ºä»€ä¹ˆéœ€è¦éçº¿æ€§</strong><br>å¦‚æœç¥ç»ç½‘ç»œåªä½¿ç”¨çº¿æ€§æ¿€æ´»å‡½æ•°ï¼ˆä¾‹å¦‚ï¼Œæ’ç­‰å‡½æ•° f(z)=zï¼‰ï¼Œé‚£ä¹ˆæ— è®ºç½‘ç»œæœ‰å¤šå°‘å±‚ï¼Œå…¶æœ€ç»ˆè¾“å‡ºä»ç„¶æ˜¯è¾“å…¥çš„çº¿æ€§å˜æ¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•´ä¸ªç½‘ç»œç­‰æ•ˆäºä¸€ä¸ªå•å±‚çš„çº¿æ€§æ¨¡å‹ï¼Œæ— æ³•æ•æ‰æ•°æ®ä¸­çš„å¤æ‚å…³ç³»ã€‚å› æ­¤ï¼Œå¼•å…¥éçº¿æ€§æ¿€æ´»å‡½æ•°ä½¿å¾—ç½‘ç»œå…·æœ‰æ›´å¼ºçš„è¡¨è¾¾èƒ½åŠ›ï¼Œèƒ½å¤Ÿå­¦ä¹ å’Œè¡¨ç¤ºå¤æ‚çš„éçº¿æ€§å…³ç³»ï¼Œä»è€Œè§£å†³æ›´å¤æ‚çš„é—®é¢˜ã€‚</p><h2 id="42-å¸¸è§çš„éçº¿æ€§æ¿€æ´»å‡½æ•°"><a href="#4-2-å¸¸è§çš„éçº¿æ€§æ¿€æ´»å‡½æ•°" class="headerlink" title="4.2 å¸¸è§çš„éçº¿æ€§æ¿€æ´»å‡½æ•°"></a>4.2 å¸¸è§çš„éçº¿æ€§æ¿€æ´»å‡½æ•°</h2><h4 id="421-sigmoid-å‡½æ•°"><a href="#4-2-1-Sigmoid-å‡½æ•°" class="headerlink" title="4.2.1 Sigmoid å‡½æ•°"></a>4.2.1 Sigmoid å‡½æ•°</h4><p>$Ïƒ(z)=\frac{1}{1+e^{âˆ’z}} â€‹$</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>è¾“å‡ºå€¼åœ¨0åˆ°1ä¹‹é—´ï¼Œé€‚ç”¨äºæ¦‚ç‡é¢„æµ‹ã€‚</li><li>åœ¨æå€¼åŒºé—´æ¢¯åº¦è¾ƒå°ï¼Œå¯èƒ½å¯¼è‡´æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚</li><li>è®¡ç®—å¤æ‚åº¦è¾ƒé«˜ã€‚</li></ul><p><strong>åº”ç”¨</strong>ï¼š</p><ul><li>å¸¸ç”¨äºäºŒåˆ†ç±»é—®é¢˜çš„è¾“å‡ºå±‚ã€‚</li></ul><h4 id="422-tanhåŒæ›²æ­£åˆ‡å‡½æ•°"><a href="#4-2-2-Tanhï¼ˆåŒæ›²æ­£åˆ‡ï¼‰å‡½æ•°" class="headerlink" title="4.2.2 Tanhï¼ˆåŒæ›²æ­£åˆ‡ï¼‰å‡½æ•°"></a>4.2.2 Tanhï¼ˆåŒæ›²æ­£åˆ‡ï¼‰å‡½æ•°</h4><p>$tanh(z)=\frac{e^z-e^{-z}}{e^z+e^{-z}}$<br>â€‹<br><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>è¾“å‡ºå€¼åœ¨-1åˆ°1ä¹‹é—´ã€‚</li><li>ç›¸å¯¹äºSigmoidå‡½æ•°ï¼ŒTanhå‡½æ•°çš„è¾“å‡ºå‡å€¼ä¸º0ï¼Œä½¿å¾—æ•°æ®æ›´ä¸­å¿ƒåŒ–ã€‚</li><li>ä¹Ÿå­˜åœ¨æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œä½†åœ¨0é™„è¿‘çš„æ¢¯åº¦è¾ƒå¤§ï¼Œæ¢¯åº¦æ¶ˆå¤±é—®é¢˜ç¨å¥½äºSigmoidã€‚</li></ul><p><strong>åº”ç”¨</strong>ï¼š</p><ul><li>å¸¸ç”¨äºéšè—å±‚ã€‚<h3 id="423-relurectified-linear-unitå‡½æ•°"><a href="#4-2-3-ReLUï¼ˆRectified-Linear-Unitï¼‰å‡½æ•°" class="headerlink" title="4.2.3 ReLUï¼ˆRectified Linear Unitï¼‰å‡½æ•°"></a>4.2.3 ReLUï¼ˆRectified Linear Unitï¼‰å‡½æ•°</h3>$ReLU(z)=max(0,z)$</li></ul><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>è®¡ç®—ç®€å•ï¼Œæ”¶æ•›é€Ÿåº¦å¿«ã€‚</li><li>åœ¨æ­£åŒºé—´ä¿æŒçº¿æ€§å…³ç³»ï¼Œåœ¨è´ŸåŒºé—´è¾“å‡ºä¸º0ã€‚</li><li>è§£å†³äº†Sigmoidå’ŒTanhçš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚</li><li>å¯èƒ½å¯¼è‡´éƒ¨åˆ†ç¥ç»å…ƒâ€œæ­»äº¡â€ï¼Œå³åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æŸäº›ç¥ç»å…ƒçš„è¾“å‡ºå§‹ç»ˆä¸º0ï¼Œä¸å†æ›´æ–°ã€‚</li></ul><p><strong>åº”ç”¨</strong>ï¼š</p><ul><li>å¹¿æ³›ç”¨äºéšè—å±‚ã€‚<h4 id="424-leaky-relu-å‡½æ•°"><a href="#4-2-4-Leaky-ReLU-å‡½æ•°" class="headerlink" title="4.2.4 Leaky ReLU å‡½æ•°"></a>4.2.4 Leaky ReLU å‡½æ•°</h4>$Leaky  ReLU(z)=max(Î±z,z)$</li></ul><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>è§£å†³äº†ReLUçš„â€œæ­»äº¡ç¥ç»å…ƒâ€é—®é¢˜ã€‚</li><li>åœ¨è´ŸåŒºé—´ç»™å®šä¸€ä¸ªå¾ˆå°çš„æ–œç‡ï¼ˆé€šå¸¸ä¸º0.01ï¼‰ã€‚</li></ul><p><strong>åº”ç”¨</strong>ï¼š</p><ul><li>æ›¿ä»£ReLUï¼Œåœ¨éšè—å±‚ä¸­ä½¿ç”¨<h4 id="425-softmax-å‡½æ•°"><a href="#4-2-5-Softmax-å‡½æ•°" class="headerlink" title="4.2.5 Softmax å‡½æ•°"></a>4.2.5 Softmax å‡½æ•°</h4>$Softmax(z_iâ€‹)=\frac{e^z_i}{âˆ‘_jâ€‹â€‹e^z_j} â€‹$</li></ul><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>å°†è¾“å‡ºå€¼è½¬æ¢ä¸ºæ¦‚ç‡åˆ†å¸ƒï¼Œæ€»å’Œä¸º1ã€‚</li><li>é€‚ç”¨äºå¤šåˆ†ç±»é—®é¢˜ã€‚</li></ul><p><strong>åº”ç”¨</strong>ï¼š</p><ul><li>å¸¸ç”¨äºå¤šåˆ†ç±»é—®é¢˜çš„è¾“å‡ºå±‚ã€‚<h4 id="426-swish-å‡½æ•°"><a href="#4-2-6-Swish-å‡½æ•°" class="headerlink" title="4.2.6 Swish å‡½æ•°"></a>4.2.6 Swish å‡½æ•°</h4>$Swish(z)=zâ‹…Ïƒ(z)=\frac{z}{1+e^{âˆ’z}} â€‹â€‹$</li></ul><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>å¹³æ»‘çš„éçº¿æ€§å‡½æ•°ï¼Œæ€§èƒ½ä¼˜äºReLUå’ŒSigmoidã€‚</li><li>ç”±Googleæå‡ºï¼Œç»“åˆäº†ReLUå’ŒSigmoidçš„ç‰¹ç‚¹ã€‚</li></ul><p><strong>åº”ç”¨</strong>ï¼š</p><ul><li>æ–°å‹æ¿€æ´»å‡½æ•°ï¼Œåœ¨ä¸€äº›æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­è¡¨ç°å‡ºè‰²ã€‚</li></ul><h2 id="43-æ¿€æ´»å‡½æ•°çš„é€‰æ‹©"><a href="#4-3-æ¿€æ´»å‡½æ•°çš„é€‰æ‹©" class="headerlink" title="4.3 æ¿€æ´»å‡½æ•°çš„é€‰æ‹©"></a>4.3 æ¿€æ´»å‡½æ•°çš„é€‰æ‹©</h2><p>æ¿€æ´»å‡½æ•°çš„é€‰æ‹©å¯¹äºç¥ç»ç½‘ç»œçš„è®­ç»ƒå’Œæ€§èƒ½æœ‰é‡è¦å½±å“ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„é€‰æ‹©å‡†åˆ™ï¼š</p><ol><li><strong>éšè—å±‚</strong>ï¼šé€šå¸¸ä½¿ç”¨ReLUæˆ–å…¶å˜ç§ï¼ˆå¦‚Leaky ReLUã€Swishï¼‰ï¼Œå› ä¸ºå®ƒä»¬è®¡ç®—ç®€å•ä¸”èƒ½æœ‰æ•ˆç¼“è§£æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚</li><li><strong>è¾“å‡ºå±‚</strong>ï¼š<ul><li><strong>å›å½’é—®é¢˜</strong>ï¼šä½¿ç”¨çº¿æ€§æ¿€æ´»å‡½æ•°ã€‚</li><li><strong>äºŒåˆ†ç±»é—®é¢˜</strong>ï¼šä½¿ç”¨Sigmoidå‡½æ•°ã€‚</li><li><strong>å¤šåˆ†ç±»é—®é¢˜</strong>ï¼šä½¿ç”¨Softmaxå‡½æ•°</li></ul></li></ol><h1 id="5-è®­ç»ƒè¿‡ç¨‹"><a href="#5-è®­ç»ƒè¿‡ç¨‹" class="headerlink" title="5 è®­ç»ƒè¿‡ç¨‹"></a>5 è®­ç»ƒè¿‡ç¨‹</h1><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ç¥ç»ç½‘ç»œï¼ŒåŒ…å«ä¸€ä¸ªè¾“å…¥å±‚ã€ä¸€ä¸ªéšè—å±‚å’Œä¸€ä¸ªè¾“å‡ºå±‚ï¼š</p><ol><li>è¾“å…¥å±‚**ï¼š2ä¸ªèŠ‚ç‚¹ï¼Œè¡¨ç¤ºè¾“å…¥ç‰¹å¾ $x_1$ å’Œ $x_2â€‹$ã€‚</li><li><strong>éšè—å±‚</strong>ï¼š2ä¸ªèŠ‚ç‚¹ï¼Œè¡¨ç¤ºéšè—çŠ¶æ€ $h_1$ å’Œ $h_2$â€‹ï¼Œåç½®å‘é‡åˆ†åˆ«ä¸º$b_1$ã€$b_2$,ä½¿ç”¨ReLUæ¿€æ´»å‡½æ•°ã€‚</li><li><strong>è¾“å‡ºå±‚</strong>ï¼š1ä¸ªèŠ‚ç‚¹ï¼Œè¡¨ç¤ºè¾“å‡º $y$ï¼Œåç½®å‘é‡åˆ†åˆ«ä¸º$b_3$,ä½¿ç”¨çº¿æ€§æ¿€æ´»å‡½æ•°ã€‚</li></ol><p><strong>æƒé‡çŸ©é˜µ</strong></p><ol><li><p><strong>è¾“å…¥å±‚åˆ°éšè—å±‚çš„æƒé‡</strong>ï¼šå‡è®¾æƒé‡ä¸º $W^{(1)} = \begin{bmatrix} W_{11} &amp; W_{12} \ W_{21} &amp; W_{22} \end{bmatrix}$,å…¶ä¸­ $W_{11}â€‹$ã€$W_{12}$â€‹ è¿æ¥ $x_1$â€‹ åˆ° $h_1$â€‹ å’Œ $h_2$â€‹ï¼Œ$W_{21}â€‹$ã€$W_{22}$â€‹ è¿æ¥ $x_2$â€‹ åˆ° $h_1$â€‹ å’Œ $h_2â€‹$ã€‚</p></li><li><p><strong>éšè—å±‚åˆ°è¾“å‡ºå±‚çš„æƒé‡</strong>ï¼šå‡è®¾æƒé‡ä¸º $W^{(2)} = \begin{bmatrix} W_{31} &amp; W_{32} \end{bmatrix}$</p><ul><li>$W_{31}$â€‹ å’Œ $W_{32}$åˆ†åˆ«è¿æ¥$h_1$ å’Œ$h_2â€‹$åˆ° $y$ã€‚å…¶ä¸­ $W_{31}$ã€$W_{32}$åˆ†åˆ«è¿æ¥ $h_1$å’Œ $h_2$åˆ° $y$</li></ul></li></ol><p>å¦‚æœæŒ‡å®šå…·ä½“æ•°æ®ï¼Œå¯ä»¥è®¾ç½®ä¸º</p><ul><li>è¾“å…¥æ•°æ®ä¸º$\mathbf{X} = [0.5, 0.6]$</li><li><p>éšè—å±‚æƒé‡çŸ©é˜µ $\mathbf{W}^{(1)} = \begin{bmatrix} 0.1 &amp; 0.2 \ 0.3 &amp; 0.4 \end{bmatrix}$</p></li><li><p>éšè—å±‚åç½®å‘é‡ $\mathbf{b}^{(1)} = \begin{bmatrix} 0.1 \ 0.2 \end{bmatrix}$</p></li><li><p>è¾“å‡ºå±‚æƒé‡çŸ©é˜µ $\mathbf{W}^{(2)} = \begin{bmatrix} 0.5 &amp; 0.6 \end{bmatrix}$</p></li><li>è¾“å‡ºå±‚åç½®å‘é‡$\mathbf{b}^{(2)} = \begin{bmatrix} 0.3 \end{bmatrix}$</li></ul><p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡è°ƒæ•´æƒé‡å’Œåç½®ï¼Œä½¿å¾—æ¨¡å‹çš„é¢„æµ‹ç»“æœå°½å¯èƒ½å‡†ç¡®ã€‚ä»¥ä¸‹çš„ä¸»è¦æ­¥éª¤.</p><h2 id="51-å‰å‘ä¼ æ’­forward-propagation"><a href="#5-1-å‰å‘ä¼ æ’­ï¼ˆForward-Propagationï¼‰" class="headerlink" title="5.1 å‰å‘ä¼ æ’­ï¼ˆForward Propagationï¼‰"></a>5.1 å‰å‘ä¼ æ’­ï¼ˆForward Propagationï¼‰</h2><p>å‰å‘ä¼ æ’­æ˜¯æ•°æ®ä»è¾“å…¥å±‚ç»è¿‡éšè—å±‚ä¼ é€’åˆ°è¾“å‡ºå±‚çš„è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€å±‚çš„èŠ‚ç‚¹æ¥æ”¶å‰ä¸€å±‚çš„è¾“å‡ºï¼Œè¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œå¹¶é€šè¿‡æ¿€æ´»å‡½æ•°ç”Ÿæˆè¾“å‡ºã€‚<br>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li><strong>åŠ æƒæ±‚å’Œ</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹æ¥æ”¶å‰ä¸€å±‚æ‰€æœ‰èŠ‚ç‚¹çš„è¾“å‡ºï¼Œè®¡ç®—åŠ æƒå’Œã€‚ $z_i = \sum_{j} w_{ij} x_j + b_i$â€‹ å…¶ä¸­ï¼Œ$z_i$ æ˜¯ç¬¬ $i$ ä¸ªèŠ‚ç‚¹çš„åŠ æƒå’Œï¼Œ$w_{ij}$ æ˜¯ä»ç¬¬ $j$ ä¸ªè¾“å…¥åˆ°ç¬¬ $i$ ä¸ªèŠ‚ç‚¹çš„æƒé‡ï¼Œ$x_j$æ˜¯ç¬¬ $j$ ä¸ªè¾“å…¥ï¼Œ$b_i$â€‹ æ˜¯åç½®ã€‚</li><li><strong>æ¿€æ´»å‡½æ•°</strong>ï¼šå¯¹åŠ æƒå’Œåº”ç”¨æ¿€æ´»å‡½æ•°ï¼Œç”ŸæˆèŠ‚ç‚¹çš„è¾“å‡ºã€‚ $a_i = f(z_i)$å¸¸ç”¨çš„æ¿€æ´»å‡½æ•°åŒ…æ‹¬Sigmoidã€Tanhå’ŒReLUã€‚</li></ul><h3 id="511-è¾“å…¥å±‚"><a href="#5-1-1-è¾“å…¥å±‚" class="headerlink" title="5.1.1 è¾“å…¥å±‚"></a>5.1.1 è¾“å…¥å±‚</h3><p>è¾“å…¥å±‚æ¥æ”¶å¤–éƒ¨æ•°æ®ï¼Œå°†å…¶ä¼ é€’ç»™ç¬¬ä¸€ä¸ªéšè—å±‚ã€‚å‡è®¾è¾“å…¥æ•°æ®ä¸º $\mathbf{X} = [x_1, x_2]$</p><h3 id="512-éšè—å±‚"><a href="#5-1-2-éšè—å±‚" class="headerlink" title="5.1.2 éšè—å±‚"></a>5.1.2 éšè—å±‚</h3><ol><li><p>è®¡ç®—éšè—å±‚çš„è¾“å…¥åŠ æƒå’Œï¼š<br>$z_1^{(1)} = w_{11}x_1 + w_{12}x_2 + b_1$</p><p>$z_2^{(1)} = w_{21}x_1 + w_{22}x_2 + b_2$</p><p>ä»£å…¥å…·ä½“æ•°æ®ï¼š$z^{(1)} = \mathbf{W}^{(1)} \mathbf{X} + \mathbf{b}^{(1)} = \begin{bmatrix} 0.1 &amp; 0.2 \ 0.3 &amp; 0.4 \end{bmatrix} \begin{bmatrix} 0.5 \ 0.6 \end{bmatrix} + \begin{bmatrix} 0.1 \ 0.2 \end{bmatrix} = \begin{bmatrix} 0.1 \cdot 0.5 + 0.2 \cdot 0.6 + 0.1 \ 0.3 \cdot 0.5 + 0.4 \cdot 0.6 + 0.2 \end{bmatrix} = \begin{bmatrix} 0.27 \ 0.62 \end{bmatrix}$</p></li><li><p>åº”ç”¨æ¿€æ´»å‡½æ•°ï¼Œè®¡ç®—éšè—å±‚çš„è¾“å‡ºï¼š<br>$h_1 = \text{ReLU}(z_1^{(1)})$</p><p>$h_2 = \text{ReLU}(z_2^{(1)})$</p></li></ol><pre><code>$h^&#123;(1)&#125; = \text&#123;ReLU&#125;(z^&#123;(1)&#125;) = \begin&#123;bmatrix&#125; \max(0, 0.27) \\ \max(0, 0.62) \end&#123;bmatrix&#125; = \begin&#123;bmatrix&#125; 0.27 \\ 0.62 \end&#123;bmatrix&#125;$</code></pre><h3 id="513-è¾“å‡ºå±‚"><a href="#5-1-3-è¾“å‡ºå±‚" class="headerlink" title="5.1.3 è¾“å‡ºå±‚"></a>5.1.3 è¾“å‡ºå±‚</h3><ol><li>è®¡ç®—è¾“å‡ºå±‚çš„è¾“å…¥åŠ æƒå’Œï¼š<br>$z^{(2)} = w_{31}h_1 + w_{32}h_2 + b_3$<br>$z^{(2)} = \mathbf{W}^{(2)} a^{(1)} + \mathbf{b}^{(2)} = \begin{bmatrix} 0.5 &amp; 0.6 \end{bmatrix} \begin{bmatrix} 0.27 \ 0.62 \end{bmatrix} + \begin{bmatrix} 0.3 \end{bmatrix} = 0.5 \cdot 0.27 + 0.6 \cdot 0.62 + 0.3 = 0.735$</li><li>åº”ç”¨æ¿€æ´»å‡½æ•°ï¼Œè®¡ç®—æœ€ç»ˆè¾“å‡ºï¼š<br>$y = z^{(2)}$<br>å‡è®¾è¾“å‡ºå±‚ä½¿ç”¨çº¿æ€§æ¿€æ´»å‡½æ•°ï¼ˆå³ä¸åšéçº¿æ€§å˜æ¢ï¼‰<br>$y = z^{(2)} = 0.735$<h2 id="52-è®¡ç®—æŸå¤±loss-calculation"><a href="#5-2-è®¡ç®—æŸå¤±ï¼ˆLoss-Calculationï¼‰" class="headerlink" title="5.2 è®¡ç®—æŸå¤±ï¼ˆLoss Calculationï¼‰"></a>5.2 è®¡ç®—æŸå¤±ï¼ˆLoss Calculationï¼‰</h2></li></ol><p>ä½¿ç”¨æŸå¤±å‡½æ•°è®¡ç®—é¢„æµ‹è¾“å‡ºä¸çœŸå®æ ‡ç­¾ä¹‹é—´çš„å·®å¼‚ã€‚æŸå¤±å‡½æ•°æ˜¯ä¸€ä¸ªè¡¡é‡æ¨¡å‹é¢„æµ‹è¯¯å·®çš„æŒ‡æ ‡ï¼Œå¸¸è§çš„æŸå¤±å‡½æ•°åŒ…æ‹¬å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰å’Œäº¤å‰ç†µæŸå¤±ã€‚</p><ul><li><p><strong>å‡æ–¹è¯¯å·®ï¼ˆMSE, Mean Squared Errorï¼‰</strong>ï¼šç”¨äºå›å½’é—®é¢˜ã€‚ $\text{MSE} = \frac{1}{N} \sum_{i=1}^N (y_i - \hat{y}_i)^2$</p></li><li><p><strong>äº¤å‰ç†µæŸå¤±ï¼ˆCross-Entropy Lossï¼‰</strong>ï¼šç”¨äºåˆ†ç±»é—®é¢˜ã€‚ $\text{Cross-Entropy} = -\sum_{i=1}^N y_i \log(\hat{y}_i)$</p></li></ul><h2 id="53-åå‘ä¼ æ’­backpropagation"><a href="#5-3-åå‘ä¼ æ’­ï¼ˆBackpropagationï¼‰" class="headerlink" title="5.3 åå‘ä¼ æ’­ï¼ˆBackpropagationï¼‰"></a>5.3 åå‘ä¼ æ’­ï¼ˆBackpropagationï¼‰</h2><p>åå‘ä¼ æ’­ç®—æ³•é€šè¿‡è®¡ç®—æŸå¤±å‡½æ•°å¯¹æ¯ä¸ªæ¨¡å‹å‚æ•°ï¼ˆæƒé‡å’Œåç½®ï¼‰çš„åå¯¼æ•°/æ¢¯åº¦ï¼Œæ¥æŒ‡å¯¼å‚æ•°æ›´æ–°ï¼Œä½¿å¾—æŸå¤±å‡½æ•°é€æ­¥å‡å°ï¼Œä»è€Œæé«˜æ¨¡å‹çš„å‡†ç¡®æ€§ã€‚</p><ul><li><strong>è®¡ç®—æ¢¯åº¦</strong>ï¼šé¦–å…ˆè®¡ç®—è¾“å‡ºå±‚èŠ‚ç‚¹çš„æŸå¤±æ¢¯åº¦ï¼Œå³æŸå¤±å‡½æ•°å¯¹è¾“å‡ºå±‚æ¯ä¸ªèŠ‚ç‚¹è¾“å‡ºçš„åå¯¼æ•°ã€‚ç„¶åé€šè¿‡é“¾å¼æ³•åˆ™ï¼Œä¾æ¬¡è®¡ç®—æ¯ä¸ªéšè—å±‚èŠ‚ç‚¹çš„æ¢¯åº¦ã€‚æ¢¯åº¦ç”±åä¸€å±‚èŠ‚ç‚¹çš„æ¢¯åº¦å’Œå½“å‰å±‚èŠ‚ç‚¹çš„è¾“å‡ºå€¼å…±åŒå†³å®šã€‚</li><li><strong>ä¼ æ’­è¯¯å·®</strong>ï¼šè¯¯å·®ä»è¾“å‡ºå±‚é€å±‚ä¼ æ’­å›è¾“å…¥å±‚ï¼Œè®¡ç®—æ¯ä¸ªå‚æ•°çš„æ¢¯åº¦ã€‚</li></ul><p>âˆ‚ æ˜¯åå¯¼æ•°ç¬¦å·</p><h3 id="531-åå¯¼æ•°å’Œæ¢¯åº¦"><a href="#5-3-1-åå¯¼æ•°å’Œæ¢¯åº¦" class="headerlink" title="5.3.1 åå¯¼æ•°å’Œæ¢¯åº¦"></a>5.3.1 åå¯¼æ•°å’Œæ¢¯åº¦</h3><p>åå¯¼æ•°è¡¨ç¤ºåœ¨å›ºå®šå…¶ä»–å˜é‡çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå˜é‡çš„å˜åŒ–ç‡ã€‚å‡è®¾ $f(x, y)$ æ˜¯ä¸€ä¸ªå…³äº $x$ å’Œ $y$çš„å‡½æ•°ï¼Œåˆ™ $f$ å¯¹ $x$ çš„åå¯¼æ•°è®°ä½œ $\frac{\partial f}{\partial x}$ã€‚</p><p>åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œåå¯¼æ•°ç”¨äºè®¡ç®—æ¢¯åº¦ï¼Œå¸®åŠ©åå‘ä¼ æ’­ç®—æ³•æ›´æ–°æƒé‡ã€‚æ¢¯åº¦æ˜¯æŸå¤±å‡½æ•°å…³äºæ¯ä¸ªå‚æ•°çš„å¯¼æ•°ï¼Œè¡¨ç¤ºæŸå¤±å‡½æ•°å˜åŒ–ç‡ã€‚å¯¹äºä¸€ä¸ªæƒé‡ $w$ï¼Œæ¢¯åº¦ $\frac{\partial L}{\partial w}$ è¡¨ç¤ºæƒé‡å˜åŒ–å¯¹æŸå¤±å‡½æ•° $L$ çš„å½±å“ã€‚<br>å…·ä½“è€Œè¨€ï¼Œæ¢¯åº¦è¡¨ç¤ºæŸå¤±å‡½æ•°ç›¸å¯¹äºæ¯ä¸ªå‚æ•°çš„åå¯¼æ•°ï¼š</p><p>$\frac{\partial L}{\partial W} = \text{æ¢¯åº¦}$</p><p>é€šè¿‡è®¡ç®—æ¯ä¸ªå‚æ•°çš„åå¯¼æ•°ï¼Œåå‘ä¼ æ’­ç®—æ³•èƒ½é€æ­¥è°ƒæ•´ç½‘ç»œæƒé‡ï¼Œä½¿å¾—æŸå¤±å‡½æ•° $L$ æœ€å°åŒ–ï¼Œæé«˜æ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›ã€‚</p><h3 id="532-åå¯¼æ•°æ¨å¯¼è¿‡ç¨‹"><a href="#5-3-2-åå¯¼æ•°æ¨å¯¼è¿‡ç¨‹" class="headerlink" title="5.3.2 åå¯¼æ•°æ¨å¯¼è¿‡ç¨‹"></a>5.3.2 åå¯¼æ•°æ¨å¯¼è¿‡ç¨‹</h3><p>å¦‚æœ $f(x, y) = x^2 + y^2$ï¼Œåˆ™å¯¹ $x$ çš„åå¯¼æ•°ä¸ºï¼š</p><p>$\frac{\partial f}{\partial x} = \frac{\partial (x^2 + y^2)}{\partial x} = 2x$</p><p>æ ¹æ®æ±‚å¯¼æ³•åˆ™ï¼Œåˆ†å¼€å¯¹æ¯ä¸€é¡¹æ±‚å¯¼ï¼š<br>$\frac{\partial f}{\partial x} = \frac{\partial (x^2 + y^2)}{\partial x} =\frac{\partial}{\partial x} (x^2) + \frac{\partial}{\partial x} (y^2)$</p><p>å¯¹äº $x^2$ï¼Œä½¿ç”¨å¹‚å‡½æ•°æ±‚å¯¼æ³•åˆ™ $\frac{\partial}{\partial x} (x^n) = nx^{n-1}$ï¼š<br>$\frac{\partial}{\partial x} (x^2) = 2x^{2-1}= 2x$<br>å¯¹äº $y^2$ï¼Œå› ä¸º$y$ è¢«è§†ä¸ºå¸¸æ•°ï¼Œå¯¹ $x$ æ±‚å¯¼ç»“æœä¸º 0ï¼š<br>$\frac{\partial}{\partial x} (y^2) = 0$</p><p>åŒç†ï¼Œå¯¹ $y$ çš„åå¯¼æ•°ä¸ºï¼š</p><p>$\frac{\partial f}{\partial y} = \frac{\partial (x^2 + y^2)}{\partial y} = 2y$</p><p>ç°åœ¨æ ¹æ®ä»¥ä¸Šç†è§£é€å±‚åå‘è®¡ç®—æ¯ä¸ªå‚æ•°çš„æ¢¯åº¦</p><h3 id="533-è®¡ç®—è¾“å‡ºå±‚çš„æ¢¯åº¦"><a href="#5-3-3-è®¡ç®—è¾“å‡ºå±‚çš„æ¢¯åº¦" class="headerlink" title="5.3.3  è®¡ç®—è¾“å‡ºå±‚çš„æ¢¯åº¦"></a>5.3.3  è®¡ç®—è¾“å‡ºå±‚çš„æ¢¯åº¦</h3><p>å‡è®¾æˆ‘ä»¬ä½¿ç”¨å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰ä½œä¸ºæŸå¤±å‡½æ•°ï¼š<br>$L = \frac{1}{2} (y - t)^2$</p><p>å…¶ä¸­ï¼Œ$t$ æ˜¯ç›®æ ‡å€¼ã€‚</p><p>é¦–å…ˆï¼Œè®¡ç®—æŸå¤±ç›¸å¯¹äºè¾“å‡º $y$ çš„æ¢¯åº¦ï¼š</p><p>$\frac{\partial L}{\partial y} = y - t$</p><p>ç„¶åï¼Œè®¡ç®—æŸå¤±ç›¸å¯¹äºéšè—å±‚åˆ°è¾“å‡ºå±‚æƒé‡ $W_{31}$â€‹ å’Œ $W_{32}$çš„æ¢¯åº¦ï¼š</p><p>$\frac{\partial L}{\partial W_{31}} = \frac{\partial L}{\partial y} \cdot \frac{\partial y}{\partial W_{31}}=\frac{\partial L}{\partial y} \cdot \frac{\partial (w_{31}h_1 + w_{32}h_2 + b_3)}{\partial W_{31}} = (y - t) \cdot h_1$</p><p>ç”±äº $W_{31}$å’Œ $h_1$â€‹ ç›¸ä¹˜ï¼Œè€Œ $h_1$â€‹  ä¸ä¾èµ–äº $W_{31}$ï¼Œå…¶ä½™é¡¹åœ¨åå¯¼æ•°è®¡ç®—ä¸­éƒ½æ˜¯å¸¸æ•°ï¼Œå› æ­¤å¯ä»¥å¿½ç•¥ã€‚æ‰€ä»¥</p><p>åœ¨è¿™ä¸ªè¡¨è¾¾å¼ä¸­ï¼Œ$W_{31}$å’Œ $h_1$â€‹ ç›¸ä¹˜ï¼Œå…¶ä½™é¡¹ä¸ $W_{31}$æ— å…³ï¼Œå› æ­¤åœ¨å¯¹ $W_{31}â€‹$ æ±‚å¯¼æ—¶å¯ä»¥å¿½ç•¥ã€‚<br>$\frac{\partial L}{\partial W_{31}} = \frac{\partial L}{\partial y} \cdot \frac{\partial y}{\partial W_{31}}=\frac{\partial L}{\partial y} \cdot \frac{\partial (w_{31}h_1)}{\partial W_{31}}$</p><p>æ ¹æ®å¹‚å‡½æ•°æ±‚å¯¼æ³•åˆ™ $\frac{\partial}{\partial x} (x^n) = nx^{n-1}$<br>æ ¹æ®çº¿æ€§æ±‚å¯¼æ³•åˆ™ï¼Œå¸¸æ•°é¡¹å¯ä»¥ç›´æ¥æå–å‡ºæ¥  $\frac{\partial}{\partial x} (a\cdot x) = a$</p><p>$\frac{\partial L}{\partial W_{31}} = \frac{\partial L}{\partial y} \cdot \frac{\partial y}{\partial W_{31}}=\frac{\partial L}{\partial y} \cdot \frac{\partial (w_{31}h_1)}{\partial W_{31}} = \frac{\partial L}{\partial y} \cdot \frac{\partial (w_{31}h_1)}{\partial W_{31}}= (y-t) \cdot h_1$</p><p>åŒç†å¯å¾—ï¼š<br>$\frac{\partial L}{\partial W_{32}} = \frac{\partial L}{\partial y} \cdot \frac{\partial y}{\partial W_{32}} = (y - t) \cdot h_2$</p><p>è®¡ç®—æŸå¤±ç›¸å¯¹äºåç½® $b_3â€‹$ çš„æ¢¯åº¦ï¼š</p><p>$\frac{\partial L}{\partial b_3} = \frac{\partial L}{\partial y} \cdot \frac{\partial y}{\partial b_3} = (y - t) \cdot 1 = y - t$</p><h3 id="534-è®¡ç®—éšè—å±‚çš„æ¢¯åº¦"><a href="#5-3-4-è®¡ç®—éšè—å±‚çš„æ¢¯åº¦" class="headerlink" title="5.3.4 è®¡ç®—éšè—å±‚çš„æ¢¯åº¦"></a>5.3.4 è®¡ç®—éšè—å±‚çš„æ¢¯åº¦</h3><p>å¯¹äºéšè—å±‚çš„æ¢¯åº¦ï¼Œéœ€è¦è®¡ç®—æŸå¤±ç›¸å¯¹äºéšè—çŠ¶æ€ $h_1$â€‹ å’Œ $h_2$â€‹ çš„æ¢¯åº¦ï¼š</p><p>$\frac{\partial L}{\partial h_1} = \frac{\partial L}{\partial y} \cdot \frac{\partial y}{\partial h_1} = (y - t) \cdot W_{31}$</p><p>$\frac{\partial L}{\partial h_2} = \frac{\partial L}{\partial y} \cdot \frac{\partial y}{\partial h_2} = (y - t) \cdot W_{32}$</p><p>å…¶ä¸­ï¼Œ$y = w_{31}h_1 + w_{32}h_2 + b_3$</p><p>è®¡ç®—æ¨å¯¼è¿‡ç¨‹åŒä¸Šï¼Œå¯ä»¥å¾—åˆ°ä»¥ä¸Šç»“æœ</p><p>ç”±äºéšè—å±‚ä½¿ç”¨çš„æ˜¯ReLUæ¿€æ´»å‡½æ•°ï¼Œå…¶å¯¼æ•°ä¸ºï¼š</p><p>$\frac{\partial \text{ReLU}(z)}{\partial z} = \begin{cases} 1 &amp; \text{if } z &gt; 0 \ 0 &amp; \text{if } z \leq 0 \end{cases}$</p><p>å…¶ä¸­ $h_1 = \text{ReLU}(z_1^{(1)})$</p><p>å› æ­¤åº”ç”¨é“¾å¼æ³•åˆ™åï¼š</p><p>$\frac{\partial L}{\partial z_1} = \frac{\partial L}{\partial h_1} \cdot \frac{\partial h_1}{\partial z_1} = (y - t) \cdot W_{31} \cdot \begin{cases} 1 &amp; \text{if } z_1 &gt; 0 \ 0 &amp; \text{if } z_1 \leq 0 \end{cases}$</p><p>$\frac{\partial L}{\partial z_2} = \frac{\partial L}{\partial h_2} \cdot \frac{\partial h_2}{\partial z_2} = (y - t) \cdot W_{32} \cdot \begin{cases} 1 &amp; \text{if } z_2 &gt; 0 \ 0 &amp; \text{if } z_2 \leq 0 \end{cases}$</p><h3 id="535-è®¡ç®—è¾“å…¥å±‚çš„æ¢¯åº¦"><a href="#5-3-5-è®¡ç®—è¾“å…¥å±‚çš„æ¢¯åº¦" class="headerlink" title="5.3.5 è®¡ç®—è¾“å…¥å±‚çš„æ¢¯åº¦"></a>5.3.5 è®¡ç®—è¾“å…¥å±‚çš„æ¢¯åº¦</h3><p>æœ€åï¼Œè®¡ç®—æŸå¤±ç›¸å¯¹äºè¾“å…¥å±‚æƒé‡ $W_{11}, W_{12}, W_{21}, W_{22}$â€‹ çš„æ¢¯åº¦ï¼š</p><p>$\frac{\partial L}{\partial W_{11}} = \frac{\partial L}{\partial z_1} \cdot \frac{\partial z_1}{\partial W_{11}} = \frac{\partial L}{\partial z_1} \cdot x_1$</p><p>$\frac{\partial L}{\partial W_{12}} = \frac{\partial L}{\partial z_2} \cdot \frac{\partial z_2}{\partial W_{12}} = \frac{\partial L}{\partial z_2} \cdot x_1$</p><p>$\frac{\partial L}{\partial W_{21}} = \frac{\partial L}{\partial z_1} \cdot \frac{\partial z_1}{\partial W_{21}} = \frac{\partial L}{\partial z_1} \cdot x_2$</p><p>$\frac{\partial L}{\partial W_{22}} = \frac{\partial L}{\partial z_2} \cdot \frac{\partial z_2}{\partial W_{22}} = \frac{\partial L}{\partial z_2} \cdot x_2$â€‹</p><h2 id="54-æ›´æ–°æƒé‡weight-update"><a href="#5-4-æ›´æ–°æƒé‡ï¼ˆWeight-Updateï¼‰" class="headerlink" title="5.4 æ›´æ–°æƒé‡ï¼ˆWeight Updateï¼‰"></a>5.4 æ›´æ–°æƒé‡ï¼ˆWeight Updateï¼‰</h2><p>ä½¿ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•æ ¹æ®è®¡ç®—å¾—åˆ°çš„æ¢¯åº¦è°ƒæ•´æƒé‡ã€‚æ¢¯åº¦ä¸‹é™çš„åŸºæœ¬å…¬å¼ä¸ºï¼š<br>$W_{newâ€‹}=W_{old}â€‹âˆ’Î·â‹…\frac{\partial L}{\partial W}$</p><p>å…¶ä¸­ï¼Œ$\eta$ æ˜¯å­¦ä¹ ç‡ï¼ˆLearning Rateï¼‰ï¼Œ$\frac{\partial L}{\partial W}$â€‹ æ˜¯æŸå¤±å‡½æ•°å¯¹æƒé‡çš„æ¢¯åº¦ã€‚</p><p>å¸¸è§çš„æ¢¯åº¦ä¸‹é™å˜ç§</p><ul><li><strong>æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆBatch Gradient Descentï¼‰</strong>ï¼šåœ¨æ•´ä¸ªè®­ç»ƒæ•°æ®é›†ä¸Šè®¡ç®—æ¢¯åº¦ï¼Œç„¶åæ›´æ–°æƒé‡ã€‚é€‚ç”¨äºå°æ•°æ®é›†ï¼Œä½†è®¡ç®—é‡å¤§ï¼Œæ•ˆç‡è¾ƒä½ã€‚</li><li><strong>éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆStochastic Gradient Descent, SGDï¼‰</strong>ï¼šåœ¨æ¯ä¸ªè®­ç»ƒæ ·æœ¬ä¸Šè®¡ç®—æ¢¯åº¦ï¼Œç„¶åæ›´æ–°æƒé‡ã€‚è®¡ç®—æ•ˆç‡é«˜ï¼Œä½†æ¢¯åº¦å™ªå£°å¤§ï¼Œæ”¶æ•›ä¸ç¨³å®šã€‚</li><li><strong>å°æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆMini-Batch Gradient Descentï¼‰</strong>ï¼šåœ¨å°æ‰¹é‡è®­ç»ƒæ ·æœ¬ä¸Šè®¡ç®—æ¢¯åº¦ï¼Œç„¶åæ›´æ–°æƒé‡ã€‚ç»“åˆäº†æ‰¹é‡å’Œéšæœºæ¢¯åº¦ä¸‹é™çš„ä¼˜ç‚¹ï¼Œå¸¸ç”¨åœ¨å®é™…è®­ç»ƒä¸­ã€‚</li></ul><h1 id="7-è¶…å‚æ•°hyperparameters-vs-æ¨¡å‹å‚æ•°parameters"><a href="#7-è¶…å‚æ•°ï¼ˆHyperparametersï¼‰-vs-æ¨¡å‹å‚æ•°ï¼ˆParametersï¼‰" class="headerlink" title="7. è¶…å‚æ•°ï¼ˆHyperparametersï¼‰ vs  æ¨¡å‹å‚æ•°ï¼ˆParametersï¼‰"></a>7. è¶…å‚æ•°ï¼ˆHyperparametersï¼‰ vs  æ¨¡å‹å‚æ•°ï¼ˆParametersï¼‰</h1><h2 id="è¶…å‚æ•°hyperparameters"><a href="#è¶…å‚æ•°ï¼ˆHyperparametersï¼‰ï¼š" class="headerlink" title="è¶…å‚æ•°ï¼ˆHyperparametersï¼‰ï¼š"></a><strong>è¶…å‚æ•°ï¼ˆHyperparametersï¼‰</strong>ï¼š</h2><ul><li>å®šä¹‰ï¼šè¶…å‚æ•°æ˜¯æŒ‡åœ¨æ¨¡å‹è®­ç»ƒä¹‹å‰éœ€è¦æ‰‹åŠ¨è®¾ç½®çš„å‚æ•°ï¼Œä¸é€šè¿‡è®­ç»ƒæ•°æ®å­¦ä¹ å¾—åˆ°ï¼Œè€Œæ˜¯é€šè¿‡è¯•éªŒã€ç»éªŒæˆ–è‡ªåŠ¨è°ƒä¼˜æ–¹æ³•è®¾å®šã€‚</li><li>ä½œç”¨ï¼šæ§åˆ¶æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ã€æ¨¡å‹å¤æ‚åº¦ã€æ­£åˆ™åŒ–ç¨‹åº¦ç­‰ã€‚</li><li>ç¤ºä¾‹ï¼šå­¦ä¹ ç‡ï¼ˆlearning rateï¼‰ã€æ‰¹å¤§å°ï¼ˆbatch sizeï¼‰ã€éšè—å±‚çš„æ•°é‡å’Œå¤§å°ã€æ­£åˆ™åŒ–ç³»æ•°ï¼ˆå¦‚L2æ­£åˆ™åŒ–ä¸­çš„Î»ï¼‰ã€è®­ç»ƒè½®æ•°ï¼ˆepochsï¼‰ç­‰ã€‚</li><li>è°ƒæ•´æ–¹æ³•ï¼šæ‰‹åŠ¨è°ƒè¯•ï¼ˆManual Tuningï¼‰ã€ç½‘æ ¼æœç´¢ï¼ˆGrid Searchï¼‰ã€éšæœºæœç´¢ï¼ˆRandom Searchï¼‰ã€è´å¶æ–¯ä¼˜åŒ–ï¼ˆBayesian Optimizationï¼‰ç­‰ã€‚</li><li>è°ƒæ•´é¢‘ç‡ï¼šé€šå¸¸åœ¨è®­ç»ƒä¹‹å‰è®¾å®šï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¸å˜ã€‚å¯èƒ½éœ€è¦å¤šæ¬¡è¯•éªŒå’Œè°ƒä¼˜è¿‡ç¨‹æ‰èƒ½ç¡®å®šæœ€ä½³è¶…å‚æ•°ã€‚</li></ul><h2 id="æ¨¡å‹å‚æ•°model-parameters"><a href="#æ¨¡å‹å‚æ•°ï¼ˆModel-Parametersï¼‰ï¼š" class="headerlink" title="æ¨¡å‹å‚æ•°ï¼ˆModel Parametersï¼‰ï¼š"></a><strong>æ¨¡å‹å‚æ•°ï¼ˆModel Parametersï¼‰</strong>ï¼š</h2><ul><li>å®šä¹‰ï¼šæ¨¡å‹å‚æ•°æ˜¯æŒ‡åœ¨æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­é€šè¿‡æ•°æ®å­¦ä¹ å¾—åˆ°çš„å‚æ•°ï¼Œè¿™äº›å‚æ•°å®šä¹‰äº†æ¨¡å‹çš„æœ€ç»ˆå½¢æ€å’Œè¡Œä¸ºã€‚</li><li>ä½œç”¨ï¼šç›´æ¥å½±å“æ¨¡å‹çš„é¢„æµ‹è¾“å‡ºï¼Œåæ˜ äº†æ¨¡å‹ä»æ•°æ®ä¸­å­¦åˆ°çš„çŸ¥è¯†ã€‚</li><li>ç¤ºä¾‹ï¼šç¥ç»ç½‘ç»œä¸­çš„æƒé‡å’Œåç½®ã€çº¿æ€§å›å½’ä¸­çš„å›å½’ç³»æ•°ã€æ”¯æŒå‘é‡æœºä¸­çš„æ”¯æŒå‘é‡ç­‰ã€‚</li><li>è°ƒæ•´æ–¹æ³•ï¼šé€šè¿‡è®­ç»ƒæ•°æ®å’Œä¼˜åŒ–ç®—æ³•ï¼ˆå¦‚æ¢¯åº¦ä¸‹é™ï¼‰è‡ªåŠ¨è°ƒæ•´ã€‚</li><li>è°ƒæ•´é¢‘ç‡ï¼šåœ¨æ¯ä¸ªè®­ç»ƒè¿­ä»£ä¸­éƒ½è¦æ›´æ–°ï¼Œç›´åˆ°æ¨¡å‹æ”¶æ•›æˆ–è¾¾åˆ°é¢„è®¾çš„è®­ç»ƒè½®æ•°ã€‚</li></ul><h2 id="ç¥ç»ç½‘ç»œä¸­çš„è¶…å‚æ•°å’Œæ¨¡å‹å‚æ•°"><a href="#ç¥ç»ç½‘ç»œä¸­çš„è¶…å‚æ•°å’Œæ¨¡å‹å‚æ•°" class="headerlink" title="ç¥ç»ç½‘ç»œä¸­çš„è¶…å‚æ•°å’Œæ¨¡å‹å‚æ•°"></a>ç¥ç»ç½‘ç»œä¸­çš„è¶…å‚æ•°å’Œæ¨¡å‹å‚æ•°</h2><p><strong>è¶…å‚æ•°</strong>ï¼š</p><ul><li>å­¦ä¹ ç‡ï¼ˆLearning Rateï¼‰ï¼šå†³å®šæ¯æ¬¡æƒé‡æ›´æ–°çš„æ­¥é•¿ã€‚</li><li>æ‰¹å¤§å°ï¼ˆBatch Sizeï¼‰ï¼šå†³å®šæ¯æ¬¡æƒé‡æ›´æ–°æ—¶ä½¿ç”¨çš„è®­ç»ƒæ ·æœ¬æ•°é‡ã€‚</li><li>éšè—å±‚æ•°å’Œæ¯å±‚ç¥ç»å…ƒæ•°é‡ï¼šå®šä¹‰ç¥ç»ç½‘ç»œçš„ç»“æ„å’Œå¤æ‚åº¦ã€‚</li><li>æ­£åˆ™åŒ–ç³»æ•°ï¼šæ§åˆ¶æ­£åˆ™åŒ–é¡¹åœ¨æŸå¤±å‡½æ•°ä¸­çš„æƒé‡ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆã€‚</li><li>è®­ç»ƒè½®æ•°ï¼ˆEpochsï¼‰ï¼šæ¨¡å‹åœ¨æ•´ä¸ªè®­ç»ƒæ•°æ®é›†ä¸Šå®Œæ•´è®­ç»ƒçš„æ¬¡æ•°ã€‚</li></ul><p><strong>æ¨¡å‹å‚æ•°</strong>ï¼š</p><ul><li>æƒé‡ï¼ˆWeightsï¼‰ï¼šè¿æ¥ç¥ç»å…ƒçš„æƒé‡ï¼Œè¡¨ç¤ºè¾“å…¥ç‰¹å¾çš„é‡è¦æ€§ã€‚</li><li>åç½®ï¼ˆBiasesï¼‰ï¼šæ¯ä¸ªç¥ç»å…ƒçš„åç½®ï¼Œç”¨äºè°ƒæ•´æ¿€æ´»å‡½æ•°çš„è¾“å‡ºã€‚</li></ul><h1 id="8-åºåˆ—æ•°æ®-vs-éåºåˆ—æ•°æ®"><a href="#8-åºåˆ—æ•°æ®-vs-éåºåˆ—æ•°æ®" class="headerlink" title="8. åºåˆ—æ•°æ® vs éåºåˆ—æ•°æ®"></a>8. åºåˆ—æ•°æ® vs éåºåˆ—æ•°æ®</h1><h2 id="1-åºåˆ—æ•°æ®sequential-data"><a href="#1-åºåˆ—æ•°æ®ï¼ˆSequential-Dataï¼‰" class="headerlink" title="1. åºåˆ—æ•°æ®ï¼ˆSequential Dataï¼‰"></a>1. åºåˆ—æ•°æ®ï¼ˆSequential Dataï¼‰</h2><p>åºåˆ—æ•°æ®ï¼ˆSequential Dataï¼‰æ˜¯æŒ‡æŒ‰ç…§æ—¶é—´æˆ–å…¶ä»–é¡ºåºæ’åˆ—çš„æ•°æ®ï¼Œå…¶ä¸­æ¯ä¸ªæ•°æ®ç‚¹çš„æ„ä¹‰å’Œä»·å€¼éƒ½ä¾èµ–äºå®ƒåœ¨åºåˆ—ä¸­çš„ä½ç½®å’Œå‰åæ•°æ®ç‚¹çš„å…³ç³»ã€‚åºåˆ—æ•°æ®å¹¿æ³›å­˜åœ¨äºè®¸å¤šå®é™…åº”ç”¨ä¸­ï¼Œå¦‚æ—¶é—´åºåˆ—ã€è‡ªç„¶è¯­è¨€å¤„ç†ã€è¯­éŸ³è¯†åˆ«ç­‰ã€‚</p><h3 id="åºåˆ—æ•°æ®çš„ç‰¹ç‚¹"><a href="#åºåˆ—æ•°æ®çš„ç‰¹ç‚¹" class="headerlink" title="åºåˆ—æ•°æ®çš„ç‰¹ç‚¹"></a>åºåˆ—æ•°æ®çš„ç‰¹ç‚¹</h3><ol><li><strong>æ—¶é—´ä¾èµ–æ€§</strong>ï¼šåºåˆ—æ•°æ®ä¸­çš„æ¯ä¸ªæ•°æ®ç‚¹ä¸å…¶å‰åæ•°æ®ç‚¹å­˜åœ¨ä¾èµ–å…³ç³»ã€‚è¿™ç§ä¾èµ–æ€§å¯ä»¥æ˜¯çŸ­æœŸçš„ï¼ˆä»…ä¾èµ–äºæœ€è¿‘çš„æ•°æ®ç‚¹ï¼‰æˆ–é•¿æœŸçš„ï¼ˆä¾èµ–äºè¾ƒæ—©çš„æ•°æ®ç‚¹ï¼‰ã€‚</li><li><strong>é¡ºåºå…³ç³»</strong>ï¼šåºåˆ—æ•°æ®çš„é¡ºåºæ˜¯è‡³å…³é‡è¦çš„ï¼Œæ•°æ®ç‚¹çš„é¡ºåºå…³ç³»å†³å®šäº†å…¶å®é™…æ„ä¹‰ã€‚ä¾‹å¦‚ï¼Œåœ¨è¯­éŸ³ä¿¡å·ä¸­ï¼ŒéŸ³é¢‘å¸§çš„é¡ºåºå†³å®šäº†æœ€ç»ˆè¯­éŸ³çš„å†…å®¹ã€‚</li><li><strong>åŠ¨æ€æ€§</strong>ï¼šåºåˆ—æ•°æ®å¾€å¾€æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œæ•°æ®ç‚¹çš„å€¼éšæ—¶é—´æˆ–å…¶ä»–é¡ºåºå˜åŒ–è€Œå˜åŒ–ã€‚</li></ol><p>é€’å½’ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰å’Œå…¶å˜ä½“å¦‚LSTMå’ŒGRUæ“…é•¿å¤„ç†åºåˆ—æ•°æ®</p><h2 id="2-éåºåˆ—æ•°æ®"><a href="#2-éåºåˆ—æ•°æ®" class="headerlink" title="2. éåºåˆ—æ•°æ®"></a>2. éåºåˆ—æ•°æ®</h2><p>éåºåˆ—åŒ–æ•°æ®æ˜¯æŒ‡é‚£äº›æ•°æ®ç‚¹ä¹‹é—´æ²¡æœ‰æ—¶é—´æˆ–é¡ºåºä¾èµ–å…³ç³»çš„æ•°æ®ã€‚ä¸åºåˆ—åŒ–æ•°æ®ï¼ˆå¦‚æ—¶é—´åºåˆ—ã€æ–‡æœ¬ã€è¯­éŸ³ä¿¡å·ç­‰ï¼‰ä¸åŒï¼Œéåºåˆ—åŒ–æ•°æ®ä¸­çš„æ¯ä¸ªæ•°æ®ç‚¹éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¾èµ–äºå‰åçš„æ•°æ®ç‚¹ã€‚éåºåˆ—åŒ–æ•°æ®åœ¨å„ç§é¢†åŸŸä¸­å¹¿æ³›å­˜åœ¨ï¼ŒåŒ…æ‹¬å›¾åƒæ•°æ®ã€è¡¨æ ¼æ•°æ®ï¼ˆç»“æ„åŒ–æ•°æ®ï¼‰ã€å›¾æ•°æ®ç­‰ã€‚<br>ä¸åŒç±»å‹çš„éåºåˆ—åŒ–æ•°æ®å¯ä»¥é€šè¿‡ä¸åŒçš„ç¥ç»ç½‘ç»œè¿›è¡Œå¤„ç†ï¼Œå¦‚å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰å¤„ç†å›¾åƒæ•°æ®ï¼Œå‰é¦ˆç¥ç»ç½‘ç»œï¼ˆFNNï¼‰å¤„ç†è¡¨æ ¼æ•°æ®ï¼Œå›¾ç¥ç»ç½‘ç»œï¼ˆGNNï¼‰å¤„ç†å›¾æ•°æ®ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€‰æ‹©åˆé€‚çš„ç¥ç»ç½‘ç»œæ¨¡å‹èƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†å„ç§éåºåˆ—åŒ–æ•°æ®ï¼Œè§£å†³å®é™…é—®é¢˜ã€‚</p><h3 id="éåºåˆ—åŒ–æ•°æ®çš„å®é™…åº”ç”¨"><a href="#éåºåˆ—åŒ–æ•°æ®çš„å®é™…åº”ç”¨" class="headerlink" title="éåºåˆ—åŒ–æ•°æ®çš„å®é™…åº”ç”¨"></a>éåºåˆ—åŒ–æ•°æ®çš„å®é™…åº”ç”¨</h3><h4 id="1-å›¾åƒæ•°æ®çš„åº”ç”¨"><a href="#1-å›¾åƒæ•°æ®çš„åº”ç”¨" class="headerlink" title="1. å›¾åƒæ•°æ®çš„åº”ç”¨"></a>1. å›¾åƒæ•°æ®çš„åº”ç”¨</h4><p>å›¾åƒæ•°æ®æ˜¯é«˜ç»´éåºåˆ—æ•°æ®ï¼Œå…·æœ‰ç©ºé—´ç»“æ„ç‰¹æ€§ã€‚å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰æ˜¯å¤„ç†å›¾åƒæ•°æ®çš„ä¸»è¦ç¥ç»ç½‘ç»œç±»å‹ã€‚</p><p><strong>åŒ»ç–—å½±åƒåˆ†æ</strong>ï¼šé€šè¿‡CNNå¤„ç†åŒ»ç–—å½±åƒï¼ˆå¦‚MRIã€CTå›¾åƒï¼‰ï¼Œè¿›è¡Œç–¾ç—…è¯Šæ–­å’Œåˆ†ç±»ã€‚</p><p><strong>è‡ªåŠ¨é©¾é©¶</strong>ï¼šä½¿ç”¨CNNåˆ†ææ±½è½¦æ‘„åƒå¤´æ•æ‰çš„é“è·¯å›¾åƒï¼Œè¯†åˆ«è¡Œäººã€äº¤é€šæ ‡å¿—å’Œå…¶ä»–è½¦è¾†ã€‚<br><strong>å›¾åƒåˆ†ç±»</strong>ï¼šä½¿ç”¨CNNå¯¹è¾“å…¥å›¾åƒè¿›è¡Œåˆ†ç±»ã€‚ä¾‹å¦‚ï¼ŒImageNetæ•°æ®é›†ä¸Šçš„ç‰©ä½“è¯†åˆ«ä»»åŠ¡ã€‚</p><ul><li>å…·ä½“åº”ç”¨ï¼šå·ç§¯å±‚æå–å›¾åƒçš„å±€éƒ¨ç‰¹å¾ï¼Œæ± åŒ–å±‚å‡å°‘ç‰¹å¾ç»´åº¦ï¼Œå…¨è¿æ¥å±‚è¿›è¡Œåˆ†ç±»ã€‚</li><li>å…¸å‹æ¨¡å‹ï¼šAlexNetã€VGGã€ResNetç­‰ã€‚<br><strong>å›¾åƒåˆ†å‰²</strong>ï¼šå°†å›¾åƒåˆ’åˆ†ä¸ºå…·æœ‰ä¸åŒè¯­ä¹‰æ„ä¹‰çš„åŒºåŸŸã€‚ä¾‹å¦‚ï¼Œè‡ªåŠ¨é©¾é©¶ä¸­çš„é“è·¯æ ‡è®°è¯†åˆ«ã€‚</li><li>å…·ä½“åº”ç”¨ï¼šåˆ©ç”¨å…¨å·ç§¯ç¥ç»ç½‘ç»œï¼ˆFCNï¼‰æˆ–U-Netå¯¹å›¾åƒè¿›è¡Œåƒç´ çº§åˆ†ç±»ã€‚</li><li>å…¸å‹æ¨¡å‹ï¼šU-Netã€SegNetç­‰ã€‚</li></ul><h4 id="2-è¡¨æ ¼æ•°æ®çš„åº”ç”¨"><a href="#2-è¡¨æ ¼æ•°æ®çš„åº”ç”¨" class="headerlink" title="2. è¡¨æ ¼æ•°æ®çš„åº”ç”¨"></a>2. è¡¨æ ¼æ•°æ®çš„åº”ç”¨</h4><p>è¡¨æ ¼æ•°æ®é€šå¸¸å­˜å‚¨åœ¨æ•°æ®åº“æˆ–ç”µå­è¡¨æ ¼ä¸­ï¼ŒåŒ…å«å¤šç§ç‰¹å¾å’Œç›®æ ‡å˜é‡ã€‚å‰é¦ˆç¥ç»ç½‘ç»œï¼ˆFNNï¼‰é€‚ç”¨äºå¤„ç†è¡¨æ ¼æ•°æ®ã€‚<br><strong>å›å½’åˆ†æ</strong>ï¼šé¢„æµ‹è¿ç»­å€¼ï¼Œå¦‚æˆ¿ä»·é¢„æµ‹ã€‚</p><ul><li>å…·ä½“åº”ç”¨ï¼šè¾“å…¥å±‚æ¥æ”¶å¤šç§ç‰¹å¾ï¼Œéšè—å±‚æå–ç‰¹å¾ä¹‹é—´çš„å¤æ‚å…³ç³»ï¼Œè¾“å‡ºå±‚ç»™å‡ºé¢„æµ‹å€¼ã€‚</li><li>å…¸å‹æ¨¡å‹ï¼šå¤šå±‚æ„ŸçŸ¥å™¨ï¼ˆMLPï¼‰ã€‚<br>-<strong>åˆ†ç±»ä»»åŠ¡</strong>ï¼šå¯¹æ•°æ®è¿›è¡Œåˆ†ç±»ï¼Œå¦‚ä¿¡ç”¨å¡æ¬ºè¯ˆæ£€æµ‹ã€‚</li><li>å…·ä½“åº”ç”¨ï¼šè¾“å…¥å±‚æ¥æ”¶å„ç‰¹å¾å€¼ï¼Œéšè—å±‚æå–ç‰¹å¾é—´å…³ç³»ï¼Œè¾“å‡ºå±‚è¿›è¡Œåˆ†ç±»ã€‚</li><li>å…¸å‹æ¨¡å‹ï¼šå¤šå±‚æ„ŸçŸ¥å™¨ï¼ˆMLPï¼‰ã€‚</li></ul><p><strong>å®¢æˆ·åˆ†ç±»</strong>ï¼šä½¿ç”¨FNNå¯¹å®¢æˆ·è¿›è¡Œåˆ†ç±»ï¼Œå¦‚æ ¹æ®å®¢æˆ·è´­ä¹°è¡Œä¸ºé¢„æµ‹å®¢æˆ·æµå¤±é£é™©ã€‚</p><h4 id="3-å›¾æ•°æ®çš„åº”ç”¨"><a href="#3-å›¾æ•°æ®çš„åº”ç”¨" class="headerlink" title="3. å›¾æ•°æ®çš„åº”ç”¨"></a>3. å›¾æ•°æ®çš„åº”ç”¨</h4><p>å›¾æ•°æ®ç”±èŠ‚ç‚¹å’Œè¾¹æ„æˆï¼Œå…·æœ‰å¤æ‚çš„è¿æ¥ç»“æ„ã€‚å›¾ç¥ç»ç½‘ç»œï¼ˆGraph Neural Networks, GNNsï¼‰ä¸“é—¨ç”¨äºå¤„ç†å›¾æ•°æ®ã€‚</p><p><strong>èŠ‚ç‚¹åˆ†ç±»</strong>ï¼šåœ¨å›¾ä¸­ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ†é…æ ‡ç­¾ï¼Œå¦‚ç¤¾äº¤ç½‘ç»œä¸­çš„ç”¨æˆ·åˆ†ç±»ã€‚</p><ul><li>å…·ä½“åº”ç”¨ï¼šå›¾å·ç§¯ç¥ç»ç½‘ç»œï¼ˆGCNï¼‰é€šè¿‡èšåˆé‚»å±…èŠ‚ç‚¹çš„ä¿¡æ¯æ›´æ–°æ¯ä¸ªèŠ‚ç‚¹çš„è¡¨ç¤ºï¼Œç„¶åè¿›è¡Œåˆ†ç±»ã€‚</li><li>å…¸å‹æ¨¡å‹ï¼šGCNã€GraphSAGEã€‚<br><strong>å›¾åˆ†ç±»</strong>ï¼šå¯¹æ•´ä¸ªå›¾è¿›è¡Œåˆ†ç±»ï¼Œå¦‚åˆ†å­ç»“æ„çš„åŒ–å­¦æ€§è´¨é¢„æµ‹ã€‚</li><li>å…·ä½“åº”ç”¨ï¼šå°†å›¾åµŒå…¥åˆ°å›ºå®šé•¿åº¦çš„å‘é‡è¡¨ç¤ºä¸­ï¼Œç„¶åä½¿ç”¨å‰é¦ˆç¥ç»ç½‘ç»œè¿›è¡Œåˆ†ç±»ã€‚</li><li>å…¸å‹æ¨¡å‹ï¼šDGCNNã€GraphSAGEã€‚</li></ul><p><strong>ç¤¾äº¤ç½‘ç»œåˆ†æ</strong>ï¼šé€šè¿‡GNNåˆ†æç¤¾äº¤ç½‘ç»œä¸­çš„ç”¨æˆ·å…³ç³»ï¼Œè¿›è¡Œç”¨æˆ·åˆ†ç±»å’Œæ¨èç³»ç»Ÿã€‚</p><p><strong>åŒ–å­¦åˆ†å­å»ºæ¨¡</strong>ï¼šä½¿ç”¨GNNåˆ†æåŒ–å­¦åˆ†å­ç»“æ„ï¼Œé¢„æµ‹åˆ†å­çš„ç‰©ç†å’ŒåŒ–å­¦æ€§è´¨ã€‚</p><h1 id="9-å‘é‡"><a href="#9-å‘é‡" class="headerlink" title="9. å‘é‡"></a>9. å‘é‡</h1><p>åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œå‘é‡æ˜¯ä¸€ä¸ªé‡è¦çš„æ•°å­¦å·¥å…·ï¼Œç”¨äºè¡¨ç¤ºå’Œæ“ä½œå¤šä¸ªæ•°å€¼ã€‚å‘é‡åœ¨ç¥ç»ç½‘ç»œçš„å„ä¸ªéƒ¨åˆ†éƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ï¼ŒåŒ…æ‹¬è¾“å…¥æ•°æ®ã€æƒé‡ã€åç½®ã€æ¿€æ´»å€¼ç­‰ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£å‘é‡åœ¨ç¥ç»ç½‘ç»œä¸­çš„è§’è‰²ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯¦ç»†é˜è¿°ï¼š</p><h3 id="å‘é‡çš„å®šä¹‰"><a href="#å‘é‡çš„å®šä¹‰" class="headerlink" title="å‘é‡çš„å®šä¹‰"></a>å‘é‡çš„å®šä¹‰</h3><p>ä¸€ä¸ªå‘é‡æ˜¯ä¸€ä¸ªå…·æœ‰æ–¹å‘å’Œå¤§å°çš„æ•°é‡é›†åˆï¼Œé€šå¸¸ç”¨ä¸€ç»´æ•°ç»„æ¥è¡¨ç¤ºã€‚åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œå‘é‡å¯ä»¥ç”¨æ¥è¡¨ç¤ºè¾“å…¥ç‰¹å¾ã€éšè—å±‚çš„æ¿€æ´»å€¼ã€è¾“å‡ºå€¼ä»¥åŠæ¨¡å‹çš„æƒé‡å’Œåç½®ã€‚</p><h3 id="å‘é‡åœ¨ç¥ç»ç½‘ç»œä¸­çš„å…·ä½“åº”ç”¨"><a href="#å‘é‡åœ¨ç¥ç»ç½‘ç»œä¸­çš„å…·ä½“åº”ç”¨" class="headerlink" title="å‘é‡åœ¨ç¥ç»ç½‘ç»œä¸­çš„å…·ä½“åº”ç”¨"></a>å‘é‡åœ¨ç¥ç»ç½‘ç»œä¸­çš„å…·ä½“åº”ç”¨</h3><h4 id="1-è¾“å…¥å‘é‡"><a href="#1-è¾“å…¥å‘é‡" class="headerlink" title="1. è¾“å…¥å‘é‡"></a>1. è¾“å…¥å‘é‡</h4><p>è¾“å…¥å‘é‡è¡¨ç¤ºç¥ç»ç½‘ç»œæ¥æ”¶åˆ°çš„åŸå§‹æ•°æ®ã€‚åœ¨ä¸€ä¸ªç®€å•çš„å‰é¦ˆç¥ç»ç½‘ç»œä¸­ï¼Œè¾“å…¥å‘é‡é€šå¸¸æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªç‰¹å¾çš„æ•°æ®ç‚¹ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªå›¾åƒåˆ†ç±»ä»»åŠ¡ï¼Œæ¯ä¸ªè¾“å…¥å‘é‡å¯èƒ½ä»£è¡¨ä¸€å¼ å›¾åƒçš„åƒç´ å€¼ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š å¯¹äºä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªç‰¹å¾çš„è¾“å…¥æ•°æ®ç‚¹$(x_1, x_2, x_3)$ï¼Œè¾“å…¥å‘é‡å¯ä»¥è¡¨ç¤ºä¸ºï¼š$\mathbf{x} = \begin{bmatrix} x_1 \ x_2 \ x_3 \end{bmatrix}$</p><h4 id="2-æƒé‡å‘é‡"><a href="#2-æƒé‡å‘é‡" class="headerlink" title="2. æƒé‡å‘é‡"></a>2. æƒé‡å‘é‡</h4><p>æƒé‡å‘é‡è¡¨ç¤ºç¥ç»å…ƒä¹‹é—´çš„è¿æ¥å¼ºåº¦ã€‚åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œæ¯ä¸ªç¥ç»å…ƒçš„è¾“å‡ºéƒ½æ˜¯å‰ä¸€å±‚ç¥ç»å…ƒè¾“å‡ºçš„åŠ æƒå’Œã€‚æƒé‡å‘é‡å†³å®šäº†è¾“å…¥ç‰¹å¾å¯¹è¾“å‡ºçš„å½±å“ç¨‹åº¦ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š å¯¹äºä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªè¾“å…¥ç‰¹å¾çš„ç¥ç»å…ƒï¼Œå…¶æƒé‡å‘é‡å¯ä»¥è¡¨ç¤ºä¸ºï¼š $\mathbf{w} = \begin{bmatrix} w_1 \ w_2 \ w_3 \end{bmatrix}$</p><h4 id="3-åç½®å‘é‡"><a href="#3-åç½®å‘é‡" class="headerlink" title="3. åç½®å‘é‡"></a>3. åç½®å‘é‡</h4><p>åç½®å‘é‡æ˜¯ä¸€ä¸ªé¢å¤–çš„å‚æ•°ï¼Œç”¨äºè°ƒæ•´ç¥ç»å…ƒçš„è¾“å‡ºï¼Œä½¿å…¶èƒ½å¤Ÿæ›´å¥½åœ°æ‹Ÿåˆæ•°æ®ã€‚åç½®å‘é‡ä¸æƒé‡å‘é‡ä¸€èµ·ï¼Œå½±å“æ¯ä¸ªç¥ç»å…ƒçš„è¾“å‡ºã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š å¯¹äºä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªè¾“å…¥ç‰¹å¾çš„ç¥ç»å…ƒï¼Œå…¶åç½®å‘é‡å¯ä»¥è¡¨ç¤ºä¸ºï¼š $\mathbf{b} = b$</p><h4 id="4-æ¿€æ´»å€¼å‘é‡"><a href="#4-æ¿€æ´»å€¼å‘é‡" class="headerlink" title="4. æ¿€æ´»å€¼å‘é‡"></a>4. æ¿€æ´»å€¼å‘é‡</h4><p>æ¿€æ´»å€¼å‘é‡è¡¨ç¤ºç¥ç»ç½‘ç»œä¸­æ¯ä¸€å±‚çš„è¾“å‡ºã€‚åœ¨å‰å‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œè¾“å…¥å‘é‡ä¸æƒé‡å‘é‡ç›¸ä¹˜å¹¶åŠ ä¸Šåç½®å‘é‡ï¼Œç»è¿‡æ¿€æ´»å‡½æ•°åå¾—åˆ°çš„å€¼å³ä¸ºæ¿€æ´»å€¼ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š å¯¹äºä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªç¥ç»å…ƒçš„éšè—å±‚ï¼Œå…¶æ¿€æ´»å€¼å‘é‡å¯ä»¥è¡¨ç¤ºä¸ºï¼š $\mathbf{a} = \begin{bmatrix} a_1 \ a_2 \ a_3 \end{bmatrix}$</p><h3 id="å‘é‡æ“ä½œ"><a href="#å‘é‡æ“ä½œ" class="headerlink" title="å‘é‡æ“ä½œ"></a>å‘é‡æ“ä½œ</h3><p>åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œå¸¸è§çš„å‘é‡æ“ä½œåŒ…æ‹¬å‘é‡åŠ æ³•ã€å‘é‡ä¹˜æ³•ï¼ˆç‚¹ç§¯ï¼‰ã€æ ‡é‡ä¹˜æ³•å’Œå‘é‡çš„æ¿€æ´»å‡½æ•°åº”ç”¨ã€‚</p><h4 id="1-å‘é‡åŠ æ³•"><a href="#1-å‘é‡åŠ æ³•" class="headerlink" title="1. å‘é‡åŠ æ³•"></a>1. å‘é‡åŠ æ³•</h4><p>å‘é‡åŠ æ³•æ˜¯å°†ä¸¤ä¸ªå‘é‡çš„å¯¹åº”å…ƒç´ ç›¸åŠ ã€‚å‡è®¾æœ‰ä¸¤ä¸ªå‘é‡ $\mathbf{a}$ å’Œ $\mathbf{b}$ï¼Œå®ƒä»¬çš„å‘é‡åŠ æ³•è¡¨ç¤ºä¸ºï¼š $\mathbf{c} = \mathbf{a} + \mathbf{b}$<br>$\mathbf{c} = \begin{bmatrix} a_1 + b_1 \ a_2 + b_2 \ a_3 + b_3 \end{bmatrix}$</p><h4 id="2-å‘é‡ä¹˜æ³•ç‚¹ç§¯"><a href="#2-å‘é‡ä¹˜æ³•ï¼ˆç‚¹ç§¯ï¼‰" class="headerlink" title="2. å‘é‡ä¹˜æ³•ï¼ˆç‚¹ç§¯ï¼‰"></a>2. å‘é‡ä¹˜æ³•ï¼ˆç‚¹ç§¯ï¼‰</h4><p>å‘é‡ç‚¹ç§¯æ˜¯å°†ä¸¤ä¸ªå‘é‡çš„å¯¹åº”å…ƒç´ ç›¸ä¹˜å¹¶æ±‚å’Œã€‚å‡è®¾æœ‰ä¸¤ä¸ªå‘é‡ a\mathbf{a}a å’Œ $\mathbf{b}$ï¼Œå®ƒä»¬çš„ç‚¹ç§¯è¡¨ç¤ºä¸ºï¼š<br>$c = \mathbf{a} \cdot \mathbf{b}$<br>$c = a_1 \cdot b_1 + a_2 \cdot b_2 + a_3 \cdot b_3$</p><h4 id="3-æ ‡é‡ä¹˜æ³•"><a href="#3-æ ‡é‡ä¹˜æ³•" class="headerlink" title="3. æ ‡é‡ä¹˜æ³•"></a>3. æ ‡é‡ä¹˜æ³•</h4><p>æ ‡é‡ä¹˜æ³•æ˜¯å°†å‘é‡çš„æ¯ä¸ªå…ƒç´ ä¹˜ä»¥ä¸€ä¸ªæ ‡é‡ã€‚å‡è®¾æœ‰ä¸€ä¸ªå‘é‡ $\mathbf{a}$ å’Œä¸€ä¸ªæ ‡é‡ $k$ï¼Œå®ƒä»¬çš„æ ‡é‡ä¹˜æ³•è¡¨ç¤ºä¸ºï¼š $\mathbf{b} = k \cdot \mathbf{a}$</p><p>$\mathbf{b} = \begin{bmatrix} k \cdot a_1 \ k \cdot a_2 \ k \cdot a_3 \end{bmatrix}$</p><h3 id="ç¤ºä¾‹å‰å‘ä¼ æ’­ä¸­çš„å‘é‡è¿ç®—"><a href="#ç¤ºä¾‹ï¼šå‰å‘ä¼ æ’­ä¸­çš„å‘é‡è¿ç®—" class="headerlink" title="ç¤ºä¾‹ï¼šå‰å‘ä¼ æ’­ä¸­çš„å‘é‡è¿ç®—"></a>ç¤ºä¾‹ï¼šå‰å‘ä¼ æ’­ä¸­çš„å‘é‡è¿ç®—</h3><p>ä»¥ä¸€ä¸ªç®€å•çš„ä¸¤å±‚ç¥ç»ç½‘ç»œä¸ºä¾‹ï¼Œè¯´æ˜å‘é‡åœ¨å‰å‘ä¼ æ’­ä¸­çš„åº”ç”¨ã€‚</p><p><strong>è¾“å…¥å±‚</strong>ï¼šè¾“å…¥å‘é‡ $\mathbf{x}$<br>$\mathbf{x} = \begin{bmatrix} x_1 \ x_2 \end{bmatrix}$</p><p><strong>éšè—å±‚</strong>ï¼šæƒé‡å‘é‡ $\mathbf{W}$ å’Œåç½®å‘é‡ $\mathbf{b}$<br>$\mathbf{W} = \begin{bmatrix} w_{11} &amp; w_{12} \ w_{21} &amp; w_{22} \end{bmatrix}$</p><p>$\mathbf{b} = \begin{bmatrix} b_1 \ b_2 \end{bmatrix}$</p><p><strong>è®¡ç®—éšè—å±‚æ¿€æ´»å€¼</strong>ï¼š<br>$\mathbf{z} = \mathbf{W} \cdot \mathbf{x} + \mathbf{b}$</p><p>$\mathbf{z} = \begin{bmatrix} w_{11}x_1 + w_{12}x_2 + b_1 \ w_{21}x_1 + w_{22}x_2 + b_2 \end{bmatrix}$</p><p><strong>åº”ç”¨æ¿€æ´»å‡½æ•°ï¼ˆå¦‚ReLUï¼‰</strong>ï¼š<br>$\mathbf{a} = \text{ReLU}(\mathbf{z})$<br>$\mathbf{a} = \begin{bmatrix} \text{ReLU}(z_1) \ \text{ReLU}(z_2) \end{bmatrix}$</p><p><strong>è¾“å‡ºå±‚</strong>ï¼šæƒé‡å‘é‡ $\mathbf{Wâ€™}$ å’Œåç½® $\mathbf{bâ€™}$<br>$\mathbf{Wâ€™} = \begin{bmatrix} w_{31} &amp; w_{32} \end{bmatrix}$<br>$\mathbf{bâ€™} = bâ€™$</p><p><strong>è®¡ç®—è¾“å‡ºå€¼</strong>ï¼š<br>$y = \mathbf{Wâ€™} \cdot \mathbf{a} + \mathbf{bâ€™}$<br>$y = w_{31}a_1 + w_{32}a_2 + bâ€™$</p><h1 id="9-è¯¯å·®"><a href="#9-è¯¯å·®" class="headerlink" title="9. è¯¯å·®"></a>9. è¯¯å·®</h1><p>è®­ç»ƒè¯¯å·®ã€æµ‹è¯•è¯¯å·®å’ŒéªŒè¯è¯¯å·®æ˜¯ä¸‰ä¸ªä¸åŒçš„æ¦‚å¿µï¼Œå®ƒä»¬åˆ†åˆ«è¡¡é‡æ¨¡å‹åœ¨ä¸åŒæ•°æ®é›†ä¸Šçš„è¡¨ç°ã€‚è¿™äº›è¯¯å·®å¸®åŠ©æˆ‘ä»¬è¯„ä¼°æ¨¡å‹çš„æ‹Ÿåˆç¨‹åº¦å’Œæ³›åŒ–èƒ½åŠ›</p><h2 id="91-åŒºåˆ«å’Œè”ç³»"><a href="#9-1-åŒºåˆ«å’Œè”ç³»" class="headerlink" title="9.1 åŒºåˆ«å’Œè”ç³»"></a>9.1 åŒºåˆ«å’Œè”ç³»</h2><ul><li><strong>è®­ç»ƒè¯¯å·®</strong>ï¼šè¡¡é‡æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šçš„è¡¨ç°ï¼Œä¸»è¦ç”¨äºè®­ç»ƒè¿‡ç¨‹ä¸­è°ƒæ•´æ¨¡å‹å‚æ•°ã€‚</li><li><strong>éªŒè¯è¯¯å·®</strong>ï¼šè¡¡é‡æ¨¡å‹åœ¨éªŒè¯æ•°æ®ä¸Šçš„è¡¨ç°ï¼Œä¸»è¦ç”¨äºè¶…å‚æ•°è°ƒä¼˜å’Œæ¨¡å‹é€‰æ‹©ã€‚éªŒè¯æ•°æ®æ˜¯ä»è®­ç»ƒæ•°æ®ä¸­åˆ†ç¦»å‡ºæ¥çš„ä¸€éƒ¨åˆ†ï¼Œä¸å‚ä¸æ¨¡å‹è®­ç»ƒã€‚</li><li><strong>æµ‹è¯•è¯¯å·®</strong>ï¼šè¡¡é‡æ¨¡å‹åœ¨æµ‹è¯•æ•°æ®ä¸Šçš„è¡¨ç°ï¼Œä¸»è¦ç”¨äºè¯„ä¼°æ¨¡å‹çš„æœ€ç»ˆæ³›åŒ–èƒ½åŠ›ã€‚æµ‹è¯•æ•°æ®åœ¨è®­ç»ƒå’ŒéªŒè¯è¿‡ç¨‹ä¸­éƒ½ä¸ä½¿ç”¨ï¼Œåªæœ‰åœ¨æ¨¡å‹è®­ç»ƒå®Œæˆåæ‰ç”¨äºè¯„ä¼°ã€‚<h3 id="92-è®­ç»ƒè¯¯å·®training-error"><a href="#9-2-è®­ç»ƒè¯¯å·®ï¼ˆTraining-Errorï¼‰" class="headerlink" title="9.2 è®­ç»ƒè¯¯å·®ï¼ˆTraining Errorï¼‰"></a>9.2 è®­ç»ƒè¯¯å·®ï¼ˆTraining Errorï¼‰</h3></li></ul><p>è®­ç»ƒè¯¯å·®æ˜¯æŒ‡æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šçš„è¯¯å·®ã€‚å®ƒåæ˜ äº†æ¨¡å‹å¯¹è®­ç»ƒæ•°æ®çš„æ‹Ÿåˆç¨‹åº¦ã€‚<br><strong>è®¡ç®—æ–¹æ³•</strong></p><p>è®­ç»ƒè¯¯å·®é€šå¸¸é€šè¿‡åœ¨è®­ç»ƒæ•°æ®ä¸Šè®¡ç®—æŸå¤±å‡½æ•°ï¼ˆä¾‹å¦‚å‡æ–¹è¯¯å·®ã€äº¤å‰ç†µæŸå¤±ç­‰ï¼‰æ¥å¾—åˆ°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰ä½œä¸ºæŸå¤±å‡½æ•°ï¼Œè®­ç»ƒè¯¯å·®å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><p>$\text{MSE}_{\text{train}} = \frac{1}{N_{\text{train}}} \sum_{i=1}^{N_{\text{train}}} (y_i - \hat{y}_i)^2$</p><p>å…¶ä¸­ï¼ŒNtrainN_{\text{train}}Ntrainâ€‹ æ˜¯è®­ç»ƒæ•°æ®çš„æ ·æœ¬æ•°é‡ï¼Œyiy_iyiâ€‹ æ˜¯ç¬¬ iii ä¸ªæ ·æœ¬çš„çœŸå®å€¼ï¼Œy^i\hat{y}_i y^â€‹iâ€‹ æ˜¯æ¨¡å‹å¯¹ç¬¬ iii ä¸ªæ ·æœ¬çš„é¢„æµ‹å€¼ã€‚</p><p><strong>ç›®æ ‡</strong><br>æœ€å°åŒ–è®­ç»ƒè¯¯å·®ï¼Œä»¥ä¾¿æ¨¡å‹èƒ½å¤Ÿè‰¯å¥½åœ°æ‹Ÿåˆè®­ç»ƒæ•°æ®ã€‚</p><p><strong>æ„ä¹‰</strong><br>ä½è®­ç»ƒè¯¯å·®è¡¨æ˜æ¨¡å‹èƒ½å¤Ÿå¾ˆå¥½åœ°æ‹Ÿåˆè®­ç»ƒæ•°æ®ã€‚ä½†è¿™å¹¶ä¸ä¸€å®šæ„å‘³ç€æ¨¡å‹åœ¨æ–°æ•°æ®ä¸Šçš„è¡¨ç°ä¹Ÿä¼šè‰¯å¥½ã€‚</p><h2 id="92-é¢„æµ‹è¯¯å·®æµ‹è¯•è¯¯å·®"><a href="#9-2-é¢„æµ‹è¯¯å·®-æµ‹è¯•è¯¯å·®" class="headerlink" title="9.2 é¢„æµ‹è¯¯å·®/æµ‹è¯•è¯¯å·®"></a>9.2 é¢„æµ‹è¯¯å·®/æµ‹è¯•è¯¯å·®</h2><p>é¢„æµ‹è¯¯å·®/æµ‹è¯•è¯¯å·® æ˜¯æŒ‡æ¨¡å‹åœ¨æœªè§è¿‡çš„æ•°æ®ï¼ˆé€šå¸¸æ˜¯æµ‹è¯•æ•°æ®æˆ–éªŒè¯æ•°æ®ï¼‰ä¸Šçš„è¯¯å·®ã€‚å®ƒåæ˜ äº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œå³æ¨¡å‹åœ¨æ–°æ•°æ®ä¸Šçš„è¡¨ç°ã€‚</p><ul><li><strong>è®¡ç®—æ–¹æ³•</strong>ï¼šåœ¨æ¨¡å‹è®­ç»ƒå®Œæˆåï¼Œä½¿ç”¨æµ‹è¯•æ•°æ®æˆ–éªŒè¯æ•°æ®è®¡ç®—æŸå¤±å‡½æ•°çš„å€¼ï¼Œè®¡ç®—æ–¹æ³•ä¸è®­ç»ƒè¯¯å·®ç±»ä¼¼</li><li><strong>ç›®æ ‡</strong>ï¼šè¯„ä¼°æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼ŒæœŸæœ›æ¨¡å‹åœ¨æµ‹è¯•æ•°æ®ä¸Šçš„è¯¯å·®å°½å¯èƒ½ä½ã€‚</li><li><strong>æ„ä¹‰</strong>ï¼šä½é¢„æµ‹è¯¯å·®è¡¨æ˜æ¨¡å‹å…·æœ‰è‰¯å¥½çš„æ³›åŒ–èƒ½åŠ›ï¼Œèƒ½å¤Ÿåœ¨æ–°æ•°æ®ä¸Šè¡¨ç°è‰¯å¥½ã€‚</li></ul><h2 id="93-è¯¯å·®çš„ä½œç”¨"><a href="#9-3-è¯¯å·®çš„ä½œç”¨" class="headerlink" title="9.3 è¯¯å·®çš„ä½œç”¨"></a>9.3 è¯¯å·®çš„ä½œç”¨</h2><p>è®­ç»ƒè¯¯å·®å’Œé¢„æµ‹è¯¯å·®çš„å…³ç³»å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¯Šæ–­æ¨¡å‹çš„çŠ¶æ€ï¼Œåˆ¤æ–­æ¨¡å‹æ˜¯å¦è¿‡æ‹Ÿåˆæˆ–æ¬ æ‹Ÿåˆã€‚</p><ul><li><strong>æ¬ æ‹Ÿåˆï¼ˆUnderfittingï¼‰</strong>ï¼šæ¨¡å‹åœ¨è®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®ä¸Šçš„è¯¯å·®éƒ½å¾ˆé«˜ï¼Œè¯´æ˜æ¨¡å‹å¤æ‚åº¦ä¸è¶³ï¼Œæ— æ³•æ•æ‰æ•°æ®ä¸­çš„è§„å¾‹ã€‚</li><li><strong>åˆé€‚æ‹Ÿåˆï¼ˆGood Fitï¼‰</strong>ï¼šæ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šçš„è¯¯å·®è¾ƒä½ï¼Œå¹¶ä¸”åœ¨æµ‹è¯•æ•°æ®ä¸Šçš„è¯¯å·®ä¹Ÿè¾ƒä½ï¼Œè¯´æ˜æ¨¡å‹å…·æœ‰è‰¯å¥½çš„æ³›åŒ–èƒ½åŠ›ã€‚</li><li><strong>è¿‡æ‹Ÿåˆï¼ˆOverfittingï¼‰</strong>ï¼šæ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šçš„è¯¯å·®å¾ˆä½ï¼Œä½†åœ¨æµ‹è¯•æ•°æ®ä¸Šçš„è¯¯å·®å¾ˆé«˜ï¼Œè¯´æ˜æ¨¡å‹è¿‡äºå¤æ‚ï¼Œæ•æ‰åˆ°äº†è®­ç»ƒæ•°æ®ä¸­çš„å™ªå£°å’Œç»†èŠ‚ï¼Œæ³›åŒ–èƒ½åŠ›è¾ƒå·®ã€‚</li></ul><h1 id="10è¿‡åº¦æ‹Ÿåˆ"><a href="#10-è¿‡åº¦æ‹Ÿåˆ" class="headerlink" title="10.è¿‡åº¦æ‹Ÿåˆ"></a>10.è¿‡åº¦æ‹Ÿåˆ</h1><p>è¿‡åº¦æ‹Ÿåˆï¼ˆOverfittingï¼‰æ˜¯æœºå™¨å­¦ä¹ ä¸­çš„ä¸€ä¸ªå¸¸è§é—®é¢˜ï¼ŒæŒ‡çš„æ˜¯æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šè¡¨ç°è‰¯å¥½ï¼Œä½†åœ¨æœªè§è¿‡çš„æµ‹è¯•æ•°æ®æˆ–å®é™…åº”ç”¨ä¸­è¡¨ç°ä¸ä½³ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºæ¨¡å‹è¿‡äºå¤æ‚ï¼Œæ•æ‰åˆ°äº†è®­ç»ƒæ•°æ®ä¸­çš„å™ªå£°å’Œå¶ç„¶æ€§æ¨¡å¼ï¼Œè€Œä¸æ˜¯æ•°æ®çš„æ½œåœ¨è§„å¾‹ã€‚</p><h3 id="è¿‡åº¦æ‹Ÿåˆçš„å…·ä½“è¡¨ç°"><a href="#è¿‡åº¦æ‹Ÿåˆçš„å…·ä½“è¡¨ç°" class="headerlink" title="è¿‡åº¦æ‹Ÿåˆçš„å…·ä½“è¡¨ç°"></a>è¿‡åº¦æ‹Ÿåˆçš„å…·ä½“è¡¨ç°</h3><ol><li><strong>è®­ç»ƒè¯¯å·®ä½ï¼Œæµ‹è¯•è¯¯å·®é«˜</strong>ï¼šæ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šçš„è¯¯å·®å¾ˆä½ï¼Œä½†åœ¨æµ‹è¯•æ•°æ®æˆ–æ–°æ•°æ®ä¸Šçš„è¯¯å·®å¾ˆé«˜ã€‚</li><li><strong>é«˜æ–¹å·®</strong>ï¼šæ¨¡å‹å¯¹è®­ç»ƒæ•°æ®ä¸­çš„ç»†èŠ‚å’Œå™ªå£°è¿‡äºæ•æ„Ÿï¼Œå¯¼è‡´å¯¹ä¸åŒæ•°æ®é›†çš„è¡¨ç°å·®å¼‚å¾ˆå¤§ã€‚</li><li><strong>å¤æ‚æ¨¡å‹</strong>ï¼šè¿‡äºå¤æ‚çš„æ¨¡å‹ï¼ˆä¾‹å¦‚ï¼Œå…·æœ‰å¤ªå¤šå‚æ•°çš„æ·±åº¦ç¥ç»ç½‘ç»œï¼‰å®¹æ˜“è¿‡åº¦æ‹Ÿåˆã€‚</li></ol><h3 id="è¿‡åº¦æ‹Ÿåˆçš„åŸå› "><a href="#è¿‡åº¦æ‹Ÿåˆçš„åŸå› " class="headerlink" title="è¿‡åº¦æ‹Ÿåˆçš„åŸå› "></a>è¿‡åº¦æ‹Ÿåˆçš„åŸå› </h3><ol><li><strong>æ¨¡å‹å¤æ‚åº¦é«˜</strong>ï¼šæ¨¡å‹çš„å‚æ•°è¿‡å¤šï¼Œèƒ½å¤Ÿæ‹Ÿåˆè®­ç»ƒæ•°æ®ä¸­çš„æ¯ä¸€ä¸ªç»†èŠ‚å’Œå™ªå£°ã€‚</li><li><strong>è®­ç»ƒæ•°æ®ä¸è¶³</strong>ï¼šè®­ç»ƒæ•°æ®é‡è¿‡å°‘ï¼Œæ¨¡å‹æ— æ³•å­¦ä¹ åˆ°æ•°æ®çš„çœŸå®åˆ†å¸ƒå’Œè§„å¾‹ã€‚</li><li><strong>å™ªå£°æ•°æ®</strong>ï¼šè®­ç»ƒæ•°æ®ä¸­åŒ…å«å¤§é‡å™ªå£°ï¼Œæ¨¡å‹å°†è¿™äº›å™ªå£°è¯¯è®¤ä¸ºæ˜¯æ•°æ®çš„æ½œåœ¨æ¨¡å¼ã€‚</li><li><strong>ç¼ºä¹æ­£åˆ™åŒ–</strong>ï¼šæ²¡æœ‰ä½¿ç”¨æ­£åˆ™åŒ–æŠ€æœ¯æ¥çº¦æŸæ¨¡å‹çš„å¤æ‚åº¦ã€‚</li></ol><h3 id="å¦‚ä½•æ£€æµ‹è¿‡åº¦æ‹Ÿåˆ"><a href="#å¦‚ä½•æ£€æµ‹è¿‡åº¦æ‹Ÿåˆ" class="headerlink" title="å¦‚ä½•æ£€æµ‹è¿‡åº¦æ‹Ÿåˆ"></a>å¦‚ä½•æ£€æµ‹è¿‡åº¦æ‹Ÿåˆ</h3><ol><li><strong>è®­ç»ƒè¯¯å·®ä¸éªŒè¯è¯¯å·®</strong>ï¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œè§‚å¯Ÿè®­ç»ƒè¯¯å·®å’ŒéªŒè¯è¯¯å·®çš„å˜åŒ–ã€‚å¦‚æœè®­ç»ƒè¯¯å·®æŒç»­ä¸‹é™ï¼Œè€ŒéªŒè¯è¯¯å·®åœ¨æŸä¸ªç‚¹ä¹‹åå¼€å§‹ä¸Šå‡ï¼Œè¿™é€šå¸¸æ˜¯è¿‡åº¦æ‹Ÿåˆçš„ä¿¡å·ã€‚</li><li><strong>äº¤å‰éªŒè¯</strong>ï¼šä½¿ç”¨äº¤å‰éªŒè¯æŠ€æœ¯è¯„ä¼°æ¨¡å‹åœ¨å¤šä¸ªæ•°æ®å­é›†ä¸Šçš„è¡¨ç°ï¼Œé¿å…æ¨¡å‹å¯¹å•ä¸€è®­ç»ƒé›†çš„è¿‡åº¦ä¾èµ–ã€‚</li><li><strong>å­¦ä¹ æ›²çº¿</strong>ï¼šç»˜åˆ¶å­¦ä¹ æ›²çº¿ï¼ˆè®­ç»ƒè¯¯å·®å’ŒéªŒè¯è¯¯å·®éšè®­ç»ƒæ ·æœ¬æ•°é‡å˜åŒ–çš„æ›²çº¿ï¼‰ï¼Œåˆ†ææ¨¡å‹çš„å­¦ä¹ è¡Œä¸ºã€‚</li></ol><h3 id="è§£å†³è¿‡åº¦æ‹Ÿåˆçš„æ–¹æ³•"><a href="#è§£å†³è¿‡åº¦æ‹Ÿåˆçš„æ–¹æ³•" class="headerlink" title="è§£å†³è¿‡åº¦æ‹Ÿåˆçš„æ–¹æ³•"></a>è§£å†³è¿‡åº¦æ‹Ÿåˆçš„æ–¹æ³•</h3><ol><li><strong>å¢åŠ è®­ç»ƒæ•°æ®</strong>ï¼šé€šè¿‡å¢åŠ è®­ç»ƒæ•°æ®é‡ï¼Œæ¨¡å‹å¯ä»¥æ›´å¥½åœ°å­¦ä¹ æ•°æ®çš„çœŸå®åˆ†å¸ƒï¼Œå‡å°‘å¯¹å™ªå£°çš„æ‹Ÿåˆã€‚</li><li><strong>ç®€åŒ–æ¨¡å‹</strong>ï¼šå‡å°‘æ¨¡å‹çš„å‚æ•°æ•°é‡æˆ–é€‰æ‹©æ›´ç®€å•çš„æ¨¡å‹ï¼Œé¿å…è¿‡åº¦æ‹Ÿåˆã€‚</li><li><strong>æ­£åˆ™åŒ–</strong>ï¼šä½¿ç”¨æ­£åˆ™åŒ–æŠ€æœ¯ï¼ˆå¦‚L1å’ŒL2æ­£åˆ™åŒ–ï¼‰æ¥çº¦æŸæ¨¡å‹å‚æ•°ï¼Œä½¿å…¶æ›´å¹³æ»‘ï¼Œå‡å°‘å¯¹è®­ç»ƒæ•°æ®çš„è¿‡åº¦æ‹Ÿåˆã€‚<ul><li><strong>L1æ­£åˆ™åŒ–</strong>ï¼šé€šè¿‡å¯¹æ¨¡å‹å‚æ•°çš„ç»å¯¹å€¼æ±‚å’Œï¼Œä½¿éƒ¨åˆ†å‚æ•°å˜ä¸ºé›¶ï¼Œèµ·åˆ°ç‰¹å¾é€‰æ‹©çš„ä½œç”¨ã€‚</li><li><strong>L2æ­£åˆ™åŒ–</strong>ï¼šé€šè¿‡å¯¹æ¨¡å‹å‚æ•°çš„å¹³æ–¹å’Œè¿›è¡Œçº¦æŸï¼Œä½¿å‚æ•°å€¼å°½å¯èƒ½å°ï¼Œä»è€Œä½¿æ¨¡å‹æ›´å¹³æ»‘ã€‚</li></ul></li><li><strong>Dropout</strong>ï¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­éšæœºä¸¢å¼ƒä¸€éƒ¨åˆ†ç¥ç»å…ƒï¼Œé˜²æ­¢æ¨¡å‹å¯¹æŸäº›è·¯å¾„çš„è¿‡åº¦ä¾èµ–ã€‚</li><li><strong>æ•°æ®å¢å¼º</strong>ï¼šé€šè¿‡å¯¹è®­ç»ƒæ•°æ®è¿›è¡Œæ—‹è½¬ã€ç¼©æ”¾ã€è£å‰ªç­‰å˜æ¢ï¼Œç”Ÿæˆæ›´å¤šçš„è®­ç»ƒæ ·æœ¬ï¼Œå¢åŠ æ•°æ®çš„å¤šæ ·æ€§ã€‚</li><li><strong>æ—©åœæ³•ï¼ˆEarly Stoppingï¼‰</strong>ï¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ç›‘æ§éªŒè¯è¯¯å·®ï¼Œå½“éªŒè¯è¯¯å·®ä¸å†ä¸‹é™æ—¶ï¼Œæå‰åœæ­¢è®­ç»ƒï¼Œé˜²æ­¢æ¨¡å‹è¿‡åº¦æ‹Ÿåˆã€‚<h1 id="11-æ³›åŒ–èƒ½åŠ›"><a href="#11-æ³›åŒ–èƒ½åŠ›" class="headerlink" title="11. æ³›åŒ–èƒ½åŠ›"></a>11. æ³›åŒ–èƒ½åŠ›</h1>æ³›åŒ–èƒ½åŠ›ï¼ˆGeneralizationï¼‰æ˜¯æŒ‡æœºå™¨å­¦ä¹ æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä»¥å¤–çš„æ•°æ®ï¼ˆé€šå¸¸æ˜¯æœªè§è¿‡çš„æµ‹è¯•æ•°æ®æˆ–çœŸå®åº”ç”¨ä¸­çš„æ•°æ®ï¼‰ä¸Šè¡¨ç°è‰¯å¥½çš„èƒ½åŠ›ã€‚å®ƒåæ˜ äº†æ¨¡å‹å¯¹æ•°æ®çš„æ™®éè§„å¾‹çš„å­¦ä¹ ç¨‹åº¦ï¼Œè€Œä¸æ˜¯å¯¹è®­ç»ƒæ•°æ®çš„è®°å¿†ç¨‹åº¦ã€‚</li></ol><p>ä¸€ä¸ªå…·æœ‰è‰¯å¥½æ³›åŒ–èƒ½åŠ›çš„æ¨¡å‹èƒ½å¤Ÿæœ‰æ•ˆåœ°ä»è®­ç»ƒæ•°æ®ä¸­å­¦ä¹ åˆ°æ½œåœ¨çš„è§„å¾‹ï¼Œå¹¶å°†è¿™äº›è§„å¾‹åº”ç”¨äºæ–°æ•°æ®ä¸Šï¼Œä»è€Œåœ¨å®é™…åº”ç”¨ä¸­ä¿æŒé«˜æ•ˆå’Œå‡†ç¡®çš„è¡¨ç°ã€‚</p><p>ç†è§£æ³›åŒ–èƒ½åŠ›éœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ol><li>è®­ç»ƒè¯¯å·®å’Œæµ‹è¯•è¯¯å·®<br>å¦‚æœæ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šçš„è¯¯å·®å¾ˆä½ï¼Œä½†åœ¨æµ‹è¯•æ•°æ®ä¸Šçš„è¯¯å·®å¾ˆé«˜ï¼Œè¿™é€šå¸¸è¡¨æ˜æ¨¡å‹è¿‡åº¦æ‹Ÿåˆï¼ˆOverfittingï¼‰ã€‚ç›¸åï¼Œå¦‚æœæ¨¡å‹åœ¨è®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®ä¸Šçš„è¯¯å·®éƒ½è¾ƒä½ï¼Œè¿™è¡¨æ˜æ¨¡å‹å…·æœ‰è‰¯å¥½çš„æ³›åŒ–èƒ½åŠ›ã€‚</li><li>æ¨¡å‹å¤æ‚åº¦<ul><li><strong>ç®€å•æ¨¡å‹</strong>ï¼šæ¨¡å‹å¤æ‚åº¦ä½ï¼Œå‚æ•°è¾ƒå°‘ï¼Œå®¹æ˜“æ¬ æ‹Ÿåˆï¼ˆUnderfittingï¼‰ï¼Œå³æ— æ³•å……åˆ†æ•æ‰æ•°æ®ä¸­çš„è§„å¾‹ã€‚</li><li><strong>å¤æ‚æ¨¡å‹</strong>ï¼šæ¨¡å‹å¤æ‚åº¦é«˜ï¼Œå‚æ•°è¾ƒå¤šï¼Œå®¹æ˜“è¿‡åº¦æ‹Ÿåˆï¼Œå³æ•æ‰äº†è®­ç»ƒæ•°æ®ä¸­çš„å™ªå£°å’Œå¶ç„¶æ¨¡å¼ã€‚<br>ä¸€ä¸ªå…·æœ‰è‰¯å¥½æ³›åŒ–èƒ½åŠ›çš„æ¨¡å‹åº”åœ¨ç®€å•å’Œå¤æ‚ä¹‹é—´å–å¾—å¹³è¡¡ï¼Œæ—¢èƒ½æ•æ‰æ•°æ®çš„æ½œåœ¨è§„å¾‹ï¼Œåˆä¸è¿‡åº¦æ‹Ÿåˆå™ªå£°ã€‚</li></ul></li></ol><h1 id="12æ­£åˆ™åŒ–"><a href="#12-æ­£åˆ™åŒ–" class="headerlink" title="12.æ­£åˆ™åŒ–"></a>12.æ­£åˆ™åŒ–</h1><p>æ­£åˆ™åŒ–ï¼ˆRegularizationï¼‰æ˜¯ä¸€ç§åœ¨æœºå™¨å­¦ä¹ å’Œç»Ÿè®¡å­¦ä¸­ç”¨äºé˜²æ­¢æ¨¡å‹è¿‡æ‹Ÿåˆï¼ˆoverfittingï¼‰çš„æŠ€æœ¯,æé«˜æ¨¡å‹æ³›åŒ–èƒ½åŠ›çš„å…³é”®æŠ€æœ¯ã€‚</p><h4 id="æ­£åˆ™åŒ–çš„ç±»å‹"><a href="#æ­£åˆ™åŒ–çš„ç±»å‹" class="headerlink" title="æ­£åˆ™åŒ–çš„ç±»å‹"></a>æ­£åˆ™åŒ–çš„ç±»å‹</h4><ol><li>L1 æ­£åˆ™åŒ–ï¼ˆLasso æ­£åˆ™åŒ–ï¼‰*<ul><li>å®šä¹‰ï¼šåœ¨æŸå¤±å‡½æ•°ä¸­æ·»åŠ æ‰€æœ‰æ¨¡å‹å‚æ•°ç»å¯¹å€¼çš„å’Œã€‚</li><li>æ•°å­¦è¡¨è¾¾ï¼š $\text{Loss} = \text{Original Loss} + \lambda \sum |w_i|$</li><li>ç‰¹ç‚¹ï¼šå¯ä»¥å¯¼è‡´ä¸€äº›å‚æ•°å®Œå…¨ä¸ºé›¶ï¼Œèµ·åˆ°ç‰¹å¾é€‰æ‹©çš„ä½œç”¨ã€‚</li></ul></li><li>L2 æ­£åˆ™åŒ–ï¼ˆRidge æ­£åˆ™åŒ–ï¼‰ï¼š<ul><li><strong>å®šä¹‰</strong>ï¼šåœ¨æŸå¤±å‡½æ•°ä¸­æ·»åŠ æ‰€æœ‰æ¨¡å‹å‚æ•°å¹³æ–¹å’Œã€‚</li><li><strong>æ•°å­¦è¡¨è¾¾</strong>ï¼š $\text{Loss} = \text{Original Loss} + \lambda \sum w_i^2$</li><li><strong>ç‰¹ç‚¹</strong>ï¼šå¯ä»¥é˜²æ­¢å‚æ•°å˜å¾—è¿‡å¤§ï¼Œä½†ä¸ä¼šä½¿å‚æ•°å®Œå…¨ä¸ºé›¶ã€‚</li></ul></li><li><strong>å¼¹æ€§ç½‘ç»œï¼ˆElastic Netï¼‰æ­£åˆ™åŒ–</strong>ï¼š<ul><li><strong>å®šä¹‰</strong>ï¼šç»“åˆ L1 å’Œ L2 æ­£åˆ™åŒ–ã€‚</li><li><strong>æ•°å­¦è¡¨è¾¾</strong>ï¼š$\text{Loss} = \text{Original Loss} + \lambda_1 \sum |w_i| + \lambda_2 \sum w_i^2$</li><li><strong>ç‰¹ç‚¹</strong>ï¼šç»“åˆäº† L1 å’Œ L2 çš„ä¼˜ç‚¹ï¼Œæ—¢å¯ä»¥é€‰æ‹©ç‰¹å¾åˆå¯ä»¥é˜²æ­¢å‚æ•°è¿‡å¤§ã€‚</li></ul></li><li><strong>Dropout æ­£åˆ™åŒ–</strong>ï¼š<ul><li><strong>å®šä¹‰</strong>ï¼šåœ¨æ¯æ¬¡è®­ç»ƒæ—¶éšæœºä¸¢å¼ƒä¸€éƒ¨åˆ†ç¥ç»å…ƒï¼Œä½¿å¾—æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¸ä¼šè¿‡äºä¾èµ–æŸäº›ç‰¹å®šçš„ç¥ç»å…ƒã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šé€šè¿‡åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¼•å…¥éšæœºæ€§ï¼Œå¢å¼ºæ¨¡å‹çš„é²æ£’æ€§ã€‚</li></ul></li></ol><h4 id="æ­£åˆ™åŒ–çš„åŸç†"><a href="#æ­£åˆ™åŒ–çš„åŸç†" class="headerlink" title="æ­£åˆ™åŒ–çš„åŸç†"></a>æ­£åˆ™åŒ–çš„åŸç†</h4><ul><li><strong>å¤æ‚åº¦æƒ©ç½š</strong>ï¼šé€šè¿‡å‘æŸå¤±å‡½æ•°ä¸­æ·»åŠ ä¸€ä¸ªè¡¨ç¤ºæ¨¡å‹å¤æ‚åº¦çš„é¡¹ï¼Œæ¨¡å‹åœ¨è®­ç»ƒæ—¶ä¸ä»…è¦æœ€å°åŒ–åŸå§‹æŸå¤±å‡½æ•°ï¼Œè¿˜è¦è€ƒè™‘æ¨¡å‹çš„å¤æ‚åº¦ã€‚</li><li><strong>å‚æ•°çº¦æŸ</strong>ï¼šé™åˆ¶æ¨¡å‹å‚æ•°çš„å¤§å°æˆ–æ•°é‡ï¼Œé˜²æ­¢æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šè¿‡åº¦æ‹Ÿåˆã€‚</li><li><strong>å¢å¼ºæ³›åŒ–èƒ½åŠ›</strong>ï¼šé€šè¿‡æ§åˆ¶æ¨¡å‹çš„å¤æ‚åº¦ï¼Œæå‡æ¨¡å‹åœ¨æœªè§æ•°æ®ä¸Šçš„è¡¨ç°ã€‚</li></ul><h4 id="æ­£åˆ™åŒ–åœ¨æ¨¡å‹ä¸­çš„åº”ç”¨"><a href="#æ­£åˆ™åŒ–åœ¨æ¨¡å‹ä¸­çš„åº”ç”¨" class="headerlink" title="æ­£åˆ™åŒ–åœ¨æ¨¡å‹ä¸­çš„åº”ç”¨"></a>æ­£åˆ™åŒ–åœ¨æ¨¡å‹ä¸­çš„åº”ç”¨</h4><p>æ­£åˆ™åŒ–æŠ€æœ¯åœ¨è®¸å¤šæœºå™¨å­¦ä¹ æ¨¡å‹ä¸­åº”ç”¨å¹¿æ³›ï¼ŒåŒ…æ‹¬çº¿æ€§å›å½’ã€é€»è¾‘å›å½’ã€æ”¯æŒå‘é‡æœºï¼ˆSVMï¼‰ã€ç¥ç»ç½‘ç»œç­‰ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ­£åˆ™åŒ–å‚æ•°ï¼ˆå¦‚ Î»\lambdaÎ»ï¼‰é€šå¸¸éœ€è¦é€šè¿‡äº¤å‰éªŒè¯ç­‰æ–¹æ³•è¿›è¡Œè°ƒä¼˜ï¼Œä»¥è·å¾—æœ€ä½³çš„æ¨¡å‹æ€§èƒ½ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0-ä»€ä¹ˆæ˜¯ç¥ç»ç½‘ç»œ-neural-networks&quot;&gt;&lt;a href=&quot;#0-ä»€ä¹ˆæ˜¯ç¥ç»ç½‘ç»œ-Neural-Networks&quot; class=&quot;headerlink&quot; title=&quot;0. ä»€ä¹ˆæ˜¯ç¥ç»ç½‘ç»œ (Neural Networks)&quot;&gt;&lt;/a&gt;0. ä»€ä¹ˆæ˜¯ç¥ç»</summary>
      
    
    
    
    
    <category term="AI" scheme="http://example.com/tags/AI/"/>
    
    <category term="ç¥ç»ç½‘ç»œ" scheme="http://example.com/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
    
    <category term="Ilya sutskeverâ€˜s 30  papers" scheme="http://example.com/tags/Ilya-sutskever%E2%80%98s-30-papers/"/>
    
  </entry>
  
  <entry>
    <title>Ilya sutskever&#39;s approx 30 research papers about AI</title>
    <link href="http://example.com/17f5a37e/"/>
    <id>http://example.com/17f5a37e/</id>
    <published>2024-06-07T09:13:13.000Z</published>
    <updated>2024-06-16T14:27:01.519Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰æ— æ„ä¸­åˆ·åˆ°è¿™ä¸ª<a href="https://x.com/keshavchan/status/1787861946173186062?utm_source=www.mattprd.com&amp;utm_medium=referral&amp;utm_campaign=openai-cofounder-the-27-papers-to-read-to-know-90-about-ai">twitter</a>,  æœ‰ç‚¹å¥½å¥‡è¿™30ç¯‡paper åˆ°åº•è®²äº†å•¥ï¼Œå­¦å®Œåˆ°åº•èƒ½çŸ¥é“ä»€ä¹ˆï¼Œæ‰€ä»¥å†³å®šè¯»ä¸€è¯»ã€‚</p><img src="/17f5a37e/1.png" class><h1 id="å¦‚ä½•è¯»"><a href="#å¦‚ä½•è¯»" class="headerlink" title="å¦‚ä½•è¯»"></a>å¦‚ä½•è¯»</h1><p>ä½œä¸ºä¸€ä¸ªç®—æ³•å’ŒAIå°ç™½,  çœŸçš„å­¦ä¼šåœ¨ä»Šå¤©90%å…³äºAI çš„å†…å®¹æœ‰ç‚¹è¶…å‡ºèƒ½åŠ›èŒƒç•´ï¼Œ æ‰€ä»¥æˆ‘çš„ç›®æ ‡æ˜¯è¯»æ‡‚è¿™äº›paperçš„æ–‡æœ¬å†…å®¹ï¼Œå»ºç«‹ä¸€ä¸ªæ•´ä½“çš„å¤§æ¡†æ¶å³å¯ã€‚</p><p>ä¾ç„¶å¯¹äºä¸€ä¸ªç®—æ³•å’ŒAIå°ç™½æ¥è¯´ï¼Œç›´æ¥é˜…è¯»paper,ã€ä¼šé‡åˆ°å¤§é‡è¯»ä¸æ‡‚çš„æ¦‚å¿µï¼Œ éœ€è¦æŸ¥è¯¢ç›¸å…³èµ„æ–™ï¼Œæˆ‘è§‰å¾—å¦‚æœä½ ä¹Ÿæ˜¯å°ç™½åŒæ—¶ä¹Ÿå¯¹è¿™äº›paper æ„Ÿå…´è¶£çš„è¯ï¼Œæˆ‘æŸ¥è¯¢çš„èµ„æ–™å’Œé˜…è¯»è¿‡ç¨‹å¯¹ä½ ä¹Ÿä¼šæœ‰å¸®åŠ©ï¼Œæ‰€ä»¥æˆ‘ä¼šæŠŠè¿™äº›å†…å®¹éƒ½è®°å½•ä¸‹æ¥ï¼Œä¾›ä½ å‚è€ƒã€‚</p><h1 id="é˜…è¯»è®°å½•"><a href="#é˜…è¯»è®°å½•" class="headerlink" title="é˜…è¯»è®°å½•"></a>é˜…è¯»è®°å½•</h1><p><a href="https://sunyan.xyz/f27811be/">ç¥ç»ç½‘ç»œï¼ˆNeural Networksï¼‰</a></p><p><a href="https://sunyan.xyz/6ac941eb/">é€’å½’ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural Networks, RNNsï¼‰</a></p><p><a href="https://sunyan.xyz/2472be8a/">The Unreasonable Effectiveness of Recurrent Neural Networks</a></p><p><a href="https://sunyan.xyz/4579c6a3/">Understanding LSTM Networks</a></p><p><a href="https://sunyan.xyz/7057a5e3/">RECURRENT NEURAL NETWORK REGULARIZATION</a>)</p><h1 id="30-research-papers"><a href="#30-research-papers" class="headerlink" title="30 research papers"></a>30 research papers</h1><p><a href="https://arc.net/folder/D0472A20-9C20-4D3F-B145-D2865C0A9FEE">https://arc.net/folder/D0472A20-9C20-4D3F-B145-D2865C0A9FEE</a></p><ol><li>The Annotated Transformer<br>ç®€ä»‹ï¼šTransformer æ¨¡å‹æ³¨é‡Šç‰ˆï¼Œè¯¦ç»†è§£æäº† Transformer æ¨¡å‹çš„å†…éƒ¨ç»“æ„å’Œå·¥ä½œåŸç†ã€‚æ¨èç†ç”±ï¼šç†è§£ç°ä»£ NLP æ¨¡å‹çš„åŸºç¡€ã€‚</li><li>The First Law of Complexodynamics<br>ç®€ä»‹ï¼šæ¢è®¨äº†å¤æ‚åŠ¨åŠ›å­¦çš„ç¬¬ä¸€å®šå¾‹ï¼Œè§£é‡Šäº†å¤æ‚ç³»ç»Ÿçš„æ¼”å˜è§„å¾‹ã€‚æ¨èç†ç”±ï¼šæä¾›äº†å…³äºå¤æ‚ç³»ç»Ÿçš„ä¸€äº›ç†è®ºåŸºç¡€ã€‚</li><li>The Unreasonable Effectiveness of Recurrent Neural Networks<br>ç®€ä»‹ï¼šè®¨è®ºäº† RNN åœ¨å¤„ç†åºåˆ—æ•°æ®æ—¶çš„æœ‰æ•ˆæ€§ã€‚æ¨èç†ç”±ï¼šå¸®åŠ©ç†è§£ RNN çš„åº”ç”¨å’Œä¼˜åŠ¿ã€‚</li><li>Understanding LSTM Networks<br>ç®€ä»‹ï¼šè¯¦ç»†ä»‹ç»äº† LSTM ç½‘ç»œçš„ç»“æ„å’ŒåŠŸèƒ½ã€‚æ¨èç†ç”±ï¼šLSTM æ˜¯ RNN çš„é‡è¦å˜ç§ï¼Œå¹¿æ³›åº”ç”¨äºåºåˆ—æ•°æ®å¤„ç†ã€‚</li><li>Recurrent Neural Network Regulation<br>ç®€ä»‹ï¼šæ¢è®¨äº† RNN çš„æ­£åˆ™åŒ–æ–¹æ³•ã€‚æ¨èç†ç”±ï¼šæ­£åˆ™åŒ–æ˜¯æé«˜æ¨¡å‹æ³›åŒ–èƒ½åŠ›çš„é‡è¦æ‰‹æ®µã€‚</li><li>Keeping Neural Networks Simple by Minimizing the Description Length of the Weights<br>ç®€ä»‹ï¼šé€šè¿‡æœ€å°åŒ–æƒé‡æè¿°é•¿åº¦æ¥ç®€åŒ–ç¥ç»ç½‘ç»œã€‚æ¨èç†ç”±ï¼šæä¾›äº†ä¸€ç§ç®€åŒ–æ¨¡å‹çš„æ–¹æ³•ï¼Œæå‡æ¨¡å‹çš„è§£é‡Šæ€§ã€‚</li><li>Pointer Networks<br>ç®€ä»‹ï¼šä»‹ç»äº†æŒ‡é’ˆç½‘ç»œåŠå…¶åœ¨å¤„ç†ç¦»æ•£åºåˆ—é—®é¢˜ä¸Šçš„åº”ç”¨ã€‚æ¨èç†ç”±ï¼šæ‹“å±•äº†å¯¹åºåˆ—æ¨¡å‹çš„è®¤è¯†ã€‚</li><li>ImageNet Classification with Deep Convolutional Neural Networks<br>ç®€ä»‹ï¼šæ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œåœ¨ ImageNet åˆ†ç±»ä¸Šçš„åº”ç”¨ã€‚æ¨èç†ç”±ï¼šç»å…¸è®ºæ–‡ï¼Œæ¨åŠ¨äº†æ·±åº¦å­¦ä¹ åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸçš„é©å‘½ã€‚</li><li><p>Order Matters: Sequence to Sequence for Sets<br>ç®€ä»‹ï¼šè®¨è®ºäº†é¡ºåºåœ¨åºåˆ—åˆ°åºåˆ—æ¨¡å‹ä¸­çš„é‡è¦æ€§ã€‚æ¨èç†ç”±ï¼šæä¾›äº†å¯¹åºåˆ—æ¨¡å‹çš„æ·±åˆ»ç†è§£ã€‚</p></li><li><p>GPipe: Easy Scaling with Micro-Batch Pipeline Parallelism<br>ç®€ä»‹ï¼šä»‹ç»äº†é€šè¿‡å¾®æ‰¹æ¬¡æµæ°´çº¿å¹¶è¡Œå®ç°æ¨¡å‹æ‰©å±•çš„æ–¹æ³•ã€‚æ¨èç†ç”±ï¼šè§£å†³å¤§è§„æ¨¡æ¨¡å‹è®­ç»ƒçš„ç“¶é¢ˆé—®é¢˜ã€‚</p></li><li>Deep Residual Learning for Image Recognition<br>ç®€ä»‹ï¼šæ·±åº¦æ®‹å·®å­¦ä¹ åœ¨å›¾åƒè¯†åˆ«ä¸­çš„åº”ç”¨ã€‚æ¨èç†ç”±ï¼šæ®‹å·®ç½‘ç»œæ˜¯æ·±åº¦å­¦ä¹ çš„ä¸€å¤§çªç ´ã€‚</li><li>Multi-Scale Context Aggregation by Dilated Convolutions<br>ç®€ä»‹ï¼šé€šè¿‡è†¨èƒ€å·ç§¯å®ç°å¤šå°ºåº¦ä¸Šä¸‹æ–‡èšåˆã€‚æ¨èç†ç”±ï¼šåœ¨å¤„ç†å›¾åƒå’Œä¿¡å·æ—¶çš„æœ‰æ•ˆæ–¹æ³•ã€‚</li><li>Neural Message Passing for Quantum Chemistry<br>ç®€ä»‹ï¼šç¥ç»æ¶ˆæ¯ä¼ é€’åœ¨é‡å­åŒ–å­¦ä¸­çš„åº”ç”¨ã€‚æ¨èç†ç”±ï¼šå±•ç¤ºäº†ç¥ç»ç½‘ç»œåœ¨ç§‘å­¦è®¡ç®—ä¸­çš„æ½œåŠ›ã€‚</li><li>Attention Is All You Need<br>ç®€ä»‹ï¼šTransformer æ¨¡å‹çš„å¥ åŸºè®ºæ–‡ï¼Œæå‡ºäº†æ³¨æ„åŠ›æœºåˆ¶ã€‚æ¨èç†ç”±ï¼šç°ä»£ NLP æ¨¡å‹çš„åŸºçŸ³ã€‚</li><li>Neural Machine Translation By Jointly Learning To Align And Translate<br>ç®€ä»‹ï¼šé€šè¿‡è”åˆå­¦ä¹ å¯¹é½å’Œç¿»è¯‘çš„ç¥ç»æœºå™¨ç¿»è¯‘æ–¹æ³•ã€‚æ¨èç†ç”±ï¼šNMT çš„é‡è¦å‘å±•ã€‚</li><li>Identity Mappings in Deep Residual Networks<br>ç®€ä»‹ï¼šæ®‹å·®ç½‘ç»œä¸­çš„æ’ç­‰æ˜ å°„ã€‚æ¨èç†ç”±ï¼šå¸®åŠ©ç†è§£æ·±åº¦ç½‘ç»œçš„è®­ç»ƒã€‚</li><li>A simple neural network module for relational reasoning<br>ç®€ä»‹ï¼šç”¨äºå…³ç³»æ¨ç†çš„ç®€å•ç¥ç»ç½‘ç»œæ¨¡å—ã€‚æ¨èç†ç”±ï¼šå¢å¼ºæ¨¡å‹çš„æ¨ç†èƒ½åŠ›ã€‚</li><li>Variational Lossy Autoencoder<br>ç®€ä»‹ï¼šå˜åˆ†æœ‰æŸè‡ªç¼–ç å™¨çš„ä»‹ç»ã€‚æ¨èç†ç”±ï¼šæä¾›äº†ä¸€ç§æ–°é¢–çš„ç”Ÿæˆæ¨¡å‹ã€‚</li><li>Relational recurrent neural networks<br>ç®€ä»‹ï¼šå…³ç³»é€’å½’ç¥ç»ç½‘ç»œã€‚æ¨èç†ç”±ï¼šç»“åˆå…³ç³»æ¨ç†å’Œåºåˆ—å»ºæ¨¡çš„ä¼˜åŠ¿ã€‚</li><li>Quantifying the Rise and Fall of Complexity in Closed Systems: The Coffee Automaton<br>ç®€ä»‹ï¼šå®šé‡åˆ†æå°é—­ç³»ç»Ÿä¸­å¤æ‚æ€§çš„å…´è¡°ã€‚æ¨èç†ç”±ï¼šç†è®ºæ€§å¼ºï¼Œæœ‰åŠ©äºç†è§£å¤æ‚ç³»ç»Ÿã€‚</li><li>Neural Turing Machines<br>ç®€ä»‹ï¼šç¥ç»å›¾çµæœºçš„æ¦‚å¿µå’Œåº”ç”¨ã€‚æ¨èç†ç”±ï¼šè¿æ¥ç¥ç»ç½‘ç»œå’Œè®¡ç®—ç†è®ºçš„é‡è¦å·¥ä½œã€‚</li><li>Deep Speech 2: End-to-End Speech Recognition in English and Mandarin<br>ç®€ä»‹ï¼šç«¯åˆ°ç«¯è¯­éŸ³è¯†åˆ«ç³»ç»Ÿ Deep Speech 2 çš„ä»‹ç»ã€‚æ¨èç†ç”±ï¼šè¯­éŸ³è¯†åˆ«é¢†åŸŸçš„é‡è¦è¿›å±•ã€‚</li><li>Scaling Laws for Neural Language Models<br>ç®€ä»‹ï¼šç¥ç»è¯­è¨€æ¨¡å‹çš„è§„æ¨¡æ³•åˆ™ã€‚æ¨èç†ç”±ï¼šå¸®åŠ©ç†è§£æ¨¡å‹æ‰©å±•çš„è§„å¾‹ã€‚</li><li>A Tutorial Introduction to the Minimum Description Length Principle<br>ç®€ä»‹ï¼šæœ€å°æè¿°é•¿åº¦åŸç†çš„æ•™ç¨‹ã€‚æ¨èç†ç”±ï¼šç†è®ºåŸºç¡€ï¼Œé€‚ç”¨äºå¤šç§æ¨¡å‹é€‰æ‹©é—®é¢˜ã€‚</li><li>Machine Super Intelligence<br>ç®€ä»‹ï¼šæœºå™¨è¶…çº§æ™ºèƒ½çš„è®¨è®ºã€‚æ¨èç†ç”±ï¼šæœªæ¥ AI å‘å±•çš„é‡è¦å‚è€ƒã€‚</li><li>Kolmogorov Complexity and Algorithmic Randomness<br>ç®€ä»‹ï¼šKolmogorov å¤æ‚æ€§å’Œç®—æ³•éšæœºæ€§çš„ä»‹ç»ã€‚æ¨èç†ç”±ï¼šè®¡ç®—å¤æ‚æ€§ç†è®ºçš„ç»å…¸ã€‚</li><li>CS231n Convolutional Neural Networks for Visual Recognition<br>ç®€ä»‹ï¼šCS231n è¯¾ç¨‹ç½‘ç«™ï¼ŒåŒ…å«å·ç§¯ç¥ç»ç½‘ç»œçš„è¯¦ç»†æ•™ç¨‹ã€‚æ¨èç†ç”±ï¼šå…¨é¢çš„å­¦ä¹ èµ„æºï¼Œé€‚åˆå…¥é—¨å’Œè¿›é˜¶å­¦ä¹ ã€‚</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä¹‹å‰æ— æ„ä¸­åˆ·åˆ°è¿™ä¸ª&lt;a href=&quot;https://x.com/keshavchan/status/1787861946173186062?utm_source=www.mattprd.com&amp;amp;utm_medium=referral&amp;amp;utm_campaign</summary>
      
    
    
    
    
    <category term="AI" scheme="http://example.com/tags/AI/"/>
    
    <category term="ç¥ç»ç½‘ç»œ" scheme="http://example.com/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
    
    <category term="Ilya sutskeverâ€˜s 30  papers" scheme="http://example.com/tags/Ilya-sutskever%E2%80%98s-30-papers/"/>
    
  </entry>
  
  <entry>
    <title>InnoDBäº‹åŠ¡-æŒä¹…æ€§çš„å®ç°,binglog &amp; redo log</title>
    <link href="http://example.com/6cb5dc64/"/>
    <id>http://example.com/6cb5dc64/</id>
    <published>2024-05-02T14:47:18.000Z</published>
    <updated>2024-05-10T15:24:50.204Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨MySQL InnoDB è¿™ä¸ªè¯­å¢ƒä¸‹ï¼Œ crash safeã€æ•°æ®ä¸ä¸¢å¤± éƒ½æŒ‡çš„æ˜¯äº‹åŠ¡çš„æŒä¹…æ€§ç‰¹æ€§ï¼Œå³äº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œåº”å½“ä¿è¯æ‰€æœ‰è¢«æˆåŠŸæäº¤çš„æ•°æ®ä¿®æ”¹éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°è¢«æŒä¹…åŒ–ï¼Œä¸ä¸¢å¤±æ•°æ®, å³ä½¿å®•æœºä¹Ÿèƒ½å¤Ÿæ¢å¤æ•°æ®</p><p>åœ¨InnoDB ä¸­ï¼ŒæŒä¹…æ€§ åŸºäºbinlog å’Œredo log å®ç°ï¼Œ ä¸”binlog ä¸redo log çš„å†™å…¥é€šè¿‡2PC åè°ƒ.</p><h1 id="0-xa-äº‹åŠ¡binlog-å’Œredo-log-çš„ä¸¤é˜¶æ®µæäº¤"><a href="#0-XA-äº‹åŠ¡ï¼šbinlog-å’Œredo-log-çš„ä¸¤é˜¶æ®µæäº¤" class="headerlink" title="0 XA äº‹åŠ¡ï¼šbinlog å’Œredo log çš„ä¸¤é˜¶æ®µæäº¤"></a>0 XA äº‹åŠ¡ï¼šbinlog å’Œredo log çš„ä¸¤é˜¶æ®µæäº¤</h1><img src="/6cb5dc64/1.png" class><p>åœ¨MySQLä¸­ï¼ŒInnoDBå­˜å‚¨å¼•æ“ çš„ redo log å’ŒMySQLæœåŠ¡å™¨å±‚binlog ä¹‹é—´çš„ä¸€è‡´æ€§æ˜¯é€šè¿‡å†…éƒ¨çš„XAæœºåˆ¶ï¼ˆå³åˆ†å¸ƒå¼äº‹åŠ¡ï¼‰æ¥å®ç°çš„ï¼Œä»»ä½•ä¸€ä¸ªæ•°æ®å‡ºç°é—®é¢˜éƒ½ä¼šè¿›è¡Œä¼šæ»šã€‚</p><p><strong>XAäº‹åŠ¡</strong>æ˜¯ä¸€ç§åˆ†å¸ƒå¼äº‹åŠ¡ã€‚é€šè¿‡ä¸¤é˜¶æ®µæäº¤åè®®å’ŒXAæ¥å£æ ‡å‡†ï¼Œäº‹åŠ¡ç®¡ç†å™¨å’Œèµ„æºç®¡ç†å™¨èƒ½å¤Ÿå¯é åœ°ååŒå·¥ä½œï¼Œå®ç°è·¨ç³»ç»Ÿçš„äº‹åŠ¡å¤„ç†ï¼Œç¡®ä¿å¤šä¸ªç‹¬ç«‹èµ„æºçš„ä¸€è‡´æ€§ã€‚</p><p>åœ¨binlog å’Œredo log çš„ä¸¤é˜¶æ®µæäº¤ï¼Œ binlog å……å½“åè°ƒè€…çš„è§’è‰²ã€‚</p><p><a href="http://localhost:4000/5b064db6/">å…³äºXA äº‹åŠ¡å…·ä½“å¯åœ¨è¿™ç¯‡æ–‡ç« ä¸­æŸ¥çœ‹</a></p><p>binlog å’Œ redo log å„è‡ªå†™å…¥çš„è¿‡ç¨‹è¿˜æœ‰å¾ˆå¤šç»†èŠ‚ï¼Œæ¥ä¸‹æ¥è¿›è¡Œè®²è§£</p><h1 id="1-binlog"><a href="#1-binlog" class="headerlink" title="1 binlog"></a>1 binlog</h1><p>binlogæ˜¯ MySQL æœåŠ¡å™¨å±‚ä½¿ç”¨çš„æ—¥å¿—æ–‡ä»¶ï¼Œè®°å½•äº†æ‰€æœ‰ä¿®æ”¹æ•°æ®åº“å†…å®¹çš„SQLè¯­å¥ï¼ˆå¦‚ INSERT, UPDATE, DELETEï¼‰,ä¹Ÿè¢«ç§°ä¸ºé€»è¾‘æ—¥å¿—ã€‚</p><p>binlog ä¸»è¦ç”¨äºä¸»å¤‡å¤åˆ¶åŒæ­¥ã€å´©æºƒæ¢å¤ç­‰åŠŸèƒ½ã€‚</p><h2 id="11-binlog-çš„ä¸‰ç§æ—¥å¿—æ ¼å¼"><a href="#1-1-binlog-çš„ä¸‰ç§æ—¥å¿—æ ¼å¼" class="headerlink" title="1.1 binlog çš„ä¸‰ç§æ—¥å¿—æ ¼å¼"></a>1.1 binlog çš„ä¸‰ç§æ—¥å¿—æ ¼å¼</h2><div class="table-container"><table><thead><tr><th><strong>æ ¼å¼</strong></th><th><strong>å®šä¹‰</strong></th><th><strong>ä¼˜ç‚¹</strong></th><th><strong>ç¼ºç‚¹</strong></th></tr></thead><tbody><tr><td><strong>Statement-Based Logging (SBL)</strong></td><td>è®°å½•æ‰§è¡Œçš„ SQL è¯­å¥æœ¬èº«ï¼Œè€Œä¸æ˜¯æ¯è¡Œæ•°æ®çš„å˜æ›´ã€‚</td><td>1. <strong>ç©ºé—´æ•ˆç‡é«˜</strong>ï¼šé€šå¸¸å ç”¨æ›´å°‘çš„ç©ºé—´ï¼Œå› ä¸ºè®°å½•çš„æ˜¯ SQL è¯­å¥ã€‚ <br>2. <strong>æ˜“äºå®¡è®¡</strong>ï¼šç›´æ¥è®°å½• SQL è¯­å¥ï¼Œæ˜“äºé˜…è¯»å’Œç†è§£ã€‚</td><td>1. <strong>éç¡®å®šæ€§è¡Œä¸º</strong>ï¼šå¯èƒ½åœ¨ä¸»ä»å¤åˆ¶ä¸­å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠåˆ°éç¡®å®šæ€§å‡½æ•°ï¼ˆå¦‚ NOW()ã€RAND()ï¼‰çš„ SQL è¯­å¥ã€‚<br>2. <strong>å¤åˆ¶é”™è¯¯</strong>ï¼šæŸäº›ç‰¹å®šæƒ…å†µä¸‹å¯èƒ½å¼•èµ·ä»æœåŠ¡å™¨çš„å¤åˆ¶é”™è¯¯ã€‚</td></tr><tr><td><strong>Row-Based Logging (RBL)</strong></td><td>è®°å½•æ•°æ®å˜æ›´å‰åçš„æ¯è¡Œæ•°æ®çš„å…·ä½“å˜åŒ–ï¼Œè€Œä¸æ˜¯æ‰§è¡Œçš„ SQL è¯­å¥ã€‚</td><td>1. <strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šåœ¨å¤åˆ¶è¿‡ç¨‹ä¸­æä¾›é«˜åº¦çš„æ•°æ®ä¸€è‡´æ€§ã€‚<br>2. <strong>å®‰å…¨æ€§æ›´é«˜</strong>ï¼šä¸è®°å½• SQL è¯­å¥ï¼Œé™ä½äº† SQL æ³¨å…¥çš„é£é™©ã€‚</td><td>1. <strong>ç©ºé—´å ç”¨å¤§</strong>ï¼šå› ä¸ºè®°å½•äº†æ¯ä¸€è¡Œçš„å˜åŒ–ï¼Œå¯èƒ½å¯¼è‡´ binlog æ–‡ä»¶è¿…é€Ÿå¢å¤§ã€‚<br>2. <strong>å¯è¯»æ€§å·®</strong>ï¼šä¸è®°å½• SQL è¯­å¥ï¼Œå¯¹äºäººç±»å®¡è®¡ä¸å‹å¥½ã€‚</td></tr><tr><td><strong>Mixed-Based Logging (MBL)</strong></td><td>ç»“åˆäº† SBL å’Œ RBL çš„ç‰¹ç‚¹ï¼Œæ ¹æ®æ“ä½œçš„ç±»å‹è‡ªåŠ¨é€‰æ‹©ä½¿ç”¨åŸºäºè¯­å¥çš„æ ¼å¼æˆ–åŸºäºè¡Œçš„æ ¼å¼è®°å½•ã€‚</td><td>1. <strong>çµæ´»æ€§é«˜</strong>ï¼šæ ¹æ® SQL è¯­å¥çš„ç‰¹æ€§é€‰æ‹©æœ€åˆé€‚çš„æ—¥å¿—æ ¼å¼ã€‚<br>2. <strong>å¹³è¡¡æ€§èƒ½å’Œä¸€è‡´æ€§</strong>ï¼šåœ¨ç¡®ä¿æ•°æ®ä¸€è‡´æ€§çš„åŒæ—¶è€ƒè™‘æ—¥å¿—å¤§å°å’Œæ€§èƒ½ã€‚</td><td>1. <strong>é…ç½®å¤æ‚</strong>ï¼šéœ€è¦é€‚å½“é…ç½®ä»¥ç¡®ä¿æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚<br>2. <strong>é¢„æµ‹æ€§å·®</strong>ï¼šè‡ªåŠ¨åˆ‡æ¢æ—¥å¿—æ ¼å¼å¯èƒ½ä½¿å¾—æ—¥å¿—çš„ç»“æœéš¾ä»¥é¢„æµ‹ã€‚</td></tr></tbody></table></div><h2 id="12-binlogå†™å…¥è¿‡ç¨‹"><a href="#1-2-binlogå†™å…¥è¿‡ç¨‹" class="headerlink" title="1.2 binlogå†™å…¥è¿‡ç¨‹"></a>1.2 binlogå†™å…¥è¿‡ç¨‹</h2><p>binlog çš„å†™å…¥é€»è¾‘æ¯”è¾ƒç®€å•ï¼šäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ° binlog cacheï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå†æŠŠ binlog cache å†™åˆ° binlog æ–‡ä»¶ä¸­ã€‚</p><h3 id="121-binlog-cache"><a href="#1-2-1-binlog-cache" class="headerlink" title="1.2.1 binlog  cache"></a>1.2.1 binlog  cache</h3><p>å¯¹äºæ¯ä¸ªå®¢æˆ·ç«¯ä¼šè¯ï¼ŒMySQL æœåŠ¡å™¨ä¸ºå…¶åˆ†é…ä¸€ä¸ª binlog cacheã€‚è¿™ä¸ªç¼“å­˜æ˜¯ç”¨æ¥ä¸´æ—¶å­˜å‚¨ä¸€ä¸ªäº‹åŠ¡ä¸­äº§ç”Ÿçš„æ‰€æœ‰ binlog äº‹ä»¶ã€‚ ä½†æ˜¯binlog cache åˆ·æ–°åˆ°ç£ç›˜æ—¶ å¤šä¸ªçº¿ç¨‹æ˜¯å…±å†™åŒä¸€ä»½ binlog æ–‡ä»¶ã€‚</p><p>å½“ä¸€ä¸ªæ–°äº‹åŠ¡å¼€å§‹æ—¶ï¼Œæ ¹æ®binlog æ—¥å¿—æ ¼å¼è®°å½• æ¯ä¸ªä¿®æ”¹SQL  è¯­å¥åˆ°binlog cache ä¸­</p><h3 id="122-page-cache-ä¸-ç£ç›˜åˆ·æ–°æŒä¹…åŒ–"><a href="#1-2-2-page-cache-ä¸-ç£ç›˜åˆ·æ–°æŒä¹…åŒ–" class="headerlink" title="1.2.2  page cache ä¸ ç£ç›˜åˆ·æ–°æŒä¹…åŒ–"></a>1.2.2  page cache ä¸ ç£ç›˜åˆ·æ–°æŒä¹…åŒ–</h3><p>å½“äº‹åŠ¡åˆ°è¾¾æäº¤é˜¶æ®µæ—¶ï¼Œé¦–å…ˆå°† binlog  cache ä¸­çš„å†…å®¹ å†™å…¥åˆ°binlog æ–‡ä»¶ä¸­ï¼Œç„¶åæäº¤äº‹åŠ¡åˆ° InnoDBï¼Œå³ commit redo log ã€‚</p><p>æ³¨æ„ï¼Œè¿™é‡Œçš„å†™å…¥å¹¶ä¸æ˜¯ç›´æ¥å†™åˆ°åˆ°ç£ç›˜ï¼Œè€Œæ˜¯å…ˆå†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„page cache, ç„¶åé€šè¿‡<code>sync_binlog</code> å‚æ•°æ¥å†³å®š ä½•æ—¶æŠŠæ•°æ®å†™å…¥åˆ° ç£ç›˜ã€‚<br><img src="/6cb5dc64/2.png" class></p><p>ç£ç›˜åˆ·æ–°é¢‘ç‡é€šè¿‡ <code>sync_binlog</code> é…ç½®å‚æ•°ï¼Œ</p><ol><li>sync_binlog=0 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¸ä¸»åŠ¨åˆ·æ–°ç£ç›˜ï¼Œç”±æ–‡ä»¶ç³»ç»Ÿè‡ªå·±æ§åˆ¶åˆ·ç›˜é¢‘ç‡</li><li>sync_binlog=1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šå°† binlog cache ä¸­çš„å†…å®¹åˆ·æ–°åˆ°ç£ç›˜</li><li>sync_binlog=N(N&gt;1) çš„æ—¶å€™ï¼Œè¡¨ç¤ºç´¯ç§¯ N ä¸ªæäº¤äº‹åŠ¡åæ‰å°†å¤šä¸ªbinlog cacheä¸­çš„å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ã€‚</li></ol><p>å¯ä»¥çœ‹åˆ°å¦‚æœsync_binlogä¸è®¾ç½®ä¸º1 ï¼Œæœ‰æœ‰åŠ©äºæé«˜åˆ·ç›˜æ•ˆç‡ï¼Œ ä½†æ˜¯æœ‰ä¸¢å¤±binlog çš„é£é™©ã€‚</p><h3 id="123-binlog-cache-ä¸å¤Ÿç”¨æ€ä¹ˆåŠ"><a href="#1-2-3-binlog-cache-ä¸å¤Ÿç”¨æ€ä¹ˆåŠ" class="headerlink" title="1.2.3  binlog cache ä¸å¤Ÿç”¨æ€ä¹ˆåŠ"></a>1.2.3  binlog cache ä¸å¤Ÿç”¨æ€ä¹ˆåŠ</h3><p>å¦‚æœbinlog cache  å†™æ»¡äº†æ€ä¹ˆåŠï¼Ÿéœ€è¦æŠŠæ•°æ®æš‚å­˜åˆ°ç£ç›˜</p><p>æ¯ä¸ªäº‹åŠ¡çš„ binlog äº‹ä»¶é¦–å…ˆè¢«å†™å…¥åˆ° binlog cache ä¸­ï¼Œè¿™ä¸ªç¼“å­˜çš„å¤§å°ç”± <code>binlog_cache_size</code> ç³»ç»Ÿå˜é‡æ§åˆ¶ã€‚</p><p>å¦‚æœä¸€ä¸ªäº‹åŠ¡éå¸¸å¤§ï¼Œæ¶‰åŠå¤§é‡çš„æ•°æ®ä¿®æ”¹ï¼Œå¯¼è‡´binlog cacheä¸è¶³ä»¥å­˜å‚¨å½“å‰äº‹åŠ¡çš„æ‰€æœ‰äº‹ä»¶æ—¶ï¼ŒMySQLé‡‡ç”¨çš„å¤„ç†æœºåˆ¶æ˜¯å°†ç¼“å­˜ä¸­çš„æ•°æ®å†™å…¥åˆ°ç£ç›˜ä¸Šçš„ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ã€‚è¿™ä¸€è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>æ£€æµ‹ç¼“å­˜æº¢å‡º</strong>ï¼šå½“è¯•å›¾å‘binlog cacheä¸­å†™å…¥æ•°æ®ï¼Œè€Œç¼“å­˜ç©ºé—´ä¸è¶³ä»¥å®¹çº³æ›´å¤šæ•°æ®æ—¶ï¼Œå°†è§¦å‘æº¢å‡ºå¤„ç†æœºåˆ¶ã€‚</li><li><strong>æ•°æ®å†™å…¥ä¸´æ—¶æ–‡ä»¶</strong>ï¼šMySQLå°†å½“å‰binlog cacheä¸­çš„æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ã€‚è¿™ä¸ªä¸´æ—¶æ–‡ä»¶é€šå¸¸ä½äºMySQLçš„æ•°æ®ç›®å½•ä¸‹ï¼Œå…·æœ‰å”¯ä¸€æ ‡è¯†ï¼Œç¡®ä¿æ•°æ®çš„éš”ç¦»å’Œå®‰å…¨ã€‚</li><li><strong>æ¸…ç©ºbinlog cache</strong>ï¼šå°†æ•°æ®å†™å…¥ä¸´æ—¶æ–‡ä»¶åï¼Œbinlog cacheä¼šè¢«æ¸…ç©ºï¼Œä¸ºæ¥ä¸‹æ¥çš„æ—¥å¿—æ•°æ®è…¾å‡ºç©ºé—´ã€‚</li><li><strong>ç»§ç»­äº‹åŠ¡æ—¥å¿—çš„è®°å½•</strong>ï¼šäº‹åŠ¡ç»§ç»­æ‰§è¡Œï¼Œæ–°çš„æ—¥å¿—äº‹ä»¶ä¼šå†æ¬¡è¢«è®°å½•åˆ°ç°åœ¨å·²ç»è¢«æ¸…ç©ºçš„binlog cacheä¸­ã€‚</li><li><strong>äº‹åŠ¡æäº¤</strong>ï¼šäº‹åŠ¡å¦‚æœæœ€ç»ˆè¢«æäº¤ï¼ŒMySQLä¼šå°†ä¸´æ—¶æ–‡ä»¶ä¸­çš„æ—¥å¿—æ•°æ®ä»¥åŠç°åœ¨binlog cacheä¸­çš„æ•°æ®ä¸€å¹¶å†™å…¥åˆ°å…¨å±€çš„binlogæ–‡ä»¶ä¸­ã€‚å¦‚æœäº‹åŠ¡å›æ»šï¼Œåˆ™ä¸´æ—¶æ–‡ä»¶å’Œbinlog cacheä¸­çš„æ•°æ®éƒ½å°†è¢«ä¸¢å¼ƒã€‚</li></ol><h2 id="13-xid"><a href="#1-3-xid" class="headerlink" title="1.3  xid"></a>1.3  xid</h2><p>XIDï¼ˆTransaction Identifierï¼‰ å¯ä»¥ç†è§£æˆæ—¶MySQL server å±‚çš„äº‹åŠ¡å”¯ä¸€æ ‡è¯†ã€‚</p><ul><li>MySQLæœåŠ¡å™¨å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªå…¨å±€äº‹åŠ¡IDè®¡æ•°å™¨ï¼Œæ¯ä¸ªæ–°äº‹åŠ¡éƒ½ä¼šåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„IDã€‚è¯¥è®¡æ•°å™¨åœ¨å†…å­˜ä¸­é€’å¢ï¼Œä¿è¯æ¯ä¸ªäº‹åŠ¡IDåœ¨å®ä¾‹ä¸­æ˜¯å”¯ä¸€çš„ã€‚</li><li>å½“ä¸€ä¸ªæ–°äº‹åŠ¡å¼€å§‹æ—¶ï¼ŒMySQLæœåŠ¡å™¨å±‚ä¼šä»å…¨å±€è®¡æ•°å™¨ä¸­è·å–ä¸€ä¸ªæ–°çš„äº‹åŠ¡IDï¼Œå°†å…¶èµ‹äºˆè¯¥äº‹åŠ¡ï¼Œå¹¶å­˜å‚¨åœ¨è¯¥äº‹åŠ¡çš„ä¸Šä¸‹æ–‡ä¸­ã€‚</li></ul><h1 id="2-redo-log"><a href="#2-redo-log" class="headerlink" title="2  redo log"></a>2  redo log</h1><p>redo logæ˜¯ InnoDB å­˜å‚¨å¼•æ“ç‰¹æœ‰çš„æ—¥å¿—æ–‡ä»¶ï¼Œç”¨äºè®°å½•å¯¹æ•°æ®åº“åšå‡ºçš„æ›´æ”¹å‰çš„æ•°æ®é¡µçŠ¶æ€,ä¹Ÿè¢«ç§°ä½œç‰©ç†æ—¥å¿—ï¼Œç¡®ä¿åœ¨æ•°æ®åº“ç³»ç»Ÿå‘ç”Ÿå´©æºƒåèƒ½å¤Ÿæ¢å¤è¿™äº›æ›´æ”¹ã€‚<br><strong>è®°å½•å†…å®¹</strong>ï¼šRedo log è®°å½•çš„æ˜¯æ•°æ®é¡µä¿®æ”¹çš„ç‰©ç†æ“ä½œï¼Œè€Œéå…·ä½“çš„ SQL è¯­å¥ã€‚</p><ul><li><strong>å¾ªç¯ä½¿ç”¨</strong>ï¼šRedo log æ˜¯å›ºå®šå¤§å°çš„ï¼Œé€šå¸¸é…ç½®ä¸ºä¸€ç»„æ–‡ä»¶ï¼Œå·¥ä½œåœ¨å¾ªç¯å†™å…¥çš„æ–¹å¼ã€‚</li><li><strong>å´©æºƒæ¢å¤</strong>ï¼šç³»ç»Ÿé‡å¯åï¼ŒInnoDB é€šè¿‡å›æ”¾ redo log æ¥æ¢å¤æœªå®Œæˆçš„äº‹åŠ¡ï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚</li><li><strong>æé«˜æ€§èƒ½</strong>ï¼šRedo log å…è®¸ InnoDB åœ¨äº‹åŠ¡æäº¤æ—¶ä¸å¿…å°†æ‰€æœ‰æ•°æ®é¡µå†™å›ç£ç›˜ï¼Œåªéœ€ç¡®ä¿ redo log å·²è¢«å†™å…¥ç£ç›˜ã€‚</li><li>è®°å½•çš„æ˜¯æ•°æ®é¡µçš„ç‰©ç†ä¿®æ”¹ã€‚ ä¸è®ºæ•°æ®é¡µæ˜¯å¦åœ¨buffer pool ä¸­ï¼Œ redo log éƒ½è¦è®°å½•ä¿®æ”¹ï¼Œ å› ä¸ºä¸è®°ä¸èƒ½ä¿è¯crash safe.</li><li>ä¿å­˜è‡ªå¢å€¼</li></ul><h2 id="21-ä¸ºä»€ä¹ˆè¦è®°å½•redo-log"><a href="#2-1-ä¸ºä»€ä¹ˆè¦è®°å½•redo-log" class="headerlink" title="2.1 ä¸ºä»€ä¹ˆè¦è®°å½•redo log"></a>2.1 ä¸ºä»€ä¹ˆè¦è®°å½•redo log</h2><h3 id="211-buffer-pool"><a href="#2-1-1-buffer-pool" class="headerlink" title="2.1.1 buffer pool"></a>2.1.1 buffer pool</h3><p>MySQL ä¸ºäº†å®ç°é«˜æ€§èƒ½ï¼Œæ˜¯ä¸å¯èƒ½æ¯æ¬¡éƒ½ä»ç£ç›˜è¯»æ•°æ®æˆ–è€…æŠŠå¯¹æ•°æ®çš„ä¿®æ”¹æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šçš„,æ‰€ä»¥ InnoDB ç”³è¯·äº†ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œç”¨äºå­˜å‚¨ä»ç£ç›˜ä¸Šè¯»å–çš„pages, è¿™ä¸ªå†…å­˜å°±æ˜¯buffer poolã€‚</p><p>buffer pool æœ‰ä¸€å—å†…å­˜å«åšï¼Œchange buffer ç”¨äºæš‚å­˜å¯¹æ•°æ®çš„ä¿®æ”¹</p><img src="/6cb5dc64/3.png" class><p>é‚£ä¹ˆåœ¨ä¿®æ”¹æ•°æ®æ—¶ï¼Œå°±ä¼šé‡åˆ°ä¸¤ç§æƒ…å†µ</p><ol><li>æ•°æ®æ‰€åœ¨çš„page åœ¨buffer pool ä¸­ï¼Œ å°±ä¼šç›´æ¥æ›´æ–°page</li><li>æ•°æ®æ‰€åœ¨çš„page ä¸åœ¨buffer pool ä¸­ï¼Œ å¦‚æœä¸éœ€è¦åŠ è½½å¯¹åº”page, å°±ä¼šå…ˆæŠŠå¯¹æ•°æ®çš„ä¿®æ”¹å…ˆè®°åœ¨change buffer ä¸­</li></ol><p>ä¸è®ºæ˜¯buffer pool, è¿˜æ˜¯ buffer pool ä¸­çš„change buffer, éƒ½æ˜¯å†…å­˜ï¼Œä¸€æ—¦å‘ç”Ÿå®•æœºï¼Œé‚£å°±æ•°æ®çš„ä¿®æ”¹çš„ä¿®æ”¹å°±ä¼šä¸¢å¤±ï¼Œæ­¤æ—¶å°±è¿èƒŒäº†äº‹åŠ¡çš„æŒä¹…æ€§ã€‚</p><p>ä¸ºäº†èƒ½æŠŠä¿®æ”¹è¿‡çš„æ•°æ®æŒä¹…åŒ–åˆä¸å½±å“æ€§èƒ½ï¼ŒInnoDB ç»™å‡ºçš„æ–¹æ¡ˆæ˜¯ä¼˜å…ˆæŠŠä¿®æ”¹æ“ä½œè®°ä¸‹æ¥å¹¶æŒä¹…åŒ–ï¼Œ äº‹åŠ¡æäº¤åï¼Œä¸‡ä¸€å®•æœºä¸¢å¤±äº†buffer pool ä¸­å·²ä¿®æ”¹ä½†æ˜¯æœªæŒä¹…åŒ–çš„å†…å®¹ï¼Œå°±å¯ä»¥æ ¹æ®æŒä¹…åŒ–çš„ä¿®æ”¹æ“ä½œé‡æ–°å¾—åˆ°ä¿®æ”¹åæ•°æ®ã€‚</p><p>è¿™é‡Œè®°å½•ä¸‹æ¥çš„ä¿®æ”¹æ“ä½œå°±æ˜¯redo log,  è€Œè¿™ç§å…ˆè®°å½•ä¿®æ”¹æ“ä½œï¼Œå†è®°å½•ä¿®æ”¹åçš„æŠ€æœ¯å«åšWALã€‚</p><h3 id="212-wal"><a href="#2-1-2-WAL" class="headerlink" title="2.1.2 WAL"></a>2.1.2 WAL</h3><p>WALï¼ˆWrite-Ahead Loggingï¼‰æ˜¯ä¸€ç§åœ¨æ•°æ®åº“ç³»ç»Ÿä¸­å¹¿æ³›é‡‡ç”¨çš„æ—¥å¿—ç®¡ç†æŠ€æœ¯ï¼Œç”¨äºä¿è¯æ•°æ®åº“çš„äº‹åŠ¡æŒä¹…æ€§å’Œæ¢å¤èƒ½åŠ›ã€‚</p><p>å®ƒçš„å…³é”®ç‚¹å°±æ˜¯å…ˆå†™æ—¥å¿—ï¼Œå†å†™çœŸæ­£çš„æ•°æ®ã€‚</p><p>redo log ç›´æ¥åº”ç”¨äº† WAL æŠ€æœ¯ï¼Œç¡®ä¿åœ¨ä»»ä½•æ•°æ®è¢«å†™å…¥æ•°æ®åº“é¡µä¹‹å‰ï¼Œç›¸åº”çš„æ—¥å¿—ä¿¡æ¯ï¼ˆå¦‚æ•°æ®é¡µçš„ä¿®æ”¹ï¼‰å…ˆè¢«å†™å…¥åˆ° redo log ä¸­ã€‚</p><p>æ€»çš„æ¥è¯´WAL æŠ€æœ¯çš„ä¼˜åŠ¿æœ‰ä»¥ä¸‹3é¡¹ï¼Œ</p><ol><li><strong>æ¢å¤èƒ½åŠ›</strong>ï¼šWAL æä¾›äº†å¼ºå¤§çš„æ•°æ®æ¢å¤èƒ½åŠ›ã€‚åœ¨å‘ç”Ÿç³»ç»Ÿæ•…éšœåï¼Œå¯ä»¥åˆ©ç”¨æ—¥å¿—æ–‡ä»¶ä¸­çš„è®°å½•æ¥é‡åšæˆ–æ’¤é”€äº‹åŠ¡ï¼Œæ¢å¤åˆ°æœ€åä¸€è‡´çš„çŠ¶æ€ã€‚</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šé€šè¿‡å°†å¯¹ç£ç›˜æ•°æ®çš„éšæœºå†™è½¬æ¢ä¸º<code>é¡ºåºå†™</code> ï¼Œ åŒæ—¶åˆ©ç”¨ <code>ç»„æäº¤</code> ï¼ŒWAL å¯ä»¥æ˜¾è‘—æé«˜æ•°æ®åº“çš„å†™æ€§èƒ½ã€‚</li><li><strong>äº‹åŠ¡åŸå­æ€§å’ŒæŒä¹…æ€§</strong>ï¼šWAL é€šè¿‡ç¡®ä¿æ‰€æœ‰æ—¥å¿—è®°å½•åœ¨å®é™…æ•°æ®å†™å…¥å‰è¢«æäº¤åˆ°ç£ç›˜ï¼Œä»è€Œæ”¯æŒæ•°æ®åº“äº‹åŠ¡çš„åŸå­æ€§å’ŒæŒä¹…æ€§ã€‚</li></ol><h2 id="22-redo-log-è®°å½•çš„å†…å®¹"><a href="#2-2-redo-log-è®°å½•çš„å†…å®¹" class="headerlink" title="2.2 redo log è®°å½•çš„å†…å®¹"></a>2.2 redo log è®°å½•çš„å†…å®¹</h2><p>ä¹‹æ‰€ä»¥è¯´redo log æ˜¯ç‰©ç†æ—¥å¿—ï¼Œ æ˜¯å› ä¸ºå…¶è®°å½•äº†å¯¹ç‰¹å®šæ•°æ®page æ•°æ®çš„ä¿®æ”¹ã€‚<br>è¯¥ä¾‹å­æ¥è‡ªæå®¢ä¸“æ ã€ŠMySQL å®æˆ˜45è®²ã€‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table t(ID int primary key, c int);</span><br><span class="line">mysql&gt; insert into t(id,k) values(id1,k1),(id2,k2);</span><br></pre></td></tr></table></figure><img src="/6cb5dc64/4.png" class><p>è¿™æ¡æ›´æ–°è¯­å¥åšäº†å¦‚ä¸‹çš„æ“ä½œï¼ˆæŒ‰ç…§å›¾ä¸­çš„æ•°å­—é¡ºåºï¼‰ï¼š</p><ol><li>Page 1 åœ¨å†…å­˜ä¸­ï¼Œç›´æ¥æ›´æ–°å†…å­˜ï¼›</li><li>Page 2 æ²¡æœ‰åœ¨å†…å­˜ä¸­ï¼Œå°±åœ¨å†…å­˜çš„ change buffer åŒºåŸŸï¼Œè®°å½•ä¸‹â€œæˆ‘è¦å¾€ Page 2 æ’å…¥ä¸€è¡Œâ€è¿™ä¸ªä¿¡æ¯</li><li>å°†ä¸Šè¿°ä¸¤ä¸ªåŠ¨ä½œè®°å…¥ redo log ä¸­ï¼ˆå›¾ä¸­ 3 å’Œ 4ï¼‰ã€‚</li></ol><p>Redo logä¸æ˜¯è®°å½•æ•°æ®é¡µâ€œæ›´æ–°ä¹‹åçš„çŠ¶æ€â€ï¼Œè€Œæ˜¯è®°å½•è¿™ä¸ªé¡µ â€œåšäº†ä»€ä¹ˆæ”¹åŠ¨â€ã€‚</p><h2 id="23-redo-log-å†™å…¥è¿‡ç¨‹"><a href="#2-3-redo-log-å†™å…¥è¿‡ç¨‹" class="headerlink" title="2.3 redo log å†™å…¥è¿‡ç¨‹"></a>2.3 redo log å†™å…¥è¿‡ç¨‹</h2><p><a href="https://time.geekbang.org/column/article/76161"># 23 | MySQLæ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„ï¼Ÿ redo log çš„å†™å…¥æœºåˆ¶-redo log buffer </a></p><p>redo log çš„å†™å…¥æœºåˆ¶å’Œ binlog ç±»å‹ï¼Œ éœ€è¦ç»å†</p><ol><li>MySQL ç³»ç»Ÿå†…å­˜cache ï¼Œ redo lo buffer</li><li>æ–‡ä»¶ç³»ç»Ÿpage cache</li><li>åˆ·æ–°æŒä¹…åŒ–åˆ°ç£ç›˜<img src="/6cb5dc64/5.png" class></li></ol><h3 id="231-redo-log-buffer"><a href="#2-3-1-redo-log-buffer" class="headerlink" title="2.3.1 redo log buffer"></a>2.3.1 redo log buffer</h3><p>add(id1,k1) to page1, new change buffer item add(id2,k2) to page2 éƒ½æ˜¯å…ˆå†™å…¥redo log buffer ä¸­</p><p>ç›¸æ¯”è¾ƒ æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±ä¸€å—ç‹¬ç«‹çš„ binlog cache ï¼Œ è€Œ redo log buffer æ˜¯å…¨å±€å…±ç”¨çš„ã€‚</p><h3 id="232-redo-logæŒä¹…åŒ–åˆ°ç£ç›˜"><a href="#2-3-2-redo-logæŒä¹…åŒ–åˆ°ç£ç›˜" class="headerlink" title="2.3.2 redo logæŒä¹…åŒ–åˆ°ç£ç›˜"></a>2.3.2 redo logæŒä¹…åŒ–åˆ°ç£ç›˜</h3><p>äº‹åŠ¡æäº¤ï¼Œæ‰§è¡Œcommit redo log åï¼Œä¼šè§¦å‘redo log buffer ä¸­å†…å®¹å†™å…¥åˆ°redo log ä¸­ã€‚</p><p>ä¸ºäº†æ§åˆ¶ redo log çš„å†™å…¥ç­–ç•¥ï¼ŒInnoDB æä¾›äº† innodb_flush_log_at_trx_commit å‚æ•°ï¼Œå®ƒæœ‰ä¸‰ç§å¯èƒ½å–å€¼ï¼š</p><ol><li>è®¾ç½®ä¸º 0 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log ç•™åœ¨ redo log buffer ä¸­ ;</li><li>è®¾ç½®ä¸º 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°† redo log ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼›</li><li>è®¾ç½®ä¸º 2 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log å†™åˆ° page cacheã€‚</li></ol><p>æ‰€ä»¥æƒ³è¦ç¡®ä¿MySQLå¼‚å¸¸é‡å¯ä¹‹åredo log æ•°æ®ä¸ä¸¢å¤±ï¼Œinnodb_flush_log_at_trx_commit è¿™ä¸ªå‚æ•° å»ºè®®è®¾ç½®æˆ1.</p><p>å‰é¢åœ¨binlogéƒ¨åˆ†è¯´åˆ°ï¼Œ åœ¨äº‹åŠ¡æäº¤å‰ï¼Œäº‹åŠ¡binlog æ˜¯ä¸ä¼šè¢«å†™å…¥åˆ°çœŸæ­£çš„binlog æ–‡ä»¶ä¸­çš„ã€‚ redo log ä¸ä¸€æ ·ï¼Œåœ¨äº‹åŠ¡æäº¤å‰ï¼Œredo log æœ‰å¯èƒ½å¤‡æŒä¹…åŒ–ç£ç›˜ã€‚æœ‰ä»¥ä¸‹3ç§æƒ…å†µ</p><ol><li>åå°çº¿ç¨‹,æ¯éš” 1 ç§’ï¼Œå°±ä¼šæŠŠ redo log buffer ä¸­çš„æ—¥å¿—ï¼Œè°ƒç”¨ write å†™åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cacheï¼Œç„¶åè°ƒç”¨ fsync æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚ï¼Œ</li><li>redo log buffer å ç”¨çš„ç©ºé—´å³å°†è¾¾åˆ° innodb_log_buffer_size ä¸€åŠçš„æ—¶å€™ï¼Œåå°çº¿ç¨‹ä¼šä¸»åŠ¨å†™ç›˜ã€‚æ³¨æ„ï¼Œç”±äºè¿™ä¸ªäº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥è¿™ä¸ªå†™ç›˜åŠ¨ä½œåªæ˜¯ writeï¼Œè€Œæ²¡æœ‰è°ƒç”¨ fsyncï¼Œä¹Ÿå°±æ˜¯åªç•™åœ¨äº†æ–‡ä»¶ç³»ç»Ÿçš„ page cacheã€‚</li><li>å¹¶è¡Œçš„äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œé¡ºå¸¦å°†è¿™ä¸ªäº‹åŠ¡çš„ redo log buffer æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚å¦‚æœ innodb_flush_log_at_trx_commit è®¾ç½®çš„æ˜¯ 1ï¼Œé‚£ä¹ˆæŒ‰ç…§è¿™ä¸ªå‚æ•°çš„é€»è¾‘ï¼Œ è¦æŠŠ redo log buffer é‡Œçš„æ—¥å¿—å…¨éƒ¨æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚è¿™æ—¶å€™ï¼Œå°±ä¼šå¸¦ä¸Šæœªæäº¤äº‹åŠ¡ åœ¨ redo log buffer é‡Œçš„æ—¥å¿—ä¸€èµ·æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚<h3 id="233-2pcçš„ç»†åŒ–è¿‡ç¨‹"><a href="#2-3-3-2PCçš„ç»†åŒ–è¿‡ç¨‹" class="headerlink" title="2.3.3 2PCçš„ç»†åŒ–è¿‡ç¨‹"></a>2.3.3 2PCçš„ç»†åŒ–è¿‡ç¨‹</h3></li></ol><h2 id="24-æ—¥å¿—æ–‡ä»¶ç»„"><a href="#2-4-æ—¥å¿—æ–‡ä»¶ç»„" class="headerlink" title="2.4  æ—¥å¿—æ–‡ä»¶ç»„"></a>2.4  æ—¥å¿—æ–‡ä»¶ç»„</h2><p>InnoDB çš„ redo log æ˜¯ä»¥æ—¥å¿—æ–‡ä»¶ç»„çš„å½¢å¼ç»„ç»‡çš„ã€‚ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ç»„é€šå¸¸åŒ…å«ä¸¤ä¸ªæˆ–æ›´å¤šçš„æ—¥å¿—æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶åœ¨ç‰©ç†ä¸Šæ˜¯è¿ç»­çš„ï¼Œå¹¶ä¸”å¾ªç¯ä½¿ç”¨ã€‚å½“ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶å†™æ»¡åï¼ŒInnoDB ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ç»§ç»­å†™å…¥ã€‚å½“æœ€åä¸€ä¸ªæ–‡ä»¶å†™æ»¡åï¼Œå®ƒä¼šå›åˆ°ç¬¬ä¸€ä¸ªæ–‡ä»¶å¹¶å¼€å§‹è¦†ç›–æ—§çš„æ—¥å¿—è®°å½•ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œç¯å½¢å†™å…¥â€ã€‚</p><h2 id="25-lsn"><a href="#2-5-LSN" class="headerlink" title="2.5 LSN"></a>2.5 LSN</h2><p>LSNï¼ˆLog Sequence Numberï¼‰,æ—¥å¿—åºåˆ—å·,æ˜¯ä¸€ä¸ªä¸æ–­å¢é•¿çš„å…¨å±€å˜é‡ï¼Œ ç”¨æ¥è®°å½•å½“å‰redo log æ–‡ä»¶ä¸­ å·²ç»å†™å…¥çš„æ—¥å¿—é‡ï¼Œ å•ä½æ˜¯å­—èŠ‚ã€‚</p><img src="/6cb5dc64/6.png" class><p>å›¾ç‰‡ä¸­çš„write pos LSN æŒ‡å½“å‰å·²ç»äº§ç”Ÿçš„çš„æ—¥å¿—é‡ï¼Œéšç€æ›´å¤šçš„äº‹åŠ¡æ•°æ®è¢«å†™å…¥ï¼Œwrite pos LSN ä¼šä¸æ–­å¢åŠ </p><p>checkpoint LSN æ˜¯redo log ä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œè¡¨ç¤ºæ‰€æœ‰ä¹‹å‰çš„æ—¥å¿—è®°å½•éƒ½å·²ç»è¢«åº”ç”¨ï¼ˆæˆ–è¯´æ˜¯â€œåˆ·æ–°â€ï¼‰åˆ°äº†ç£ç›˜çš„æ•°æ®é¡µä¸Šï¼Œå› æ­¤ï¼Œä»è¿™ä¸ªä½ç½®ä»¥å‰çš„æ—¥å¿—æ•°æ®å¯ä»¥å®‰å…¨åœ°è¢«è¦†å†™ï¼Œ ä¸ä¼šå‡ºç°æ•°æ®ä¸¢å¤±çš„æƒ…å†µã€‚ redo log ä¼šæœ‰å¤šä¸ªæ£€æŸ¥ç‚¹</p><p>write pos LSN å’Œ checkpoint LSNä¹‹é—´ç©ºç€çš„éƒ¨åˆ†ï¼Œå¯ä»¥ç”¨æ¥è®°å½•æ–°çš„æ“ä½œã€‚</p><p>å¦‚æœ write pos LSN  èµ¶ä¸Šäº†æœ€ä¸€ä¸ªcheckpoint  LSN ä½ç½®ï¼Œè¿™æ„å‘³ç€ redo log çš„ç©ºé—´ä¸è¶³ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®åº“æ“ä½œåœé¡¿ï¼Œå› ä¸ºç³»ç»Ÿéœ€è¦ç­‰å¾…è¶³å¤Ÿçš„æ—¥å¿—ç©ºé—´æ¥è®°å½•æ–°çš„äº‹åŠ¡æ•°æ®ã€‚</p><h2 id="26-ç»„æäº¤"><a href="#2-6-ç»„æäº¤" class="headerlink" title="2.6  ç»„æäº¤"></a>2.6  ç»„æäº¤</h2><p>å‰é¢æè¿‡ï¼Œredo log æå‡æ€§èƒ½ï¼Œä¸€ä¸ªæ˜¯æŠŠå¯¹ç£ç›˜çš„éšæœºå†™è½¬æ¢æˆäº†é¡ºåºå†™ï¼Œä¸€ä¸ªæ˜¯ç»„æäº¤æœºåˆ¶ã€‚</p><p>ç»„æäº¤æœºåˆ¶ï¼ˆGroup Commitï¼‰æ˜¯ä¸€ç§é€šè¿‡åˆå¹¶å¤šä¸ªäº‹åŠ¡çš„æ—¥å¿—æäº¤æ“ä½œæ¥æé«˜I/Oæ•ˆç‡çš„ç­–ç•¥ã€‚è¿™ä¸€æœºåˆ¶åŸºäºLSNï¼ˆLog Sequence Numberï¼Œæ—¥å¿—åºåˆ—å·ï¼‰æ¥è¿½è¸ªå’Œç®¡ç†æ—¥å¿—æäº¤ã€‚</p><p>ä»¥ä¸‹å›¾ä¸ºä¾‹è§£é‡Š<br><img src="/6cb5dc64/8.png" class></p><ol><li><strong>äº‹åŠ¡<code>trx1</code>å¼€å§‹</strong>ï¼š<ul><li><code>trx1</code>è¿›å…¥äº‹åŠ¡é˜Ÿåˆ—å¹¶è¢«é€‰ä¸ºç»„çš„é¢†å¯¼è€…ï¼Œæ—¥å¿—è®°å½•çš„LSNå¼€å§‹å¢åŠ ã€‚</li></ul></li><li><strong>äº‹åŠ¡<code>trx2</code>å’Œ<code>trx3</code>åŠ å…¥</strong><ul><li>åœ¨<code>trx1</code>è¿›å…¥é˜Ÿåˆ—ä¹‹åï¼Œ<code>trx2</code>å’Œ<code>trx3</code>ç´§éšå…¶åè¿›å…¥æäº¤é˜Ÿåˆ—ã€‚</li></ul></li><li><strong>LSNæ›´æ–°åˆ°160</strong>ï¼š<ul><li>éšç€<code>trx2</code>å’Œ<code>trx3</code>çš„æ—¥å¿—å†™å…¥ç¼“å†²åŒºï¼Œæ•´ä¸ªç»„çš„æœ€åä¸€ä¸ªæ—¥å¿—åºåˆ—å·<code>LSN</code>å˜ä¸º160ã€‚</li></ul></li><li><strong>é¢†å¯¼è€…<code>trx1</code>æ‰§è¡Œå†™ç›˜</strong>ï¼š<ul><li><code>trx1</code>ä½œä¸ºç»„çš„é¢†å¯¼è€…ï¼Œæºå¸¦<code>LSN=160</code>å»æ‰§è¡Œä¸€æ¬¡æ€§æ—¥å¿—å†™ç›˜ï¼ˆfsyncï¼‰æ“ä½œã€‚</li></ul></li><li><strong>å†™ç›˜å®Œæˆ</strong>ï¼š<ul><li><code>trx1</code>çš„fsyncæ“ä½œå®Œæˆåï¼Œæ‰€æœ‰<code>LSN &lt;= 160</code>çš„æ—¥å¿—è®°å½•éƒ½è¢«æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</li></ul></li><li><strong>äº‹åŠ¡è¿”å›æäº¤æˆåŠŸ</strong>ï¼š<ul><li><code>trx1</code>ã€<code>trx2</code>å’Œ<code>trx3</code>éƒ½æ ‡è®°ä¸ºæäº¤æˆåŠŸå¹¶ä»æäº¤é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚</li></ul></li></ol><h1 id="3-äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„binlog-å’Œredolog-å’Œundo-log"><a href="#3-äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„binlog-å’Œredolog-å’Œundo-log" class="headerlink" title="3 äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„binlog å’Œredolog å’Œundo log"></a>3 äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„binlog å’Œredolog å’Œundo log</h1><p>ä¸‹é¢å°†ç»“åˆMySQL çš„é€»è¾‘æ¶æ„ å’Œå…·ä½“SQL , æ¥å…·ä½“åœ°çœ‹ä¸€ä¸‹binlog å’Œredo log çš„å†™å…¥</p><img src="/6cb5dc64/9.png" class><p>SQL<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table T(ID int primary key, c int);</span><br><span class="line">mysql&gt; update T set c=c+1 where ID=2;</span><br></pre></td></tr></table></figure></p><p>ç»“æœMySQL çš„é€»è¾‘æ¶æ„ï¼Œ è¯¥update sqlçš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹</p><ol><li>æ‰§è¡Œå™¨å…ˆæ‰¾InnoDBå– ID=2 è¿™ä¸€è¡Œã€‚ID æ˜¯ä¸»é”®ï¼Œå¼•æ“ç›´æ¥ç”¨æ ‘æœç´¢æ‰¾åˆ°è¿™ä¸€è¡Œã€‚å¦‚æœ ID=2 è¿™ä¸€è¡Œæ‰€åœ¨çš„æ•°æ®é¡µæœ¬æ¥å°±åœ¨buffer pool ä¸­ï¼Œå°±ç›´æ¥è¿”å›ç»™æ‰§è¡Œå™¨ï¼›å¦åˆ™ï¼Œéœ€è¦å…ˆä»ç£ç›˜è¯»å…¥buffer poolï¼Œç„¶åå†è¿”å›ã€‚</li><li>æ‰§è¡Œå™¨æ‹¿åˆ°å¼•æ“ç»™çš„è¡Œæ•°æ®ï¼ŒæŠŠè¿™ä¸ªå€¼åŠ ä¸Š 1ï¼Œæ¯”å¦‚åŸæ¥æ˜¯ Nï¼Œç°åœ¨å°±æ˜¯ N+1ï¼Œå¾—åˆ°æ–°çš„ä¸€è¡Œæ•°æ®ï¼Œå†è°ƒç”¨å¼•æ“æ¥å£å†™å…¥è¿™è¡Œæ–°æ•°æ®ã€‚</li><li>InnoDBå¼•æ“è®°å½•è¯¥è¡Œæ•°æ®çš„undo log, ç„¶åæ–°æ•°æ®æ›´æ–°åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœæ•°æ®æœ¬æ¥å°±åœ¨å†…å­˜ä¸­ï¼Œåˆ™ç›´æ¥ä¿®æ”¹æ•°æ®é¡µï¼Œå¦‚æœä¸å†å†…å­˜ä¸­ï¼Œåˆ™å°†ä¿®æ”¹è®°å½•åœ¨change buffer  ä¸­ï¼ŒåŒæ—¶å°†è¿™ä¸ªæ›´æ–°æ“ä½œè®°å½•åˆ° redo log é‡Œé¢ï¼Œæ­¤æ—¶ redo log å¤„äº prepare çŠ¶æ€ã€‚</li><li>ç„¶åå‘ŠçŸ¥æ‰§è¡Œå™¨æ‰§è¡Œå®Œæˆäº†ï¼Œéšæ—¶å¯ä»¥æäº¤äº‹åŠ¡ã€‚æ‰§è¡Œå™¨ç”Ÿæˆè¿™ä¸ªæ“ä½œçš„ binlogï¼Œå¹¶æŠŠ binlog å†™å…¥ç£ç›˜ã€‚</li><li>æ‰§è¡Œå™¨è°ƒç”¨å¼•æ“çš„æäº¤äº‹åŠ¡æ¥å£ï¼Œå¼•æ“æŠŠåˆšåˆšå†™å…¥çš„ redo log æ”¹æˆæäº¤ï¼ˆcommitï¼‰çŠ¶æ€ï¼Œæ›´æ–°å®Œæˆã€‚æ ¹æ® innodb_flush_log_at_trx_commit å†³å®šredo log æ˜¯å¦æŒä¹…åŒ–åˆ°ç£ç›˜</li><li>buffer pool ä¸­å¯¹æ•°æ®é¡µçš„æ›´æ–° ,ç­‰å¾…è„é¡µåˆ·çº¿æ“ä½œæŒä¹…åŒ–åˆ°ç£ç›˜</li></ol><p>14.prepareé˜¶æ®µ,å°†äº‹åŠ¡çš„xidå†™å…¥ï¼Œå°†binlog_cacheé‡Œçš„è¿›è¡Œflushä»¥åŠsyncæ“ä½œ(å¤§äº‹åŠ¡çš„è¯è¿™æ­¥éå¸¸è€—æ—¶)<br>15.commité˜¶æ®µï¼Œç”±äºä¹‹å‰è¯¥äº‹åŠ¡äº§ç”Ÿçš„redo logå·²ç»syncåˆ°ç£ç›˜äº†ã€‚æ‰€ä»¥è¿™æ­¥åªæ˜¯åœ¨redo logé‡Œæ ‡è®°commit</p><h1 id="4-å´©æºƒæ¢å¤çš„é€»è¾‘"><a href="#4-å´©æºƒæ¢å¤çš„é€»è¾‘" class="headerlink" title="4 å´©æºƒæ¢å¤çš„é€»è¾‘"></a>4 å´©æºƒæ¢å¤çš„é€»è¾‘</h1><p>å´©æºƒæ¢å¤è¿‡ç¨‹ä¸­ï¼ŒInnoDB ä¼šä»æœ€è¿‘çš„ checkpoint LSNå¼€å§‹ï¼Œåº”ç”¨ redo log ä¸­çš„æ›´æ”¹ï¼Œç›´åˆ°è¾¾åˆ°å´©æºƒæ—¶çš„ write pos LSNï¼Œä»¥æ­¤æ¥æ¢å¤æ•°æ®åº“åˆ°æœ€åä¸€æ¬¡æäº¤çš„çŠ¶æ€ã€‚</p><p>çœ‹ä¸€ä¸‹å´©æºƒæ¢å¤æ—¶çš„åˆ¤æ–­è§„åˆ™</p><ol><li>å¦‚æœ redo log é‡Œé¢çš„äº‹åŠ¡æ˜¯å®Œæ•´çš„ï¼Œåˆ™ç›´æ¥æäº¤ï¼›</li><li>å¦‚æœ redo log é‡Œé¢çš„äº‹åŠ¡åªæœ‰å®Œæ•´çš„ prepareï¼Œåˆ™åˆ¤æ–­å¯¹åº”çš„äº‹åŠ¡ binlog æ˜¯å¦å­˜åœ¨å¹¶å®Œæ•´ï¼š<ol><li>å¦‚æœå®Œæ•´ï¼Œåˆ™æäº¤äº‹åŠ¡ï¼›</li><li>å¦åˆ™ï¼Œå›æ»šäº‹åŠ¡ã€‚==æ­¤å¤„äº‹åŠ¡å›æ»šåŸºäºundo log ==</li></ol></li><li>å¦‚æœredo log æ²¡æœ‰å®Œæ•´çš„prepare, åˆ™äº‹åŠ¡åŸºäºundo log å›æ»š</li></ol><p>âš ï¸è¯´æ˜ä¸€ä¸‹ï¼Œinnodb_flush_log_at_trx_commit  å®é™…ä¸Šæ§åˆ¶äº†redo prepare å’Œcommit ä¸¤ä¸ªé˜¶æ®µçš„åˆ·ç›˜ç­–ç•¥ï¼Œæ¯”å¦‚innodb_flush_log_at_trx_commit  =1 æ—¶åœ¨ <code>prepare</code> é˜¶æ®µå’Œ <code>commit</code> é˜¶æ®µï¼Œ<code>redo log</code> éƒ½ä¼šæŒä¹…åŒ–å†™å…¥ç£ç›˜ã€‚æ‰€ä»¥æ‰ä¼šå‡ºç°ç¬¬äºŒç§ç£ç›˜æœ‰ä¸”åªæœ‰å®Œæ•´prepare çš„æƒ…å†µã€‚</p><p>æ¥ä¸‹æ¥æ ¹æ®ä¸€äº›å…·ä½“çš„é—®é¢˜æ¥è¯¦ç»†è¯´æ˜å´©æºƒæ¢å¤æ—¶çš„ç»†èŠ‚</p><h2 id="41-å¦‚ä½•åˆ¤æ–­-redo-log-æ˜¯å®Œæ•´çš„"><a href="#4-1-å¦‚ä½•åˆ¤æ–­-redo-log-æ˜¯å®Œæ•´çš„" class="headerlink" title="4.1  å¦‚ä½•åˆ¤æ–­ redo log æ˜¯å®Œæ•´çš„"></a>4.1  å¦‚ä½•åˆ¤æ–­ redo log æ˜¯å®Œæ•´çš„</h2><p>redo log commit é˜¶æ®µä¼šæœ‰commit æ ‡è¯†</p><h2 id="42-å¦‚æœåˆ¤æ–­binlog-å®Œæ•´æ€§"><a href="#4-2-å¦‚æœåˆ¤æ–­binlog-å®Œæ•´æ€§" class="headerlink" title="4.2. å¦‚æœåˆ¤æ–­binlog å®Œæ•´æ€§"></a>4.2. å¦‚æœåˆ¤æ–­binlog å®Œæ•´æ€§</h2><p>ä¸€ä¸ªäº‹åŠ¡çš„ binlog æ˜¯æœ‰å®Œæ•´æ ¼å¼çš„ï¼š<br>statement æ ¼å¼çš„ binlogï¼Œæœ€åä¼šæœ‰ COMMITï¼›<br>row æ ¼å¼çš„ binlogï¼Œæœ€åä¼šæœ‰ä¸€ä¸ª XID eventã€‚</p><h2 id="43-redo-log-å’Œ-binlog-æ˜¯æ€ä¹ˆå…³è”èµ·æ¥çš„"><a href="#4-3-redo-log-å’Œ-binlog-æ˜¯æ€ä¹ˆå…³è”èµ·æ¥çš„" class="headerlink" title="4.3. redo log å’Œ binlog æ˜¯æ€ä¹ˆå…³è”èµ·æ¥çš„"></a>4.3. redo log å’Œ binlog æ˜¯æ€ä¹ˆå…³è”èµ·æ¥çš„</h2><p>åœ¨å´©æºƒæ¢å¤æ—¶ï¼Œé€šè¿‡è¯»å–Redo Logä¸­çš„Xidï¼Œèƒ½å¤Ÿå°†å…¶ä¸Binlogä¸­çš„Xidè¿›è¡ŒåŒ¹é…ã€‚</p><p>XIDï¼ˆTransaction Identifierï¼‰ å¯ä»¥ç†è§£æˆæ—¶MySQL server å±‚çš„äº‹åŠ¡å”¯ä¸€æ ‡è¯†ã€‚<br>redo log  ä¸­ä¼šè®°å½•XID</p><p>å¦‚æœç¢°åˆ°åªæœ‰ parepareã€è€Œæ²¡æœ‰ commit çš„ redo logï¼Œå°±æ‹¿ç€ XID å» binlog æ‰¾å¯¹åº”çš„äº‹åŠ¡ã€‚</p><h2 id="44-ä¸ºä»€ä¹ˆè¦ç”¨2pc-åè°ƒbinlogå’Œredo-log"><a href="#4-4-ä¸ºä»€ä¹ˆè¦ç”¨2PC-åè°ƒbinlogå’Œredo-log" class="headerlink" title="4.4. ä¸ºä»€ä¹ˆè¦ç”¨2PC åè°ƒbinlogå’Œredo log"></a>4.4. ä¸ºä»€ä¹ˆè¦ç”¨2PC åè°ƒbinlogå’Œredo log</h2><p>ç±»ä¼¼çš„é—®é¢˜è¿˜æœ‰ï¼Œä¸ºä»€ä¹ˆå¤„äº prepare é˜¶æ®µçš„ redo log åŠ ä¸Šå®Œæ•´ binlog å°±å¯ä»¥æäº¤äº‹åŠ¡ã€‚</p><p>è¿™ä¸¤ä¸ªé—®é¢˜æœ¬è´¨ä¸Šéƒ½æ˜¯æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</p><p>binlog æ˜¯server å±‚æ—¥å¿—ï¼Œ æ˜¯MySQL ä¸€å¼€å§‹å°±æœ‰çš„åŠŸèƒ½ï¼Œè¢«ç”¨åœ¨äº†å¾ˆå¤šåœ°æ–¹ï¼Œæ¯”å¦‚å¤‡ä»½ã€ä¸»å¤‡åŒæ­¥å¤åˆ¶ã€‚redo log æ˜¯InnoDB å±‚æ—¥å¿—ï¼Œæ˜¯InnoDB ä¸ºäº†å®ç°äº‹åŠ¡åŠŸèƒ½æ–°å¢çš„ã€‚ä½¿ç”¨2PCå¯ä»¥ç»´æŠ¤ä¸¤ä»½ä¹‹é—´çš„é€»è¾‘ä¸€è‡´ã€‚</p><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦ç»´æŠ¤ä¸¤ä»½æ—¥å¿—é—´çš„é€»è¾‘ä¸€è‡´å‘¢ã€‚</p><p>binlog æ˜¯server å±‚æ—¥å¿—ï¼Œ æ˜¯MySQL ä¸€å¼€å§‹å°±æœ‰çš„åŠŸèƒ½ï¼Œè¢«ç”¨åœ¨äº†å¾ˆå¤šåœ°æ–¹ï¼Œæ¯”å¦‚å¤‡ä»½ã€ä¸»å¤‡åŒæ­¥å¤åˆ¶ã€‚redo log æ˜¯InnoDB å±‚æ—¥å¿—ï¼Œæ˜¯InnoDB ä¸ºäº†å®ç°äº‹åŠ¡åŠŸèƒ½æ–°å¢çš„ã€‚å¦‚æœä¸¤ä»½æ—¥å¿—é€»è¾‘æˆ–è€…è¯´æ•°æ®ä¸ä¸€è‡´ï¼Œ é‚£ä¹ˆç”¨æ—¥å¿—æ¢å¤å‡ºæ¥çš„æ•°æ®åº“çŠ¶æ€å°±æœ‰å¯èƒ½å’Œå®ƒæœ¬æ¥åº”è¯¥çš„çŠ¶æ€ä¸ä¸€è‡´ã€‚</p><p>å…·ä½“ä¸¾ä¾‹æ¥è®²ï¼Œå¦‚æœä¸ç”¨2PCï¼Œä¸¤ç§æ—¥å¿—è¦ä¹ˆæ˜¯å…ˆå†™ redo log å†å†™ binlogï¼Œæˆ–è€…å…ˆå†™binlog å†å†™redo log ã€‚<br>ä»ç„¶ç”¨å‰é¢çš„ update è¯­å¥æ¥åšä¾‹å­ã€‚å‡è®¾å½“å‰ ID=2 çš„è¡Œï¼Œå­—æ®µ c çš„å€¼æ˜¯ 0ï¼Œå†å‡è®¾æ‰§è¡Œ update è¯­å¥è¿‡ç¨‹ä¸­åœ¨å†™å®Œç¬¬ä¸€ä¸ªæ—¥å¿—åï¼Œç¬¬äºŒä¸ªæ—¥å¿—è¿˜æ²¡æœ‰å†™å®ŒæœŸé—´å‘ç”Ÿäº† crashï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</p><ol><li><p>å…ˆå†™ redo log åå†™ binlogã€‚å‡è®¾åœ¨ redo log å†™å®Œï¼Œbinlog è¿˜æ²¡æœ‰å†™å®Œçš„æ—¶å€™ï¼ŒMySQL è¿›ç¨‹å¼‚å¸¸é‡å¯ã€‚ç”±äºæˆ‘ä»¬å‰é¢è¯´è¿‡çš„ï¼Œredo log å†™å®Œä¹‹åï¼Œç³»ç»Ÿå³ä½¿å´©æºƒï¼Œä»ç„¶èƒ½å¤ŸæŠŠæ•°æ®æ¢å¤å›æ¥ï¼Œæ‰€ä»¥æ¢å¤åè¿™ä¸€è¡Œ c çš„å€¼æ˜¯ 1ã€‚ä½†æ˜¯ç”±äº binlog æ²¡å†™å®Œå°± crash äº†ï¼Œè¿™æ—¶å€™ binlog é‡Œé¢å°±æ²¡æœ‰è®°å½•è¿™ä¸ªè¯­å¥ã€‚å› æ­¤ï¼Œä¹‹åå¤‡ä»½æ—¥å¿—çš„æ—¶å€™ï¼Œå­˜èµ·æ¥çš„ binlog é‡Œé¢å°±æ²¡æœ‰è¿™æ¡è¯­å¥ã€‚ç„¶åä½ ä¼šå‘ç°ï¼Œå¦‚æœéœ€è¦ç”¨è¿™ä¸ª binlog æ¥æ¢å¤ä¸´æ—¶åº“çš„è¯ï¼Œç”±äºè¿™ä¸ªè¯­å¥çš„ binlog ä¸¢å¤±ï¼Œè¿™ä¸ªä¸´æ—¶åº“å°±ä¼šå°‘äº†è¿™ä¸€æ¬¡æ›´æ–°ï¼Œæ¢å¤å‡ºæ¥çš„è¿™ä¸€è¡Œ c çš„å€¼å°±æ˜¯ 0ï¼Œä¸åŸåº“çš„å€¼ä¸åŒã€‚</p></li><li><p>å…ˆå†™ binlog åå†™ redo logã€‚å¦‚æœåœ¨ binlog å†™å®Œä¹‹å crashï¼Œç”±äº redo log è¿˜æ²¡å†™ï¼Œå´©æºƒæ¢å¤ä»¥åè¿™ä¸ªäº‹åŠ¡æ— æ•ˆï¼Œæ‰€ä»¥è¿™ä¸€è¡Œ c çš„å€¼æ˜¯ 0ã€‚ä½†æ˜¯ binlog é‡Œé¢å·²ç»è®°å½•äº†â€œæŠŠ c ä» 0 æ”¹æˆ 1â€è¿™ä¸ªæ—¥å¿—ã€‚æ‰€ä»¥ï¼Œåœ¨ä¹‹åç”¨ binlog æ¥æ¢å¤çš„æ—¶å€™å°±å¤šäº†ä¸€ä¸ªäº‹åŠ¡å‡ºæ¥ï¼Œæ¢å¤å‡ºæ¥çš„è¿™ä¸€è¡Œ c çš„å€¼å°±æ˜¯ 1ï¼Œä¸åŸåº“çš„å€¼ä¸åŒã€‚å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœä¸ä½¿ç”¨â€œä¸¤é˜¶æ®µæäº¤â€ï¼Œé‚£ä¹ˆæ•°æ®åº“çš„çŠ¶æ€å°±æœ‰å¯èƒ½å’Œç”¨å®ƒçš„æ—¥å¿—æ¢å¤å‡ºæ¥çš„åº“çš„çŠ¶æ€ä¸ä¸€è‡´ã€‚</p></li></ol><p>åŒç†ï¼Œä¸ºä»€ä¹ˆå¤„äº prepare é˜¶æ®µçš„ redo log åŠ ä¸Šå®Œæ•´ binlog å°±å¯ä»¥æäº¤äº‹åŠ¡ã€‚å› ä¸ºå¦‚æœbinlog å†™å®Œä»¥å MySQL å‘ç”Ÿå´©æºƒï¼Œè¿™æ—¶å€™ binlog å·²ç»å†™å…¥äº†ï¼Œä¹‹åå°±ä¼šè¢«ä»åº“ï¼ˆæˆ–è€…ç”¨è¿™ä¸ª binlog æ¢å¤å‡ºæ¥çš„åº“ï¼‰ä½¿ç”¨ã€‚å¦‚æœredo log äº‹åŠ¡ä¸æäº¤çš„è¯ï¼Œå°±ä¼šå‘ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ</p><h2 id="45-ä¸è¦binlog-å¯ä»¥å—"><a href="#4-5-ä¸è¦binlog-å¯ä»¥å—" class="headerlink" title="4.5. ä¸è¦binlog å¯ä»¥å—"></a>4.5. ä¸è¦binlog å¯ä»¥å—</h2><p>ä»…ä»äº‹åŠ¡æŒä¹…åŒ–/å´©æºƒæ¢å¤è¿™ä¸ªåŠŸèƒ½æ¥è®²ï¼Œ åªè¦redo log  æ˜¯å¯ä»¥å®Œæˆçš„ã€‚<br>ä½†æ˜¯binlog ä½œä¸º MySQL ä¸€å¼€å§‹å°±æœ‰çš„åŠŸèƒ½ï¼Œè¢«ç”¨åœ¨äº†å¾ˆå¤šåœ°æ–¹ï¼Œæœ‰redo log æ— æ³•æ›¿ä»£çš„åŠŸèƒ½ ã€‚</p><ol><li>å½’æ¡£ã€‚redo log æ˜¯å¾ªç¯å†™ï¼Œå†™åˆ°æœ«å°¾æ˜¯è¦å›åˆ°å¼€å¤´ç»§ç»­å†™çš„ã€‚è¿™æ ·å†å²æ—¥å¿—æ²¡æ³•ä¿ç•™ï¼Œredo log ä¹Ÿå°±èµ·ä¸åˆ°å½’æ¡£çš„ä½œç”¨ã€‚</li><li>ä¸»ä»å¤åˆ¶åŒæ­¥</li><li>MySQL é«˜å¯ç”¨</li><li>åœ¨ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œ ä¹Ÿä¼šä½¿ç”¨binlogåšæ•°æ®åŒæ­¥ï¼Œæ¯”å¦‚ä½¿ç”¨canal åŒæ­¥binlogæ•°æ® åˆ°ES<h2 id="46-æ•°æ®ä¸€å®šä¸ä¼šä¸¢å¤±å—-åŒ1-è®¾ç½®"><a href="#4-6-æ•°æ®ä¸€å®šä¸ä¼šä¸¢å¤±å—-åŒ1-è®¾ç½®" class="headerlink" title="4.6 æ•°æ®ä¸€å®šä¸ä¼šä¸¢å¤±å—-åŒ1 è®¾ç½®"></a>4.6 æ•°æ®ä¸€å®šä¸ä¼šä¸¢å¤±å—-åŒ1 è®¾ç½®</h2></li></ol><p>åœ¨ä»‹ç»binlogå’Œredo log å†™å…¥è¿‡ç¨‹çš„æ—¶å€™ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°<br>sync_binlog  æ§åˆ¶binlog æŒä¹…åŒ–åˆ°ç£ç›˜çš„é¢‘ç‡</p><ol><li>sync_binlog=0 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¸ä¸»åŠ¨åˆ·æ–°ç£ç›˜ï¼Œç”±æ–‡ä»¶ç³»ç»Ÿè‡ªå·±æ§åˆ¶åˆ·ç›˜é¢‘ç‡</li><li>sync_binlog=1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šå°† binlog cache ä¸­çš„å†…å®¹åˆ·æ–°åˆ°ç£ç›˜</li><li>sync_binlog=N(N&gt;1) çš„æ—¶å€™ï¼Œè¡¨ç¤ºç´¯ç§¯ N ä¸ªæäº¤äº‹åŠ¡åæ‰å°†å¤šä¸ªbinlog cacheä¸­çš„å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ã€‚</li></ol><p>innodb_flush_log_at_trx_commit  æ§åˆ¶redo log æŒä¹…åŒ–åˆ°ç£ç›˜çš„é¢‘ç‡</p><ol><li>è®¾ç½®ä¸º 0 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log ç•™åœ¨ redo log buffer ä¸­ ;</li><li>è®¾ç½®ä¸º 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°† redo log ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼›</li><li>è®¾ç½®ä¸º 2 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log å†™åˆ° page cacheã€‚</li></ol><p>å¯ä»¥çœ‹åˆ°å—ï¼Œåªæœ‰åœ¨åŒ1è®¾ç½®çš„æ—¶å€™ï¼Œsync_binlog å’Œ innodb_flush_log_at_trx_commit éƒ½è®¾ç½®æˆ 1ï¼Œ æ‰èƒ½ç¡®ä¿ä¸€å®šä¸ä¼šä¸¢æ•°æ®</p><p>é€šå¸¸æˆ‘ä»¬è¯´ MySQL çš„â€œåŒ 1â€é…ç½®ï¼ŒæŒ‡çš„å°±æ˜¯ sync_binlog å’Œ innodb_flush_log_at_trx_commit éƒ½è®¾ç½®æˆ 1ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªäº‹åŠ¡å®Œæ•´æäº¤å‰ï¼Œéœ€è¦ç­‰å¾…ä¸¤æ¬¡åˆ·ç›˜ï¼Œä¸€æ¬¡æ˜¯ redo logï¼ˆprepare é˜¶æ®µï¼‰ï¼Œä¸€æ¬¡æ˜¯ binlogã€‚</p><p>å¦‚æœä¸è®¾ç½®æˆåŒ1ï¼Œ æœ‰åŠ©äºæé«˜æ€§èƒ½ã€‚</p><h1 id="5-binlog-vs-redo-log"><a href="#5-binlog-vs-redo-log" class="headerlink" title="5. binlog vs redo log"></a>5. binlog vs redo log</h1><h4 id="å·®å¼‚"><a href="#å·®å¼‚" class="headerlink" title="å·®å¼‚"></a>å·®å¼‚</h4><ul><li><strong>å±‚çº§å·®å¼‚</strong>ï¼šBinlog å·¥ä½œåœ¨ MySQL æœåŠ¡å™¨å±‚ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ï¼›è€Œ redo log æ˜¯ InnoDB å­˜å‚¨å¼•æ“å±‚ç‰¹æœ‰çš„ã€‚</li><li><strong>è®°å½•å½¢å¼</strong>ï¼šBinlog å¯ä»¥è®°å½• SQL è¯­å¥æˆ–è¡Œå˜æ›´ï¼Œredo log è®°å½•çš„æ˜¯æ•°æ®é¡µçš„ç‰©ç†å˜åŒ–ï¼Œå³â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€</li><li><strong>ç›®çš„å’Œç”¨é€”</strong>ï¼šBinlog ä¸»è¦ç”¨äºæ•°æ®å¤åˆ¶å’Œå´©æºƒæ¢å¤ï¼Œè€Œ redo log ä¸»è¦ç”¨äºäº‹åŠ¡çš„æŒä¹…æ€§å’Œå´©æºƒæ¢å¤ã€‚</li><li><strong>å¤§å°ç®¡ç†</strong>ï¼šRedo log çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œå¾ªç¯ä½¿ç”¨å¾ªç¯å†™ï¼›binlog æ˜¯è¿½åŠ å†™ï¼Œå¯ä»¥ä¸æ–­å¢é•¿ï¼Œéœ€è¦å®šæœŸè¿›è¡Œæ¸…ç†ã€‚</li><li><strong>æ—¥å¿—å†™å…¥</strong>ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±ä¸€å—ç‹¬ç«‹çš„ binlog cache ï¼Œ è€Œ redo log buffer æ˜¯å…¨å±€å…±ç”¨çš„</li></ul><h4 id="å…±åŒç‚¹"><a href="#å…±åŒç‚¹" class="headerlink" title="å…±åŒç‚¹"></a>å…±åŒç‚¹</h4><ul><li><strong>äº‹åŠ¡å®‰å…¨</strong>ï¼šä¸¤è€…éƒ½æ˜¯ä¸ºäº†ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§å’ŒåŸå­æ€§ã€‚</li><li><strong>æ¢å¤æ”¯æŒ</strong>ï¼šåœ¨ç³»ç»Ÿæˆ–ç¡¬ä»¶æ•…éšœåï¼Œä¸¤è€…éƒ½èƒ½è¢«ç”¨æ¥æ¢å¤æ•°æ®ã€‚</li><li><strong>å†™å‰æ—¥å¿—</strong>ï¼šéƒ½é‡‡ç”¨äº†å†™å‰æ—¥å¿—ï¼ˆwrite-ahead logging, WALï¼‰çš„æŠ€æœ¯ï¼Œå³åœ¨å®é™…ä¿®æ”¹æ•°æ®åº“å†…å®¹å‰å…ˆè®°å½•æ—¥å¿—ã€‚</li><li>ä»ç”Ÿäº§åˆ°å†™å…¥ç£ç›˜å‡æœ‰å†…å­˜page - åˆ°page cache - ç£ç›˜ï¼Œåˆ·æ–°åˆ°ç£ç›˜çš„æ—¶æœºå‡æœ‰å‚æ•°æ§åˆ¶</li></ul><h1 id="ç›¸å…³æ–‡ç« "><a href="#ç›¸å…³æ–‡ç« " class="headerlink" title="ç›¸å…³æ–‡ç« "></a>ç›¸å…³æ–‡ç« </h1><p><a href="https://sunyan.xyz/5b064db6/">Intro to äº‹åŠ¡</a><br><a href="https://sunyan.xyz/9cd551f5/">Intro to InnoDB äº‹åŠ¡</a><br><a href="https://sunyan.xyz/b36b0ce9/">InnoDBäº‹åŠ¡-åŸå­æ€§çš„å®ç°,undo log</a><br><a href="https://sunyan.xyz/9faedfe0/">InnoDBäº‹åŠ¡-éš”ç¦»æ€§çš„å®ç°,MVCC &amp; é”</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨MySQL InnoDB è¿™ä¸ªè¯­å¢ƒä¸‹ï¼Œ crash safeã€æ•°æ®ä¸ä¸¢å¤± éƒ½æŒ‡çš„æ˜¯äº‹åŠ¡çš„æŒä¹…æ€§ç‰¹æ€§ï¼Œå³äº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œåº”å½“ä¿è¯æ‰€æœ‰è¢«æˆåŠŸæäº¤çš„æ•°æ®ä¿®æ”¹éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°è¢«æŒä¹…åŒ–ï¼Œä¸ä¸¢å¤±æ•°æ®, å³ä½¿å®•æœºä¹Ÿèƒ½å¤Ÿæ¢å¤æ•°æ®&lt;/p&gt;
&lt;p&gt;åœ¨InnoDB ä¸­ï¼ŒæŒä¹…æ€§ åŸºäºbinlog å’Œr</summary>
      
    
    
    
    
    <category term="MySQL" scheme="http://example.com/tags/MySQL/"/>
    
    <category term="äº‹åŠ¡" scheme="http://example.com/tags/%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>InnoDBäº‹åŠ¡-éš”ç¦»æ€§çš„å®ç°, MVCC &amp; é”</title>
    <link href="http://example.com/9faedfe0/"/>
    <id>http://example.com/9faedfe0/</id>
    <published>2024-05-02T14:42:57.000Z</published>
    <updated>2024-05-10T15:24:50.199Z</updated>
    
    <content type="html"><![CDATA[<p>éš”ç¦»æ€§ï¼Œè¿˜æœ‰ä¸€ä¸ªè¯´æ³•å°±æ˜¯ æ•°æ®å¯è§æ€§ã€‚</p><p>éš”ç¦»æ€§ã€æ•°æ®å¯è§æ€§æ˜¯ä¸€ä¸ªåœ¨å¹¶å‘äº‹åŠ¡ä¸‹æ‰éœ€è¦è€ƒè™‘çš„é—®é¢˜ï¼Œå¹¶å‘äº‹åŠ¡å¯ä»¥åˆ†3ç§æƒ…å†µè€ƒè™‘</p><ol><li>è¯»-è¯»ï¼Œ è¯»æ“ä½œä¸ä¼šå¯¹æ•°æ®äº§ç”Ÿå½±å“ï¼Œæ‰€ä»¥ä¸éœ€è¦å…³æ³¨</li><li>è¯»-å†™ or å†™-è¯»ï¼Œ å¯èƒ½ä¼šå‡ºç°è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</li><li>å†™-å†™ï¼Œå¯èƒ½ä¼šè„å†™çš„æƒ…å†µ</li></ol><p>å¹¶å‘äº‹åŠ¡ä¸‹çš„æ•°æ®çš„ä¸€è‡´æ€§å†™é—®é¢˜</p><ul><li>è„å†™ï¼šä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡ä¿®æ”¹è¿‡çš„æ•°æ®ã€‚</li></ul><p>å¹¶å‘äº‹åŠ¡ä¸‹çš„æ•°æ®çš„ä¸€è‡´æ€§è¯»é—®é¢˜</p><ul><li><strong>è„è¯»</strong>ï¼šäº‹åŠ¡è¯»å–äº†æœªæäº¤çš„æ•°æ®ï¼Œå¯èƒ½é€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚</li><li><strong>ä¸å¯é‡å¤è¯»</strong>ï¼šäº‹åŠ¡åœ¨å†…éƒ¨çš„å¤šæ¬¡è¯»å–ä¸­çœ‹åˆ°äº†åŒä¸€æ•°æ®çš„ä¸åŒç‰ˆæœ¬ï¼Œä¸»è¦ç”±äºå…¶ä»–äº‹åŠ¡çš„æ›´æ–°æ“ä½œã€‚</li><li><strong>å¹»è¯»</strong>ï¼šäº‹åŠ¡åœ¨ä¸¤æ¬¡æŸ¥è¯¢åŒä¸€ä¸ªèŒƒå›´æ—¶çœ‹åˆ°äº†ä¸ä¸€æ ·çš„è¡Œï¼Œé€šå¸¸æ˜¯å› ä¸ºå…¶ä»–äº‹åŠ¡æ·»åŠ æˆ–åˆ é™¤äº†è¡Œã€‚</li></ul><p>MySQL  çš„ 4ç§ äº‹åŠ¡éš”ç¦»çº§åˆ«</p><div class="table-container"><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>è§£å†³çš„é—®é¢˜</th><th>æœªè§£å†³çš„é—®é¢˜</th><th>åŸç†æè¿°</th></tr></thead><tbody><tr><td><strong>è¯»æœªæäº¤</strong></td><td>æ— </td><td>è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</td><td>å…è®¸äº‹åŠ¡è¯»å–å…¶ä»–äº‹åŠ¡æœªæäº¤çš„ä¿®æ”¹ï¼Œå¯èƒ½å¯¼è‡´è„è¯»ã€‚</td></tr><tr><td><strong>è¯»å·²æäº¤</strong></td><td>è„è¯»</td><td>ä¸å¯é‡å¤è¯»ã€å¹»è¯»</td><td>åªèƒ½çœ‹åˆ°å·²ç»è¢«å…¶ä»–äº‹åŠ¡æäº¤çš„æ•°æ®ï¼Œé¿å…äº†è„è¯»ï¼Œä½†ä¸èƒ½é˜²æ­¢åœ¨åŒä¸€äº‹åŠ¡ä¸­çœ‹åˆ°ä¸ä¸€è‡´çš„æ•°æ®ã€‚</td></tr><tr><td><strong>å¯é‡å¤è¯»</strong></td><td>è„è¯»ã€ä¸å¯é‡å¤è¯»</td><td>MySQL åœ¨è¯¥éš”ç¦»çº§åˆ«ä¸‹åŠ ä¸Šgap é”å¯éƒ¨åˆ†è§£å†³å¹»è¯»é—®é¢˜</td><td>åœ¨äº‹åŠ¡å¼€å§‹åæ‰€æœ‰SELECTæ“ä½œéƒ½çœ‹åˆ°ä¸€è‡´çš„å¿«ç…§ï¼Œé¿å…äº†ä¸å¯é‡å¤è¯»ï¼Œä½†æ— æ³•é˜²æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥æ–°è¡Œï¼ˆå¹»è¯»ï¼‰ã€‚</td></tr><tr><td><strong>ä¸²è¡ŒåŒ–</strong></td><td>è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</td><td>æ— </td><td>â€œå†™â€ä¼šåŠ â€œå†™é”â€ï¼Œâ€œè¯»â€ä¼šåŠ â€œè¯»é”â€ã€‚å½“å‡ºç°è¯»å†™é”å†²çªçš„æ—¶å€™ï¼Œåè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚é€šè¿‡å¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œé˜²æ­¢äº†è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ï¼Œæä¾›äº†æœ€é«˜çº§åˆ«çš„éš”ç¦»ã€‚</td></tr></tbody></table></div><p>ç”±äºè„å†™å¯¼è‡´çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜éå¸¸ä¸¥é‡ï¼Œä»»ä½•ä¸€ç§éš”ç¦»çº§åˆ«ä¸‹éƒ½ä¸å…è®¸å‘ç”Ÿï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹æ“ä½œå¿…é¡»é€šè¿‡é”ä¸²è¡Œæ‰§è¡Œ</p><p>InnoDB åœ¨è§£å†³ å¹¶å‘äº‹åŠ¡æ—¶ï¼Œåˆ†æˆä¸¤ç§æƒ…å†µå¯¹åº”ä¸åŒçš„è§£å†³æ–¹æ¡ˆ</p><ol><li>å¿«ç…§è¯»-MVCC</li><li>å½“å‰è¯»- é”</li></ol><h1 id="1-å¿«ç…§è¯»çš„éš”ç¦»æ€§-mvcc"><a href="#1-å¿«ç…§è¯»çš„éš”ç¦»æ€§-MVCC" class="headerlink" title="1 å¿«ç…§è¯»çš„éš”ç¦»æ€§-MVCC"></a>1 å¿«ç…§è¯»çš„éš”ç¦»æ€§-MVCC</h1><ul><li><strong>ä¸€è‡´æ€§è§†å›¾</strong>ï¼šåœ¨å¿«ç…§è¯»ä¸­ï¼Œäº‹åŠ¡ä¼šåˆ›å»ºä¸€ä¸ªä¸€è‡´æ€§è§†å›¾ï¼ˆConsistent Read Viewï¼‰ï¼Œç¡®ä¿å½“å‰äº‹åŠ¡è¯»å–åˆ°çš„éƒ½æ˜¯äº‹åŠ¡å¼€å§‹æ—¶çš„æ•°æ®çŠ¶æ€ã€‚å®ƒä¾èµ–äºMVCCçš„å®ç°ã€‚</li><li><strong>æ— éœ€é”å®š</strong>ï¼šå¿«ç…§è¯»æ˜¯ä¸€ç§æ— é”çš„è¯»å–ï¼Œå³è¯»å–æ•°æ®æ—¶ä¸éœ€è¦å¯¹è¡Œè®°å½•è¿›è¡Œé”å®šï¼Œå› æ­¤å®ƒä¸ä¼šé˜»å¡äº‹åŠ¡çš„è¯»å†™ï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šè¢«å…¶ä»–äº‹åŠ¡çš„è¯»å†™æ“ä½œé˜»å¡ã€‚</li><li><strong>éš”ç¦»çº§åˆ«å½±å“</strong>ï¼šå¿«ç…§è¯»çš„è¡Œä¸ºå—äº‹åŠ¡éš”ç¦»çº§åˆ«çš„å½±å“ï¼Œä¸åŒçš„éš”ç¦»çº§åˆ«ä¼šå½±å“è¯»å–åˆ°çš„ç‰ˆæœ¬ã€‚<ul><li>åœ¨è¯»æœªæäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½è¯»å–æœ€æ–°äº‹åŠ¡ï¼›</li><li>åœ¨ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«ä¸‹ï¼Œä½¿ç”¨é”æ§åˆ¶æ•°æ®çš„è®¿é—®ã€‚</li><li>åœ¨è¯»å·²æäº¤å’Œå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œä½¿ç”¨MVCC æ¥æ§åˆ¶æ•°æ®çš„å¯è§æ€§ã€‚</li></ul></li></ul><p>InnoDBå­˜å‚¨å¼•æ“çš„MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æœºåˆ¶æ˜¯åŸºäºReadViewå’ŒUndo Logå…±åŒå®ç°çš„ï¼Œå…³é”®æ˜¯é€šè¿‡<code>TRX_ID</code>å’Œ<code>ROLL_PTR</code>ä¸¤ä¸ªè¡Œè®°å½•éšè—åˆ—æ¥è·Ÿè¸ªå’Œç®¡ç†æ¯ä¸€è¡Œçš„ä¿®æ”¹ç‰ˆæœ¬ã€‚</p><h2 id="11-ç‰ˆæœ¬é“¾-undo-log"><a href="#1-1-ç‰ˆæœ¬é“¾-undo-log" class="headerlink" title="1.1 ç‰ˆæœ¬é“¾ -undo log"></a>1.1 ç‰ˆæœ¬é“¾ -undo log</h2><p>åœ¨åŸºäºundo log å®ç°åŸå­æ€§ ä¸€æ–‡ä¸­ï¼Œå¯ä»¥çœ‹åˆ°</p><ol><li>è¡Œè®°å½•ä¸­æœ‰roll_pointer,</li><li>update æ“ä½œä¸­TRX_UNDO_UPD_EXIST_REC å’Œ TRX_UNDO_DEL_MARK_REC ç±»å‹çš„undo log ä¸­ï¼Œä¹Ÿæœ‰roll_pointer,<br>é€šè¿‡è¿™äº›roll_pointer, å¯ä»¥å½¢æˆä¸€æ¡è¡Œè®°å½•çš„ç‰ˆæœ¬é“¾ã€‚</li></ol><p>insert æ“ä½œä¸­ï¼Œå¯¹åº”çš„undo logæ²¡æœ‰roll_pointer å±æ€§ï¼Œå› ä¸ºinsert æ“ä½œå°±æ˜¯ä¸€ä¸ªè¡Œè®°å½•çš„åˆå§‹ç‰ˆæœ¬ï¼Œæ²¡æœ‰æ¯”å®ƒæ›´æ—©çš„æ“ä½œäº†ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªé€šè¿‡roll_pointer ç»„æˆçš„ç‰ˆæœ¬é“¾ï¼Œæ¯ä¸ªundo log è¿›è¡Œäº†å†…å®¹çœç•¥ä»¥å±•ç¤ºé“¾æ¥çš„é‡ç‚¹å†…å®¹</p><img src="/9faedfe0/1.png" class><h2 id="12-readview"><a href="#1-2-readview" class="headerlink" title="1.2 readview"></a>1.2 readview</h2><p>æœ‰äº†ç‰ˆæœ¬é“¾ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•åˆ¤æ–­å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®å¯¹å½“å‰äº‹åŠ¡å¯è§å‘¢ï¼Œè¿™é‡Œéœ€è¦å¼•å…¥readview æ¦‚å¿µã€‚</p><p>Read View ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªå…³é”®çš„éƒ¨åˆ†ï¼š</p><ol><li><strong>m_ids</strong>ï¼šå½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„äº‹åŠ¡IDåˆ—è¡¨ã€‚è¿™äº›äº‹åŠ¡åœ¨ç”Ÿæˆ Read View æ—¶å·²ç»å¼€å§‹ä½†å°šæœªæäº¤ã€‚</li><li><strong>min_trx_id</strong>ï¼šç”Ÿæˆ Read View æ—¶ï¼Œæ´»è·ƒäº‹åŠ¡IDä¸­çš„æœ€å°å€¼ã€‚è¿™æ˜¯å› ä¸ºä»»ä½• ID å°äºæ­¤å€¼çš„äº‹åŠ¡åœ¨ Read View ç”Ÿæˆå‰å·²ç»æäº¤ã€‚</li><li><strong>max_trx_id</strong>ï¼šç”Ÿæˆ Read View æ—¶ï¼Œå·²çŸ¥çš„ä¸‹ä¸€ä¸ªäº‹åŠ¡IDã€‚ä»»ä½•å¤§äºæˆ–ç­‰äºæ­¤ ID çš„äº‹åŠ¡åœ¨ç”Ÿæˆ Read View åå¼€å§‹çš„ã€‚</li><li><strong>creator_trx_id</strong>ï¼šç”Ÿæˆè¿™ä¸ª Read View çš„äº‹åŠ¡çš„äº‹åŠ¡IDã€‚ ä¸€ä¸ªäº‹åŠ¡åªæœ‰è¿›è¡Œä¿®æ”¹æ“ä½œæ—¶ï¼Œæ‰ä¼šè¢«åˆ†é…trx_id, å¦åˆ™ä¸€ä¸ªäº‹åŠ¡çš„trx_id é»˜è®¤éƒ½æ˜¯0ï¼Œ æ‰€ä»¥ creator_trx_id ä¹Ÿæœ‰å¯èƒ½æ—¶0</li></ol><p><strong>è¿ä½œæ–¹å¼</strong>ï¼š</p><ul><li>å½“äº‹åŠ¡æ‰§è¡ŒæŸ¥è¯¢æ“ä½œæ—¶ï¼Œå®ƒä¼šæ ¹æ®è‡ªå·±çš„ Read View æ¥åˆ¤æ–­æ•°æ®è¡Œçš„å¯è§æ€§ã€‚å…·ä½“æ¥è¯´ï¼Œæ¯è¡Œæ•°æ®éƒ½æœ‰è‡ªå·±çš„ç³»ç»Ÿç‰ˆæœ¬å·ï¼ˆtrx_idï¼Œå³äº‹åŠ¡IDï¼‰ã€‚Read View é€šè¿‡ä»¥ä¸‹é€»è¾‘æ¥ç¡®å®šè¡Œçš„å¯è§æ€§ï¼š<ol><li>å¦‚æœè¡ŒåŠè®°å½•çš„trx_id  å’Œcreator_trx_id ç›¸ç­‰ï¼Œè¯´æ˜å½“å‰äº‹åŠ¡åœ¨è®¿é—®è‡ªå·±ä¿®æ”¹çš„æ•°æ®ï¼Œæ•°æ®å¯è§ã€‚</li><li>å¦‚æœè¡Œçš„ç‰ˆæœ¬å·å°äº min_trx_idï¼Œè¯´æ˜è¡Œæ˜¯åœ¨ Read View ç”Ÿæˆä¹‹å‰è¢«åˆ›å»ºæˆ–æœ€åä¿®æ”¹çš„ï¼Œå› æ­¤å¯¹å½“å‰äº‹åŠ¡å¯è§ã€‚</li><li>å¦‚æœè¡Œçš„ç‰ˆæœ¬å·å¤§äºæˆ–ç­‰äº max_trx_idï¼Œè¯´æ˜è¡Œæ˜¯åœ¨ Read View ç”Ÿæˆä¹‹åè¢«åˆ›å»ºæˆ–ä¿®æ”¹çš„ï¼Œå› æ­¤å¯¹å½“å‰äº‹åŠ¡ä¸å¯è§ã€‚</li><li>å¦‚æœè¡Œçš„ç‰ˆæœ¬å·åœ¨ min_trx_id å’Œ max_trx_id ä¹‹é—´ï¼Œè¿˜éœ€è¦æ£€æŸ¥è¿™ä¸ªç‰ˆæœ¬å·æ˜¯å¦å±äº m_ids åˆ—è¡¨ä¸­çš„æŸä¸ªäº‹åŠ¡ï¼š<ul><li>å¦‚æœå±äºï¼Œè¯´æ˜è¯¥è¡Œå¯èƒ½ç”±å°šæœªæäº¤çš„äº‹åŠ¡ä¿®æ”¹ï¼Œå¯¹å½“å‰äº‹åŠ¡ä¸å¯è§ã€‚</li><li>å¦‚æœä¸å±äºï¼Œè¯´æ˜è¯¥è¡Œç”±å·²æäº¤çš„äº‹åŠ¡ä¿®æ”¹ï¼Œå¯¹å½“å‰äº‹åŠ¡å¯è§ã€‚</li></ul></li></ol></li></ul><p>å¦‚æœæŸä¸ªç‰ˆæœ¬çš„æ•°æ®å¯¹å½“å‰äº‹åŠ¡ä¸å¯è§ï¼Œé‚£å°±é¡ºç€ç‰ˆæœ¬é“¾æ‰¾æ´—ä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œå¹¶æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤è¿›è¡Œåˆ¤æ–­ã€‚å¦‚æœä¸€ä¸ªæ•°æ®ç›´åˆ°æœ€åä¸€ä¸ªç‰ˆæœ¬éƒ½ä¸å¯è§ï¼Œé‚£å°±è¯´æ˜è¯¥æ¡æ•°æ®å¯¹å½“å‰äº‹åŠ¡å®Œå…¨ä¸å¯è§</p><h3 id="121-readview-å’Œ-è¯»å·²æäº¤read-committed"><a href="#1-2-1-readview-å’Œ-è¯»å·²æäº¤ï¼ˆRead-Committedï¼‰" class="headerlink" title="1.2.1  readview å’Œ è¯»å·²æäº¤ï¼ˆRead Committedï¼‰"></a>1.2.1  readview å’Œ è¯»å·²æäº¤ï¼ˆRead Committedï¼‰</h3><ul><li><strong>ç”Ÿæˆæ—¶æœº</strong>ï¼šåœ¨ RC éš”ç¦»çº§åˆ«ä¸‹ï¼ŒRead View ä¸æ˜¯åœ¨äº‹åŠ¡å¼€å§‹æ—¶ç”Ÿæˆï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡å†…æ¯æ¬¡æ‰§è¡Œ SQL æŸ¥è¯¢æ—¶éƒ½ä¼šç”Ÿæˆæ–°çš„readview, æ‰€ä»¥è¯¥äº‹åŠ¡å†…æ˜¯å¯ä»¥çœ‹åˆ°å…¶ä»–äº‹åŠ¡å·²æäº¤çš„å¯¹æ•°æ®çš„ä¿®æ”¹ï¼Œè¿™åœ¨æ•°æ®ä¸€è‡´æ€§ä¸Šå°±è¡¨ç°ä¸º<code>ä¸å¯é‡å¤è¯»</code></li><li><strong>è¡Œä¸º</strong>ï¼šæ¯æ¬¡æŸ¥è¯¢éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„ Read Viewï¼ŒåŒ…å«å½“å‰æ—¶åˆ»æ‰€æœ‰æœªå®Œæˆçš„äº‹åŠ¡IDã€‚è¿™ç¡®ä¿äº†æŸ¥è¯¢åªèƒ½çœ‹åˆ°é‚£äº›åœ¨æ‰§è¡ŒæŸ¥è¯¢å‰å·²ç»æäº¤çš„äº‹åŠ¡æ‰€åšçš„æ›´æ”¹ã€‚</li></ul><h3 id="122-readview-å’Œ-å¯é‡å¤è¯»repeatable-read"><a href="#1-2-2-readview-å’Œ-å¯é‡å¤è¯»ï¼ˆRepeatable-Readï¼‰" class="headerlink" title="1.2.2 readview å’Œ å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰"></a>1.2.2 readview å’Œ å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰</h3><p>InnoDB çš„ é»˜è®¤éš”ç¦»çº§åˆ«ã€‚</p><ul><li><strong>ç”Ÿæˆæ—¶æœº</strong>ï¼šåœ¨ RR éš”ç¦»çº§åˆ«ä¸‹ï¼ŒRead View æ˜¯åœ¨äº‹åŠ¡çš„ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ“ä½œå¼€å§‹æ—¶åˆ›å»ºçš„ï¼Œä¸”åœ¨æ•´ä¸ªäº‹åŠ¡æœŸé—´ä¿æŒä¸å˜ã€‚è¿™æ„å‘³ç€æ•´ä¸ªäº‹åŠ¡ä¸­æ‰€æœ‰çš„æŸ¥è¯¢éƒ½å°†çœ‹åˆ°ç›¸åŒçš„æ•°æ®å¿«ç…§ã€‚</li><li><strong>è¡Œä¸º</strong>ï¼šä¸€æ—¦ç”Ÿæˆï¼Œè¿™ä¸ª Read View å°†åŒ…å«äº‹åŠ¡å¼€å§‹æ—¶åˆ»çš„æ‰€æœ‰æ´»è·ƒäº‹åŠ¡IDã€‚æ— è®ºè¿™äº›äº‹åŠ¡åæ¥å¦‚ä½•æäº¤æˆ–å›æ»šï¼Œå½“å‰äº‹åŠ¡çš„åç»­æŸ¥è¯¢éƒ½ä¸ä¼šæ„ŸçŸ¥åˆ°è¿™äº›å˜åŒ–ã€‚</li></ul><h3 id="123-ä¸¤è€…çš„å¯¹æ¯”"><a href="#1-2-3-ä¸¤è€…çš„å¯¹æ¯”" class="headerlink" title="1.2.3 ä¸¤è€…çš„å¯¹æ¯”"></a>1.2.3 ä¸¤è€…çš„å¯¹æ¯”</h3><ul><li><strong>æ•°æ®å¯è§æ€§</strong>ï¼šåœ¨è¯»å·²æäº¤ä¸­ï¼Œäº‹åŠ¡å¯èƒ½çœ‹åˆ°å…¶ä»–äº‹åŠ¡æäº¤çš„æ›´æ–°ï¼ˆå³äº‹åŠ¡ä¸­çš„æŸ¥è¯¢å¯èƒ½è¿”å›ä¸åŒçš„ç»“æœï¼‰ï¼Œè€Œåœ¨å¯é‡å¤è¯»ä¸­ï¼Œäº‹åŠ¡ä¿è¯äº†å§‹ç»ˆå¯¹æ•°æ®çš„ä¸€è‡´è§†å›¾ã€‚</li><li><strong>Read View çš„ç”Ÿæˆé¢‘ç‡</strong>ï¼šè¯»å·²æäº¤æ¯æ¬¡æŸ¥è¯¢éƒ½é‡æ–°ç”Ÿæˆ Read Viewï¼Œè€Œå¯é‡å¤è¯»åªåœ¨äº‹åŠ¡å¼€å§‹æ—¶ç”Ÿæˆä¸€æ¬¡ã€‚</li><li><strong>ç³»ç»Ÿå¼€é”€</strong>ï¼šç”±äºè¯»å·²æäº¤æ¯æ¬¡æŸ¥è¯¢éƒ½éœ€è¦ç”Ÿæˆ Read Viewï¼Œå¯èƒ½ä¼šæœ‰æ›´é«˜çš„ç³»ç»Ÿå¼€é”€ï¼Œå°¤å…¶æ˜¯åœ¨æŸ¥è¯¢é¢‘ç¹çš„åœºæ™¯ä¸­ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¯é‡å¤è¯»çš„å¼€é”€ä¸»è¦é›†ä¸­åœ¨äº‹åŠ¡å¼€å§‹é˜¶æ®µã€‚</li></ul><h1 id="2-å½“å‰è¯»çš„éš”ç¦»å‹-é”"><a href="#2-å½“å‰è¯»çš„éš”ç¦»å‹-é”" class="headerlink" title="2 å½“å‰è¯»çš„éš”ç¦»å‹-é”"></a>2 å½“å‰è¯»çš„éš”ç¦»å‹-é”</h1><p>å½“å‰è¯»æŒ‡çš„æ˜¯è¯»å–æ•°æ®æ—¶æ€»æ˜¯è·å–æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶é€šè¿‡åŠ é”ï¼ˆè¡Œçº§åˆ«çš„æ’ä»–é”ï¼ŒSé”æˆ–Xé”ï¼‰ä»¥ç¡®ä¿ä¸€è‡´æ€§ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡ä¿®æ”¹æˆ–åˆ é™¤è¿™äº›æ•°æ®ã€‚</p><p>å½“å‰è¯»é€šå¸¸ç”¨äºéœ€è¦ä¿®æ”¹æ•°æ®çš„æŸ¥è¯¢ï¼Œå¦‚</p><ol><li>selectâ€¦lock in share mode (å…±äº«è¯»é”)</li><li>selectâ€¦for update</li><li>UPDATE</li><li>DELETE</li></ol><p>å…³äºè¡Œé”å’Œé—´éš™é”çš„å…·ä½“åŠ é”è§„åˆ™ï¼Œå’Œéš”ç¦»çº§åˆ«å’Œç´¢å¼•æœ‰å…³ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒä½•ç™»æˆçš„åŠ é”åˆ†ææ–‡ç« <br><a href="https://github.com/hedengcheng/tech/blob/master/database/MySQL/MySQL%20%E5%8A%A0%E9%94%81%E5%A4%84%E7%90%86%E5%88%86%E6%9E%90.pdf">MySQL åŠ é”åˆ†æ</a></p><h1 id="3-å¹»è¯»bad-case"><a href="#3-å¹»è¯»bad-case" class="headerlink" title="3. å¹»è¯»bad case"></a>3. å¹»è¯»bad case</h1><p>åœ¨å‰é¢ä»‹ç»éš”ç¦»çº§åˆ«æ—¶ï¼Œæåˆ° åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ åŠ ä¸Š é—´éš™é”ï¼Œ å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šè§£å†³å¹»è§‰ã€‚<br>ä½†æ˜¯å¦‚æœä¸€ä¸ªäº‹åŠ¡ä¸­ å¿«ç…§è¯»å’Œå½“å‰è¯»æ··ç”¨ï¼Œå°±ä¼šå‡ºç°å¹»è¯»bad case.</p><p><a href="https://xiaolincoding.com/mysql/transaction/phantom.html#%E5%B9%BB%E8%AF%BB%E8%A2%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E5%86%B3%E4%BA%86%E5%90%97">å¹»è¯»è¢«å®Œå…¨è§£å†³äº†å—ï¼Ÿ</a> è¿™ç¯‡æ–‡ç« ä¸­ä¾‹ä¸¾ä¸¤ä¸ªå¹»è¯» bad case,è®²çš„æ¯”è¾ƒæ¸…æ™°ï¼Œå¯ä»¥å‚è€ƒ</p><h1 id="4-å½“å‰è¯»vså¿«ç…§è¯»"><a href="#4-å½“å‰è¯»vså¿«ç…§è¯»" class="headerlink" title="4. å½“å‰è¯»vså¿«ç…§è¯»"></a>4. å½“å‰è¯»vså¿«ç…§è¯»</h1><ul><li><strong>å¿«ç…§è¯»ï¼ˆSnapshot Readï¼‰</strong>ï¼š<ul><li>è¯»å–æ•°æ®æ—¶ä½¿ç”¨çš„æ˜¯æŸä¸€æ—¶é—´ç‚¹çš„å¿«ç…§ï¼Œä¸ä¼šåŠ é”ã€‚</li><li>ä½¿ç”¨MVCCæœºåˆ¶ï¼Œæ ¹æ®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«å’Œç‰ˆæœ¬å·è¿”å›åˆé€‚çš„è¡Œç‰ˆæœ¬ã€‚</li><li>é€šå¸¸ç”¨äº<code>SELECT</code>æŸ¥è¯¢ã€‚</li></ul></li><li><strong>å½“å‰è¯»ï¼ˆCurrent Readï¼‰</strong>ï¼š<ul><li>å§‹ç»ˆè¯»å–æœ€æ–°ç‰ˆæœ¬çš„è¡Œã€‚</li><li>å¯èƒ½ä¼šåŠ é”ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡ä¿®æ”¹æˆ–åˆ é™¤è¯»å–çš„æ•°æ®ã€‚</li><li>é€šå¸¸ç”¨äºä¿®æ”¹æ•°æ®çš„æŸ¥è¯¢æ“ä½œï¼Œå¦‚<code>SELECT ... FOR UPDATE</code>ã€<code>SELECT ... LOCK IN SHARE MODE</code>ã€<code>UPDATE</code>å’Œ<code>DELETE</code>ã€‚</li></ul></li></ul><h1 id="ç›¸å…³æ–‡ç« "><a href="#ç›¸å…³æ–‡ç« " class="headerlink" title="ç›¸å…³æ–‡ç« "></a>ç›¸å…³æ–‡ç« </h1><p><a href="https://sunyan.xyz/5b064db6/">Intro to äº‹åŠ¡</a><br><a href="https://sunyan.xyz/9cd551f5/">Intro to InnoDB äº‹åŠ¡</a><br><a href="https://sunyan.xyz/b36b0ce9/">InnoDBäº‹åŠ¡-åŸå­æ€§çš„å®ç°,undo log</a><br><a href="https://sunyan.xyz/6cb5dc64/">InnoDBäº‹åŠ¡-æŒä¹…æ€§çš„å®ç°, binglog &amp; redo log&amp;undo log</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;éš”ç¦»æ€§ï¼Œè¿˜æœ‰ä¸€ä¸ªè¯´æ³•å°±æ˜¯ æ•°æ®å¯è§æ€§ã€‚&lt;/p&gt;
&lt;p&gt;éš”ç¦»æ€§ã€æ•°æ®å¯è§æ€§æ˜¯ä¸€ä¸ªåœ¨å¹¶å‘äº‹åŠ¡ä¸‹æ‰éœ€è¦è€ƒè™‘çš„é—®é¢˜ï¼Œå¹¶å‘äº‹åŠ¡å¯ä»¥åˆ†3ç§æƒ…å†µè€ƒè™‘&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¯»-è¯»ï¼Œ è¯»æ“ä½œä¸ä¼šå¯¹æ•°æ®äº§ç”Ÿå½±å“ï¼Œæ‰€ä»¥ä¸éœ€è¦å…³æ³¨&lt;/li&gt;
&lt;li&gt;è¯»-å†™ or å†™-è¯»ï¼Œ å¯èƒ½ä¼šå‡ºç°è„è¯»ã€ä¸</summary>
      
    
    
    
    
    <category term="MySQL" scheme="http://example.com/tags/MySQL/"/>
    
    <category term="äº‹åŠ¡" scheme="http://example.com/tags/%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>InnoDBäº‹åŠ¡-åŸå­æ€§çš„å®ç°,undo log</title>
    <link href="http://example.com/b36b0ce9/"/>
    <id>http://example.com/b36b0ce9/</id>
    <published>2024-05-02T14:22:30.000Z</published>
    <updated>2024-05-10T15:24:50.194Z</updated>
    
    <content type="html"><![CDATA[<p>åŸå­æ€§æŒ‡çš„æ˜¯äº‹åŠ¡è¦ä¹ˆå®Œå…¨æˆåŠŸæ‰§è¡Œï¼Œè¦ä¹ˆå®Œå…¨å¤±è´¥å›æ»šï¼Œä¸å…è®¸éƒ¨åˆ†æ‰§è¡Œã€‚</p><p>è¿™æœ¬è´¨ä¸Šæ˜¯åœ¨è¦æ±‚å…·æœ‰<code>rollback å›æ»šèƒ½åŠ›</code>ã€‚</p><p>InnoDBä¸­çš„äº‹åŠ¡å¯èƒ½ä¼šç”±ç”¨æˆ·ä¸»åŠ¨è§¦å‘Rollbackï¼›ä¹Ÿå¯èƒ½å› ä¸ºé‡åˆ°æ­»é”å¼‚å¸¸Rollbackï¼›æˆ–è€…å‘ç”ŸCrashï¼Œé‡å¯åå¯¹æœªæäº¤çš„äº‹åŠ¡å›æ»šã€‚</p><p>InnoDB çš„ rollbackå›æ»šèƒ½åŠ› æ˜¯åŸºäº undo log å®ç°çš„ã€‚undo log è®°å½•äº†ä¿®æ”¹æ“ä½œå‰çš„æ—§ç‰ˆæœ¬æ•°æ®ï¼Œä»¥ä¾¿åœ¨å›æ»šæ—¶æ¢å¤æ•°æ®ã€‚</p><h1 id="1-ä¸€æ¡-undo-log-çš„ç»“æ„"><a href="#1-ä¸€æ¡-undo-log-çš„ç»“æ„" class="headerlink" title="1  ä¸€æ¡ undo log  çš„ç»“æ„"></a>1  ä¸€æ¡ undo log  çš„ç»“æ„</h1><h2 id="11-undo-log-çš„åˆ†ç±»"><a href="#1-1-undo-log-çš„åˆ†ç±»" class="headerlink" title="1.1  undo log çš„åˆ†ç±»"></a>1.1  undo log çš„åˆ†ç±»</h2><p>åªæœ‰åœ¨äº‹åŠ¡ä¸­å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼ˆå¦‚ INSERTã€DELETEã€UPDATEï¼‰çš„æ—¶å€™ï¼Œ æ‰éœ€è¦è®°å½•undo logï¼Œå¿«ç…§è¯» select  ä¸éœ€è¦è®°å½•ã€‚</p><p>ä¸åŒçš„ä¿®æ”¹æ“ä½œäº§ç”Ÿçš„ <code>undo log</code> è®°å½•çš„å†…å®¹å’Œç»“æ„ä¼šæœ‰æ‰€ä¸åŒï¼Œå› ä¸ºæ¯ç§æ“ä½œå¯¹æ•°æ®çš„å½±å“ä¸åŒ, æ‰€ä»¥undo log ä¹Ÿä¼šæœ‰ä¸åŒçš„ç±»å‹ã€‚</p><p>InnoDB çš„ undo log ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p><ol><li><strong>TRX_UNDO_INSERT</strong>ï¼šæ­¤ç±»ä¸»è¦åŒ…æ‹¬ <code>TRX_UNDO_INSERT_REC</code> ç±»å‹çš„æ—¥å¿—ï¼Œä¸“é—¨ç”¨äºè®°å½•æ’å…¥æ“ä½œçš„æ’¤é”€ä¿¡æ¯ã€‚</li><li><strong>TRX_UNDO_UPDATE</strong>ï¼šæ­¤ç±»åŒ…æ‹¬ <code>TRX_UNDO_UPD_EXIST_REC</code> å’Œ <code>TRX_UNDO_DEL_MARK_REC</code>ï¼Œç”¨äºè®°å½•æ›´æ–°å­˜åœ¨çš„è®°å½•å’Œæ ‡è®°åˆ é™¤æ“ä½œçš„æ’¤é”€ä¿¡æ¯ã€‚</li></ol><ul><li><strong>å…±åŒç‚¹</strong>ï¼šæ‰€æœ‰ç±»å‹çš„æ“ä½œéƒ½éœ€è¦ä¸”åªéœ€è¦è®°å½•<code>è¶³å¤Ÿçš„ä¿¡æ¯</code>æ¥é€†è½¬æ‰€æ‰§è¡Œçš„æ“ä½œã€‚è¿™äº›è®°å½•éƒ½å­˜å‚¨åœ¨ InnoDB çš„ undo è¡¨ç©ºé—´æˆ–è€…ç³»ç»Ÿè¡¨ç©ºé—´ä¸­</li><li><strong>å·®å¼‚</strong>ï¼šä¸åŒæ“ä½œç±»å‹çš„ undo æ—¥å¿—è®°å½•çš„å…·ä½“å†…å®¹æ ¹æ®æ“ä½œçš„æ€§è´¨è€Œå¼‚ã€‚INSERT ä¸»è¦å…³æ³¨æ ‡è®°æ–°å¢è¡Œçš„åˆ é™¤ï¼ŒDELETE éœ€è¦è®°å½•å®Œæ•´çš„è¡Œæ•°æ®ä»¥ä¾¿æ¢å¤ï¼Œè€Œ UPDATE è®°å½•ä¿®æ”¹å‰çš„å­—æ®µå€¼ã€‚</li></ul><p>âš ï¸ï¼šå¯¹äº undo log çš„è®°å½•å¹¶ä¸æ˜¯åŸºäºæ¯æ¡ä¿®æ”¹ SQL è¯­å¥ï¼Œè€Œæ˜¯åŸºäº ä¿®æ”¹SQL è¯­å¥å½±å“çš„æ¯ä¸€æ¡è®°å½•ã€‚è¿™æ„å‘³ç€æ¯æ¡è¢«ä¿®æ”¹çš„è®°å½•éƒ½ä¼šæœ‰å¯¹åº”çš„ undo log ã€‚å¦‚æœä¸€ä¸ª SQL è¯­å¥å½±å“ä¿®æ”¹äº†å¤šè¡Œæ•°æ®ï¼Œé‚£ä¹ˆå°†ä¼šæœ‰å¤šæ¡ undo log ç”Ÿæˆã€‚</p><h2 id="12-insert-æ“ä½œçš„-undo-log"><a href="#1-2-INSERT-æ“ä½œçš„-Undo-log" class="headerlink" title="1.2  INSERT æ“ä½œçš„ Undo log"></a>1.2  INSERT æ“ä½œçš„ Undo log</h2><p>å¯¹äº INSERT æ“ä½œï¼Œundo æ—¥å¿—é€šå¸¸è®°å½•è¾ƒå°‘çš„ä¿¡æ¯ï¼Œä¸»è¦æ˜¯æŠŠè¿™æ¡è®°å½•çš„ä¸»é”®ä¿¡æ¯è®°ä¸Šã€‚<br><img src="/b36b0ce9/1.png" class></p><h3 id="121-end-of-record-å’Œ-start-of-record"><a href="#1-2-1-end-of-record-å’Œ-start-of-record" class="headerlink" title="1.2.1 end of record  å’Œ start of record"></a>1.2.1 end of record  å’Œ start of record</h3><p>åœ¨InnoDBçš„undoæ—¥å¿—ç»“æ„ä¸­ï¼Œ<code>end of record</code>å’Œ<code>start of record</code> ä¸¤ä¸ªå­—æ®µå…±åŒèµ·åˆ°é“¾æ¥undoæ—¥å¿—è®°å½•çš„ä½œç”¨ï¼Œä½¿è¿™äº›è®°å½•å½¢æˆä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¹¶æä¾›é¡ºåºéå†å’Œåå‘éå†çš„åŠŸèƒ½</p><p><strong>end of record</strong></p><ul><li><strong>å®šä¹‰ï¼š</strong><ul><li><code>end of record</code>å­—æ®µæŒ‡ç¤ºå½“å‰undoæ—¥å¿—è®°å½•çš„ç»“æŸä½ç½®ï¼Œå¹¶æä¾›ä¸‹ä¸€æ¡undoæ—¥å¿—è®°å½•çš„èµ·å§‹åœ°å€ã€‚</li><li>å½“æœ€åä¸€æ¡undoæ—¥å¿—è®°å½•æ²¡æœ‰åç»§æ—¶ï¼Œåˆ™ä¸‹ä¸€æ¡undoæ—¥å¿—è®°å½•çš„èµ·å§‹åœ°å€ä¸ºNULL</li></ul></li><li><strong>ç›®çš„ï¼š</strong><ul><li>æŒ‡å‘é“¾è¡¨ä¸­çš„ä¸‹ä¸€æ¡è®°å½•ï¼Œæ–¹ä¾¿<code>é¡ºåºéå†</code>æ—¥å¿—è®°å½•ï¼Œå¯ä»¥ç”¨äºå›æ”¾æˆ–è€…é‡åšæ—¥å¿—ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¢å¤é˜¶æ®µ</li></ul></li></ul><p><strong>start of record</strong></p><ul><li><strong>å®šä¹‰ï¼š</strong><ul><li><code>start of record</code>å­—æ®µæŒ‡ç¤ºå½“å‰undoæ—¥å¿—è®°å½•çš„èµ·å§‹ä½ç½®ï¼Œå¹¶æä¾›ä¸Šä¸€æ¡undoæ—¥å¿—è®°å½•çš„ç»“æŸåœ°å€ã€‚</li><li>å¦‚æœå½“å‰undoæ—¥å¿—è®°å½•æ˜¯é“¾è¡¨ä¸­çš„ç¬¬ä¸€æ¡ï¼Œåˆ™ä¸Šä¸€æ¡undoæ—¥å¿—è®°å½•çš„ç»“æŸåœ°å€ä¸º<code>NULL</code>ã€‚</li></ul></li><li><strong>ç›®çš„ï¼š</strong><ul><li>æŒ‡å‘é“¾è¡¨ä¸­çš„ä¸Šä¸€æ¡è®°å½•ï¼Œæ–¹ä¾¿<code>åå‘éå†</code>æ—¥å¿—è®°å½•ï¼Œç”¨äºäº‹åŠ¡å›æ»š</li></ul></li></ul><img src="/b36b0ce9/2.png" class><h3 id="122-undo-type"><a href="#1-2-2-undo-type" class="headerlink" title="1.2.2 undo type"></a>1.2.2 undo type</h3><p>è¯¥å­—æ®µæŒ‡å®šundoæ—¥å¿—è®°å½•çš„ç±»å‹, ç”¨äºåŒºåˆ†ä¸åŒç±»å‹çš„undoæ“ä½œï¼Œå¦‚<code>TRX_UNDO_INSERT_REC</code> ã€ <code>TRX_UNDO_UPD_EXIST_REC</code> å’Œ <code>TRX_UNDO_DEL_MARK_REC</code></p><h3 id="123-undo-no"><a href="#1-2-3-undo-no" class="headerlink" title="1.2.3 undo no"></a>1.2.3 undo no</h3><p>æ—¥å¿—ç¼–å·ï¼Œ åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä»0å¼€å§‹é€’å¢ï¼Œæ¯ç”Ÿæˆä¸€æ¡æ—¥å¿—ï¼Œundo no å°±åŠ 1</p><h3 id="124-table-id"><a href="#1-2-4-table-id" class="headerlink" title="1.2.4 table id"></a>1.2.4 table id</h3><p>åŸå§‹è®°å½•æ‰€åœ¨è¡¨çš„æ ‡è¯†ç¬¦ï¼Œä½¿undoæ—¥å¿—èƒ½å¤Ÿä¸åŸå§‹è®°å½•æ‰€åœ¨çš„è¡¨å…³è”ã€‚</p><h3 id="125"><a href="#1-2-5" class="headerlink" title="1.2.5 "></a>1.2.5 <len, value></len,></h3><p>æ­¤éƒ¨åˆ†ä»¥<code>&lt;é•¿åº¦ï¼Œå€¼&gt;</code>çš„å½¢å¼ä¿å­˜æ¯ä¸ªä¸»é”®åˆ—çš„ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨å›æ»šæ’å…¥æ“ä½œæ—¶æ¢å¤ä¸»é”®å€¼ï¼š</p><ol><li>lenï¼šè¡¨ç¤ºå¯¹åº”åˆ—çš„å­˜å‚¨ç©ºé—´å¤§å°ã€‚</li><li>valueï¼šå­˜å‚¨ä¸»é”®çš„å®é™…å€¼ã€‚</li></ol><h2 id="13-delete-æ“ä½œçš„-undo-log-æ ‡è®°åˆ é™¤"><a href="#1-3-DELETE-æ“ä½œçš„-Undo-log-æ ‡è®°åˆ é™¤" class="headerlink" title="1.3  DELETE æ“ä½œçš„ Undo log-æ ‡è®°åˆ é™¤"></a>1.3  DELETE æ“ä½œçš„ Undo log-æ ‡è®°åˆ é™¤</h2><img src="/b36b0ce9/3.png" class><ol><li>trx_id<br>è®°å½•ä¸Šä¸€ä¸ªæ—§ç‰ˆæœ¬æ•°æ®çš„trx_id,  è¯¥å€¼ä»è¡Œè®°å½•çš„éšè—åˆ—trx_id ä¸­è·å–<ul><li><strong>ç›®çš„ï¼š</strong> åœ¨å›æ»šè¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªå­—æ®µå¯ä»¥å¸®åŠ©æ¢å¤è¢«åˆ é™¤çš„è®°å½•çš„åŸå§‹äº‹åŠ¡ä¿¡æ¯ï¼Œç¡®ä¿åœ¨æ¢å¤æœŸé—´ä¸ä¼šå‡ºç°ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</li></ul></li><li>roll_pointer<br>è®°å½•ä¸Šä¸€ä¸ªæ—§ç‰ˆæœ¬æ•°æ®çš„roll_pointer,  è¯¥å€¼ä»è¡Œè®°å½•çš„éšè—åˆ—roll_pointer ä¸­è·å–<ul><li><strong>æè¿°ï¼š</strong> æŒ‡å‘è¢«åˆ é™¤è®°å½•çš„åŸå§‹å›æ»šæŒ‡é’ˆ (<code>roll_pointer</code>)ã€‚</li></ul></li></ol><p>åœ¨InnoDBä¸­ï¼Œæ¯æ¡è¡Œè®°å½•éƒ½æœ‰ä¸€ä¸ªä½ï¼ˆbitï¼‰æ ‡è®°æ¥æŒ‡ç¤ºè¯¥è®°å½•çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬æ˜¯å¦å·²è¢«åˆ é™¤ã€‚è¿™æ˜¯é€šè¿‡è®°å½•å¤´ï¼ˆRecord Headerï¼‰ä¸­çš„<code>info bits</code>å­—æ®µå®ç°çš„ã€‚</p><h3 id="131-æ ‡è®°åˆ é™¤"><a href="#1-3-1-æ ‡è®°åˆ é™¤" class="headerlink" title="1.3.1 æ ‡è®°åˆ é™¤"></a>1.3.1 æ ‡è®°åˆ é™¤</h3><p>TRX_UNDO_DEL_MARK_REC æ—¥å¿— æŒ‡çš„æ˜¯å¯¹è®°å½•çš„é€»è¾‘åˆ é™¤ï¼Œé€»è¾‘åˆ é™¤æŒ‡çš„æ˜¯åªè¢«æ ‡è®°ä¸ºåˆ é™¤çŠ¶æ€ï¼Œå¹¶ä¸ä¼šç«‹å³å°†å…¶ç‰©ç†åˆ é™¤ï¼Œå› ä¸ºè¿˜è¦æ”¯æŒäº‹åŠ¡å›æ»šï¼Œä»¥åŠMVCCã€‚</p><p>è¢«æ ‡è®°åˆ é™¤çš„æ•°æ®å¦‚æœçœŸçš„éœ€è¦åˆ é™¤ï¼Œä¼šåœ¨é€‚å½“çš„æ—¶å€™ç”±åå°çº¿ç¨‹å®é™…æ¸…ç†</p><h3 id="132-è¡Œè®°å½•çš„åˆ é™¤æ ‡è®°"><a href="#1-3-2-è¡Œè®°å½•çš„åˆ é™¤æ ‡è®°" class="headerlink" title="1.3.2  è¡Œè®°å½•çš„åˆ é™¤æ ‡è®°"></a>1.3.2  è¡Œè®°å½•çš„åˆ é™¤æ ‡è®°</h3><p>æ¯æ¡è¡Œè®°å½•çš„å¤´éƒ¨éƒ½æœ‰ä¸€ä¸ª<code>info bits</code>å­—æ®µï¼Œç”¨æ¥å­˜å‚¨è®°å½•çš„çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ˜¯å¦å·²è¢«åˆ é™¤ã€‚</p><p>åœ¨<code>info bits</code>å­—æ®µçš„ç¬¬5ä¸ªbitä½ä¸Šï¼Œæ ‡è®°è®°å½•æ˜¯å¦å·²è¢«åˆ é™¤ï¼Œ å½“æ­¤bitä½ä¸º<code>1</code>æ—¶ï¼Œè¡¨ç¤ºè¯¥è®°å½•å·²è¢«æ ‡è®°åˆ é™¤ï¼›ä¸º<code>0</code>æ—¶ï¼Œè¡¨ç¤ºè¯¥è®°å½•æ˜¯æ­£å¸¸çš„ã€‚</p><h2 id="14-update-æ“ä½œçš„-undo-log"><a href="#1-4-UPDATE-æ“ä½œçš„-Undo-log" class="headerlink" title="1.4 UPDATE æ“ä½œçš„ Undo log"></a>1.4 UPDATE æ“ä½œçš„ Undo log</h2><p>update çš„æ“ä½œ åˆ†ä¸ºä¸¤ç§</p><ol><li><p>ä¸æ›´æ–°ä¸»é”®çš„update,  è¿™ç§æ“ä½œ ä¸€æ¡è®°å½• åªä¼šTRX_UNDO_UPD_EXIST_REC ä¸€æ¡undo log</p></li><li><p>æ›´æ–°ä¸»é”®çš„update ï¼Œè¿™ç§updateåœ¨å®é™…æ‰§è¡Œæ—¶ï¼Œ ä¼šå…ˆåˆ é™¤æ—§è®°å½•ï¼Œå†insert ä¸€æ¡æ–°çºªå½•ï¼Œ æ‰€ä»¥ä¼šè®°å½•ä¸¤æ¡undo log, ä¸€æ¡TRX_UNDO_DEL_MARK_RECï¼Œ ä¸€æ¡TRX_UNDO_INSERT_REC</p></li></ol><img src="/b36b0ce9/4.png" class><p>å…·ä½“å­—æ®µä¿¡æ¯å’Œå‰é¢ä¸¤ç§ç±»ä¼¼ï¼Œä¸å†è¯¦è¿°ã€‚</p><h1 id="2ä¸€ä¸ªäº‹åŠ¡ä¸­çš„å¤šæ¡undo-logå¦‚ä½•ç»„ç»‡åœ¨ä¸€èµ·"><a href="#2ä¸€ä¸ªäº‹åŠ¡ä¸­çš„å¤šæ¡undo-logå¦‚ä½•ç»„ç»‡åœ¨ä¸€èµ·" class="headerlink" title="2ä¸€ä¸ªäº‹åŠ¡ä¸­çš„å¤šæ¡undo  logå¦‚ä½•ç»„ç»‡åœ¨ä¸€èµ·"></a>2ä¸€ä¸ªäº‹åŠ¡ä¸­çš„å¤šæ¡undo  logå¦‚ä½•ç»„ç»‡åœ¨ä¸€èµ·</h1><h2 id="21-undo-page-åˆ†ç±»å‹å­˜å‚¨undo-log"><a href="#2-1-undo-page-åˆ†ç±»å‹å­˜å‚¨undo-log" class="headerlink" title="2.1 undo page -åˆ†ç±»å‹å­˜å‚¨undo log"></a>2.1 undo page -åˆ†ç±»å‹å­˜å‚¨undo log</h2><p>InnoDB å¯¹æ•°æ®çš„ç®¡ç†æ˜¯ä»¥ <code>page</code> ä¸ºå•ä½è¿›è¡Œçš„ï¼Œundo log ä¹Ÿéµå¾ªè¿™ä¸€åŸåˆ™ï¼Œå³å­˜å‚¨åœ¨ä¸“é—¨çš„ undo pages ä¸­ã€‚</p><p>æ¯ä¸ª undo page ä¸­çš„æ—¥å¿—è®°å½•æ˜¯ä¸“ç”¨çš„ï¼Œä¸åŒç±»å‹çš„undo log  ä¸èƒ½æ··ç€å­˜å‚¨ï¼Œ å³ä¸€ä¸ª page ä¸­ä¸èƒ½åŒæ—¶è®°å½• <code>TRX_UNDO_INSERT</code> ç±»å‹å’Œ <code>TRX_UNDO_UPDATE</code> ç±»å‹çš„æ—¥å¿—ã€‚</p><p>è¿™æ ·è®¾è®¡çš„ç†ç”±æ˜¯ä¸ºäº†é¿å…åœ¨å›æ»šæ—¶éœ€è¦åœ¨åŒä¸€é¡µé¢ä¸Šæœç´¢ä¸åŒç±»å‹çš„æ—¥å¿—è®°å½•ï¼Œä»è€Œæé«˜äº†å›æ»šæ“ä½œçš„æ•ˆç‡ã€‚</p><p>å¯æ˜¯ ä¸€ä¸ªäº‹åŠ¡å†…å¯ä»¥åŒæ—¶å­˜åœ¨insert undo logå’Œupdate undo log, å¦‚æœäº‹åŠ¡éœ€è¦å›æ»šåˆ™æ‰€æœ‰æ“ä½œéƒ½éœ€è¦å›æ»šï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦åˆ†å¼€å­˜å‚¨å‘¢ï¼Ÿ</p><ol><li><p><strong>ä¼˜åŒ–äº‹åŠ¡å›æ»šçš„é€»è¾‘</strong></p><ul><li><strong>æ“ä½œä¾èµ–æ€§å‡å°‘</strong>ï¼šæ’å…¥æ“ä½œçš„å›æ»šä»…æ¶‰åŠåˆ°åˆ é™¤ä¹‹å‰æ’å…¥çš„è¡Œï¼Œè€Œæ›´æ–°æˆ–åˆ é™¤æ“ä½œçš„å›æ»šéœ€è¦æ¢å¤åŸå§‹æ•°æ®ã€‚å°†è¿™äº›æ“ä½œçš„æ—¥å¿—åˆ†å¼€ï¼Œå¯ä»¥åœ¨å›æ»šæ—¶å‡å°‘å¯¹ä¸åŒç±»å‹æ—¥å¿—å¤„ç†é€»è¾‘çš„ä¾èµ–ï¼Œä½¿å¾—å›æ»šè¿‡ç¨‹æ›´åŠ æ¨¡å—åŒ–å’Œæœ‰åºã€‚</li><li><strong>æ‰§è¡Œæ•ˆç‡</strong>ï¼šåˆ†å¼€å­˜å‚¨ä½¿å¾—å¤„ç†å„è‡ªçš„å›æ»šé€»è¾‘æ—¶å¯ä»¥æ›´åŠ é«˜æ•ˆï¼Œå› ä¸ºæ¯ç§ç±»å‹çš„å›æ»šå¤„ç†åªéœ€å…³æ³¨å…¶å¯¹åº”ç±»å‹çš„æ—¥å¿—é¡µã€‚è¿™å‡å°‘äº†åœ¨å•ä¸€æ—¥å¿—é¡µä¸­æœç´¢å’Œå¤„ç†ä¸åŒç±»å‹æ—¥å¿—çš„å¤æ‚æ€§å’Œæ—¶é—´ã€‚</li></ul></li><li><p><strong>å¹¶è¡Œå¤„ç†</strong><br>å°½ç®¡ä¸€ä¸ªäº‹åŠ¡ä¸­å¯èƒ½å­˜åœ¨å¤šç§ç±»å‹çš„ undo æ—¥å¿—ï¼Œä½†åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œä¸åŒçš„å›æ»šä»»åŠ¡å¯èƒ½ç”±ä¸åŒçš„ç³»ç»Ÿè¿›ç¨‹æˆ–çº¿ç¨‹å¤„ç†ã€‚ä¾‹å¦‚ï¼ŒæŸäº›æƒ…å†µä¸‹ç³»ç»Ÿå¯èƒ½å¹¶è¡Œåœ°å¤„ç† <code>insert undo log</code> å’Œ <code>update undo log</code>ã€‚åˆ†å¼€å­˜å‚¨å¯ä»¥å‡å°‘é”çš„ç«äº‰å’Œç®¡ç†çš„å¤æ‚æ€§ï¼Œæé«˜å¹¶å‘å¤„ç†çš„æ•ˆç‡ã€‚</p></li><li><strong>ç©ºé—´å’Œæ€§èƒ½ç®¡ç†</strong><ul><li><strong>ç®€åŒ–ç©ºé—´å›æ”¶</strong>ï¼šåœ¨äº‹åŠ¡æäº¤åï¼Œ<code>insert undo log</code> å¯ä»¥ç«‹å³è¢«ä¸¢å¼ƒå’Œå›æ”¶ï¼Œå› ä¸ºæ’å…¥æ“ä½œç”Ÿæˆçš„è®°å½•ä¸€æ—¦æäº¤å³è§†ä¸ºæœ‰æ•ˆã€‚è€Œ <code>update undo log</code> å¯èƒ½éœ€è¦è¢«ä¿ç•™ä»¥æ”¯æŒå…¶ä»–äº‹åŠ¡çš„ä¸€è‡´æ€§è¯»ï¼ˆç”±äº MVCCï¼‰ã€‚åˆ†å¼€å­˜å‚¨ä½¿å¾—ç©ºé—´ç®¡ç†æ›´ä¸ºé«˜æ•ˆï¼Œå› ä¸ºå¯ä»¥é’ˆå¯¹æ€§åœ°å¤„ç†å’Œå›æ”¶æ—¥å¿—ç©ºé—´ã€‚</li><li><strong>ä¼˜åŒ–è¯»å–æ€§èƒ½</strong>ï¼šåœ¨äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå°¤å…¶æ˜¯åœ¨ä¸€äº›åªæ¶‰åŠåˆ°ç‰¹å®šç±»å‹æ“ä½œçš„æŸ¥è¯¢æˆ–å›æ»šæ“ä½œä¸­ï¼Œåˆ†å¼€å­˜å‚¨å¯ä»¥ä¼˜åŒ–æ—¥å¿—çš„è¯»å–æ€§èƒ½ï¼Œå› ä¸ºç³»ç»Ÿå¯ä»¥ç›´æ¥å®šä½åˆ°ç›¸å…³ç±»å‹çš„æ—¥å¿—é¡µã€‚</li></ul></li><li><strong>æ—¥å¿—ç»´æŠ¤çš„ç®€åŒ–</strong><ul><li>åˆ†å¼€å­˜å‚¨æœ‰åŠ©äºç®€åŒ–æ—¥å¿—ç»´æŠ¤å’Œæ—¥å¿—ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ç³»ç»Ÿå¯ä»¥æ›´å®¹æ˜“åœ°è¿½è¸ªå’Œç®¡ç†ä¸åŒç±»å‹æ—¥å¿—çš„ç”Ÿæˆã€ä½¿ç”¨å’Œæ¸…ç†å‘¨æœŸã€‚</li></ul></li></ol><h2 id="22-undo-page-é“¾è¡¨"><a href="#2-2-undo-page-é“¾è¡¨" class="headerlink" title="2.2 undo page é“¾è¡¨"></a>2.2 undo page é“¾è¡¨</h2><p>åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå¤šæ¡ undo logã€‚</p><p>å¦‚æœä¸€ä¸ª undo page å¡«æ»¡äº†ï¼Œäº‹åŠ¡ä¼šå‘ç³»ç»Ÿç”³è¯·æ–°çš„undo page,å¹¶å°†å…¶é€šè¿‡é“¾è¡¨ï¼ˆé€šå¸¸æ˜¯ä½¿ç”¨ç±»ä¼¼äºå‰é©±ï¼ˆpreviousï¼‰å’Œåç»§ï¼ˆnextï¼‰æŒ‡é’ˆçš„æœºåˆ¶ï¼‰è¿æ¥èµ·æ¥ã€‚</p><p>å‰é¢æåˆ°è¿‡ï¼Œä¸€ä¸ª undo page ä¸èƒ½æ··åˆå­˜å‚¨ä¸èƒ½ç±»å‹çš„é“¾æ¥ï¼Œ æ‰€ä»¥å¯¹äºä¸€ä¸ªäº‹åŠ¡å®ƒå¯ä»¥æœ‰insert undo page å’Œupdate undo page ä¸¤ä¸ªé“¾è¡¨ã€‚</p><p>æ¯ä¸ªäº‹åŠ¡éƒ½ä¼šåˆ†é…å•ç‹¬çš„é¡µé¢é“¾è¡¨ã€‚</p><img src="/b36b0ce9/5.png" class><p>ä¸‹é¢ç®€å•ä»‹ç»ä¸‹é“¾è¡¨ä¸­ç¬¬ä¸€ä¸ª undo page</p><ol><li><p>file header å¦‚å‰é¢ä»‹ç»ï¼Œä¼šæœ‰ä¸€ä¸ªå­—æ®µæ¥æ ‡è¯†è¯¥page æ˜¯undo page, ç”¨æ¥å­˜å‚¨undo logã€‚</p></li><li><p>undo page header ä¼šè®°å½•è¯¥é¡µé¢å­˜å‚¨çš„undo log ç±»å‹ï¼Œ insert or update</p></li><li><p>undo log segment header , ä¼šè®°å½•è¯¥é“¾è¡¨æ‰€å±çš„segment</p></li><li><p>undo log header ,ç†è®ºä¸Šï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½ä¼šåˆ†é…è‡ªå·±çš„é¡µé¢é“¾è¡¨ï¼Œ ä½†å¦‚æœä¸€ä¸ªäº‹åŠ¡äº§ç”Ÿçš„undo logå¾ˆå°‘ï¼Œé‚£ä¹ˆè¿™ä¸ªé¡µé¢é“¾è¡¨å°±æœ‰å¯èƒ½è¢«é‡ç”¨ã€‚æ‰€ä»¥å®é™…ä¸Šä¸€ä¸ªé¡µé¢é“¾è¡¨ä¸­å®é™…å¯èƒ½å­˜å‚¨å¤šä¸ªäº‹åŠ¡çš„undo log,  undo log header  ä¸­è®°å½•äº†ä¸åŒäº‹åŠ¡é—´æ—¥å¿—çš„åˆ†éš”ä¿¡æ¯ã€‚</p></li></ol><h2 id="23-å›æ»šæ®µ"><a href="#2-3-å›æ»šæ®µ" class="headerlink" title="2.3 å›æ»šæ®µ"></a>2.3 å›æ»šæ®µ</h2><p>InnoDBé»˜è®¤åˆ›å»º128ä¸ªå›æ»šæ®µï¼ˆRollback Segmentsï¼‰ï¼Œç”¨äºç®¡ç†undoæ—¥å¿—ã€‚</p><ul><li><strong>å…ƒæ•°æ®å­˜å‚¨ï¼š</strong> æ¯ä¸ªå›æ»šæ®µçš„å…ƒæ•°æ®å­˜å‚¨åœ¨ç³»ç»Ÿè¡¨ç©ºé—´ç¬¬5å·é¡µé¢ä¸­ã€‚</li><li><strong>Slotç»“æ„</strong>ï¼šæ¯ä¸ªå›æ»šæ®µåŒ…å«1024ä¸ª<code>slot</code>ï¼Œæ¯ä¸ª<code>slot</code>å¯ä»¥æ˜ å°„åˆ°ä¸€ä¸ªUndoé¡µã€‚</li><li><strong>äº‹åŠ¡ä¸å›æ»šæ®µçš„å…³è”ï¼š</strong> äº‹åŠ¡ä¼šåœ¨éœ€è¦çš„æ—¶å€™åˆ†é…ä¸€ä¸ªå›æ»šæ®µã€‚</li><li><strong>è½®è¯¢ç­–ç•¥ï¼š</strong> InnoDBä½¿ç”¨è½®è¯¢æ–¹å¼å°†å›æ»šæ®µåˆ†é…ç»™æ–°äº‹åŠ¡ï¼Œä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚</li></ul><h2 id="24-undoé¡µé“¾è¡¨çš„å½¢æˆä¸ç»´æŠ¤"><a href="#2-4-Undoé¡µé“¾è¡¨çš„å½¢æˆä¸ç»´æŠ¤" class="headerlink" title="2.4  Undoé¡µé“¾è¡¨çš„å½¢æˆä¸ç»´æŠ¤"></a>2.4  Undoé¡µé“¾è¡¨çš„å½¢æˆä¸ç»´æŠ¤</h2><ol><li><strong>äº‹åŠ¡å¼€å§‹ï¼š</strong><ul><li>æ–°çš„äº‹åŠ¡å¼€å§‹æ—¶ï¼Œä¼šåˆ†é…ä¸€ä¸ªæ’å…¥æ®µå’Œä¸€ä¸ªæ›´æ–°æ®µã€‚</li><li>åœ¨åˆ†é…çš„å›æ»šæ®µå¤´é¡µä¸­ï¼Œåˆå§‹åŒ–undoé¡µé“¾è¡¨çš„å¤´æŒ‡é’ˆå’Œå°¾æŒ‡é’ˆã€‚</li></ul></li><li><strong>æŸ¥æ‰¾å¯ç”¨çš„Slotï¼š</strong><ul><li>äº‹åŠ¡åœ¨å¼€å§‹å†™å…¥undoæ—¥å¿—æ—¶ï¼Œä¼šé¦–å…ˆæŸ¥æ‰¾ä¸€ä¸ªå¯ç”¨çš„<code>slot</code>ï¼Œå¹¶åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„undoé¡µé“¾è¡¨ã€‚</li></ul></li><li><strong>åˆ†é…æ–°çš„Undoé¡µï¼š</strong><ul><li>åˆ†é…æ–°çš„undoé¡µï¼Œå°†å…¶æ·»åŠ åˆ°undoé¡µé“¾è¡¨çš„æœ«å°¾ã€‚</li><li>å¦‚æœè¿™æ˜¯é“¾è¡¨çš„ç¬¬ä¸€ä¸ªundoé¡µï¼Œå›æ»šæ®µå¤´é¡µçš„<code>first</code>æŒ‡é’ˆå’Œ<code>last</code>æŒ‡é’ˆä¼šåŒæ—¶æŒ‡å‘è¯¥é¡µã€‚</li></ul></li><li><strong>ç»´æŠ¤Undoé¡µé“¾è¡¨ï¼š</strong><ul><li>å½“undoé¡µé“¾è¡¨ä¸­çš„æœ€åä¸€ä¸ªundoé¡µå·²æ»¡æ—¶ï¼Œåˆ†é…ä¸€ä¸ªæ–°çš„undoé¡µå¹¶é“¾æ¥åˆ°é“¾è¡¨çš„æœ«å°¾ã€‚</li><li>å›æ»šæ®µå¤´é¡µçš„<code>last</code>æŒ‡é’ˆä¼šæŒ‡å‘æ–°åˆ†é…çš„undoé¡µã€‚</li><li>æ–°undoé¡µçš„<code>prev</code>æŒ‡é’ˆæŒ‡å‘é“¾è¡¨çš„å‰ä¸€ä¸ªundoé¡µï¼Œå½¢æˆé“¾è¡¨ç»“æ„ã€‚</li></ul></li></ol><h1 id="3-è¡Œè®°å½•å¦‚ä½•ä¸undo-log-å…³è”-roll_pointer"><a href="#3-è¡Œè®°å½•å¦‚ä½•ä¸undo-log-å…³è”-roll-pointer" class="headerlink" title="3 è¡Œè®°å½•å¦‚ä½•ä¸undo log å…³è” -roll_pointer"></a>3 è¡Œè®°å½•å¦‚ä½•ä¸undo log å…³è” -roll_pointer</h1><img src="/b36b0ce9/6.png" class><p><code>roll_pointer</code> æ˜¯å­˜å‚¨åœ¨æ¯ä¸ªè¡Œè®°å½•ä¸­çš„ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘è¯¥è¡Œè®°å½•ç›¸å…³çš„æœ€è¿‘ä¸€æ¬¡undo log è®°å½•ã€‚</p><p>æ³¨æ„è¿™ä¸ªundo è®°å½•æŒ‡çš„æ˜¯å…·ä½“çš„ undo logï¼Œè€Œä¸æ˜¯æ•´ä¸ªé¡µé¢é“¾è¡¨ã€‚</p><img src="/b36b0ce9/7.png" class><ul><li>å½“è¡Œè®°å½•è¢«ä¿®æ”¹ï¼ˆåŒ…æ‹¬æ›´æ–°ã€åˆ é™¤æˆ–ä½œä¸ºå¤šæ­¥æ“ä½œçš„ä¸€éƒ¨åˆ†çš„æ’å…¥ï¼‰æ—¶ï¼ŒInnoDB é¦–å…ˆä¼šåœ¨ undo æ—¥å¿—ä¸­å†™å…¥ä¸€æ¡è®°å½•ï¼Œè¿™æ¡è®°å½•åŒ…å«äº†è¡Œä¿®æ”¹å‰çš„æ•°æ®ï¼Œå’Œè¡Œè®°å½•ä¸­çš„çš„roll_pointer,</li><li>InnoDB æ›´æ–°è¡Œè®°å½•ä¸­çš„ <code>roll_pointer</code>ï¼Œä½¿å…¶æŒ‡å‘æ–°å†™å…¥çš„ undo æ—¥å¿—è®°å½•ã€‚å¦‚æœè¿™ä¸ªè¡Œå†æ¬¡è¢«ä¿®æ”¹ï¼Œæ–°çš„ undo æ—¥å¿—å°†è¢«å†™å…¥ï¼Œ<code>roll_pointer</code> ä¼šæ›´æ–°ä¸ºæŒ‡å‘è¿™æ¡æ–°çš„è®°å½•ã€‚æ–°çš„undo æ—¥å¿—ä¸­ä¼šè®°å½•ä¹‹å‰çš„roll_pointer</li></ul><h1 id="4-ä¸€æ¡è®°å½•çš„ç‰ˆæœ¬é“¾å¦‚ä½•å½¢æˆ"><a href="#4-ä¸€æ¡è®°å½•çš„ç‰ˆæœ¬é“¾å¦‚ä½•å½¢æˆ" class="headerlink" title="4. ä¸€æ¡è®°å½•çš„ç‰ˆæœ¬é“¾å¦‚ä½•å½¢æˆ"></a>4. ä¸€æ¡è®°å½•çš„ç‰ˆæœ¬é“¾å¦‚ä½•å½¢æˆ</h1><p>InnoDB é€šè¿‡ roll_ptr æŠŠæ¯ä¸€è¡Œçš„å†å²ç‰ˆæœ¬ä¸²è”åœ¨ä¸€èµ·</p><ol><li>è¡Œè®°å½•ä¸­æœ‰roll_pointer,</li><li>update æ“ä½œä¸­TRX_UNDO_UPD_EXIST_REC å’Œ TRX_UNDO_DEL_MARK_REC ç±»å‹çš„undo log ä¸­ï¼Œä¹Ÿæœ‰roll_pointer,<br>é€šè¿‡è¿™äº›roll_pointer, å¯ä»¥å½¢æˆä¸€æ¡è¡Œè®°å½•çš„ç‰ˆæœ¬é“¾ã€‚</li></ol><p>insert æ“ä½œä¸­ï¼Œå¯¹åº”çš„undo logæ²¡æœ‰roll_pointer å±æ€§ï¼Œå› ä¸ºinsert æ“ä½œå°±æ˜¯ä¸€ä¸ªè¡Œè®°å½•çš„åˆå§‹ç‰ˆæœ¬ï¼Œæ²¡æœ‰æ¯”å®ƒæ›´æ—©çš„æ“ä½œäº†ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªé€šè¿‡roll_pointer ç»„æˆçš„ç‰ˆæœ¬é“¾ï¼Œæ¯ä¸ªundo log è¿›è¡Œäº†å†…å®¹çœç•¥ä»¥å±•ç¤ºé“¾æ¥çš„é‡ç‚¹å†…å®¹</p><img src="/b36b0ce9/8.png" class><h1 id="5-undo-log-çš„æŒä¹…åŒ–"><a href="#5-undo-log-çš„æŒä¹…åŒ–" class="headerlink" title="5. undo log çš„æŒä¹…åŒ–"></a>5. undo log çš„æŒä¹…åŒ–</h1><p>undoæ—¥å¿—åˆ·ç›˜æ—¶æœºçš„å‚æ•°ï¼Œä½†é€šè¿‡æ§åˆ¶Redoæ—¥å¿—ã€è„é¡µåˆ·æ–°å’ŒPurgeçº¿ç¨‹çš„å‚æ•°ï¼Œå¯ä»¥é—´æ¥å½±å“undoæ—¥å¿—çš„åˆ·ç›˜ç­–ç•¥ã€‚</p><p><strong>WALæŠ€æœ¯</strong><br>åœ¨æ•°æ®å®é™…ä¿®æ”¹å‰ï¼Œå…ˆå°†undoæ—¥å¿—æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</p><p><strong>åˆ·ç›˜æ—¶æœºï¼š</strong></p><ul><li><strong>äº‹åŠ¡æäº¤ï¼š</strong> å½“äº‹åŠ¡æäº¤æ—¶ï¼Œç›¸å…³çš„undoæ—¥å¿—ä¼šè¢«å†™å…¥ç£ç›˜ã€‚</li><li><strong>è„é¡µåˆ·ç›˜ï¼š</strong> åœ¨InnoDBå°†è„é¡µï¼ˆdirty pageï¼‰å†™å…¥ç£ç›˜ä¹‹å‰ï¼Œé¦–å…ˆä¼šç¡®ä¿æ‰€æœ‰ç›¸å…³çš„undoæ—¥å¿—å·²ç»è¢«æŒä¹…åŒ–ã€‚</li><li><strong>Redoæ—¥å¿—åŒæ­¥ï¼š</strong> å½“ä¸€ä¸ªRedoæ—¥å¿—è¢«åŒæ­¥åˆ°ç£ç›˜æ—¶ï¼Œæ‰€æœ‰ç›¸å…³çš„undoæ—¥å¿—ä¹Ÿå¿…é¡»è¢«åŒæ­¥ã€‚</li></ul><h1 id="6-åŸºäºundo-log-çš„å›æ»šæ“ä½œ"><a href="#6-åŸºäºundo-log-çš„å›æ»šæ“ä½œ" class="headerlink" title="6 åŸºäºundo log çš„å›æ»šæ“ä½œ"></a>6 åŸºäºundo log çš„å›æ»šæ“ä½œ</h1><p>InnoDBä¸­çš„äº‹åŠ¡</p><ol><li>å¯èƒ½ä¼šç”±ç”¨æˆ·ä¸»åŠ¨è§¦å‘Rollbackï¼›</li><li>ä¹Ÿå¯èƒ½å› ä¸ºé‡åˆ°æ­»é”å¼‚å¸¸Rollbackï¼›</li><li>æˆ–è€…å‘ç”ŸCrashï¼Œé‡å¯åå¯¹æœªæäº¤çš„äº‹åŠ¡å›æ»šã€‚<h2 id="61-ç”¨æˆ·åº”ç”¨ç¨‹åºä¸»åŠ¨å›æ»š"><a href="#6-1-ç”¨æˆ·-åº”ç”¨ç¨‹åºä¸»åŠ¨å›æ»š" class="headerlink" title="6.1. ç”¨æˆ·/åº”ç”¨ç¨‹åºä¸»åŠ¨å›æ»š"></a>6.1. ç”¨æˆ·/åº”ç”¨ç¨‹åºä¸»åŠ¨å›æ»š</h2></li></ol><ul><li>åå‘éå†ï¼ˆstart of recordï¼‰å½“å‰äº‹åŠ¡çš„undoæ—¥å¿—é“¾è¡¨ï¼ŒæŒ‰é€†åºæ¢å¤æ¯ä¸ªæ›´æ”¹ã€‚</li><li><strong>æ’å…¥æ“ä½œï¼š</strong> åœ¨æ•°æ®é¡µä¸­åˆ é™¤å·²æ’å…¥çš„è®°å½•ã€‚</li><li><strong>åˆ é™¤æ“ä½œï¼š</strong> æ¢å¤å·²åˆ é™¤çš„è®°å½•ã€‚</li><li><strong>æ›´æ–°æ“ä½œï¼š</strong> æ¢å¤æ›´æ–°å‰çš„è®°å½•ã€‚</li><li>æ¯ä¸ªæ“ä½œæ¢å¤å®Œæˆåï¼Œä»undoæ—¥å¿—é“¾è¡¨ä¸­ç§»é™¤ç›¸åº”çš„undoæ—¥å¿—è®°å½•ã€‚</li></ul><h2 id="62-æ­»é”å¼‚å¸¸å›æ»š"><a href="#6-2-æ­»é”å¼‚å¸¸å›æ»š" class="headerlink" title="6.2. æ­»é”å¼‚å¸¸å›æ»š"></a>6.2. æ­»é”å¼‚å¸¸å›æ»š</h2><p>InnoDBé€šè¿‡æ­»é”æ£€æµ‹ç®—æ³•å‘ç°ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡ä¹‹é—´çš„é”ç­‰å¾…ï¼Œå½¢æˆæ­»é”ï¼Œ,é€‰æ‹©æœ€å°ä»£ä»·ï¼Œå³æŒæœ‰é”èµ„æºæœ€å°‘çš„äº‹åŠ¡åŠ¡è¿›è¡Œå›æ»šã€‚</p><p>ä¸ä¸»åŠ¨å›æ»šç±»ä¼¼ï¼Œéå†å½“å‰äº‹åŠ¡çš„undoæ—¥å¿—é“¾è¡¨ï¼ŒæŒ‰é€†åºæ¢å¤æ¯ä¸ªæ›´æ”¹ã€‚</p><h2 id="63-å´©æºƒæ¢å¤"><a href="#6-3-å´©æºƒæ¢å¤" class="headerlink" title="6.3  å´©æºƒæ¢å¤"></a>6.3  å´©æºƒæ¢å¤</h2><p>MySQLæœåŠ¡å™¨æˆ–æ“ä½œç³»ç»Ÿå´©æºƒåï¼ŒInnoDBé€šè¿‡Undoæ—¥å¿—ä¸Redoæ—¥å¿—ç»“åˆï¼Œç¡®ä¿å´©æºƒæ—¶æ•°æ®é¡µçš„çŠ¶æ€æ¢å¤åˆ°ä¸€è‡´çš„çŠ¶æ€ï¼Œ undoæ—¥å¿—ç”¨æ¥ å›æ»šæœªæäº¤çš„äº‹åŠ¡ã€‚</p><h1 id="7-undo-log-çš„æ¸…ç†"><a href="#7-undo-log-çš„æ¸…ç†" class="headerlink" title="7 undo log çš„æ¸…ç†"></a>7 undo log çš„æ¸…ç†</h1><p>äº‹åŠ¡æäº¤åï¼Œç›¸å…³çš„Undoæ—¥å¿—è®°å½•ä»éœ€ä¿ç•™ä¸€æ®µæ—¶é—´ä»¥æ”¯æŒå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰</p><h2 id="71-purge-çº¿ç¨‹"><a href="#7-1-Purge-çº¿ç¨‹" class="headerlink" title="7.1 Purge çº¿ç¨‹"></a>7.1 Purge çº¿ç¨‹</h2><p>InnoDB é€šè¿‡ä¸€ä¸ªåå°çº¿ç¨‹ç§°ä¸º Purgeï¼Œæ¥æ¸…ç†ä¸å†éœ€è¦çš„ undo logã€‚</p><ul><li><strong>è§¦å‘æ¡ä»¶</strong>ï¼šPurge è¿›ç¨‹ä¼šå®šæœŸæ£€æŸ¥é‚£äº›å·²æäº¤äº‹åŠ¡çš„ undo logã€‚å®ƒä¼šç¡®å®šè¿™äº› undo log æ˜¯å¦è¿˜è¢«å…¶ä»–æ´»è·ƒäº‹åŠ¡ä½œä¸º MVCC çš„ä¸€éƒ¨åˆ†æ‰€éœ€ã€‚</li><li><strong>åˆ é™¤æ“ä½œ</strong>ï¼šå¦‚æœä¸€ä¸ª undo log è®°å½•ä¸å†è¢«ä»»ä½•äº‹åŠ¡æ‰€éœ€è¦ï¼ŒPurge è¿›ç¨‹ä¼šå°†å…¶ä» undo è¡¨ç©ºé—´ä¸­åˆ é™¤ï¼Œé‡Šæ”¾ç›¸å…³èµ„æºã€‚</li></ul><p>undo log çš„æ¸…ç†æœºåˆ¶æ˜¯åŒºåˆ†æ“ä½œç±»å‹çš„ã€‚</p><h2 id="72-insert-undo-log"><a href="#7-2-Insert-Undo-Log" class="headerlink" title="7.2 Insert Undo Log"></a>7.2 Insert Undo Log</h2><p>Insert undo log ä¸»è¦è®°å½•æ’å…¥æ“ä½œçš„ä¿¡æ¯ã€‚å› ä¸ºæ’å…¥æ“ä½œä»…ä»…æ·»åŠ æ–°çš„è®°å½•ï¼Œä¸æ¶‰åŠå·²å­˜åœ¨æ•°æ®çš„ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™ç§ç±»å‹çš„ undo log ä¸»è¦ç”¨äºåœ¨äº‹åŠ¡å¤±è´¥æ—¶æ’¤é”€æ’å…¥æ“ä½œã€‚</p><ul><li><strong>æ¸…ç†æ—¶æœº</strong>ï¼šå½“ä¸€ä¸ªäº‹åŠ¡è¿›è¡Œæ’å…¥æ“ä½œå¹¶æˆåŠŸæäº¤åï¼Œç›¸åº”çš„ insert undo log ç«‹å³å˜å¾—æ— ç”¨ï¼Œå› ä¸ºæ’å…¥çš„æ•°æ®å·²ç»è¢«ç¡®è®¤å¹¶ä¸éœ€è¦å†è¢«æ’¤é”€ã€‚æ­¤æ—¶ï¼Œè¿™äº› undo log å¯ä»¥è¢«å®‰å…¨åœ°æ¸…ç†æ‰ï¼Œå› ä¸ºå®ƒä»¬ä¸å†è¢«ä»»ä½•äº‹åŠ¡æ‰€éœ€ã€‚</li><li><strong>æ¸…ç†è¿‡ç¨‹</strong>ï¼šPurge çº¿ç¨‹ä¼šæ£€æµ‹åˆ°è¿™äº› insert undo log ä¸å·²æäº¤çš„äº‹åŠ¡å…³è”ï¼Œå¹¶å°†å®ƒä»¬æ ‡è®°ä¸ºå¯æ¸…ç†ã€‚ç„¶åï¼Œè¿™äº› log ä¼šä» undo è¡¨ç©ºé—´ä¸­åˆ é™¤ï¼Œç›¸å…³çš„ç£ç›˜ç©ºé—´å¾—ä»¥å›æ”¶ã€‚</li></ul><h2 id="73-update-undo-log"><a href="#7-3-Update-Undo-Log" class="headerlink" title="7.3 Update Undo Log"></a>7.3 Update Undo Log</h2><p>Update undo log è®°å½•äº†å¯¹ç°æœ‰æ•°æ®çš„ä¿®æ”¹ï¼ˆåŒ…æ‹¬æ›´æ–°å’Œåˆ é™¤æ“ä½œï¼‰ã€‚è¿™äº›è®°å½•å¯¹äºäº‹åŠ¡å›æ»šå’Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰è‡³å…³é‡è¦ã€‚</p><ul><li><strong>æ¸…ç†æ—¶æœº</strong>ï¼šä¸ insert undo log ä¸åŒï¼Œå³ä½¿ç›¸å…³äº‹åŠ¡å·²ç»æäº¤ï¼Œupdate undo log ä¹Ÿä¸èƒ½ç«‹å³è¢«æ¸…ç†ã€‚è¿™æ˜¯å› ä¸ºåœ¨ InnoDB ä¸­å®ç° MVCC æ—¶ï¼Œå…¶ä»–å¹¶å‘äº‹åŠ¡å¯èƒ½éœ€è¦è®¿é—®è¿™äº› log ä¸­çš„æ—§æ•°æ®ç‰ˆæœ¬æ¥ç»´æŒä¸€è‡´æ€§è¯»ã€‚</li><li><strong>æ¸…ç†è¿‡ç¨‹</strong>ï¼šPurge çº¿ç¨‹ä¼šå‘¨æœŸæ€§åœ°æ£€æŸ¥ update undo logã€‚åªæœ‰å½“è¿™äº› log è®°å½•ä¸å†è¢«ä»»ä½•å…¶ä»–æ´»è·ƒäº‹åŠ¡æ‰€éœ€æ—¶ï¼ˆå³æ²¡æœ‰æ›´æ—©çš„è¯»è§†å›¾éœ€è¦è¿™äº›æ•°æ®ï¼‰ï¼Œå®ƒä»¬æ‰ä¼šè¢«æ ‡è®°ä¸ºå¯æ¸…ç†ã€‚ç„¶åï¼ŒPurge æ“ä½œä¼šé€æ­¥ä» undo è¡¨ç©ºé—´ä¸­åˆ é™¤è¿™äº›è®°å½•ã€‚</li></ul><h2 id="74-é•¿äº‹åŠ¡å¯¹undo-log-æ¸…ç†çš„å½±å“"><a href="#7-4-é•¿äº‹åŠ¡å¯¹undo-log-æ¸…ç†çš„å½±å“" class="headerlink" title="7.4 é•¿äº‹åŠ¡å¯¹undo log æ¸…ç†çš„å½±å“"></a>7.4 é•¿äº‹åŠ¡å¯¹undo log æ¸…ç†çš„å½±å“</h2><p>é•¿äº‹åŠ¡æ„å‘³ç€ç³»ç»Ÿé‡Œé¢ä¼šå­˜åœ¨å¾ˆè€çš„äº‹åŠ¡è§†å›¾ã€‚ç”±äºè¿™äº›äº‹åŠ¡éšæ—¶å¯èƒ½è®¿é—®æ•°æ®åº“é‡Œé¢çš„ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ªäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œæ•°æ®åº“é‡Œé¢å®ƒå¯èƒ½ç”¨åˆ°çš„å›æ»šè®°å½•éƒ½å¿…é¡»ä¿ç•™ï¼Œè¿™å°±ä¼šå¯¼è‡´å¤§é‡å ç”¨å­˜å‚¨ç©ºé—´ã€‚</p><h1 id="ç›¸å…³æ–‡ç« "><a href="#ç›¸å…³æ–‡ç« " class="headerlink" title="ç›¸å…³æ–‡ç« "></a>ç›¸å…³æ–‡ç« </h1><p><a href="https://sunyan.xyz/5b064db6/">Intro to äº‹åŠ¡</a><br><a href="https://sunyan.xyz/9cd551f5/">Intro to InnoDB äº‹åŠ¡</a><br><a href="https://sunyan.xyz/9faedfe0/">InnoDBäº‹åŠ¡-éš”ç¦»æ€§çš„å®ç°,MVCC &amp; é”</a><br><a href="https://sunyan.xyz/6cb5dc64/">InnoDBäº‹åŠ¡-æŒä¹…æ€§çš„å®ç°,binglog &amp; redo log&amp;undo log</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åŸå­æ€§æŒ‡çš„æ˜¯äº‹åŠ¡è¦ä¹ˆå®Œå…¨æˆåŠŸæ‰§è¡Œï¼Œè¦ä¹ˆå®Œå…¨å¤±è´¥å›æ»šï¼Œä¸å…è®¸éƒ¨åˆ†æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;è¿™æœ¬è´¨ä¸Šæ˜¯åœ¨è¦æ±‚å…·æœ‰&lt;code&gt;rollback å›æ»šèƒ½åŠ›&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;InnoDBä¸­çš„äº‹åŠ¡å¯èƒ½ä¼šç”±ç”¨æˆ·ä¸»åŠ¨è§¦å‘Rollbackï¼›ä¹Ÿå¯èƒ½å› ä¸ºé‡åˆ°æ­»é”å¼‚å¸¸Rollbackï¼›æˆ–</summary>
      
    
    
    
    
    <category term="MySQL" scheme="http://example.com/tags/MySQL/"/>
    
    <category term="äº‹åŠ¡" scheme="http://example.com/tags/%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>Intro to InnoDBäº‹åŠ¡</title>
    <link href="http://example.com/9cd551f5/"/>
    <id>http://example.com/9cd551f5/</id>
    <published>2024-05-02T14:15:42.000Z</published>
    <updated>2024-05-10T15:17:42.616Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨<a href="https://sunyan.xyz/5b064db6/">Intro to äº‹åŠ¡ä¸­</a>ä»‹ç»è¿‡ï¼Œ ä¸€è‡´æ€§æ˜¯äº‹åŠ¡çš„æ ¸å¿ƒç‰¹å¾ï¼Œæˆ–è€…è¯´æœ€ç»ˆç›®çš„ï¼Œ<code>åŸå­æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§éƒ½æ˜¯å®ç°ä¸€è‡´æ€§çš„æ‰‹æ®µ</code>ã€‚</p><p>æ‰€ä»¥åœ¨ä»‹ç»InnoDB äº‹åŠ¡æ—¶ï¼Œä¸»è¦ä»‹ç»AID ç‰¹æ€§çš„å®ç°<br><a href="https://sunyan.xyz/b36b0ce9/">InnoDBäº‹åŠ¡-åŸå­æ€§çš„å®ç°ï¼Œ undo log</a><br><a href="https://sunyan.xyz/9faedfe0/">InnoDBäº‹åŠ¡-éš”ç¦»æ€§çš„å®ç°, MVCC &amp; é”</a><br><a href="https://sunyan.xyz/6cb5dc64/">InnoDBäº‹åŠ¡-æŒä¹…æ€§çš„å®ç°ï¼Œ binglog &amp; redo log&amp;undo log</a></p><p>åœ¨å…·ä½“çœ‹InnoDB äº‹åŠ¡å®ç°AID ç‰¹æ€§ä¹‹å‰ï¼Œå¯ä»¥å…ˆçœ‹ä»¥ä¸‹è¿™äº›å‰ç½®çŸ¥è¯†</p><h1 id="1-innodb-æ•°æ®ç®¡ç†"><a href="#1-InnoDB-æ•°æ®ç®¡ç†" class="headerlink" title="1. InnoDB æ•°æ®ç®¡ç†"></a>1. InnoDB æ•°æ®ç®¡ç†</h1><h2 id="11-page"><a href="#1-1-Page" class="headerlink" title="1.1 Page"></a>1.1 Page</h2><p>page æ˜¯ InnoDB å­˜å‚¨æ•°æ®çš„åŸºæœ¬å•ä½ï¼Œä¹Ÿæ˜¯æ•°æ®åœ¨ç£ç›˜å’Œå†…å­˜ä¹‹é—´äº¤æ¢çš„æœ€å°å•ä½ã€‚æ¯ä¸ªé¡µé€šå¸¸çš„å¤§å°ä¸º 16KB<br>é’ˆå¯¹ä¸åŒçš„æ•°æ®æœ‰ä¸åŒçš„Pageç±»å‹è¿›è¡Œå­˜å‚¨ï¼Œå¦‚index page ç´¢å¼•é¡µï¼Œ undo page  ç­‰</p><ol><li>File Header ä¸­ æœ‰fil_page_type æ¥æ ‡è¯†è¯¥é¡µçš„ç±»å‹</li><li>File Trailer ç”¨æ¥æ ¡éªŒé¡µé¢æ•°æ®æ˜¯å¦å®Œæˆ <img src="/9cd551f5/1.png" class></li></ol><h2 id="12-åŒºextent"><a href="#1-2-åŒºï¼ˆextentï¼‰" class="headerlink" title="1.2 åŒºï¼ˆextentï¼‰"></a>1.2 åŒºï¼ˆextentï¼‰</h2><p>ä¸ºäº†æ›´å¥½åœ°ç®¡ç†page, InnoDBå¼•å…¥äº†åŒºçš„æ¦‚å¿µï¼Œ è¿ç»­çš„64ä¸ªpage  æ˜¯ä¸€ä¸ªåŒºï¼Œå¤§å°é»˜è®¤æ˜¯1MBã€‚ å¯ä»¥è®¤ä¸ºextent æ˜¯ä¸€ä¸ªç‰©ç†ä¸Šæ¦‚å¿µ</p><p>ä¸€ä¸ªåŒºï¼ˆExtentï¼‰æ˜¯ç”±è¿ç»­çš„é¡µç»„æˆçš„æ•°æ®å—ï¼Œæ¯ä¸ªåŒºåŒ…å« 64 ä¸ªè¿ç»­çš„é¡µï¼Œå› æ­¤æ¯ä¸ªåŒºçš„å¤§å°ä¸º 1MB ï¼ˆ16KB * 64ï¼‰ã€‚ä½¿ç”¨åŒºçš„ç›®çš„æ˜¯ä¸ºäº†ä¼˜åŒ–ç£ç›˜ç©ºé—´çš„åˆ†é…å’Œç®¡ç†ï¼Œé€šè¿‡æ‰¹é‡å¤„ç†è¿ç»­çš„é¡µ,å‡å°‘éšæœºIOæ¥æé«˜æ•°æ®å­˜å–æ•ˆç‡ã€‚</p><h2 id="13-æ®µ-segment"><a href="#1-3-æ®µ-ï¼ˆsegment-ï¼‰" class="headerlink" title="1.3 æ®µ ï¼ˆsegment ï¼‰"></a>1.3 æ®µ ï¼ˆsegment ï¼‰</h2><p>InnoDB ä¸­çš„æ®µï¼ˆSegmentï¼‰ä½œä¸ºä¸€ä¸ªé€»è¾‘ç»“æ„ï¼Œèµ·ç€å°†æ•°æ®åº“çš„é«˜å±‚é€»è¾‘ç»“æ„ï¼ˆå¦‚è¡¨å’Œç´¢å¼•ï¼‰ä¸ä½å±‚ç‰©ç†å­˜å‚¨ç»“æ„ï¼ˆå¦‚é¡µå’ŒåŒºï¼‰è¿æ¥èµ·æ¥çš„æ¡¥æ¢ä½œç”¨ã€‚</p><p>ä»¥ä¸‹æ˜¯å‡ ä¸ªè¯¦ç»†çš„ä¾‹å­ï¼Œé€šè¿‡è¿™äº›ä¾‹å­å¯ä»¥æ›´å¥½åœ°ç†è§£æ®µæ˜¯å¦‚ä½•åœ¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­å‘æŒ¥ä½œç”¨çš„ã€‚</p><h3 id="131-æ•°æ®è¡¨æ®µ"><a href="#1-3-1-æ•°æ®è¡¨æ®µ" class="headerlink" title="1.3.1 æ•°æ®è¡¨æ®µ"></a>1.3.1 æ•°æ®è¡¨æ®µ</h3><p>å‡è®¾æ‚¨åœ¨æ•°æ®åº“ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–°è¡¨ï¼Œè¿™ä¸ªè¡¨å°†éœ€è¦å­˜å‚¨æ•°æ®è¡Œã€‚InnoDB ä¼šä¸ºè¿™ä¸ªè¡¨åˆ›å»ºä¸€ä¸ªæ•°æ®æ®µï¼š</p><ul><li><strong>é€»è¾‘å±‚é¢</strong>ï¼šåœ¨é€»è¾‘å±‚é¢ï¼Œè¿™ä¸ªæ•°æ®æ®µä»£è¡¨äº†è¡¨ä¸­æ‰€æœ‰æ•°æ®è¡Œçš„é›†åˆã€‚</li><li><strong>ç‰©ç†å±‚é¢</strong>ï¼šç‰©ç†ä¸Šï¼Œè¿™ä¸ªæ•°æ®æ®µå¼€å§‹æ—¶å¯èƒ½åªåŒ…å«å‡ ä¸ªåŒºï¼Œæ¯ä¸ªåŒºç”± 64 ä¸ªè¿ç»­çš„é¡µç»„æˆã€‚éšç€è¡¨ä¸­æ•°æ®çš„å¢åŠ ï¼Œæ®µå¯ä»¥åŠ¨æ€åœ°åˆ†é…æ›´å¤šçš„åŒºæ¥å­˜å‚¨æ›´å¤šçš„æ•°æ®é¡µã€‚</li><li><strong>æ“ä½œ</strong>ï¼šå½“ä½ æ‰§è¡Œ INSERT æ“ä½œå‘è¡¨ä¸­æ·»åŠ æ•°æ®æ—¶ï¼ŒInnoDB å°†åœ¨è¿™ä¸ªæ•°æ®æ®µä¸­æ‰¾åˆ°é€‚å½“çš„é¡µæ¥å­˜å‚¨æ–°çš„è¡Œã€‚å¦‚æœå¿…è¦çš„é¡µä¸å­˜åœ¨æˆ–é¡µå·²æ»¡ï¼Œæ®µç®¡ç†é€»è¾‘å°†è¯·æ±‚åˆ†é…æ–°çš„åŒºï¼Œå¹¶ç»§ç»­æ•°æ®æ’å…¥ã€‚</li></ul><h3 id="132-ç´¢å¼•æ®µ"><a href="#1-3-2-ç´¢å¼•æ®µ" class="headerlink" title="1.3.2 ç´¢å¼•æ®µ"></a>1.3.2 ç´¢å¼•æ®µ</h3><p>å½“ä½ ä¸ºè¡¨åˆ›å»ºä¸€ä¸ªç´¢å¼•æ—¶ï¼Œæ— è®ºæ˜¯ä¸»é”®ç´¢å¼•è¿˜æ˜¯è¾…åŠ©ç´¢å¼•ï¼ŒInnoDB éƒ½ä¼šä¸ºæ¯ä¸ªç´¢å¼•åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ç´¢å¼•æ®µï¼š</p><ul><li><strong>é€»è¾‘å±‚é¢</strong>ï¼šç´¢å¼•æ®µé€»è¾‘ä¸Šè¡¨ç¤ºç´¢å¼•çš„ç»“æ„ï¼Œè¿™åŒ…æ‹¬ç»´æŠ¤é”®å€¼å’ŒæŒ‡å‘è¡¨ä¸­å¯¹åº”è¡Œçš„æŒ‡é’ˆã€‚</li><li><strong>ç‰©ç†å±‚é¢</strong>ï¼šç‰©ç†ä¸Šï¼Œç´¢å¼•æ®µå­˜å‚¨ç´¢å¼•æ ‘ï¼ˆB-treeï¼‰çš„ç»“æ„ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹ï¼ˆæˆ–é¡µï¼‰åŒ…å«ç´¢å¼•é”®å’ŒæŒ‡å‘è¡Œçš„æŒ‡é’ˆã€‚éšç€ç´¢å¼•çš„å¢é•¿ï¼Œå¯èƒ½éœ€è¦æ›´å¤šçš„é¡µå’ŒåŒºæ¥æ‰©å±•ç´¢å¼•æ ‘ã€‚</li><li><strong>æ“ä½œ</strong>ï¼šè¿›è¡ŒæŸ¥è¯¢ä¼˜åŒ–æ—¶ï¼Œå¦‚æ‰§è¡ŒåŸºäºç´¢å¼•çš„æŸ¥æ‰¾ï¼ŒInnoDB é€šè¿‡ç´¢å¼•æ®µå¿«é€Ÿè®¿é—®ç›¸å…³é¡µï¼Œæœ‰æ•ˆåœ°å®šä½åˆ°æ•°æ®è¡Œã€‚</li></ul><h3 id="133-undo-æ—¥å¿—æ®µ"><a href="#1-3-3-Undo-æ—¥å¿—æ®µ" class="headerlink" title="1.3.3 Undo æ—¥å¿—æ®µ"></a>1.3.3 Undo æ—¥å¿—æ®µ</h3><p>Undo æ—¥å¿—ä¹Ÿæ˜¯ä½¿ç”¨æ®µæ¥ç®¡ç†çš„ï¼Œæ¯å½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œä¿®æ”¹å‰çš„æ•°æ®å°†å­˜å‚¨åœ¨ undo æ—¥å¿—æ®µä¸­ï¼š</p><ul><li><strong>é€»è¾‘å±‚é¢</strong>ï¼šé€»è¾‘ä¸Šï¼Œundo æ—¥å¿—æ®µä¿å­˜äº†æ•°æ®ä¿®æ”¹å‰çš„çŠ¶æ€ï¼Œæ”¯æŒäº‹åŠ¡çš„å›æ»šæ“ä½œã€‚</li><li><strong>ç‰©ç†å±‚é¢</strong>ï¼šç‰©ç†ä¸Šï¼Œundo æ—¥å¿—æ®µç”±ä¸€ç³»åˆ—çš„é¡µç»„æˆï¼Œè¿™äº›é¡µæŒ‰éœ€åˆ†é…ï¼Œå¹¶åœ¨äº‹åŠ¡å›æ»šæ—¶æä¾›å¿…è¦çš„å†å²æ•°æ®ã€‚</li><li><strong>æ“ä½œ</strong>ï¼šå¦‚æœäº‹åŠ¡å¤±è´¥æˆ–æ‰§è¡Œ ROLLBACK å‘½ä»¤ï¼ŒInnoDB é€šè¿‡è®¿é—® undo æ—¥å¿—æ®µä¸­çš„è®°å½•æ¥æ¢å¤æ•°æ®åˆ°å…¶åŸå§‹çŠ¶æ€ã€‚</li></ul><h2 id="14-è¡¨ç©ºé—´tablespace"><a href="#1-4-è¡¨ç©ºé—´ï¼ˆTablespaceï¼‰" class="headerlink" title="1.4 è¡¨ç©ºé—´ï¼ˆTablespaceï¼‰"></a>1.4 è¡¨ç©ºé—´ï¼ˆTablespaceï¼‰</h2><p>è¡¨ç©ºé—´æ˜¯ InnoDB æ•°æ®å­˜å‚¨çš„æœ€é«˜å±‚çº§ï¼Œå®ƒå¯ä»¥åŒ…å«å¤šä¸ªæ®µã€‚è¡¨ç©ºé—´æ˜¯ç£ç›˜ä¸Šçš„ç‰©ç†æ–‡ä»¶ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå†…éƒ¨ç»„ç»‡ç€æ•°æ®åº“çš„æ•°æ®å’Œç´¢å¼•ã€‚InnoDB é»˜è®¤æœ‰ä¸€ä¸ªä¸»è¡¨ç©ºé—´ï¼Œå³ <code>ibdata</code> æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†ç³»ç»Ÿæ•°æ®ã€æ•°æ®å­—å…¸ã€undo æ—¥å¿—ç­‰ã€‚æ­¤å¤–ï¼ŒInnoDB è¿˜æ”¯æŒæ¯ä¸ªè¡¨ä½¿ç”¨å•ç‹¬çš„æ–‡ä»¶ä½œä¸ºç‹¬ç«‹è¡¨ç©ºé—´ï¼ˆfile-per-tableï¼‰ï¼Œè¿™æœ‰åŠ©äºæ•°æ®åº“çš„æ‰©å±•å’Œç®¡ç†ã€‚</p><h1 id="2è¡Œè®°å½•æ ¼å¼"><a href="#2-è¡Œè®°å½•æ ¼å¼" class="headerlink" title="2.è¡Œè®°å½•æ ¼å¼"></a>2.è¡Œè®°å½•æ ¼å¼</h1><p>æ•°æ®è¡¨ä¸­çš„è¡Œå­˜æ”¾åœ¨ æ•°æ®page  ä¸­ï¼Œ ä»¥compact è¡Œæ ¼å¼ä¸ºä¾‹ï¼Œ æ¯ä¸€æ¡æ•°æ®è®°å½•çš„å­˜å‚¨æ ¼å¼å¦‚ä¸‹ï¼Œ<br>    <img src="/9cd551f5/2.png" class></p><p>å…¶ä¸­çœŸå®æ•°æ®éƒ¨åˆ†ï¼Œé™¤äº†æ•°æ®è¡¨ä¸­å®šä¹‰çš„åˆ—ä¹‹å¤–ï¼ŒInnoDB ä¼šé»˜è®¤ä¸ºæ¯æ¡è®°å½•æ·»åŠ éšè—åˆ—</p><div class="table-container"><table><thead><tr><th>åˆ—å</th><th>æ˜¯å¦å¿…é¡»</th><th>å æ®ç©ºé—´</th><th>æè¿°</th></tr></thead><tbody><tr><td>row_id</td><td>å¦</td><td>6 å­—èŠ‚</td><td>è¡ŒIDï¼Œå”¯ä¸€æ ‡è¯†ä¸€æ¡è®°å½•</td></tr><tr><td>trx_id</td><td>æ˜¯</td><td>6 å­—èŠ‚</td><td>äº‹åŠ¡ID</td></tr><tr><td>roll_pointer</td><td>æ˜¯</td><td>7 å­—èŠ‚</td><td>å›æ»šæŒ‡é’ˆ</td></tr></tbody></table></div><img src="/9cd551f5/3.png" class><p><code>roll_pointer</code> æ˜¯å­˜å‚¨åœ¨æ¯ä¸ªè¡Œè®°å½•ä¸­çš„ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘è¯¥è¡Œè®°å½•ç›¸å…³çš„æœ€è¿‘ä¸€æ¬¡undo log è®°å½•ã€‚<br><code>trx_id</code> æ˜¯ InnoDB å­˜å‚¨å¼•æ“å†…éƒ¨ç”¨æ¥å”¯ä¸€æ ‡è¯†æ¯ä¸ªäº‹åŠ¡çš„æ ‡è¯†ç¬¦ï¼Œå®ƒè®°å½•äº†æœ€è¿‘ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡ã€‚</p><h1 id="3-innodb-äº‹åŠ¡trx_id"><a href="#3-InnoDB-äº‹åŠ¡trx-id" class="headerlink" title="3. InnoDB äº‹åŠ¡trx_id"></a>3. InnoDB äº‹åŠ¡trx_id</h1><p><code>trx_id</code> æ˜¯ InnoDB å­˜å‚¨å¼•æ“å†…éƒ¨ç”¨æ¥å”¯ä¸€æ ‡è¯†æ¯ä¸ªäº‹åŠ¡çš„æ ‡è¯†ç¬¦ã€‚è¿™ä¸ªäº‹åŠ¡IDæ˜¯ä¸€ä¸ªé€’å¢çš„æ•°å­—ï¼Œç”± InnoDB å†…éƒ¨è‡ªåŠ¨ç”Ÿæˆå’Œç®¡ç†ã€‚</p><p>trx_id å­˜å‚¨åœ¨è¡Œè®°å½•çš„éšè—åˆ—ä¸­ã€‚</p><p>MySQLserver å±‚ä¹Ÿæœ‰ä¸€ä¸ªäº‹åŠ¡å”¯ä¸€æ ‡è¯†å«XIDã€‚</p><p>InnoDB å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª max_trx_id å…¨å±€å˜é‡ï¼Œæ¯æ¬¡éœ€è¦ç”³è¯·ä¸€ä¸ªæ–°çš„ trx_id æ—¶ï¼Œå°±è·å¾— max_trx_id çš„å½“å‰å€¼ï¼Œç„¶åå¹¶å°† max_trx_id åŠ  1ã€‚</p><p>åŠŸèƒ½å’Œä½œç”¨</p><ol><li><strong>äº‹åŠ¡çš„å”¯ä¸€æ ‡è¯†</strong>ï¼š<code>trx_id</code> ä¸º InnoDB æä¾›äº†ä¸€ç§æ–¹å¼æ¥å”¯ä¸€åœ°è¯†åˆ«å’Œè·Ÿè¸ªæ¯ä¸ªæ´»åŠ¨çš„æˆ–å·²å®Œæˆçš„äº‹åŠ¡ã€‚</li><li><strong>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰</strong>ï¼šåœ¨ InnoDB çš„ MVCC å®ç°ä¸­ï¼Œ<code>trx_id</code> è¢«ç”¨æ¥æ ‡è®°æ¯æ¡è®°å½•çš„ç‰ˆæœ¬ï¼Œä»¥æ­¤æ¥æ”¯æŒäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€‚ä¸åŒäº‹åŠ¡çœ‹åˆ°çš„æ•°æ®è§†å›¾ä¾èµ–äºè®°å½•çš„ <code>trx_id</code> ä¸äº‹åŠ¡çš„ <code>trx_id</code> æ¯”è¾ƒã€‚</li><li><strong>å›æ»šå’Œæ¢å¤</strong>ï¼šåœ¨äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå¦‚æœéœ€è¦å›æ»šï¼ŒInnoDB é€šè¿‡ <code>trx_id</code> æ¥ç¡®å®šå“ªäº›æ›´æ”¹éœ€è¦è¢«æ’¤é”€ã€‚æ­¤å¤–ï¼Œåœ¨ç³»ç»Ÿå´©æºƒåçš„æ¢å¤è¿‡ç¨‹ä¸­ï¼Œ<code>trx_id</code> ä¹Ÿè¢«ç”¨æ¥é‡å»ºæ´»è·ƒäº‹åŠ¡çš„çŠ¶æ€ã€‚</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨&lt;a href=&quot;https://sunyan.xyz/5b064db6/&quot;&gt;Intro to äº‹åŠ¡ä¸­&lt;/a&gt;ä»‹ç»è¿‡ï¼Œ ä¸€è‡´æ€§æ˜¯äº‹åŠ¡çš„æ ¸å¿ƒç‰¹å¾ï¼Œæˆ–è€…è¯´æœ€ç»ˆç›®çš„ï¼Œ&lt;code&gt;åŸå­æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§éƒ½æ˜¯å®ç°ä¸€è‡´æ€§çš„æ‰‹æ®µ&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥åœ¨ä»‹ç»InnoDB äº‹</summary>
      
    
    
    
    
    <category term="MySQL" scheme="http://example.com/tags/MySQL/"/>
    
    <category term="äº‹åŠ¡" scheme="http://example.com/tags/%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>Intro to äº‹åŠ¡</title>
    <link href="http://example.com/5b064db6/"/>
    <id>http://example.com/5b064db6/</id>
    <published>2024-05-01T13:57:16.000Z</published>
    <updated>2024-05-08T14:05:03.875Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-ä»€ä¹ˆæ˜¯äº‹åŠ¡"><a href="#1-ä»€ä¹ˆæ˜¯äº‹åŠ¡" class="headerlink" title="1. ä»€ä¹ˆæ˜¯äº‹åŠ¡"></a>1. ä»€ä¹ˆæ˜¯äº‹åŠ¡</h1><p>äº‹åŠ¡ï¼ˆTransactionï¼‰çš„æ¦‚å¿µèµ·æºäºæ•°æ®åº“é¢†åŸŸï¼Œæœ€æ—©ç”±ç¾å›½è®¡ç®—æœºç§‘å­¦å®¶ E. F. Codd åœ¨å…¶å…³äºå…³ç³»æ•°æ®åº“ï¼ˆRelational Databaseï¼‰çš„è®ºæ–‡ä¸­æå‡ºã€‚</p><p>ä»–æå‡ºäº† ACIDï¼ˆåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§ï¼‰å±æ€§ï¼Œè¿™äº›å±æ€§æˆä¸ºäº‹åŠ¡çš„æ ¸å¿ƒç‰¹å¾ã€‚</p><p>åœ¨ä»Šå¤©çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œäº‹åŠ¡çš„æ¦‚å¿µå·²ä¸ä»…ä»…åº”ç”¨äºæ•°æ®åº“é¢†åŸŸï¼Œè¿˜æ‹“å±•åˆ°äº†ä¸šåŠ¡å¼€å‘çš„å„ä¸ªé¢†åŸŸï¼ŒåŒ…æ‹¬ä½†ä¸é™äºæ•°æ®åº“ã€ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ã€‚</p><h2 id="11-acid-ç‰¹æ€§"><a href="#1-1-ACID-ç‰¹æ€§" class="headerlink" title="1.1 ACID ç‰¹æ€§"></a>1.1 ACID ç‰¹æ€§</h2><ul><li>åŸå­æ€§(Atomicity):  ä¿è¯äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å‘ç”Ÿï¼Œæœ‰åŠ©äºå¤„ç†ç³»ç»Ÿé”™è¯¯æˆ–æ•…éšœæ—¶çš„æ•°æ®æ¢å¤ï¼Œç¡®ä¿äº‹åŠ¡æ‰§è¡Œçš„å®Œæ•´æ€§ã€‚</li><li>ä¸€è‡´æ€§(Consistency)ï¼šç³»ç»Ÿä»ä¸€ä¸ªæ­£ç¡®æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªæ­£ç¡®æ€ï¼Œç”±åº”ç”¨é€šè¿‡ AID æ¥ä¿è¯ï¼Œå¯ä»¥è¯´æ˜¯äº‹åŠ¡çš„æ ¸å¿ƒç‰¹æ€§</li><li>éš”ç¦»æ€§(Isolation): å¤„ç†å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„å„ç§é—®é¢˜ï¼Œç¡®ä¿æ¯ä¸ªäº‹åŠ¡çœ‹åˆ°çš„æ˜¯ä¸€è‡´çš„æ•°æ®è§†å›¾ï¼Œé˜²æ­¢äº¤å‰äº‹åŠ¡çš„å¹²æ‰°ã€‚</li><li>æŒä¹…æ€§(Durability): ç¡®ä¿äº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå…¶ç»“æœå°±å°±ä¼šè¢«æŒä¹…åŒ–ï¼Œè¿™ä¿è¯äº†æ•°æ®çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</li></ul><p>å®šä¹‰æœ¬èº«ä¸å†èµ˜è¿°ï¼Œè¿™é‡Œé‡ç‚¹å¼ºè°ƒä¸€ç‚¹ï¼šä¸€è‡´æ€§æ˜¯äº‹åŠ¡çš„æ ¸å¿ƒç‰¹å¾ï¼Œæˆ–è€…è¯´æœ€ç»ˆç›®çš„ã€‚<code>åŸå­æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§éƒ½æ˜¯å®ç°ä¸€è‡´æ€§çš„æ‰‹æ®µ</code>ï¼Œå› æ­¤è¿™ 4 ä¸ªç‰¹æ€§å¹¶ä¸æ˜¯å¹¶åˆ—å…³ç³»ã€‚</p><h1 id="2-äº‹åŠ¡çš„åˆ†ç±»"><a href="#2-äº‹åŠ¡çš„åˆ†ç±»" class="headerlink" title="2. äº‹åŠ¡çš„åˆ†ç±»"></a>2. äº‹åŠ¡çš„åˆ†ç±»</h1><p>ä¸‹é¢å°†æŠŠäº‹åŠ¡æŒ‰ç…§æœåŠ¡å’Œæ•°æ®æºæ•°é‡è¿›è¡Œåˆ†ç±»ï¼Œè¿™ç§åˆ†ç±»æœ‰åŠ©äºç†è§£äº‹åŠ¡ç®¡ç†çš„å¤æ‚æ€§ä»¥åŠåœ¨ä¸åŒåœºæ™¯ä¸‹çš„è®¾è®¡å’Œå®ç°ã€‚</p><h2 id="21-æœ¬åœ°äº‹åŠ¡-å•æœåŠ¡å•æ•°æ®æºäº‹åŠ¡"><a href="#2-1-æœ¬åœ°äº‹åŠ¡-å•æœåŠ¡å•æ•°æ®æºäº‹åŠ¡" class="headerlink" title="2.1  æœ¬åœ°äº‹åŠ¡-å•æœåŠ¡å•æ•°æ®æºäº‹åŠ¡"></a>2.1  æœ¬åœ°äº‹åŠ¡-å•æœåŠ¡å•æ•°æ®æºäº‹åŠ¡</h2><p>åœ¨å®é™…ä¸šåŠ¡å¼€å‘ä¸­ï¼Œå•ä¸ªæœåŠ¡æ“ä½œå•ä¸ªæ•°æ®æºçš„äº‹åŠ¡è¢«å½’ç±»ä¸ºæœ¬åœ°äº‹åŠ¡ã€‚è¿™ç§äº‹åŠ¡ç±»å‹æ˜¯æœ€ç®€å•çš„ï¼Œå› ä¸ºå®ƒç›´æ¥ä¾èµ–äºæ•°æ®åº“æœ¬èº«çš„äº‹åŠ¡èƒ½åŠ›æ¥å®Œæˆï¼Œåº”ç”¨æ— éœ€è¿›è¡Œé¢å¤–æ“ä½œ</p><p><strong>ç¤ºä¾‹ï¼š</strong><br>åº“å­˜æœåŠ¡ï¼šå½“ç”¨æˆ·ä¸‹å•æ—¶ï¼Œåº“å­˜æœåŠ¡è´Ÿè´£æ£€æŸ¥å’Œæ›´æ–°å•†å“åº“å­˜ã€‚è¿™ä¸ªæœåŠ¡å¯èƒ½åªä¸ä¸€ä¸ªåº“å­˜æ•°æ®åº“äº¤äº’ï¼Œè¿›è¡Œå‡åº“å­˜çš„æ“ä½œã€‚å¦‚æœåº“å­˜è¶³å¤Ÿï¼Œäº‹åŠ¡æäº¤ï¼Œå¦åˆ™å›æ»šã€‚è¿™ä¸ªæ“ä½œåªæ¶‰åŠåº“å­˜æ•°æ®åº“ï¼Œå› æ­¤æ˜¯ä¸€ä¸ªå…¸å‹çš„æœ¬åœ°äº‹åŠ¡ã€‚</p><h2 id="2-2-åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#2-2-åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="2. 2 åˆ†å¸ƒå¼äº‹åŠ¡"></a>2. 2 åˆ†å¸ƒå¼äº‹åŠ¡</h2><p>åˆ†å¸ƒå¼äº‹åŠ¡å¯ä»¥ä»è·¨å¤šä¸ªæ•°æ®æºçš„äº‹åŠ¡å’Œè·¨å¤šä¸ªæœåŠ¡çš„äº‹åŠ¡ä¸¤ä¸ªè§’åº¦ç†è§£ã€‚å®ƒæ—¢å¯ä»¥æ˜¯å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¹‹é—´çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯è·¨ä¸åŒä¸­é—´ä»¶çš„ä¸šåŠ¡å±‚é¢åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><h3 id="221-å•æœåŠ¡å¤šæ•°æ®æº"><a href="#2-2-1-å•æœåŠ¡å¤šæ•°æ®æº" class="headerlink" title="2.2.1 å•æœåŠ¡å¤šæ•°æ®æº"></a>2.2.1 å•æœåŠ¡å¤šæ•°æ®æº</h3><p>è¿™ç§æƒ…å†µé€šå¸¸å‘ç”Ÿåœ¨å•ä¸ªåº”ç”¨æˆ–æœåŠ¡éœ€è¦åŒæ—¶æ“ä½œå¤šä¸ªæ•°æ®åº“æˆ–å­˜å‚¨ç³»ç»Ÿã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªç”µå­å•†åŠ¡åº”ç”¨å¯èƒ½éœ€è¦åœ¨å¤„ç†è®¢å•çš„åŒæ—¶ï¼Œåœ¨ä¸€ä¸ªæ•°æ®åº“ä¸­æ›´æ–°åº“å­˜ä¿¡æ¯ï¼Œåœ¨å¦ä¸€ä¸ªæ•°æ®åº“ä¸­æ›´æ–°ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ã€‚è¿™è¦æ±‚äº‹åŠ¡ç®¡ç†æœºåˆ¶èƒ½å¤Ÿè·¨è¶Šè¿™äº›æ•°æ®åº“ï¼Œç¡®ä¿æ‰€æœ‰æ•°æ®åº“æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§</p><p>åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¦‚XAåè®®è¿™æ ·çš„åˆ†å¸ƒå¼äº‹åŠ¡åè®®ï¼Œé€šè¿‡2PCç­‰æœºåˆ¶æ¥åè°ƒå’Œç®¡ç†è·¨å¤šä¸ªæ•°æ®æºçš„äº‹åŠ¡ã€‚</p><h3 id="222-å¤šæœåŠ¡å¤šæ•°æ®æº"><a href="#2-2-2-å¤šæœåŠ¡å¤šæ•°æ®æº" class="headerlink" title="2.2.2 å¤šæœåŠ¡å¤šæ•°æ®æº"></a>2.2.2 å¤šæœåŠ¡å¤šæ•°æ®æº</h3><p>éšç€å¾®æœåŠ¡æ¶æ„çš„å‘å±•ï¼Œå•ä¸ªä¸šåŠ¡æ“ä½œå¾€å¾€éœ€è¦å¤šä¸ªå¾®æœåŠ¡åä½œå®Œæˆï¼Œè€Œè¿™äº›æœåŠ¡å¯èƒ½å„è‡ªä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“ã€‚ä¾‹å¦‚ï¼Œåœ¨ç”µå•†ä¸‹å•è¿‡ç¨‹ä¸­ï¼Œè®¢å•æœåŠ¡ã€åº“å­˜æœåŠ¡ã€è´¦åŠ¡æœåŠ¡ã€ç‰©æµæœåŠ¡å’Œä¼˜æƒ æœåŠ¡éœ€è¦ååŒå¤„ç†åŒä¸€ä¸šåŠ¡è¯·æ±‚ï¼Œå¹¶è¿›è¡Œäº¤äº’å’Œæ•°æ®æ›´æ–°ã€‚</p><p>åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡çš„ç®¡ç†æ¯”å•ä¸ªæœåŠ¡åœºæ™¯æ›´ä¸ºå¤æ‚ï¼Œå› ä¸ºå®ƒä¸ä»…æ¶‰åŠæ•°æ®ä¸€è‡´æ€§ï¼Œè¿˜æ¶‰åŠç½‘ç»œè°ƒç”¨çš„å¯é æ€§å’ŒæœåŠ¡é—´çš„åè°ƒã€‚è¿™ç±»åˆ†å¸ƒå¼äº‹åŠ¡é€šå¸¸å¯ä»¥é€šè¿‡å¯é æ¶ˆæ¯é˜Ÿåˆ—ã€TCC å’Œ SAGA ç­‰æ¨¡å¼æ¥å®ç°ã€‚</p><h2 id="23-å…±äº«äº‹åŠ¡-å¤šæœåŠ¡å•æ•°æ®æº"><a href="#2-3-å…±äº«äº‹åŠ¡-å¤šæœåŠ¡å•æ•°æ®æº" class="headerlink" title="2.3 å…±äº«äº‹åŠ¡-å¤šæœåŠ¡å•æ•°æ®æº"></a>2.3 å…±äº«äº‹åŠ¡-å¤šæœåŠ¡å•æ•°æ®æº</h2><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œé€šå¸¸ä¸å…è®¸å¤šæœåŠ¡å…±äº«åŒä¸€æ•°æ®æºã€‚ç†æƒ³çš„å¾®æœåŠ¡æ¶æ„æ˜¯æ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰å…¶ä¸“å±æ•°æ®åº“ï¼ˆå³æœåŠ¡ä¸æ•°æ®æºä¸€ä¸€å¯¹åº”ï¼‰ï¼Œè¿™ç§è®¾è®¡è¢«ç§°ä¸ºæ•°æ®åº“éš”ç¦»ã€‚</p><p>å› æ­¤ï¼Œæœ¬æ–‡åŠæœ¬ç³»åˆ—ä¸ä¼šæ¶‰åŠè¯¥ç±»å‹äº‹åŠ¡ã€‚</p><h1 id="3-ä¸¤ç§åˆ†å¸ƒå¼äº‹åŠ¡çš„åŒºåˆ«"><a href="#3-ä¸¤ç§åˆ†å¸ƒå¼äº‹åŠ¡çš„åŒºåˆ«" class="headerlink" title="3. ä¸¤ç§åˆ†å¸ƒå¼äº‹åŠ¡çš„åŒºåˆ«"></a>3. ä¸¤ç§åˆ†å¸ƒå¼äº‹åŠ¡çš„åŒºåˆ«</h1><p>åœ¨äº‹åŠ¡åˆ†ç±»ä¸­ï¼Œ<code>å•æœåŠ¡å¤šæ•°æ®æº</code> å’Œ <code>å¤šæœåŠ¡å¤šæ•°æ®æº</code> éƒ½è¢«å½’ç±»ä¸ºåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé‚£ä¹ˆè¿™ä¸¤ç§åˆ†å¸ƒå¼äº‹åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œå•æœåŠ¡å¤šæ•°æ®æºäº‹åŠ¡æ˜¯å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¹‹é—´çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œ ä¹Ÿè¢«ç§°ä¸ºå…¨å±€äº‹åŠ¡ã€‚å½“å®ƒè¢«ç§°ä¸ºåˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼Œè¿™é‡Œçš„â€œåˆ†å¸ƒå¼â€æ˜¯ç›¸å¯¹äºæ•°æ®æºè€Œè¨€çš„ï¼Œå¹¶ä¸æ¶‰åŠæœåŠ¡ã€‚</p><p>è€Œå¤šæœåŠ¡å¤šæ•°æ®æºäº‹åŠ¡æ˜¯è·¨ä¸åŒä¸­é—´ä»¶çš„ä¸šåŠ¡å±‚é¢åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><p>è¿™ä¸¤ç§åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€ä¸ªé‡è¦åŒºåˆ«åœ¨äºä¸€è‡´æ€§çš„å®ç°æ–¹å¼ä¸åŒï¼š</p><ul><li>å•æœåŠ¡å¤šæ•°æ®æºäº‹åŠ¡é€šå¸¸å¯ä»¥è¿½æ±‚ <strong>å¼ºä¸€è‡´æ€§</strong>ã€‚</li><li>å¤šæœåŠ¡å¤šæ•°æ®æºäº‹åŠ¡ç”±äºå…¶å¤æ‚æ€§å’Œåˆ†å¸ƒå¼ç‰¹æ€§ï¼Œé€šå¸¸åªèƒ½è¿½æ±‚ <strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ã€‚</li></ul><p>ä¸‹é¢å°†è¯¦ç»†è§£é‡Šè¿™ä¸¤ç§æƒ…å†µåŠå…¶åŸå› ã€‚</p><h2 id="31-å•æœåŠ¡å¤šæ•°æ®æº-ä¸-å¼ºä¸€è‡´æ€§"><a href="#3-1-å•æœåŠ¡å¤šæ•°æ®æº-ä¸-å¼ºä¸€è‡´æ€§" class="headerlink" title="3.1 å•æœåŠ¡å¤šæ•°æ®æº ä¸ å¼ºä¸€è‡´æ€§"></a>3.1 å•æœåŠ¡å¤šæ•°æ®æº ä¸ å¼ºä¸€è‡´æ€§</h2><p>åœ¨å•æœåŠ¡å¤šæ•°æ®æºçš„åœºæ™¯ä¸­ï¼Œå°½ç®¡æ¶‰åŠå¤šä¸ªæ•°æ®æºï¼Œä½†æ‰€æœ‰æ“ä½œéƒ½ç”±ä¸€ä¸ªå•ä¸€æœåŠ¡æ§åˆ¶ã€‚è¿™ç§é…ç½®å…è®¸ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰ç­‰ä¼ ç»Ÿçš„åˆ†å¸ƒå¼äº‹åŠ¡åè®®æ¥ç¡®ä¿å¼ºä¸€è‡´æ€§ï¼Œå³åœ¨ä»»ä½•æ—¶åˆ»ï¼Œæ‰€æœ‰æ•°æ®æºéƒ½èƒ½åæ˜ å‡ºç›¸åŒçš„äº‹åŠ¡çŠ¶æ€ã€‚</p><p><strong>ä¸ºä»€ä¹ˆå¯ä»¥å®ç°å¼ºä¸€è‡´æ€§ï¼š</strong></p><ul><li><strong>é›†ä¸­å¼åè°ƒ</strong>ï¼šå•ä¸ªæœåŠ¡å¯ä»¥ä½œä¸ºäº‹åŠ¡çš„ä¸­å¤®åè°ƒè€…ï¼Œç®¡ç†æ‰€æœ‰æ•°æ®æºçš„äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</li><li><strong>é”å®šèµ„æº</strong>ï¼šäº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­å¯ä»¥åœ¨å„ä¸ªæ•°æ®æºä¸Šé”å®šå¿…è¦çš„èµ„æºï¼Œç›´åˆ°äº‹åŠ¡å®Œæˆï¼Œç¡®ä¿äº‹åŠ¡çš„åŸå­æ€§å’Œä¸€è‡´æ€§ã€‚</li><li><strong>åŒæ­¥æ›´æ–°</strong>ï¼šæ‰€æœ‰æ•°æ®æºçš„æ›´æ–°æ“ä½œå¯ä»¥åŒæ­¥è¿›è¡Œï¼Œç¡®ä¿åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œæ‰€æœ‰çš„å˜æ›´éƒ½èƒ½ä¸€æ¬¡æ€§åæ˜ å‡ºæ¥ã€‚</li></ul><h2 id="32-å¤šæœåŠ¡å¤šæ•°æ®æº-ä¸-æœ€ç»ˆä¸€è‡´æ€§"><a href="#3-2-å¤šæœåŠ¡å¤šæ•°æ®æº-ä¸-æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="3.2 å¤šæœåŠ¡å¤šæ•°æ®æº ä¸ æœ€ç»ˆä¸€è‡´æ€§"></a>3.2 å¤šæœåŠ¡å¤šæ•°æ®æº ä¸ æœ€ç»ˆä¸€è‡´æ€§</h2><p>å¤šæœåŠ¡å¤šæ•°æ®æºäº‹åŠ¡æ¶‰åŠå¤šä¸ªç‹¬ç«‹çš„æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡å¯èƒ½ç®¡ç†è‡ªå·±çš„æ•°æ®æºã€‚åœ¨è¿™ç§æ¶æ„ä¸‹ï¼Œå®ç°å¼ºä¸€è‡´æ€§å˜å¾—éå¸¸å¤æ‚å’Œæˆæœ¬é«˜æ˜‚ï¼Œå› æ­¤é€šå¸¸é‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§æ¨¡å‹ã€‚</p><p><strong>ä¸ºä»€ä¹ˆé€šå¸¸åªèƒ½å®ç°æœ€ç»ˆä¸€è‡´æ€§ï¼š</strong></p><ul><li><strong>æœåŠ¡è‡ªæ²»</strong>ï¼šæ¯ä¸ªæœåŠ¡éƒ½æ˜¯è‡ªæ²»çš„ï¼Œç‹¬ç«‹ç®¡ç†è‡ªå·±çš„æ•°æ®æºï¼Œå®ƒä»¬ä¹‹é—´çš„é€šä¿¡å¯èƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä¸èƒ½ç«‹å³åæ˜ å…¶ä»–æœåŠ¡çš„çŠ¶æ€å˜æ›´ã€‚</li><li><strong>å¤æ‚çš„åè°ƒæœºåˆ¶</strong>ï¼šéœ€è¦è·¨æœåŠ¡åè°ƒå¤æ‚çš„äº‹åŠ¡å¯èƒ½æ¶‰åŠç½‘ç»œå»¶è¿Ÿå’ŒæœåŠ¡é—´é€šä¿¡å¤±è´¥ï¼Œä½¿å¾—åŒæ­¥æ›´æ–°æ‰€æœ‰æ•°æ®æºå˜å¾—ä¸åˆ‡å®é™…ã€‚</li><li><strong>ä½¿ç”¨è¡¥å¿äº‹åŠ¡</strong>ï¼šå¤šæœåŠ¡äº‹åŠ¡å¸¸é‡‡ç”¨å¦‚SAGAç­‰æ¨¡å¼ï¼Œé€šè¿‡ä¸€ç³»åˆ—çš„æœ¬åœ°äº‹åŠ¡å’Œè¡¥å¿äº‹åŠ¡æ¥å¤„ç†ä¸šåŠ¡æµç¨‹ï¼Œæ¯ä¸ªäº‹åŠ¡ç‹¬ç«‹æäº¤ï¼Œä»…é€šè¿‡è¡¥å¿æœºåˆ¶æ¥æ’¤é”€é”™è¯¯æ“ä½œï¼Œé€æ­¥è¾¾åˆ°æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li></ul><h1 id="4-å¼ºä¸€è‡´æ€§-vs-æœ€ç»ˆä¸€è‡´æ€§"><a href="#4-å¼ºä¸€è‡´æ€§-vs-æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="4.  å¼ºä¸€è‡´æ€§ vs æœ€ç»ˆä¸€è‡´æ€§"></a>4.  å¼ºä¸€è‡´æ€§ vs æœ€ç»ˆä¸€è‡´æ€§</h1><h2 id="41-ä¸€è‡´æ€§çš„åˆ†ç±»"><a href="#4-1-ä¸€è‡´æ€§çš„åˆ†ç±»" class="headerlink" title="4.1 ä¸€è‡´æ€§çš„åˆ†ç±»"></a>4.1 ä¸€è‡´æ€§çš„åˆ†ç±»</h2><h3 id="411-å¼ºä¸€è‡´æ€§strong-consistency"><a href="#4-1-1-å¼ºä¸€è‡´æ€§ï¼ˆStrong-Consistencyï¼‰" class="headerlink" title="4.1.1 å¼ºä¸€è‡´æ€§ï¼ˆStrong Consistencyï¼‰"></a>4.1.1 å¼ºä¸€è‡´æ€§ï¼ˆStrong Consistencyï¼‰</h3><p><strong>å¼ºä¸€è‡´æ€§</strong>æ„å‘³ç€ç³»ç»Ÿåœ¨æ›´æ–°æ•°æ®åï¼Œä»»ä½•éšåçš„è®¿é—®éƒ½å°†ç«‹å³çœ‹åˆ°è¿™ä¸€æ›´æ–°ã€‚åœ¨å¼ºä¸€è‡´æ€§æ¨¡å‹ä¸­ï¼Œæ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„æ•°æ®åœ¨ä»»ä½•æ—¶é—´ç‚¹éƒ½æ˜¯ä¸€è‡´çš„ã€‚è¿™é€šå¸¸è¦æ±‚åœ¨æ•°æ®æ›´æ–°è¿‡ç¨‹ä¸­è¿›è¡Œä¸¥æ ¼çš„åè°ƒï¼Œç¡®ä¿æ‰€æœ‰å‰¯æœ¬åœ¨ç»§ç»­æ“ä½œå‰éƒ½åŒæ­¥æ›´æ–°ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>æ•°æ®ä¸€è‡´æ€§å’Œç”¨æˆ·ä½“éªŒæœ€ä¸ºç†æƒ³ã€‚</li><li>æ˜“äºç†è§£å’Œä½¿ç”¨ï¼Œå› ä¸ºå®ƒæ¨¡æ‹Ÿäº†å•ä¸ªç³»ç»Ÿçš„è¡Œä¸ºã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>å¯èƒ½ä¸¥é‡å½±å“ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ï¼Œå°¤å…¶åœ¨ç½‘ç»œå»¶è¿Ÿè¾ƒé«˜çš„æƒ…å†µä¸‹ã€‚</li><li>åœ¨ CAP å®šç†ä¸­ï¼Œé€šå¸¸éœ€è¦åœ¨é‡åˆ°ç½‘ç»œåˆ†åŒºæ—¶ç‰ºç‰²å¯ç”¨æ€§ã€‚<h3 id="412-çº¿æ€§ä¸€è‡´æ€§linearizability"><a href="#4-1-2-çº¿æ€§ä¸€è‡´æ€§ï¼ˆLinearizabilityï¼‰" class="headerlink" title="4.1.2 çº¿æ€§ä¸€è‡´æ€§ï¼ˆLinearizabilityï¼‰"></a>4.1.2 çº¿æ€§ä¸€è‡´æ€§ï¼ˆLinearizabilityï¼‰</h3></li></ul><p>çº¿æ€§ä¸€è‡´æ€§æ˜¯å¼ºä¸€è‡´æ€§çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå®ƒä¸ä»…ä¿è¯æ‰€æœ‰èŠ‚ç‚¹çœ‹åˆ°ç›¸åŒçš„æ•°æ®ï¼Œè¿˜è¦æ±‚ç³»ç»Ÿè¡¨ç°å¾—å°±åƒæ‰€æœ‰æ“ä½œéƒ½æ˜¯é¡ºåºå‘ç”Ÿçš„ã€‚è¿™æ„å‘³ç€å¦‚æœæ“ä½œAåœ¨æ“ä½œBä¹‹å‰å®Œæˆï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½åº”è¯¥é¦–å…ˆçœ‹åˆ°Açš„ç»“æœï¼Œç„¶åæ˜¯Bçš„ç»“æœã€‚<br><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>æä¾›äº†å¼ºä¸€è‡´æ€§çš„æœ€é«˜æ ‡å‡†ï¼Œé€‚ç”¨äºéœ€è¦ä¸¥æ ¼æ•°æ®é¡ºåºçš„åº”ç”¨ã€‚</li><li>ç®€åŒ–äº†ç³»ç»Ÿçš„ç¼–ç¨‹æ¨¡å‹ã€‚<br><strong>ç¼ºç‚¹</strong>ï¼š</li><li>å¯¹ç³»ç»Ÿæ€§èƒ½å’Œå¯ç”¨æ€§çš„å½±å“æ¯”ä¸€èˆ¬çš„å¼ºä¸€è‡´æ€§è¿˜è¦å¤§ã€‚</li></ul><h3 id="413-å¼±ä¸€è‡´æ€§weak-consistency"><a href="#4-1-3-å¼±ä¸€è‡´æ€§ï¼ˆWeak-Consistencyï¼‰" class="headerlink" title="4.1.3 å¼±ä¸€è‡´æ€§ï¼ˆWeak Consistencyï¼‰"></a>4.1.3 å¼±ä¸€è‡´æ€§ï¼ˆWeak Consistencyï¼‰</h3><p>å¼±ä¸€è‡´æ€§ä¸ä¿è¯åœ¨æ•°æ®æ›´æ–°åç«‹å³åæ˜ è¿™ä¸€å˜åŒ–ã€‚åœ¨æ›´æ–°æ“ä½œå’Œå…¶å½±å“è¢«æ‰€æœ‰ç”¨æˆ·è§‚å¯Ÿåˆ°ä¹‹é—´ï¼Œå­˜åœ¨ä¸€ä¸ªä¸ç¡®å®šçš„æ—¶é—´çª—å£ã€‚è¿™ç§æ¨¡å‹é€šå¸¸ç”¨äºå¯¹å®æ—¶ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„ç³»ç»Ÿã€‚<br><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>æé«˜äº†ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚</li><li>åœ¨å¤„ç†é«˜å¹¶å‘æ“ä½œæ—¶æ›´åŠ æœ‰æ•ˆã€‚<br><strong>ç¼ºç‚¹</strong>ï¼š</li><li>ç”¨æˆ·å¯èƒ½ä¼šè¯»åˆ°æ—§æ•°æ®ã€‚</li><li>åº”ç”¨é€»è¾‘å¯èƒ½éœ€è¦å¤„ç†æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚<h3 id="414-æœ€ç»ˆä¸€è‡´æ€§eventual-consistency"><a href="#4-1-4-æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual-Consistencyï¼‰" class="headerlink" title="4.1.4  æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual Consistencyï¼‰"></a>4.1.4  æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual Consistencyï¼‰</h3></li></ul><p>æœ€ç»ˆä¸€è‡´æ€§ä¿è¯ï¼Œåœ¨æ²¡æœ‰æ–°çš„æ›´æ–°çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„æ•°æ®å‰¯æœ¬æœ€ç»ˆå°†ä¼šæ˜¯ä¸€è‡´çš„ã€‚ç³»ç»Ÿä¸ä¿è¯è¾¾åˆ°ä¸€è‡´çŠ¶æ€çš„å…·ä½“æ—¶é—´ã€‚<br><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>é«˜åº¦å¯ç”¨å’Œå¯æ‰©å±•ã€‚</li><li>é€‚ç”¨äºåˆ†å¸ƒå¹¿æ³›çš„ç³»ç»Ÿï¼Œå¯ä»¥å®¹å¿æ•°æ®åœ¨çŸ­æ—¶é—´å†…çš„ä¸ä¸€è‡´ã€‚<br><strong>ç¼ºç‚¹</strong>ï¼š</li><li>åº”ç”¨éœ€è¦èƒ½å¤Ÿå¤„ç†æ•°æ®ä¸€æ®µæ—¶é—´å†…çš„ä¸ä¸€è‡´ã€‚</li><li>å¼€å‘è€…éœ€è¦è®¾è®¡æœ‰æ•ˆçš„æ•°æ®åŒæ­¥å’Œå†²çªè§£å†³ç­–ç•¥ã€‚<h2 id="42-cap-ä¸-acidçš„å¾®å¦™å¹³è¡¡-åˆ†å¸ƒå¼ç³»ç»Ÿåªèƒ½è¿½æ±‚æœ€ç»ˆä¸€è‡´æ€§"><a href="#4-2-CAP-ä¸-ACIDçš„å¾®å¦™å¹³è¡¡-åˆ†å¸ƒå¼ç³»ç»Ÿåªèƒ½è¿½æ±‚æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="4.2  CAP ä¸ ACIDçš„å¾®å¦™å¹³è¡¡-åˆ†å¸ƒå¼ç³»ç»Ÿåªèƒ½è¿½æ±‚æœ€ç»ˆä¸€è‡´æ€§"></a>4.2  CAP ä¸ ACIDçš„å¾®å¦™å¹³è¡¡-åˆ†å¸ƒå¼ç³»ç»Ÿåªèƒ½è¿½æ±‚æœ€ç»ˆä¸€è‡´æ€§</h2></li></ul><p>æ ¹æ® CAP å®šç†ï¼Œä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰å’Œåˆ†åŒºå®¹å¿æ€§ï¼ˆPartition Toleranceï¼‰ä¸‰ä¸ªå±æ€§ï¼Œæœ€å¤šåªèƒ½æ»¡è¶³å…¶ä¸­ä¸¤ä¸ªï¼Œå¿…é¡»ç‰ºç‰²ä¸€ä¸ªã€‚</p><ul><li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong>ï¼šåœ¨ä»»ä½•æ—¶åˆ»ï¼Œä»»ä½•åˆ†å¸ƒå¼èŠ‚ç‚¹ä¸­çœ‹åˆ°çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´ã€‚</li><li><strong>å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰</strong>ï¼šç³»ç»Ÿèƒ½å¤Ÿä¸é—´æ–­åœ°æä¾›æœåŠ¡çš„èƒ½åŠ›ã€‚</li><li><strong>åˆ†åŒºå®¹å¿æ€§ï¼ˆPartition Toleranceï¼‰</strong>ï¼šåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œå½“éƒ¨åˆ†èŠ‚ç‚¹å› ç½‘ç»œåŸå› å¤±è”ï¼ˆå³å½¢æˆâ€œç½‘ç»œåˆ†åŒºâ€ï¼‰æ—¶ï¼Œç³»ç»Ÿä»èƒ½æ­£ç¡®æä¾›æœåŠ¡çš„èƒ½åŠ›ã€‚</li></ul><h2 id="421-ä¸ºä»€ä¹ˆè¯´-åˆ†å¸ƒå¼ç³»ç»Ÿ-å¿…é¡»æ¥å—-åˆ†åŒºå®¹å¿æ€§"><a href="#4-2-1-ä¸ºä»€ä¹ˆè¯´-åˆ†å¸ƒå¼ç³»ç»Ÿ-å¿…é¡»æ¥å—-åˆ†åŒºå®¹å¿æ€§" class="headerlink" title="4.2.1 ä¸ºä»€ä¹ˆè¯´ åˆ†å¸ƒå¼ç³»ç»Ÿ å¿…é¡»æ¥å— åˆ†åŒºå®¹å¿æ€§"></a>4.2.1 ä¸ºä»€ä¹ˆè¯´ åˆ†å¸ƒå¼ç³»ç»Ÿ å¿…é¡»æ¥å— åˆ†åŒºå®¹å¿æ€§</h2><p>ç†è§£ä¸ºä»€ä¹ˆåˆ†åŒºå®¹å¿æ€§åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¿…ç„¶å­˜åœ¨ï¼Œéœ€è¦ä»åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ„æˆå’Œç½‘ç»œé€šä¿¡çš„ä¸å¯é æ€§ä¸¤ä¸ªè§’åº¦æ¢è®¨ã€‚</p><ol><li><p><strong>åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ„æˆ</strong> åˆ†å¸ƒå¼ç³»ç»Ÿç”±å¤šä¸ªç›¸äº’åä½œçš„ç‹¬ç«‹ç»„ä»¶ç»„æˆï¼Œè¿™äº›ç»„ä»¶å¯èƒ½ä½äºç‰©ç†ä¸Šåˆ†æ•£çš„ä¸åŒä½ç½®ã€‚è¯¥æ¶æ„çš„ä¸»è¦ä¼˜åŠ¿æ˜¯æé«˜ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€å®¹é”™æ€§å’Œèµ„æºåˆ©ç”¨ç‡ã€‚ç„¶è€Œï¼Œè¿™ä¹Ÿæ„å‘³ç€ç³»ç»Ÿçš„å„ä¸ªéƒ¨åˆ†å¿…é¡»é€šè¿‡ç½‘ç»œé€šä¿¡ã€‚</p></li><li><p><strong>ç½‘ç»œé€šä¿¡çš„ä¸å¯é æ€§</strong> ç½‘ç»œæœ¬èº«å­˜åœ¨ä¸å¯é æ€§ï¼Œå¯èƒ½å› å¤šç§åŸå› å¯¼è‡´é€šä¿¡å¤±è´¥ï¼š</p><ol><li><strong>ç½‘ç»œæ•…éšœ</strong>ï¼šç½‘ç»œè®¾å¤‡æˆ–è¿æ¥å¯èƒ½å‡ºç°æ•…éšœï¼Œå¦‚è·¯ç”±å™¨æ•…éšœã€è¿æ¥æ–­å¼€ç­‰ã€‚</li><li><strong>ç½‘ç»œå»¶è¿Ÿ</strong>ï¼šæ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½é­é‡ä¸å¯é¢„æµ‹çš„å»¶è¿Ÿã€‚</li><li><strong>å¸¦å®½é™åˆ¶</strong>ï¼šç½‘ç»œçš„å¸¦å®½é™åˆ¶å¯èƒ½å¯¼è‡´æ•°æ®åŒ…å»¶è¿Ÿåˆ°è¾¾æˆ–ä¸¢å¤±ã€‚</li><li><strong>ç½‘ç»œå®‰å…¨</strong>ï¼šç½‘ç»œæ”»å‡»ï¼ˆå¦‚åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»ï¼ŒDDoSï¼‰å¯èƒ½å¯¼è‡´ç½‘ç»œéƒ¨åˆ†æˆ–å®Œå…¨ä¸å¯ç”¨ã€‚</li></ol></li></ol><p>å¦‚æœä¸€ä¸ªç³»ç»Ÿè®¾è®¡é€‰æ‹©ä¸æ¥å—ç½‘ç»œåˆ†åŒºï¼Œé‚£ä¹ˆä¸€æ—¦ç½‘ç»œåˆ†åŒºå‘ç”Ÿï¼Œç³»ç»Ÿå°†æ— æ³•æ­£å¸¸å·¥ä½œï¼Œè¿™åœ¨å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ä¸­æ˜¯ä¸å¯æ¥å—çš„ã€‚</p><p>å› æ­¤ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåˆ†åŒºå®¹å¿æ€§ï¼ˆPartition Toleranceï¼‰æ˜¯å¿…ç„¶å­˜åœ¨çš„ç‰¹æ€§ã€‚</p><p>åŸºäºåˆ†åŒºå®¹å¿æ€§å¿…é¡»æ»¡è¶³çš„ç°çŠ¶ä»¥åŠ CAP ç†è®ºï¼Œç³»ç»Ÿåªèƒ½åœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¹‹é—´åšå‡ºé€‰æ‹©ã€‚é€šå¸¸ï¼Œç³»ç»Ÿä¼šé€‰æ‹©é«˜å¯ç”¨æ€§ï¼Œå¼ºä¸€è‡´æ€§å› æ­¤è¢«ç‰ºç‰²ï¼Œç³»ç»Ÿåªèƒ½è¿½æ±‚æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><h1 id="5-ç†è§£åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„å„ç§åè®®"><a href="#5-ç†è§£åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„å„ç§åè®®" class="headerlink" title="5. ç†è§£åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„å„ç§åè®®"></a>5. ç†è§£åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„å„ç§åè®®</h1><h2 id="51-dtp-æ¨¡å‹å’Œ-xa-è§„èŒƒ"><a href="#5-1-DTP-æ¨¡å‹å’Œ-XA-è§„èŒƒ" class="headerlink" title="5.1 DTP æ¨¡å‹å’Œ XA è§„èŒƒ"></a>5.1 DTP æ¨¡å‹å’Œ XA è§„èŒƒ</h2><h3 id="511-dtp-æ¨¡å‹"><a href="#5-1-1-DTP-æ¨¡å‹" class="headerlink" title="5.1.1  DTP æ¨¡å‹"></a>5.1.1  DTP æ¨¡å‹</h3><p>DTPï¼ˆDistributed Transaction Processingï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ï¼‰æ¨¡å‹æ˜¯ç”± X/Openï¼ˆåæ¥çš„ Open Groupï¼‰æå‡ºçš„ä¸€ç§åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†æ¶æ„æ¨¡å‹ã€‚å®ƒå®šä¹‰äº†ä¸€å¥—æ ‡å‡†ï¼Œä½¿å¾—ä¸åŒå‚å•†çš„åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ç³»ç»Ÿèƒ½å¤Ÿäº’æ“ä½œã€‚</p><p>åœ¨æ ‡å‡†çš„ DTP æ¨¡å‹ä¸­ï¼Œå®šä¹‰äº†ä»¥ä¸‹å››ä¸ªä¸»è¦ç»„ä»¶ï¼š</p><ol><li><p><strong>Application Programï¼ˆAPï¼Œåº”ç”¨ç¨‹åºï¼‰ï¼š</strong></p><ul><li>å‘èµ·åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸»ä½“ï¼Œç”±æœ€ç»ˆç”¨æˆ·æˆ–å¼€å‘è€…ç¼–å†™ã€‚</li><li>é€šè¿‡è°ƒç”¨äº‹åŠ¡ç®¡ç†å™¨çš„æ¥å£ï¼ˆä¾‹å¦‚ TX æ¥å£ï¼‰å¼€å§‹ã€æäº¤æˆ–å›æ»šäº‹åŠ¡ã€‚</li><li>åº”ç”¨ç¨‹åºä¸äº‹åŠ¡ç®¡ç†å™¨å’Œèµ„æºç®¡ç†å™¨äº¤äº’ã€‚</li></ul></li><li><strong>Transaction Managerï¼ˆTMï¼Œäº‹åŠ¡ç®¡ç†å™¨ï¼‰ï¼š</strong><ul><li>è´Ÿè´£ç®¡ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„å¼€å§‹ã€æäº¤å’Œå›æ»šç­‰æ“ä½œã€‚</li><li>ç»´æŠ¤äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤åè®®ï¼ˆ2PCï¼‰åè°ƒæ‰€æœ‰å‚ä¸çš„èµ„æºç®¡ç†å™¨ã€‚</li><li>æä¾›å¯¹å¤–çš„ TX æ¥å£ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œå¹¶é€šè¿‡ XA æ¥å£ä¸èµ„æºç®¡ç†å™¨äº¤äº’ã€‚</li></ul></li><li><strong>Resource Managerï¼ˆRMï¼Œèµ„æºç®¡ç†å™¨ï¼‰ï¼š</strong><ul><li>è´Ÿè´£ç®¡ç†å’Œæ§åˆ¶å¯¹ç‰¹å®šèµ„æºçš„è®¿é—®ï¼Œä¾‹å¦‚æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰ã€æ–‡ä»¶ç³»ç»Ÿã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ã€‚</li><li>æ¥æ”¶äº‹åŠ¡ç®¡ç†å™¨çš„è¯·æ±‚ä»¥è¿›è¡Œèµ„æºæ“ä½œï¼Œå¹¶ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚</li><li>å®ç° XA æ¥å£ä¸äº‹åŠ¡ç®¡ç†å™¨é€šä¿¡ã€‚</li></ul></li><li><strong>Communication Resource Managerï¼ˆCRMï¼Œé€šä¿¡èµ„æºç®¡ç†å™¨ï¼‰ï¼š</strong><ul><li>å¯é€‰ç»„ä»¶ï¼Œè´Ÿè´£ç®¡ç†ä¸å¤–éƒ¨ç³»ç»Ÿçš„é€šä¿¡èµ„æºã€‚</li><li>åœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­åè°ƒå’ŒåŒæ­¥äº‹åŠ¡çŠ¶æ€ï¼Œç¡®ä¿è·¨ç³»ç»Ÿçš„äº‹åŠ¡ä¸€è‡´æ€§ã€‚</li><li>ç®¡ç†è·¨ç½‘ç»œçš„äº‹åŠ¡ä¼ æ’­ï¼Œç¡®ä¿åˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„äº‹åŠ¡å¤„ç†ä¸€è‡´æ€§ã€‚</li></ul></li></ol><p><strong>ä¸»è¦æ¥å£ï¼š</strong></p><ol><li><strong>TX æ¥å£ï¼š</strong><ul><li>åº”ç”¨ç¨‹åº AP ä¸äº‹åŠ¡ç®¡ç†å™¨ TM ä¹‹é—´çš„æ¡¥æ¢ï¼Œè´Ÿè´£äº‹åŠ¡çš„å¼€å§‹ã€æäº¤å’Œå›æ»šç­‰æ“ä½œã€‚</li><li>ä¾‹å¦‚ï¼Œåœ¨ Java EE ä¸­ï¼ŒTX æ¥å£é€šå¸¸å¯¹åº” <code>javax.transaction.UserTransaction</code>ã€‚</li></ul></li><li><strong>XA æ¥å£ï¼š</strong><ul><li>äº‹åŠ¡ç®¡ç†å™¨ TM ä¸èµ„æºç®¡ç†å™¨ RM ä¹‹é—´çš„æ¥å£ï¼Œåè°ƒèµ„æºç®¡ç†å™¨åœ¨ä¸¤é˜¶æ®µæäº¤åè®®ä¸­çš„æ“ä½œã€‚</li><li>å¸¸è§çš„ XA æ¥å£æ–¹æ³•åŒ…æ‹¬ <code>xa_open</code>ã€<code>xa_start</code>ã€<code>xa_end</code>ã€<code>xa_prepare</code>ã€<code>xa_commit</code>ã€<code>xa_rollback</code> ç­‰ã€‚</li></ul></li><li><strong>CRM æ¥å£ï¼š</strong><ul><li>äº‹åŠ¡ç®¡ç†å™¨ä¸é€šä¿¡èµ„æºç®¡ç†å™¨ä¹‹é—´çš„æ¥å£ï¼Œç¡®ä¿åˆ†å¸ƒå¼äº‹åŠ¡åœ¨ç½‘ç»œé€šä¿¡ä¸­ä¿æŒä¸€è‡´æ€§ã€‚</li><li>æ²¡æœ‰æ˜ç¡®çš„æ ‡å‡†æ¥å£ï¼Œç”±å„ç³»ç»Ÿå‚å•†è‡ªè¡Œå®ç°ã€‚</li></ul></li></ol><h3 id="512-xaè§„èŒƒ"><a href="#5-1-2-XAè§„èŒƒ" class="headerlink" title="5.1.2 XAè§„èŒƒ"></a>5.1.2 XAè§„èŒƒ</h3><p>XA è§„èŒƒæ˜¯ X/Open ç»„ç»‡åœ¨ DTPï¼ˆDistributed Transaction Processingï¼‰æ¨¡å‹ä¸­å®šä¹‰çš„ï¼Œç”¨äºæè¿°äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTMï¼‰å’Œèµ„æºç®¡ç†å™¨ï¼ˆRMï¼‰ä¹‹é—´äº¤äº’çš„æ¥å£æ ‡å‡†ã€‚</p><ol><li><p><strong>æ¥å£æ ‡å‡†ï¼š</strong><br>XA è§„èŒƒå®šä¹‰äº†ä¸€å¥—æ ‡å‡†æ¥å£ï¼ŒåŒ…æ‹¬ <code>xa_start</code>ã€<code>xa_end</code>ã€<code>xa_prepare</code>ã€<code>xa_commit</code>ã€<code>xa_rollback</code> ç­‰ã€‚</p></li><li><p><strong>2PC åè®®ï¼š</strong><br>XA æ¥å£å®ç°äº†ä¸¤é˜¶æ®µæäº¤åè®®ï¼ˆ2PCï¼‰ï¼Œä»¥ç¡®ä¿åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚</p></li></ol><h3 id="513-xa-äº‹åŠ¡"><a href="#5-1-3-XA-äº‹åŠ¡" class="headerlink" title="5.1.3 XA äº‹åŠ¡"></a>5.1.3 XA äº‹åŠ¡</h3><p><strong>XAäº‹åŠ¡</strong>æ˜¯ä¸€ç§åˆ†å¸ƒå¼äº‹åŠ¡ã€‚é€šè¿‡ä¸¤é˜¶æ®µæäº¤åè®®å’ŒXAæ¥å£æ ‡å‡†ï¼Œäº‹åŠ¡ç®¡ç†å™¨å’Œèµ„æºç®¡ç†å™¨èƒ½å¤Ÿå¯é åœ°ååŒå·¥ä½œï¼Œå®ç°è·¨ç³»ç»Ÿçš„äº‹åŠ¡å¤„ç†ï¼Œç¡®ä¿å¤šä¸ªç‹¬ç«‹èµ„æºçš„ä¸€è‡´æ€§ã€‚</p><p><strong>å®é™…åº”ç”¨</strong></p><ol><li>æ•°æ®åº“ç³»ç»Ÿï¼š<ul><li>å¤§å¤šæ•°ä¸»æµæ•°æ®åº“ç³»ç»Ÿéƒ½æ”¯æŒXAäº‹åŠ¡ï¼Œå¦‚Oracleã€MySQLã€DB2ã€SQL Serverç­‰ã€‚</li><li>é€šè¿‡å®ç°XAæ¥å£ï¼Œæ•°æ®åº“å¯ä»¥å‚ä¸åˆ†å¸ƒå¼äº‹åŠ¡å¹¶ä¸äº‹åŠ¡ç®¡ç†å™¨ååŒå·¥ä½œã€‚</li></ul></li><li>æ¶ˆæ¯ä¸­é—´ä»¶ï¼š<ul><li>ä¸€äº›æ¶ˆæ¯é˜Ÿåˆ—å’Œæ¶ˆæ¯ä¸­é—´ä»¶ä¹Ÿæ”¯æŒXAäº‹åŠ¡ï¼Œå¦‚IBM MQã€ActiveMQç­‰ã€‚</li><li>èƒ½å¤Ÿç¡®ä¿æ¶ˆæ¯å‘é€ä¸å…¶ä»–èµ„æºæ“ä½œçš„ä¸€è‡´æ€§ã€‚</li></ul></li><li>Java EEç¯å¢ƒï¼š<ul><li>åœ¨Java EEåº”ç”¨ç¨‹åºä¸­ï¼Œ<code>javax.transaction.UserTransaction</code>å’Œ<code>javax.transaction.TransactionManager</code>æ¥å£æä¾›äº†å¯¹XAäº‹åŠ¡çš„æ”¯æŒã€‚<h2 id="52-ä¸¤é˜¶æ®µæäº¤2pc"><a href="#5-2-ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰" class="headerlink" title="5.2 ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰"></a>5.2 ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰</h2></li></ul></li></ol><p>ä¸¤é˜¶æ®µæäº¤æ˜¯ä¸€ç§å…·ä½“çš„äº‹åŠ¡åè®®ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­åè°ƒå¤šä¸ªäº‹åŠ¡å‚ä¸è€…çš„è¡Œä¸ºï¼Œä»¥ç¡®ä¿äº‹åŠ¡çš„åŸå­æ€§ã€‚å®ƒåŒ…å«ä»¥ä¸‹ä¸¤ä¸ªé˜¶æ®µï¼š</p><ul><li><strong>å‡†å¤‡é˜¶æ®µ</strong>ï¼šåè°ƒè€…è¯¢é—®æ‰€æœ‰å‚ä¸è€…ï¼Œæ˜¯å¦å‡†å¤‡å¥½æäº¤äº‹åŠ¡ã€‚</li><li><strong>æäº¤/å›æ»šé˜¶æ®µ</strong>ï¼šåŸºäºå„å‚ä¸è€…çš„ç­”å¤å’Œè¶…æ—¶æƒ…å†µï¼Œåè°ƒè€…å†³å®šæ˜¯å¦å…¨å±€æäº¤æˆ–å›æ»šï¼Œ<ul><li>åªæœ‰å…¨éƒ¨å‚ä¸è€…å›ç­”äº†prepared æ‰ä¼šcommit;</li><li>è‹¥æœ‰ä¸€ä¸ªå‚ä¸è€…å›ç­”å’Œnon-prepared æˆ–è€…è¶…æ—¶æœªå›ç­”ï¼Œåˆ™rollback</li></ul></li></ul><img src="/5b064db6/1.png" class><h3 id="521-åè°ƒè€…å®•æœºå•ç‚¹é—®é¢˜å‚ä¸è€…é˜»å¡"><a href="#5-2-1-åè°ƒè€…å®•æœºï¼šå•ç‚¹é—®é¢˜ï¼Œå‚ä¸è€…é˜»å¡" class="headerlink" title="5.2.1 åè°ƒè€…å®•æœºï¼šå•ç‚¹é—®é¢˜ï¼Œå‚ä¸è€…é˜»å¡"></a>5.2.1 åè°ƒè€…å®•æœºï¼šå•ç‚¹é—®é¢˜ï¼Œå‚ä¸è€…é˜»å¡</h3><p>åœ¨2PCä¸­ï¼Œä¸€ä¸ªé‡è¦ç‰¹ç‚¹æ˜¯å‚ä¸è€…ç¼ºä¹è¶…æ—¶æœºåˆ¶ã€‚å› æ­¤ï¼Œåœ¨ç¬¬ä¸€é˜¶æ®µç»“æŸåï¼Œä»–ä»¬å¿…é¡»åŸåœ°ç­‰å¾…åè°ƒè€…çš„ç¬¬äºŒé˜¶æ®µæŒ‡ä»¤ã€‚ä¸€æ—¦åè°ƒè€…å®•æœºï¼Œæ‰€æœ‰å‚ä¸è€…éƒ½ä¼šå—åˆ°å½±å“ã€‚å¦‚æœåè°ƒè€…é•¿æ—¶é—´æœªæ¢å¤æˆ–æœªå‘é€æ­£å¸¸çš„æäº¤æˆ–å›æ»šæŒ‡ä»¤ï¼Œæ‰€æœ‰å‚ä¸è€…éƒ½å°†è¢«é˜»å¡ã€‚</p><p>ä¸ºä½•å‚ä¸è€…ç¼ºä¹è¶…æ—¶å¤„ç†æœºåˆ¶å‘¢ï¼Ÿå› ä¸ºè¿™å¯èƒ½å¼•å‘æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚å½“å‚ä¸è€…è¿Ÿè¿Ÿæœªæ”¶åˆ°æäº¤æˆ–å›æ»šæŒ‡ä»¤æ—¶ï¼Œæ— è®ºå…¶é»˜è®¤ä¸ºæäº¤è¿˜æ˜¯å›æ»šï¼Œéƒ½å¯èƒ½å¯¼è‡´å…¨å±€æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>è¿™ä¹Ÿç»™äº†æˆ‘ä»¬ä¸šåŠ¡å¼€å‘ä¸€äº›å¯ç¤ºï¼šåœ¨ä»»ä½•ä¸ç¡®å®šæƒ…å†µä¸‹ï¼Œéƒ½ä¸åº”éšæ„æŒ‡å®šé»˜è®¤æ“ä½œï¼Œæœ€ä½³åšæ³•æ˜¯å¯åŠ¨è­¦æŠ¥ï¼Œè®©äººå·¥ä»‹å…¥å¤„ç†ã€‚</p><h3 id="522-å›æ»šæ€§èƒ½å·®"><a href="#5-2-2-å›æ»šæ€§èƒ½å·®" class="headerlink" title="5.2.2  å›æ»šæ€§èƒ½å·®"></a>5.2.2  å›æ»šæ€§èƒ½å·®</h3><p>æ‰€æœ‰çš„æ“ä½œéƒ½å·²ç»å®Œæˆï¼Œå›æ»šéœ€è¦å…¨éƒ¨æ¨ç¿»ã€‚</p><h3 id="523-ä¸€è‡´æ€§é—®é¢˜"><a href="#5-2-3-ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="5.2.3 ä¸€è‡´æ€§é—®é¢˜"></a>5.2.3 ä¸€è‡´æ€§é—®é¢˜</h3><h4 id="5241-åè°ƒè€…å®•æœº"><a href="#5-2-4-1-åè°ƒè€…å®•æœº" class="headerlink" title="5.2.4.1 åè°ƒè€…å®•æœº"></a>5.2.4.1 åè°ƒè€…å®•æœº</h4><p>å¦‚ä¸Šé¢å•ç‚¹é—®é¢˜ä¸­æè¿°ï¼Œåè°ƒè€…å®•æœºåï¼Œç”±äºå‚ä¸è€…æ²¡æœ‰è¶…æ—¶å¤„ç†æœºåˆ¶ï¼Œä¼šä¸€ç›´é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°åè°ƒè€…å®•æœºæ¢å¤åï¼Œ æ ¹æ®æŒä¹…åŒ–çš„æ•°æ®åˆ¤æ–­è¯¥äº‹åŠ¡çŠ¶æ€ï¼Œè¿›è€Œå‘é€commit æˆ–è€… rollback ï¼Œ æ‰€ä»¥åœ¨åè°ƒè€…å®•æœºæ¢å¤å‰ åè°ƒè€…å’Œå‚ä¸è€…çš„æ•°æ®æ˜¯ä¸ä¸€è‡´çš„</p><h4 id="5232-å‚ä¸è€…å®•æœº"><a href="#5-2-3-2-å‚ä¸è€…å®•æœº" class="headerlink" title="5.2.3.2 å‚ä¸è€…å®•æœº"></a>5.2.3.2 å‚ä¸è€…å®•æœº</h4><p>å¦‚æœå‚ä¸è€…æ”¶åˆ°commitåï¼Œå®•æœºäº†ã€‚æ­¤æ—¶æ•°æ®ä¹Ÿæ˜¯ä¸ä¸€è‡´çš„<br>å‚ä¸è€…å®•æœºæ¢å¤åï¼Œå¯ä»¥æ£€æŸ¥è‡ªå·±çš„æŒä¹…åŒ–ä¿¡æ¯ï¼Œæ¥åˆ¤æ–­äº‹åŠ¡çš„çŠ¶æ€ã€‚</p><h4 id="5233-ç½‘ç»œé—®é¢˜"><a href="#5-2-3-3-ç½‘ç»œé—®é¢˜" class="headerlink" title="5.2.3.3 ç½‘ç»œé—®é¢˜"></a>5.2.3.3 ç½‘ç»œé—®é¢˜</h4><p>æœ‰çš„å‚ä¸è€…æ”¶åˆ°äº†commit,æœ‰çš„å‚ä¸è€…æ”¶ä¸åˆ°ï¼›<br>å‚ä¸è€…çš„ack æ¶ˆæ¯ï¼Œåè°ƒè€…æœ‰çš„æ”¶åˆ°äº†ï¼Œæœ‰çš„æ²¡æ”¶åˆ°ã€‚<br>å…¶ä¸­å‚ä¸è€…æ”¶ä¸åˆ°ç¬¬äºŒé˜¶æ®µçš„æ¶ˆæ¯ï¼Œè‡ªç„¶ä¸ä¼šæœ‰ack, è¡¨ç°ä¸Šä¹Ÿæ˜¯åè°ƒè€…æ”¶ä¸åˆ°ackã€‚<br>è¿™é‡Œçš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ åè°ƒè€…è¶…æ—¶å¤„ç†æœºåˆ¶-é‡è¯•ï¼Œåœ¨é‡è¯•æˆåŠŸä¹‹å‰ï¼Œæ•°æ®æ˜¯ä¸ä¸€è‡´çš„ã€‚</p><h3 id="524-æ¢³ç†ä¸‹-dtp-xa-2pc-ä¹‹é—´çš„å…³ç³»"><a href="#5-2-4-æ¢³ç†ä¸‹-DTPã€XAã€2PC-ä¹‹é—´çš„å…³ç³»" class="headerlink" title="5.2.4 æ¢³ç†ä¸‹ DTPã€XAã€2PC ä¹‹é—´çš„å…³ç³»"></a>5.2.4 æ¢³ç†ä¸‹ DTPã€XAã€2PC ä¹‹é—´çš„å…³ç³»</h3><p>DTPï¼ˆDistributed Transaction Processingï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ï¼‰æ¨¡å‹æ˜¯ç”±X/Openï¼ˆåæ¥çš„Open Groupï¼‰æå‡ºçš„ä¸€ç§åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†çš„ä½“ç³»ç»“æ„æ¨¡å‹ã€‚å®ƒå®šä¹‰äº†ä¸€å¥—æ ‡å‡†ï¼Œä½¿å¾—ä¸åŒå‚å•†çš„åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ç³»ç»Ÿèƒ½å¤Ÿäº’æ“ä½œã€‚</p><p>XAè§„èŒƒæ˜¯X/Openç»„ç»‡ åœ¨DTPï¼ˆDistributed Transaction Processingï¼‰æ¨¡å‹ä¸­å®šä¹‰çš„ï¼Œç”¨äºæè¿°äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTMï¼‰å’Œèµ„æºç®¡ç†å™¨ï¼ˆRMï¼‰ä¹‹é—´çš„äº¤äº’çš„æ¥å£æ ‡å‡†ã€‚</p><p>XA è§„èŒƒåŸºäº2PC å®ç°ã€‚<br><img src="/5b064db6/2.png" class></p><p>ä½†æ˜¯ 2PCåè®®æ˜¯ä¸€ç§é€šç”¨çš„äº‹åŠ¡æäº¤åè®®ï¼Œå¯ä»¥åœ¨ä»»ä½•å®ç°ä¸­ä½¿ç”¨ã€‚é™¤äº†XAè§„èŒƒï¼Œ2PCåè®®è¿˜å¯ä»¥ç”¨äºå…¶ä»–äº‹åŠ¡ç®¡ç†åè®®å’Œæ¡†æ¶ï¼Œå¦‚ï¼š</p><ol><li><strong>Seata</strong>ï¼šé˜¿é‡Œå·´å·´å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶ï¼Œæä¾›å…¨å±€äº‹åŠ¡ç®¡ç†æœåŠ¡ï¼Œæ”¯æŒ2PCä½†ä¸ç›´æ¥ä½¿ç”¨XAæ¥å£ã€‚</li><li><strong>Atomikos</strong>ï¼šæ”¯æŒä¸¤é˜¶æ®µæäº¤åè®®çš„ç‹¬ç«‹äº‹åŠ¡ç®¡ç†å™¨ã€‚</li><li><strong>Bitronix</strong>ï¼šå¦ä¸€ä¸ªç‹¬ç«‹äº‹åŠ¡ç®¡ç†å™¨ï¼Œä¹Ÿæ”¯æŒ2PCåè®®ã€‚</li><li>åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå¯ä»¥ç›´æ¥åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­å®ç°ç®€åŒ–ç‰ˆçš„2PCåè®®ï¼Œè€Œæ— éœ€éµå¾ªXAè§„èŒƒã€‚</li></ol><h2 id="53-ä¸‰é˜¶æ®µæäº¤3pc"><a href="#5-3-ä¸‰é˜¶æ®µæäº¤ï¼ˆ3PCï¼‰" class="headerlink" title="5.3  ä¸‰é˜¶æ®µæäº¤ï¼ˆ3PCï¼‰"></a>5.3  ä¸‰é˜¶æ®µæäº¤ï¼ˆ3PCï¼‰</h2><p>3PC çš„3ä¸ªé˜¶æ®µï¼Œ</p><ol><li>CanCommit</li><li>PreCommit</li><li>DoCommit</li></ol><p>3PC ç›¸æ¯”2PC çš„å˜åŒ–</p><ol><li>3PCæäº¤æŠŠ2PCçš„prepare é˜¶æ®µç»†åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«ç§°ä¸º CanCommitã€PreCommit</li><li>å‚ä¸è€…å¢åŠ äº†è¶…æ—¶å¤„ç†æœºåˆ¶ï¼Œè¶…æ—¶é»˜è®¤ä¼šæäº¤äº‹åŠ¡</li></ol><p>3PC çš„æå‡ºæ˜¯ä¸ºäº†æ”¹è¿›2PC å­˜åœ¨çš„é—®é¢˜</p><h3 id="531-cancommit-ä¼˜åŒ–å›æ»šæ“ä½œæ€§èƒ½"><a href="#5-3-1-CanCommit-ä¼˜åŒ–å›æ»šæ“ä½œæ€§èƒ½" class="headerlink" title="5.3.1 CanCommit ä¼˜åŒ–å›æ»šæ“ä½œæ€§èƒ½"></a>5.3.1 CanCommit ä¼˜åŒ–å›æ»šæ“ä½œæ€§èƒ½</h3><p>æ–°å¢çš„ CanCommit æ˜¯ä¸€ä¸ªè¯¢é—®é˜¶æ®µï¼Œåè°ƒè€…è®©æ¯ä¸ªå‚ä¸çš„æ•°æ®åº“æ ¹æ®è‡ªèº«çŠ¶æ€ï¼Œè¯„ä¼°è¯¥äº‹åŠ¡æ˜¯å¦æœ‰å¯èƒ½é¡ºåˆ©å®Œæˆã€‚è¿™å¯ä»¥è§£å†³æé«˜precommit é˜¶æ®µçš„æˆåŠŸç‡ï¼Œä¸‡ä¸€å¤±è´¥äº†ï¼Œå›æ»šæ“ä½œä¹Ÿæ¯”è¾ƒè½»ï¼Œå› ä¸ºè¿˜æ²¡å¼€å§‹åšå®è´¨æ€§çš„æ“ä½œ</p><p>ä½†æ˜¯è¿™é‡Œè¦æ³¨æ„ä¸€ä¸ªæ€§èƒ½é—®é¢˜ï¼Œåœ¨äº‹åŠ¡éœ€è¦å›æ»šçš„åœºæ™¯ä¸­ï¼Œä¸‰æ®µå¼çš„æ€§èƒ½é€šå¸¸è¦æ¯”ä¸¤æ®µå¼å¥½å¾ˆå¤šï¼Œä½†åœ¨äº‹åŠ¡èƒ½å¤Ÿæ­£å¸¸æäº¤çš„åœºæ™¯ä¸­ï¼Œä¸¤æ®µå¼å’Œä¸‰æ®µå¼æäº¤çš„æ€§èƒ½éƒ½å¾ˆå·®ï¼Œä¸‰æ®µå¼å› ä¸ºå¤šäº†ä¸€æ¬¡è¯¢é—®ï¼Œæ€§èƒ½è¿˜è¦æ›´å·®ä¸€äº›ã€‚</p><h3 id="532-è§£å†³åè°ƒè€…å•ç‚¹é—®é¢˜"><a href="#5-3-2-è§£å†³åè°ƒè€…å•ç‚¹é—®é¢˜" class="headerlink" title="5.3.2 è§£å†³åè°ƒè€…å•ç‚¹é—®é¢˜"></a>5.3.2 è§£å†³åè°ƒè€…å•ç‚¹é—®é¢˜</h3><p>é€šè¿‡å¢åŠ å‚ä¸è€…è¶…æ—¶å¤„ç†æœºåˆ¶ï¼Œé»˜è®¤ä¼šæäº¤äº‹åŠ¡ï¼Œç›¸å½“äºè§£å†³äº†åè°ƒè€…å®•æœºå‚ä¸è€…é˜»å¡ç­‰å¾…çš„å•ç‚¹é—®é¢˜</p><h3 id="533-åŠ é‡æ•°æ®ä¸€è‡´æ€§é—®é¢˜"><a href="#5-3-3-åŠ é‡æ•°æ®ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="5.3.3 åŠ é‡æ•°æ®ä¸€è‡´æ€§é—®é¢˜"></a>5.3.3 åŠ é‡æ•°æ®ä¸€è‡´æ€§é—®é¢˜</h3><p>åœ¨2PCä¸­å·²ç»è®¨è®ºè¿‡,ä¸ºä»€ä¹ˆ2PCå‚ä¸è€…æ²¡æœ‰è¶…æ—¶å¤„ç†æœºåˆ¶ï¼Ÿ<br>å› ä¸ºè¶…æ—¶å¤„ç†æœºåˆ¶å¯èƒ½å¼•å‘æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œå½“ å‚ä¸è€…è¿Ÿè¿Ÿæ”¶ä¸åˆ°commit or rollback æŒ‡ä»¤æ—¶ï¼Œ å‚ä¸è€…ä¸è®ºæ˜¯ é»˜è®¤æäº¤ è¿˜æ˜¯é»˜è®¤å›æ»šï¼Œéƒ½æœ‰å¯èƒ½å¯¼è‡´å…¨å±€æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>3PC å¢åŠ äº†è¶…æ—¶æœºåˆ¶ï¼Œ ä¼šé»˜è®¤æäº¤äº‹åŠ¡ï¼Œè¿™ä¼šåŠ é‡æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜</p><h2 id="54-tcctry-confirmcancel"><a href="#5-4-TCCï¼ˆTry-Confirm-Cancelï¼‰" class="headerlink" title="5.4 TCCï¼ˆTry-Confirm/Cancelï¼‰"></a>5.4 TCCï¼ˆTry-Confirm/Cancelï¼‰</h2><p>TCCæ˜¯ä¸€ç§åº”ç”¨å±‚äº‹åŠ¡åè®®ï¼Œå®ƒåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šTryï¼ˆå°è¯•ï¼‰ã€Confirmï¼ˆç¡®è®¤ï¼‰ã€Cancelï¼ˆå–æ¶ˆï¼‰ã€‚åœ¨Tryé˜¶æ®µï¼Œæ¯ä¸ªå‚ä¸è€…å°è¯•æ‰§è¡Œäº‹åŠ¡å¹¶é”å®šå¿…è¦èµ„æºï¼›åœ¨Confirmé˜¶æ®µï¼Œå¦‚æœæ‰€æœ‰å‚ä¸è€…çš„Tryæ“ä½œéƒ½æˆåŠŸï¼Œé‚£ä¹ˆæ‰§è¡ŒConfirmæ“ä½œæäº¤äº‹åŠ¡ï¼›å¦‚æœä»»ä½•Tryå¤±è´¥ï¼Œåˆ™æ‰§è¡ŒCancelæ“ä½œå›æ»šäº‹åŠ¡ã€‚TCCé€‚ç”¨äºä¸šåŠ¡é€»è¾‘å¤æ‚ï¼Œéœ€è¦é•¿æ—¶é—´è¿è¡Œçš„äº‹åŠ¡ã€‚</p><p>ä¸ªäººè®¤ä¸ºï¼ŒTCCå¯ä»¥è¢«ç†è§£ä¸ºæ˜¯2PCçš„ä¸€ç§å˜ä½“ï¼Œå…·æœ‰ä¸¤é˜¶æ®µçš„ç»“æ„ï¼Œä½†å®ƒåœ¨å®æ–½å’Œæ“ä½œä¸Šæ›´é€‚åˆå¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å’Œæé«˜ç³»ç»Ÿçš„çµæ´»æ€§ä¸æ•ˆç‡ã€‚</p><h2 id="55-å¯é æ¶ˆæ¯é˜Ÿåˆ—"><a href="#5-5-å¯é æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="5.5  å¯é æ¶ˆæ¯é˜Ÿåˆ—"></a>5.5  å¯é æ¶ˆæ¯é˜Ÿåˆ—</h2><p>ä½¿ç”¨å¯é æ¶ˆæ¯é˜Ÿåˆ—æ¥è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜æ˜¯ä¸€ç§è¢«ç§°ä¸ºâ€œæœ€ç»ˆä¸€è‡´æ€§â€çš„ç­–ç•¥ï¼Œå®ƒé€šè¿‡å¼‚æ­¥æ¶ˆæ¯ä¼ é€’çš„æ–¹å¼ï¼Œç¡®ä¿åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¤šä¸ªæœåŠ¡ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><p>ä½¿ç”¨å¯é æ¶ˆæ¯é˜Ÿåˆ—è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ ¸å¿ƒæ€æƒ³åœ¨äºï¼š</p><ol><li><strong>å¼‚æ­¥ä¸æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼šé€šè¿‡å¼‚æ­¥çš„æ–¹å¼å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¹¶ç¡®ä¿æœ€ç»ˆä¸€è‡´æ€§ã€‚</li><li><strong>å¯é æ¶ˆæ¯ä¼ é€’</strong>ï¼šç¡®ä¿æ¶ˆæ¯ä¼ é€’çš„å¯é æ€§ï¼ŒåŒ…æ‹¬é‡è¯•æœºåˆ¶ã€å¹‚ç­‰å¤„ç†ç­‰ã€‚</li></ol><h2 id="56-saga"><a href="#5-6-SAGA" class="headerlink" title="5.6 SAGA"></a>5.6 SAGA</h2><p>SAGAæ˜¯ä¸€ç§å°†é•¿æœŸäº‹åŠ¡åˆ†è§£ä¸ºä¸€ç³»åˆ—è¾ƒå°çš„ã€ç‹¬ç«‹çš„å­äº‹åŠ¡çš„æ–¹æ³•ã€‚æ¯ä¸ªå­äº‹åŠ¡éƒ½å¯ä»¥å•ç‹¬æäº¤æˆ–å›æ»šã€‚å¦‚æœæŸä¸ªå­äº‹åŠ¡å¤±è´¥ï¼ŒSAGAé€šè¿‡æ‰§è¡Œè¡¥å¿äº‹åŠ¡ï¼ˆå³é€†æ“ä½œï¼‰æ¥æ¢å¤ä¹‹å‰çš„çŠ¶æ€ã€‚SAGAé™ä½äº†èµ„æºé”å®šçš„æ—¶é—´ï¼Œé€‚ç”¨äºå¾®æœåŠ¡æ¶æ„ä¸­çš„äº‹åŠ¡ç®¡ç†ã€‚</p><p>å‚è€ƒæ–‡ç« <br>ã€Šå‘¨å¿—æ˜çš„è½¯ä»¶æ¶æ„è¯¾ã€‹<br><a href="https://www.51cto.com/article/648668.html">https://www.51cto.com/article/648668.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-ä»€ä¹ˆæ˜¯äº‹åŠ¡&quot;&gt;&lt;a href=&quot;#1-ä»€ä¹ˆæ˜¯äº‹åŠ¡&quot; class=&quot;headerlink&quot; title=&quot;1. ä»€ä¹ˆæ˜¯äº‹åŠ¡&quot;&gt;&lt;/a&gt;1. ä»€ä¹ˆæ˜¯äº‹åŠ¡&lt;/h1&gt;&lt;p&gt;äº‹åŠ¡ï¼ˆTransactionï¼‰çš„æ¦‚å¿µèµ·æºäºæ•°æ®åº“é¢†åŸŸï¼Œæœ€æ—©ç”±ç¾å›½è®¡ç®—æœºç§‘å­¦å®¶ E. F. Cod</summary>
      
    
    
    
    
    <category term="äº‹åŠ¡" scheme="http://example.com/tags/%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨github page+hexo åˆ›å»ºä¸ªäººç½‘ç«™</title>
    <link href="http://example.com/5fe6baa/"/>
    <id>http://example.com/5fe6baa/</id>
    <published>2024-04-29T01:29:29.000Z</published>
    <updated>2024-06-16T09:50:05.895Z</updated>
    
    <content type="html"><![CDATA[<p>å…³äºä½¿ç”¨ github page + hexo åˆ›å»ºä¸ªäººç½‘ç«™ï¼Œ <a href="https://hexo.io/zh-cn/">hexoå®˜ç½‘</a>ä¸Šçš„æ­¥éª¤å·²ç»éå¸¸è¯¦ç»†ï¼Œç½‘ä¸Šä¹Ÿæœ‰éå¸¸å¤šç›¸å…³çš„æ–‡ç« ï¼Œ æ‰€ä»¥åŸºç¡€æ­¥éª¤å°±ä¸å†™äº†ã€‚</p><p>è¿™é‡Œè®°å½•ä¸€äº›ä¸ªæ€§åŒ–è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€‚</p><h1 id="1-toc-é”šç‚¹å¤±æ•ˆ"><a href="#1-TOC-é”šç‚¹å¤±æ•ˆ" class="headerlink" title="1. TOC é”šç‚¹å¤±æ•ˆ"></a>1. TOC é”šç‚¹å¤±æ•ˆ</h1><p>æ–‡ç« ç›®å½•æ­£å¸¸ç”Ÿæˆäº†ï¼Œä½†æ˜¯ç‚¹å‡»ç›®å½•æ— æ³•è·³è½¬åˆ°æ–‡ç« å¯¹åº”ä½ç½®ã€‚<br><a href="https://convivae.top/posts/hexo-bo-ke-cai-keng/#%E6%96%B9%E6%B3%95-2">è§£å†³åŠæ³•ç‚¹è¿™é‡ŒæŸ¥çœ‹</a></p><h1 id="2-æ–‡ç« çš„çŸ­é“¾æ¥ç”Ÿæˆ"><a href="#2-æ–‡ç« çš„çŸ­é“¾æ¥ç”Ÿæˆ" class="headerlink" title="2. æ–‡ç« çš„çŸ­é“¾æ¥ç”Ÿæˆ"></a>2. æ–‡ç« çš„çŸ­é“¾æ¥ç”Ÿæˆ</h1><p>hexo æ–‡ç« æ ‡é¢˜é»˜è®¤çš„æ ¼å¼æ˜¯:year/:month/:day/:title/,è¿™ä¸ªæ ¼å¼çš„æ ‡é¢˜åœ¨æˆ‘çœ‹æ¥æœ‰2ä¸ªä¸»è¦é—®é¢˜</p><ol><li>å¤ªé•¿ï¼Œå¯ä»¥è€ƒè™‘åªå–é»˜è®¤æ ¼å¼ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚:title/</li><li>æ˜“å˜åŒ–ï¼Œ å†™æ–‡ç« æ—¶æœ‰å¯èƒ½ä¼šä¿®æ”¹æ ‡é¢˜,æ‰€ä»¥æ–‡ç« çš„urlå°±ä¼šå‘ç”Ÿå˜åŒ–ã€‚ url ä¸€æ—¦å‘ç”Ÿå˜åŒ–å°±ä¼šå¯¹ç½‘ç«™æ’åäº§ç”Ÿè´Ÿé¢å½±å“</li></ol><p>ç»¼ä¸Šï¼Œæˆ‘å¸Œæœ›æ¯ç¯‡æ–‡ç« éƒ½æœ‰ä¸€ä¸ª å›ºå®šä¸”çŸ­çš„ urlã€‚</p><p><a href="https://github.com/rozbo/hexo-abbrlink">hexo-abbrlink:create one and only link for every post for hexo</a> æ’ä»¶å¯ä»¥å®ç°è¯¥åŠŸèƒ½ï¼Œ</p><p>å®ƒæ ¹æ®æ–‡ç« æ ‡é¢˜å’Œåˆ›å»ºæ—¶é—´ä¸ºæ–‡ç« ç”Ÿæˆä¸€ä¸ªabbrlinkï¼Œ å¦‚æœæ–‡ç« å·²ç»æœ‰è¯¥å±æ€§åˆ™ä¸ä¼šé‡å¤ç”Ÿæˆã€‚</p><h1 id="3-custom-domain-æ¶ˆå¤±è®°"><a href="#3-custom-domain-æ¶ˆå¤±è®°" class="headerlink" title="3. custom domain æ¶ˆå¤±è®°"></a>3. custom domain æ¶ˆå¤±è®°</h1><p>åœ¨github pages é…ç½®äº†custom domain ï¼Œä½†æ˜¯æˆ‘å‘ç°æ¯æ¬¡deployæ–°å†…å®¹åï¼Œé…ç½®å¥½çš„custom domain éƒ½ä¼šæ¶ˆå¤±ï¼Œç»è¿‡æ’æŸ¥å‘ç°æ˜¯ç¼ºå¤±æ¥ CNAMEæ–‡ä»¶ã€‚</p><h2 id="31-cnameæ˜¯ä»€ä¹ˆ"><a href="#3-1-CNAMEæ˜¯ä»€ä¹ˆ" class="headerlink" title="3.1 CNAMEæ˜¯ä»€ä¹ˆ"></a>3.1 CNAMEæ˜¯ä»€ä¹ˆ</h2><p>CNAMEï¼ˆCanonical Nameï¼‰è®°å½•æ˜¯ä¸€ç§DNSï¼ˆDomain Name Systemï¼‰è®°å½•ç±»å‹ï¼Œç”¨äºå°†ä¸€ä¸ªåŸŸååˆ«åæ˜ å°„åˆ°å¦ä¸€ä¸ªçœŸæ­£çš„åŸŸåã€‚<br>å®ƒçš„ä½œç”¨æ˜¯ç®€åŒ–åŸŸåç®¡ç†ã€å®ç°è´Ÿè½½å‡è¡¡ã€æ”¯æŒCDNé›†æˆç­‰ã€‚CNAMEè®°å½•çš„å·¥ä½œæµç¨‹åŒ…æ‹¬DNSæŸ¥è¯¢ã€é€’å½’æŸ¥è¯¢ã€æƒå¨DNSæœåŠ¡å™¨å“åº”å’ŒIPåœ°å€è¿”å›ç­‰æ­¥éª¤ã€‚é€šè¿‡æ­£ç¡®é…ç½®CNAMEè®°å½•ï¼Œå¯ä»¥æœ‰æ•ˆç®¡ç†å’Œä¼˜åŒ–ç½‘ç«™çš„åŸŸåè§£æã€‚</p><h2 id="32-cnameè®°å½•çš„ä½œç”¨"><a href="#3-2-CNAMEè®°å½•çš„ä½œç”¨" class="headerlink" title="3.2 CNAMEè®°å½•çš„ä½œç”¨"></a>3.2 CNAMEè®°å½•çš„ä½œç”¨</h2><ol><li>åŸŸåé‡å®šå‘ï¼šå…è®¸å¤šä¸ªåŸŸåæŒ‡å‘åŒä¸€ä¸ªç›®æ ‡åŸŸåï¼Œç®€åŒ–äº†åŸŸåç®¡ç†ã€‚ä¾‹å¦‚ï¼Œå°†www.example.comå’Œblog.example.coméƒ½æŒ‡å‘example.comã€‚</li><li>è´Ÿè½½å‡è¡¡ï¼šé€šè¿‡CNAMEè®°å½•å¯ä»¥å°†æµé‡åˆ†å¸ƒåˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</li><li>å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆCDNï¼‰é›†æˆï¼šCDNæä¾›å•†é€šå¸¸è¦æ±‚å°†ç”¨æˆ·çš„å­åŸŸåï¼ˆå¦‚cdn.example.comï¼‰CNAMEåˆ°ä»–ä»¬çš„CDNåŸŸåï¼ˆå¦‚cdn.provider.comï¼‰ï¼Œä»¥ä¾¿è¿›è¡Œæµé‡ç®¡ç†å’Œå†…å®¹åˆ†å‘ã€‚</li></ol><h2 id="33-cnameè®°å½•çš„å·¥ä½œæµç¨‹"><a href="#3-3-CNAMEè®°å½•çš„å·¥ä½œæµç¨‹" class="headerlink" title="3.3 CNAMEè®°å½•çš„å·¥ä½œæµç¨‹"></a>3.3 CNAMEè®°å½•çš„å·¥ä½œæµç¨‹</h2><p>CNAMEè®°å½•çš„å·¥ä½œæµç¨‹å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªä¸»è¦é˜¶æ®µï¼šè§£æCNAMEè®°å½•æœ¬èº«å’Œè§£æCNAMEè®°å½•æŒ‡å‘çš„ç›®æ ‡åŸŸåï¼Œç›´åˆ°æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªIPåœ°å€ã€‚</p><ol><li>DNSæŸ¥è¯¢å¼€å§‹ï¼š<br>ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥åŸŸåï¼Œå¦‚www.example.comï¼Œå¹¶å‘é€DNSæŸ¥è¯¢è¯·æ±‚ã€‚</li><li>é€’å½’DNSæœåŠ¡å™¨å¤„ç†è¯·æ±‚ï¼š<br>ç”¨æˆ·çš„è®¡ç®—æœºå‘é€’å½’DNSæœåŠ¡å™¨ï¼ˆé€šå¸¸ç”±ISPæä¾›ï¼‰å‘é€è¯·æ±‚ã€‚<br>é€’å½’DNSæœåŠ¡å™¨æŸ¥è¯¢æ ¹DNSæœåŠ¡å™¨ï¼Œè·å–é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼ˆå¦‚.comçš„æœåŠ¡å™¨ï¼‰çš„ä¿¡æ¯ã€‚</li><li>é€’å½’æŸ¥è¯¢è¿‡ç¨‹ï¼š<br>é€’å½’DNSæœåŠ¡å™¨æŸ¥è¯¢é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼Œè·å–è¯¥åŸŸçš„æƒå¨DNSæœåŠ¡å™¨ä¿¡æ¯ï¼ˆå¦‚example.comçš„DNSæœåŠ¡å™¨ï¼‰ã€‚<br>é€’å½’DNSæœåŠ¡å™¨æ¥ç€æŸ¥è¯¢æƒå¨DNSæœåŠ¡å™¨ã€‚</li><li>æƒå¨DNSæœåŠ¡å™¨å“åº”ï¼š<br>æƒå¨DNSæœåŠ¡å™¨æŸ¥æ‰¾www.example.comçš„DNSè®°å½•ã€‚<br>å¦‚æœwww.example.comæœ‰ä¸€ä¸ªCNAMEè®°å½•æŒ‡å‘example.comï¼Œæƒå¨DNSæœåŠ¡å™¨è¿”å›è¿™ä¸ªCNAMEè®°å½•ã€‚</li><li>CNAMEè§£æï¼š<br>é€’å½’DNSæœåŠ¡å™¨æ¥æ”¶åˆ°CNAMEè®°å½•åï¼Œå†æ¬¡è¿›è¡ŒDNSæŸ¥è¯¢ï¼Œä»¥è§£æCNAMEè®°å½•æŒ‡å‘çš„ç›®æ ‡åŸŸåexample.comã€‚<br>é€’å½’DNSæœåŠ¡å™¨æœ€ç»ˆè·å–ç›®æ ‡åŸŸåexample.comçš„Aè®°å½•ï¼ˆIPåœ°å€ï¼‰ã€‚</li><li>è¿”å›IPåœ°å€ï¼š<br>é€’å½’DNSæœåŠ¡å™¨å°†ç›®æ ‡åŸŸåexample.comçš„Aè®°å½•è¿”å›ç»™ç”¨æˆ·çš„è®¡ç®—æœºã€‚<br>ç”¨æˆ·çš„è®¡ç®—æœºä½¿ç”¨è¯¥IPåœ°å€ä¸ç›®æ ‡æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼ŒåŠ è½½ç½‘ç«™å†…å®¹ã€‚<h2 id="34-hexo-ä¸­cname-æ–‡ä»¶çš„ä½œç”¨"><a href="#3-4-Hexo-ä¸­CNAME-æ–‡ä»¶çš„ä½œç”¨" class="headerlink" title="3.4 Hexo ä¸­CNAME æ–‡ä»¶çš„ä½œç”¨"></a>3.4 Hexo ä¸­CNAME æ–‡ä»¶çš„ä½œç”¨</h2></li></ol><p>å½“ä½ ä½¿ç”¨è‡ªå®šä¹‰åŸŸåè€Œä¸æ˜¯<code>username.github.io</code>æ¥è®¿é—®ç½‘ç«™æ—¶ï¼Œéœ€è¦åœ¨åœ¨<code>source</code>ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶<code>CNAME</code> æ–‡ä»¶ï¼Œå¹¶å†™å…¥è‡ªå®šä¹‰åŸŸå</p><ul><li><code>CNAME</code>æ–‡ä»¶çš„å­˜åœ¨å’Œå†…å®¹ä¼šå‘ŠçŸ¥GitHub Pagesä½ å¸Œæœ›é€šè¿‡å“ªä¸ªè‡ªå®šä¹‰åŸŸåè®¿é—®ä½ çš„ç½‘ç«™ã€‚</li><li>ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„è‡ªå®šä¹‰åŸŸåæ˜¯<code>www.example.com</code>ï¼Œä½ éœ€è¦åœ¨<code>CNAME</code>æ–‡ä»¶ä¸­å†™å…¥<code>www.example.com</code>ã€‚</li></ul><h1 id="4-æ•°å­¦å…¬å¼çš„æ”¯æŒ"><a href="#4-æ•°å­¦å…¬å¼çš„æ”¯æŒ" class="headerlink" title="4. æ•°å­¦å…¬å¼çš„æ”¯æŒ"></a>4. æ•°å­¦å…¬å¼çš„æ”¯æŒ</h1><p>å¯å‚è€ƒ <a href="https://myblackboxrecorder.com/use-math-in-hexo/">åœ¨ä»»æ„çš„hexoä¸»é¢˜æ”¯æŒæ•°å­¦å…¬å¼</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å…³äºä½¿ç”¨ github page + hexo åˆ›å»ºä¸ªäººç½‘ç«™ï¼Œ &lt;a href=&quot;https://hexo.io/zh-cn/&quot;&gt;hexoå®˜ç½‘&lt;/a&gt;ä¸Šçš„æ­¥éª¤å·²ç»éå¸¸è¯¦ç»†ï¼Œç½‘ä¸Šä¹Ÿæœ‰éå¸¸å¤šç›¸å…³çš„æ–‡ç« ï¼Œ æ‰€ä»¥åŸºç¡€æ­¥éª¤å°±ä¸å†™äº†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œè®°å½•ä¸€äº›ä¸ªæ€§åŒ–è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€‚</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>chatGPTæ˜¯å¦‚ä½•è¢«è®­ç»ƒå‡ºæ¥çš„</title>
    <link href="http://example.com/8cb014c5/"/>
    <id>http://example.com/8cb014c5/</id>
    <published>2024-04-19T07:23:32.000Z</published>
    <updated>2024-05-17T09:14:34.168Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡å†…å®¹åŸºäº Andrej Karpathy çš„è§†é¢‘ <a href="https://www.youtube.com/watch?v=bZQun8Y4L2A">State of GPT</a>ï¼Œå¹¶åŠ å…¥äº†ä¸ªäººç†è§£ï¼Œè¿›è¡Œæ€»ç»“ã€‚</p><p>è¯¥éƒ¨åˆ†çš„ä¸»é¢˜æ˜¯how to train your GPT assistantsï¼Œ  åœ¨chatGPT çš„è¯­å¢ƒä¸­ï¼ŒAssistant ç‰¹æŒ‡èƒ½å›ç­”é—®é¢˜ï¼ŒåƒåŠ©æ‰‹ä¸€æ ·å¯ä»¥å¸®æˆ‘ä»¬åšå¾ˆå¤šäº‹ã€‚</p><h1 id="0-gptè®­ç»ƒçš„å››ä¸ªé˜¶æ®µ"><a href="#0-GPTè®­ç»ƒçš„å››ä¸ªé˜¶æ®µ" class="headerlink" title="0. GPTè®­ç»ƒçš„å››ä¸ªé˜¶æ®µ"></a>0. GPTè®­ç»ƒçš„å››ä¸ªé˜¶æ®µ</h1><img src="/8cb014c5/1.png" class><p>ç›®å‰æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨åˆ°çš„chatGPT éƒ½æ˜¯RLFH æ¨¡å‹ï¼Œè¯¥æ¨¡å‹çš„è®­ç»ƒå¯ä»¥åˆ†ä¸º3ä¸ªé˜¶æ®µ</p><ol><li>pretraining  é¢„è®­ç»ƒ</li><li>Supervised finetuning ç›‘ç£å¾®è°ƒ</li><li>Reinforcement Learning from Human Feedbackï¼Œ åŒ…æ‹¬reward modeling å’ŒReinforcement Learningï¼Œ å› ä¸ºreward modeling ä¸èƒ½ç‹¬ç«‹èµ·ä½œç”¨ï¼Œä¹Ÿä¸èƒ½ç‹¬ç«‹éƒ¨ç½²ï¼Œå¿…é¡»Reinforcement Learningç»“åˆä½¿ç”¨ï¼Œæ‰€ä»¥æŠŠå®ƒä»¬å½’ç±»ä¸ºä¸€ä¸ªé˜¶æ®µã€‚</li></ol><p>åœ¨ä»¥ä¸Šæ¯ä¸ªé˜¶æ®µä¸­ï¼Œéƒ½æœ‰å„è‡ªè®­ç»ƒéœ€è¦çš„æ•°æ®é›†ã€ç®—æ³•ã€å’Œè®­ç»ƒè¾“å‡ºç»“æœ</p><h1 id="1-pre-training-é¢„è®­ç»ƒ"><a href="#1-pre-training-é¢„è®­ç»ƒ" class="headerlink" title="1. pre-training   é¢„è®­ç»ƒ"></a>1. pre-training   é¢„è®­ç»ƒ</h1><p>pre-trainin é¢„è®­ç»ƒé˜¶æ®µæ˜¯ä¸€åˆ‡çš„èµ·ç‚¹ï¼Œå®ƒéœ€è¦æœ€å¤šçš„æ•°æ®ï¼Œæœ€å¤šçš„è®¡ç®—èµ„æºGPUï¼Œæœ€é•¿çš„è®­ç»ƒæ—¶é—´ã€‚</p><p>æ€»çš„ç‰¹ç‚¹å¦‚ä¸‹</p><ol><li><strong>å¤§è§„æ¨¡æ•°æ®</strong>ï¼šé¢„è®­ç»ƒä½¿ç”¨çš„å¤§è§„æ¨¡æ•°æ®é›†åŒ…å«äº†æ¥è‡ªäº’è”ç½‘çš„å„ç§æ–‡æœ¬ï¼Œè¿™äº›æ•°æ®é›†è§„æ¨¡åºå¤§ï¼Œé€šå¸¸åŒ…å«æ•°åäº¿ç”šè‡³æ•°ç™¾äº¿ä¸ªtokenã€‚</li><li><strong>æ— ç›‘ç£å­¦ä¹ </strong>ï¼šé¢„è®­ç»ƒé€šå¸¸é‡‡ç”¨æ— ç›‘ç£å­¦ä¹ æ–¹æ³•ï¼Œå³ä¸éœ€è¦äººä¸ºæ ‡æ³¨çš„æ•°æ®ã€‚æ¨¡å‹é€šè¿‡é¢„æµ‹æ–‡æœ¬ä¸­çš„ä¸‹ä¸€è¯ï¼ˆæˆ–ä¸‹ä¸€ä¸ªtokenï¼‰æ¥å­¦ä¹ è¯­è¨€ç»“æ„å’Œæ¨¡å¼ã€‚</li><li><strong>é€šç”¨æ€§</strong>ï¼šé¢„è®­ç»ƒæ¨¡å‹å…·æœ‰é€šç”¨æ€§ï¼Œå› ä¸ºå®ƒå¹¶æ²¡æœ‰é’ˆå¯¹ç‰¹å®šä»»åŠ¡è¿›è¡Œä¼˜åŒ–ï¼Œè€Œæ˜¯å¹¿æ³›åœ°å­¦ä¹ å„ç§è¯­è¨€æ¨¡å¼ã€‚è¿™ç§é€šç”¨æ€§ä½¿å¾—æ¨¡å‹å¯ä»¥é€‚åº”å¤šç§ä¸‹æ¸¸ä»»åŠ¡ã€‚<h2 id="11-dataset"><a href="#1-1-Dataset" class="headerlink" title="1.1 Dataset"></a>1.1 Dataset</h2></li></ol><img src="/8cb014c5/2.png" class><p>é¢„è®­ç»ƒä½¿ç”¨çš„å¤§è§„æ¨¡æ•°æ®é›†åŒ…å«äº†æ¥è‡ªäº’è”ç½‘çš„å„ç§æ–‡æœ¬ï¼Œè¿™äº›æ•°æ®é›†è§„æ¨¡åºå¤§ï¼Œä¸è¿‡ç›®å‰chatGPT æ²¡æœ‰å…¬å¼€å…·ä½“çš„æ•°æ®ï¼Œ ä¸Šå›¾æ˜¯meta å¼€æºçš„LLaMAçš„è®­ç»ƒæ•°æ®é›†</p><ul><li>67.0%çš„Common Crawlï¼Œä¹Ÿå°±æ˜¯å¸¸è§„ç½‘ç»œçˆ¬å–çš„æ•°æ®é›†ï¼Œè¿™éƒ¨åˆ†æ•°æ®é›†çš„ç‰¹ç‚¹æ˜¯å†…å®¹æ¶‰åŠçš„ç±»å‹å¾ˆå…¨é¢ï¼Œä½†æ˜¯å› ä¸ºå†…å®¹å¯èƒ½æ˜¯ä»»ä½•äººå†™çš„ï¼Œè´¨é‡ä¸€èˆ¬åä½ï¼Œä¹Ÿä¼šåŒ…å«å¤§é‡ä¸ç›¸å…³ï¼Œä¾‹å¦‚å¹¿å‘Šã€å¯¼èˆªæ¡ã€ç‰ˆæƒå£°æ˜ç­‰ã€‚</li><li>15.0%æ˜¯C4æ•°æ®é›† (Colossal Clean Crawled Corpus, â€œåºå¤§çš„æ¸…æ´è¯­æ–™åº“â€)ï¼Œè¿™ä¸ªæ•°æ®é›†åŒ…å«äº†å¤§é‡çš„ç½‘é¡µæ–‡æœ¬ï¼Œè¿™äº›æ–‡æœ¬å·²ç»è¿‡æ¸…ç†ï¼Œç§»é™¤äº†å¹¿å‘Šã€é‡å¤å†…å®¹ã€éè‹±è¯­æ–‡æœ¬ã€å’Œå…¶ä»–ä¸é€‚åˆè®­ç»ƒçš„å…ƒç´ ã€‚è¿™ä¸ªæ•°æ®é›†çš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªå¤§è§„æ¨¡ã€é«˜è´¨é‡ã€å¤šæ ·æ€§å¼ºçš„è‹±è¯­æ–‡æœ¬æ•°æ®é›†ï¼Œä»¥æ”¯æŒè‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ã€‚å°½ç®¡C4ç»è¿‡æ¸…ç†ï¼Œä½†ä»ç„¶åŒ…å«äº†æ¥è‡ªäº’è”ç½‘çš„å„ç§æ–‡æœ¬ï¼Œå› æ­¤å¯èƒ½åŒ…å«ä¸€äº›è´¨é‡ä¸é«˜çš„ä¿¡æ¯çš„ä¿¡æ¯ã€‚</li><li>å‰©ä½™18%çš„è®­ç»ƒæ•°æ®æ¥æºä¸»è¦æ˜¯æ¥è‡ªGithubã€ç»´åŸºç™¾ç§‘ã€ä¹¦ç±ã€Arxivè®ºæ–‡ã€äº¤æ˜“æ‰€ç­‰ï¼Œ å¯ä»¥è®¤ä¸ºæ˜¯é«˜è´¨é‡çš„æ•°æ®ã€‚</li></ul><p>è¿™äº›è®­ç»ƒæ•°æ®æœ‰ä»¥ä¸‹ç‰¹ç‚¹</p><ol><li><strong>è§„æ¨¡åºå¤§</strong>ï¼šè®­ç»ƒæ•°æ®çš„æ•°é‡éå¸¸å¤§ï¼ŒåŒ…å«æ•°åäº¿æ¡æ–‡æœ¬è®°å½•ã€‚è¿™ç§å¤§è§„æ¨¡çš„æ•°æ®é‡å¸®åŠ©æ¨¡å‹å­¦ä¼šè¯­è¨€çš„å¤æ‚æ€§å’Œç»†å¾®å·®åˆ«ã€‚</li><li><strong>å¤šæ ·æ€§</strong>ï¼šè®­ç»ƒæ•°æ®æ¶µç›–äº†å¹¿æ³›çš„ä¸»é¢˜å’Œé¢†åŸŸï¼ŒåŒ…æ‹¬ç§‘å­¦ã€è‰ºæœ¯ã€å†å²ã€æ–‡å­¦ã€æŠ€æœ¯ã€æ—¥å¸¸ç”Ÿæ´»ç­‰ã€‚è¿™ç§å¤šæ ·æ€§ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿåº”å¯¹å„ç§ç±»å‹çš„é—®é¢˜å’Œå¯¹è¯ã€‚</li><li><strong>å¹¿æ³›è¦†ç›–</strong>ï¼šæ¶µç›–äº†ä»åŸºç¡€çŸ¥è¯†åˆ°ä¸“ä¸šçŸ¥è¯†çš„å¹¿æ³›èŒƒå›´ï¼Œä½¿å¾—æ¨¡å‹åœ¨å›ç­”é—®é¢˜æ—¶æ—¢èƒ½å¤„ç†ç®€å•çš„æ—¥å¸¸é—®é¢˜ï¼Œä¹Ÿèƒ½åº”å¯¹å¤æ‚çš„ä¸“ä¸šé—®é¢˜ã€‚</li><li>. <strong>å¼€æ”¾è·å–</strong>ï¼šæ‰€æœ‰æ•°æ®éƒ½æ¥è‡ªå…¬å¼€å¯è·å–çš„èµ„æºï¼Œæ²¡æœ‰ä½¿ç”¨ç§äººæˆ–å—ä¿æŠ¤çš„æ•°æ®ï¼Œç¡®ä¿äº†æ•°æ®çš„åˆæ³•æ€§å’Œé“å¾·æ€§ã€‚</li></ol><p>æ ¹æ®ä»¥ä¸Šç‰¹ç‚¹ï¼Œå¯ä»¥æ€»ç»“è®¤ä¸ºåƒchatGPT è¿™æ ·çš„LLM, å­¦ä¹ äº†äººç±»åœ¨äº’è”ç½‘ä¸Šå‘è¡¨è¿‡æ‰€æœ‰çŸ¥è¯†ã€‚ä¸è¿‡ç”±äºé«˜è´¨é‡çš„æ•°æ®åªå 18%ï¼Œ å¦‚æœä½ æƒ³è·å–é«˜è´¨é‡çš„å›ç­”ï¼Œæ‰€ä»¥ä½ éœ€è¦ä¸€äº›chatGPT æ²Ÿé€šçš„æŠ€å·§ï¼Œ å³prompt æŠ€å·§ï¼Œæ‰èƒ½è·å–é«˜è´¨é‡çš„å›ç­”ã€‚</p><h2 id="12-preprocess-dataset-tokenization"><a href="#1-2-preprocess-dataset-Tokenization" class="headerlink" title="1.2 preprocess dataset-Tokenization"></a>1.2 preprocess dataset-Tokenization</h2><p>é’ˆå¯¹ä»äº’è”ç½‘ä¸Šè·å–åˆ°çš„å¤§é‡æ•°æ®ï¼ŒchatGPT å¹¶ä¸æ˜¯ç›´æ¥æ‹¿æ¥è®­ç»ƒï¼Œè€Œæ˜¯è¦ç»è¿‡tokenization æ ‡è®°åŒ–ï¼Œå°†æ–‡æœ¬è½¬æ¢æˆæ¨¡å‹å¯ä»¥ç†è§£çš„æ•´æ•°åºåˆ—ã€‚</p><h3 id="121-ä»€ä¹ˆæ˜¯tokenization"><a href="#1-2-1-ä»€ä¹ˆæ˜¯Tokenizationï¼Ÿ" class="headerlink" title="1.2.1 ä»€ä¹ˆæ˜¯Tokenizationï¼Ÿ"></a>1.2.1 ä»€ä¹ˆæ˜¯Tokenizationï¼Ÿ</h3><p>Tokenizationæ˜¯å°†æ–‡æœ¬æ‹†åˆ†æˆè¾ƒå°çš„å•å…ƒï¼ˆç§°ä¸ºtokensï¼‰çš„è¿‡ç¨‹ã€‚è¿™äº›tokenså¯ä»¥æ˜¯å•è¯ã€å­è¯ã€å­—ç¬¦æˆ–å…¶ä»–æ–‡æœ¬ç‰‡æ®µï¼Œï¼Œå¹¶å°†å…¶æ˜ å°„åˆ°ç‰¹å®šçš„æ ‡è®°æˆ–æ•´æ•°çš„è¿‡ç¨‹ã€‚</p><img src="/8cb014c5/3.png" class><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒGPT å¹¶ä¸æ˜¯ç›´æ¥ä½¿ç”¨ä»äº’è”ç½‘ä¸Šè·å–çš„åŸå§‹æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œ è€Œæ˜¯å…ˆè®²æ•°æ®åˆ†è§£æˆtoken,å†å°†token è½¬åŒ–æˆæ•´æ•°æ•°åˆ—ã€‚æœ€ç»ˆè¿›å…¥åˆ°ç¥ç»ç½‘ç»œ/Transformer è¿›è¡Œè®­ç»ƒçš„æ˜¯è¿™äº›æ•´æ•°æ•°åˆ—ã€‚</p><p>ä»¥ä¸‹Tokenizationçš„æ­¥éª¤ï¼š</p><ol><li><p><strong>æ–‡æœ¬æ¸…ç†</strong>ï¼šåœ¨è¿›è¡ŒTokenizationä¹‹å‰ï¼Œæ–‡æœ¬å¯èƒ½éœ€è¦æ¸…ç†ï¼Œæ¯”å¦‚å»æ‰å¤šä½™çš„ç©ºæ ¼ã€æ ‡ç‚¹ç¬¦å·çš„å¤„ç†ç­‰ã€‚è¿™ä¸€æ­¥éª¤è§†å…·ä½“åº”ç”¨è€Œå®šã€‚</p></li><li><p><strong>æ‹†åˆ†æ–‡æœ¬</strong>ï¼šå°†æ–‡æœ¬æ‹†åˆ†æˆtokensã€‚ä¾‹å¦‚ï¼Œå¯¹äºå¥å­â€œChatGPT is great.â€ï¼Œå¯ä»¥æ‹†åˆ†ä¸ºâ€œChatGPTâ€ã€â€œisâ€å’Œâ€œgreatâ€ã€‚</p></li><li><p><strong>å­è¯çº§åˆ«çš„Tokenization</strong>ï¼šç°ä»£è¯­è¨€æ¨¡å‹ï¼ˆå¦‚GPT-3ï¼‰é€šå¸¸ä½¿ç”¨å­è¯ï¼ˆsubwordï¼‰çº§åˆ«çš„Tokenizationï¼Œå¦‚Byte Pair Encodingï¼ˆBPEï¼‰æˆ–WordPieceã€‚è¿™äº›æ–¹æ³•å¯ä»¥å°†ç½•è§è¯åˆ†è§£ä¸ºæ›´å¸¸è§çš„å­è¯ç‰‡æ®µã€‚ä¾‹å¦‚ï¼Œå•è¯â€œunhappinessâ€å¯ä»¥åˆ†è§£ä¸ºâ€œunâ€ã€â€œhappinessâ€æˆ–è¿›ä¸€æ­¥åˆ†è§£ä¸ºâ€œunâ€ã€â€œhappiâ€ã€â€œnessâ€ã€‚</p></li><li><p><strong>åˆ†é…å”¯ä¸€ID</strong>ï¼šæ¯ä¸ªtokenè¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•°IDï¼Œæ¨¡å‹å†…éƒ¨ä½¿ç”¨è¿™äº›IDè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨æ–‡æœ¬ã€‚ä¾‹å¦‚ï¼Œâ€œChatGPTâ€å¯èƒ½è¢«åˆ†é…ID 12345ï¼Œâ€œisâ€è¢«åˆ†é…ID 6789ï¼Œä¾æ­¤ç±»æ¨ã€‚</p></li></ol><h3 id="122ä»€ä¹ˆæ˜¯token"><a href="#1-2-2ä»€ä¹ˆæ˜¯token" class="headerlink" title="1.2.2ä»€ä¹ˆæ˜¯token"></a>1.2.2ä»€ä¹ˆæ˜¯token</h3><p>token åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä¸­æ‰®æ¼”ç€æ ¸å¿ƒè§’è‰²ï¼Œå°¤å…¶æ˜¯åœ¨è®­ç»ƒåƒChatGPTè¿™æ ·çš„å¤§å‹è¯­è¨€æ¨¡å‹æ—¶ï¼Œtokenæ˜¯<code>æ¨¡å‹è®­ç»ƒ</code>å’Œ<code>ç”Ÿæˆæ–‡æœ¬</code>çš„åŸºæœ¬å•ä½ã€‚ åœ¨è‹±è¯­é¢„æ–™ä¸­ï¼Œå®ƒå¯ä»¥æ˜¯æ˜¯ä¸€ä¸ªè¯ã€ä¹Ÿå¯ä»¥æ˜¯ä¸€éƒ¨åˆ†è¯ã€æˆ–è€…ä¸€ä¸ªå­—ç¬¦ï¼ˆè™½ç„¶æ¼”è®²ä¸­ç¤ºä¾‹å¯¹token çš„ä¸¾ä¾‹åŸºæœ¬æ˜¯éƒ½æ˜¯å®Œæ•´çš„å•è¯ï¼‰</p><p>é‚£ä¹ˆè¿™é‡Œå°±è¦æ€è€ƒï¼Œä¸ºä»€ä¹ˆä¸ç”¨å®Œæ•´çš„å•è¯è®­ç»ƒå‘¢ï¼Œæ—¢ç®€å•åˆç›´æ¥ã€‚</p><ol><li>è¯æ±‡è¡¨å¤§å°å’Œç¨€ç–æ€§é—®é¢˜<br>ä½¿ç”¨å®Œæ•´å•è¯è¿›è¡Œè®­ç»ƒçš„ä¸€ä¸ªä¸»è¦é—®é¢˜æ˜¯è¯æ±‡è¡¨çš„å¤§å°ã€‚è‹±è¯­å’Œå…¶ä»–è¯­è¨€ä¸­çš„è¯æ±‡é‡éå¸¸åºå¤§ï¼Œå°¤å…¶æ˜¯å½“è€ƒè™‘åˆ°æ–°è¯ã€ä¸“æœ‰åè¯ã€ä¸åŒçš„è¯å½¢å˜åŒ–ï¼ˆå¦‚å¤æ•°å½¢å¼ã€æ—¶æ€ç­‰ï¼‰æ—¶ï¼Œè¯æ±‡è¡¨çš„è§„æ¨¡å¯èƒ½ä¼šå˜å¾—éå¸¸å¤§ã€‚<ul><li><strong>å¤§è¯æ±‡è¡¨é—®é¢˜</strong>ï¼šä¸€ä¸ªåºå¤§çš„è¯æ±‡è¡¨æ„å‘³ç€æ¨¡å‹éœ€è¦å¤„ç†æ›´å¤šçš„å•è¯ï¼Œè¿™ä¸ä»…å¢åŠ äº†æ¨¡å‹çš„å¤æ‚æ€§ï¼Œè¿˜ä¼šæ˜¾è‘—å¢åŠ è®­ç»ƒå’Œè¿è¡Œæ¨¡å‹æ‰€éœ€çš„èµ„æºï¼ˆå¦‚å†…å­˜å’Œè®¡ç®—æ—¶é—´ï¼‰ã€‚</li><li><strong>ç¨€ç–æ€§é—®é¢˜</strong>ï¼šå½“è¯æ±‡è¡¨å¾ˆå¤§æ—¶ï¼Œå¾ˆå¤šå•è¯åœ¨è®­ç»ƒæ•°æ®ä¸­å‡ºç°çš„é¢‘ç‡å¯èƒ½éå¸¸ä½ï¼Œå¯¼è‡´æ•°æ®ç¨€ç–ã€‚ç¨€ç–æ€§é—®é¢˜ä¼šé™ä½æ¨¡å‹å¯¹è¿™äº›å•è¯çš„å­¦ä¹ æ•ˆç‡ï¼Œå½±å“æ¨¡å‹çš„æ€§èƒ½å’Œæ³›åŒ–èƒ½åŠ›ã€‚</li></ul></li><li>å¤„ç†æœªçŸ¥è¯æ±‡çš„èƒ½åŠ›<br>ç›´æ¥ä½¿ç”¨å®Œæ•´å•è¯è¿›è¡Œè®­ç»ƒé¢ä¸´çš„å¦ä¸€ä¸ªæŒ‘æˆ˜æ˜¯å¦‚ä½•å¤„ç†è®­ç»ƒæ•°æ®ä¸­æœªå‡ºç°è¿‡çš„å•è¯ï¼ˆå³æœªçŸ¥è¯æ±‡æˆ–OOVé—®é¢˜ï¼‰ã€‚<ul><li><strong>æœªçŸ¥è¯æ±‡ï¼ˆOOVï¼‰é—®é¢˜</strong>ï¼šåœ¨æ–°çš„æ–‡æœ¬ä¸­ç»å¸¸ä¼šå‡ºç°è®­ç»ƒæ•°æ®ä¸­æœªè§è¿‡çš„å•è¯ã€‚å¦‚æœæ¨¡å‹åªå­¦ä¹ åˆ°äº†å®Œæ•´å•è¯ï¼Œé‚£ä¹ˆå®ƒå¾ˆéš¾å¤„ç†è¿™äº›æœªçŸ¥è¯æ±‡ã€‚</li><li><strong>æ³›åŒ–èƒ½åŠ›</strong>ï¼šé€šè¿‡ä½¿ç”¨å­è¯ï¼ˆå¦‚è¯å¹²ã€å‰ç¼€ã€åç¼€ç­‰ï¼‰æˆ–æ›´å°çš„å•å…ƒï¼Œæ¨¡å‹å¯ä»¥æ›´å¥½åœ°æ³›åŒ–åˆ°æœªè§è¿‡çš„å•è¯ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡è¯†åˆ«â€œun-â€å’Œâ€œ-ableâ€è¿™æ ·çš„å‰åç¼€ï¼Œæ¨¡å‹å¯ä»¥æ¨æ–­å‡ºâ€œunbelievableâ€ç­‰å•è¯çš„å«ä¹‰ï¼Œå³ä½¿è¿™ä¸ªè¯åœ¨è®­ç»ƒæ•°æ®ä¸­æ²¡æœ‰ç›´æ¥å‡ºç°è¿‡ã€‚</li></ul></li><li>è®­ç»ƒæ•ˆç‡å’Œè®¡ç®—èµ„æº<br>åˆ†è¯è¿˜å¯ä»¥å¸®åŠ©æé«˜è®­ç»ƒæ•ˆç‡å’Œå‡å°‘å¯¹è®¡ç®—èµ„æºçš„éœ€æ±‚ã€‚<ul><li><strong>å‡å°‘å‚æ•°æ•°é‡</strong>ï¼šè¾ƒå°çš„è¯æ±‡è¡¨å¯ä»¥å‡å°‘æ¨¡å‹çš„å‚æ•°æ•°é‡ï¼Œé™ä½è¿‡æ‹Ÿåˆçš„é£é™©ï¼ŒåŒæ—¶æé«˜æ¨¡å‹çš„è®­ç»ƒé€Ÿåº¦å’Œæ¨ç†é€Ÿåº¦ã€‚</li><li><strong>å†…å­˜å’Œå­˜å‚¨ä¼˜åŒ–</strong>ï¼šä½¿ç”¨æ›´å°çš„è¯æ±‡è¡¨æ„å‘³ç€å¯ä»¥æ›´é«˜æ•ˆåœ°ä½¿ç”¨å†…å­˜å’Œå­˜å‚¨èµ„æºï¼Œå°¤å…¶æ˜¯åœ¨åµŒå…¥å±‚ä¸­ã€‚</li></ul></li><li>é€‚åº”å¤šæ ·åŒ–çš„è¯­è¨€ç°è±¡<br>è¯­è¨€ä¸­å­˜åœ¨å¤§é‡çš„å˜ä½“å’Œåˆ›æ–°ï¼Œç›´æ¥ä½¿ç”¨å®Œæ•´å•è¯å¯èƒ½éš¾ä»¥é€‚åº”è¿™äº›å˜åŒ–ã€‚<ul><li><strong>è¯å½¢å˜åŒ–</strong>ï¼šåœ¨è®¸å¤šè¯­è¨€ä¸­ï¼Œå•è¯å¯ä»¥æœ‰å¤šç§å½¢å¼ã€‚ä½¿ç”¨åŸºäºè§„åˆ™æˆ–ç»Ÿè®¡çš„åˆ†è¯æ–¹æ³•å¯ä»¥å¸®åŠ©æ¨¡å‹ç†è§£ä¸åŒè¯å½¢ä¹‹é—´çš„å…³è”ï¼Œæé«˜æ¨¡å‹å¯¹è¯­è¨€å˜åŒ–çš„é€‚åº”èƒ½åŠ›ã€‚</li><li><strong>æ–°è¯åˆ›é€ å’Œç½‘ç»œè¯­è¨€</strong>ï¼šæ–°è¯å’Œç½‘ç»œæµè¡Œè¯­çš„å‡ºç°æ˜¯å¸¸æ€ã€‚åˆ†è¯ç³»ç»Ÿå¯ä»¥é€šè¿‡æ›´æ–°è¯åº“æˆ–è°ƒæ•´åˆ†è¯ç®—æ³•æ¥é€‚åº”è¿™äº›å˜åŒ–ã€‚</li></ul></li></ol><h2 id="13-unsupervised-learning-æ— ç›‘ç£å­¦ä¹ "><a href="#1-3-Unsupervised-Learning-æ— ç›‘ç£å­¦ä¹ " class="headerlink" title="1.3 Unsupervised Learning-æ— ç›‘ç£å­¦ä¹ "></a>1.3 Unsupervised Learning-æ— ç›‘ç£å­¦ä¹ </h2><p>é¢„è®­ç»ƒé‡‡ç”¨æ— ç›‘ç£å­¦ä¹ æ–¹æ³•ï¼Œå³ä¸éœ€è¦äººä¸ºæ ‡æ³¨çš„æ•°æ®ã€‚æ¨¡å‹é€šè¿‡é¢„æµ‹æ–‡æœ¬ä¸­çš„ä¸‹ä¸€è¯ï¼ˆæˆ–ä¸‹ä¸€ä¸ªtokenï¼‰æ¥å­¦ä¹ è¯­è¨€ç»“æ„å’Œæ¨¡å¼ã€‚</p><img src="/8cb014c5/4.png" class><p>æ•°æ®ä¼šä»¥æ‰¹æ¬¡ä¸ºå•ä½ï¼Œ è¾“å…¥åˆ°Transformerä¸­è¿›è¡Œè®­ç»ƒï¼Œå…¶è®­ç»ƒè¿‡ç¨‹å°±æ˜¯ä¸æ–­è®©æ¨¡å‹æ ¹æ®å‰é¢å·²ç»çš„å†…å®¹ï¼ˆé»„è‰²éƒ¨åˆ†ï¼‰ï¼Œå»çŒœæµ‹å½“å‰token(ç»¿è‰²éƒ¨åˆ†)çš„ä¸‹ä¸€ä¸ªè¯æ˜¯ä»€ä¹ˆï¼ˆçº¢è‰²éƒ¨åˆ†ï¼‰ï¼Œ å¦‚æœçŒœæµ‹çš„ç»“æœå’Œå®é™…æƒ…å†µä¸ä¸€è‡´ï¼Œåˆ™è¦è°ƒæ•´æ¨¡å‹ï¼Œç›´è‡³ç»“æœä¸€è‡´ã€‚</p><p>çŒœæµ‹çš„è¿‡ç¨‹æ˜¯åŸºäºæ¦‚ç‡è¿›è¡Œçš„ã€‚</p><p>å¦‚æœçŒœé”™äº†ï¼Œé‚£è·ç¦»æ­£ç¡®ç­”æ¡ˆåˆå¤šè¿œï¼Œè¿™å°±æ˜¯æŸå¤±å‡½æ•°çš„æ¦‚å¿µã€‚ä½æŸå¤±æ„å‘³ç€æ›´é«˜çš„é¢„æµ‹æ­£ç¡®æ¦‚ç‡</p><img src="/8cb014c5/5.png" class><h2 id="13-base-model"><a href="#1-3-base-model" class="headerlink" title="1.3 base model"></a>1.3 base model</h2><p>é¢„è®­ç»ƒå®Œæˆåä¼šå¾—åˆ°ä¸€ä¸ªbase model ï¼Œå› ä¸ºå®ƒå¹¶æ²¡æœ‰é’ˆå¯¹ç‰¹å®šä»»åŠ¡è¿›è¡Œä¼˜åŒ–ï¼Œè€Œæ˜¯å¹¿æ³›åœ°å­¦ä¹ å„ç§è¯­è¨€æ¨¡å¼ã€‚è¿™ç§é€šç”¨æ€§ä½¿å¾—æ¨¡å‹å¯ä»¥é€‚åº”å¤šç§ä¸‹æ¸¸ä»»åŠ¡ã€‚</p><h3 id="131-base-model-are-not-assistant"><a href="#1-3-1-base-model-are-not-assistant" class="headerlink" title="1.3.1 base model are not assistant"></a>1.3.1 base model are not assistant</h3><p>è¿™å¥è¯çš„å«ä¹‰æ˜¯base model å¹¶ä¸èƒ½å›ç­”é—®é¢˜ã€‚<br>é¢„è®­ç»ƒé˜¶æ®µå¾—åˆ°çš„base model  åªæ˜¯ä¸€ä¸ªæ–‡æ¡£ç”Ÿæˆå™¨ï¼Œ åªä¼šæ ¹æ®ä½ è¾“å…¥çš„å†…å®¹å»é¢„æµ‹ä¸‹ä¸€ä¸ªå•è¯ï¼Œå¹¶ä¸ä¼šå›ç­”ä½ çš„é—®é¢˜ï¼Œæ‰€ä»¥è¿˜èµ·ä¸åˆ°assistant åŠ©æ‰‹ çš„ä½œç”¨ã€‚ å¦‚å›¾ä¸­ï¼Œbase model å¹¶ä¸ä¼šæŒ‰ç…§ä½ çš„è¦æ±‚å†™è¯—ï¼ŒçŸ¥è¯†ç”Ÿæˆç›¸ä¼¼çš„å†…å®¹ã€‚<br><img src="/8cb014c5/6.png" class></p><p>what is the capital of France?</p><p>å†ä¾‹å¦‚é’ˆå¯¹ä»¥ä¸Šé—®é¢˜ï¼Œbase model å¹¶ä¸ä¼šå›ç­”é—®é¢˜ï¼Œç»™å‡ºâ€œParisâ€, è€Œæ˜¯ä¼šç»­å†™å†…å®¹ï¼Œ ç»™å‡ºä»¥ä¸‹å¯èƒ½çš„ç­”æ¡ˆ<br>what is Franceâ€™s largest city?<br>what is Franceâ€™s population?<br>what is the currency of France?</p><h2 id="14-å¦‚ä½•è®©-base-model-å›ç­”é—®é¢˜"><a href="#1-4-å¦‚ä½•è®©-base-model-å›ç­”é—®é¢˜" class="headerlink" title="1.4  å¦‚ä½•è®© base model å›ç­”é—®é¢˜"></a>1.4  å¦‚ä½•è®© base model å›ç­”é—®é¢˜</h2><h3 id="141-few-shot-learning"><a href="#1-4-1-few-shot-Learning" class="headerlink" title="1.4.1 few-shot Learning"></a>1.4.1 few-shot Learning</h3><p><strong>Few-shot Learning</strong>ï¼šæŒ‡çš„ä¸€ç§åœ¨ç»™æ¨¡å‹æä¾›å°‘é‡ç¤ºä¾‹çš„æƒ…å†µä¸‹è®©å…¶å­¦ä¹ æ–°ä»»åŠ¡çš„æ–¹æ³•ã€‚Few-shot å¯ä»¥åˆ†ä¸ºé›¶æ ·æœ¬å­¦ä¹ ï¼ˆzero-shot learningï¼‰ã€ä¸€æ ·æœ¬å­¦ä¹ ï¼ˆone-shot learningï¼‰å’Œå°æ ·æœ¬å­¦ä¹ ï¼ˆfew-shot learningï¼‰ã€‚<br><strong>åŸç†</strong>ï¼šæ¨¡å‹åœ¨å¤§è§„æ¨¡è¯­æ–™ä¸Šè¿›è¡Œé¢„è®­ç»ƒï¼Œå­¦åˆ°äº†å¹¿æ³›çš„è¯­è¨€çŸ¥è¯†å’ŒåŸºæœ¬ä»»åŠ¡èƒ½åŠ›ã€‚åœ¨æ–°ä»»åŠ¡ä¸Šï¼Œé€šè¿‡æä¾›å°‘é‡çš„ç¤ºä¾‹ï¼ˆè¾“å…¥-è¾“å‡ºå¯¹ï¼‰ï¼Œæ¨¡å‹å¯ä»¥ä»ä¸­æ¨æ–­å‡ºè¯¥ä»»åŠ¡çš„æ¨¡å¼å’Œè¦æ±‚ã€‚</p><p>few-shot ä¹‹æ‰€ä»¥èµ·ä½œç”¨ï¼Œæ˜¯æŠŠé—®é¢˜ä¼ªè£…æˆäº†ä¸€ä¸ªæ–‡æ¡£ä¸­ç¼ºå¤±çš„å†…å®¹ï¼Œè®©base model é€šè¿‡å®Œæˆæ–‡æ¡£çš„èƒ½åŠ›æŠŠå®ƒè¡¥å…¨ã€‚ä½†æ˜¯è¿™ä¸€è¿‡ç¨‹éå¸¸ä¸ç¨³å®šï¼Œ åœ¨å®è·µä¸­æ€»ä½“æ•ˆæœä¸€èˆ¬ã€‚<br><img src="/8cb014c5/7.png" class></p><h3 id="142-supervised-finetuning"><a href="#1-4-2-Supervised-finetuning" class="headerlink" title="1.4.2 Supervised finetuning"></a>1.4.2 Supervised finetuning</h3><p>æŒ‡åœ¨base model çš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨å¸¦æœ‰æ ‡ç­¾çš„æ•°æ®é›†å¯¹æ¨¡å‹è¿›è¡Œè¿›ä¸€æ­¥è®­ç»ƒï¼Œä»¥æé«˜å…¶åœ¨ç‰¹å®šä»»åŠ¡ä¸Šçš„è¡¨ç°ã€‚</p><h3 id="143-few-shot-vs-supervised-finetuning"><a href="#1-4-3-few-shot-vs-Supervised-finetuning" class="headerlink" title="1.4.3 few-shot  vs Supervised finetuning"></a>1.4.3 few-shot  vs Supervised finetuning</h3><ul><li><strong>Few-shot Learning</strong>ï¼š<ul><li><strong>ä¼˜ç‚¹</strong>ï¼šæ— éœ€å¤§é‡æ ‡æ³¨æ•°æ®ï¼Œé€‚åº”æ–°ä»»åŠ¡å¿«é€Ÿã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šåœ¨ä»»åŠ¡å¤æ‚æˆ–ç¤ºä¾‹è¾ƒå°‘æ—¶ï¼Œæ•ˆæœå¯èƒ½ä¸å¦‚ç›‘ç£å¾®è°ƒã€‚</li></ul></li><li><strong>ç›‘ç£å¾®è°ƒ</strong>ï¼š<ul><li><strong>ä¼˜ç‚¹</strong>ï¼šåœ¨æœ‰è¶³å¤Ÿæ ‡æ³¨æ•°æ®æ—¶ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡æ¨¡å‹æ€§èƒ½ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šéœ€è¦å¤§é‡æ ‡æ³¨æ•°æ®ï¼Œæˆæœ¬è¾ƒé«˜ã€‚</li></ul></li></ul><h1 id="2-supervised-finetuning-stage-å¾®è°ƒ"><a href="#2-Supervised-finetuning-stage-å¾®è°ƒ" class="headerlink" title="2. Supervised finetuning stage å¾®è°ƒ"></a>2. Supervised finetuning stage å¾®è°ƒ</h1><p>æŒ‡åœ¨base model çš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨å¸¦æœ‰æ ‡ç­¾çš„æ•°æ®é›†å¯¹æ¨¡å‹è¿›è¡Œè¿›ä¸€æ­¥è®­ç»ƒï¼Œä»¥æé«˜å…¶åœ¨ç‰¹å®šä»»åŠ¡ä¸Šçš„è¡¨ç°ã€‚</p><h2 id="21-dataset"><a href="#2-1-Dataset" class="headerlink" title="2.1 Dataset"></a>2.1 Dataset</h2><p>ç›¸æ¯”pre-training é¢„è®­ç»ƒé˜¶æ®µï¼ŒSupervised finetuning ç›‘ç£å¾®è°ƒé˜¶æ®µä½¿ç”¨å°‘é‡ä½†é«˜è´¨é‡çš„æ•°æ®é›†ã€‚<br>è¿™äº›æ•°æ®é›†åŒ…å«äº†æˆå¯¹çš„è¾“å…¥å’ŒæœŸæœ›è¾“å‡ºï¼Œä¾‹å¦‚é—®é¢˜ä¸ç­”æ¡ˆï¼ˆQ&amp;Aï¼‰ã€å‘½ä»¤ä¸å“åº”ã€æˆ–è€…å…¶ä»–ç›¸å…³ä»»åŠ¡çš„é…å¯¹ã€‚<br>è¿™äº›æ•°æ®é€šå¸¸é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å¾—ï¼š</p><ol><li><strong>äººå·¥æ ‡æ³¨</strong>ï¼šé›‡ä½£æ ‡æ³¨äººå‘˜æ ¹æ®é¢„è®¾çš„æŒ‡å¯¼æ–‡æ¡£ï¼ˆlabeling documentationï¼‰æ¥åˆ›å»ºæ•°æ®ã€‚æ ‡æ³¨äººå‘˜å¯èƒ½ä¼šæ ¹æ®ç»™å®šçš„æŒ‡ä»¤ç¼–å†™é—®é¢˜çš„ç­”æ¡ˆï¼Œæˆ–è€…è¯„ä¼°å’Œé€‰æ‹©æ¨¡å‹ç”Ÿæˆçš„å€™é€‰å›ç­”ã€‚</li><li><strong>ä¼—åŒ…å¹³å°</strong>ï¼šä½¿ç”¨ä¼—åŒ…æœåŠ¡ï¼ˆå¦‚Amazon Mechanical Turkï¼‰æ¥æ”¶é›†å’Œæ ‡æ³¨æ•°æ®ã€‚è¿™ç§æ–¹å¼å¯ä»¥å¿«é€Ÿä¸”æˆæœ¬ç›¸å¯¹è¾ƒä½åœ°è·å¾—å¤§é‡æ ‡æ³¨æ•°æ®</li><li><strong>åˆä½œä¼™ä¼´</strong>ï¼šä¸å­¦æœ¯æœºæ„ã€ç ”ç©¶ç»„ç»‡æˆ–å…¶ä»–å…¬å¸åˆä½œï¼Œå…±äº«æˆ–å…±åŒåˆ›å»ºæ•°æ®é›†ã€‚</li></ol><img src="/8cb014c5/8.png" class><h2 id="22-sft-model"><a href="#2-2-SFT-model" class="headerlink" title="2.2 SFT model"></a>2.2 SFT model</h2><p>SFT model å·²ç»æ˜¯ä¸€ä¸ªå¯ä»¥å›ç­”é—®é¢˜çš„assistant</p><h2 id="24-pre-training-vs-fine-tuning"><a href="#2-4-Pre-training-vs-fine-tuning" class="headerlink" title="2.4  Pre-training vs fine tuning"></a>2.4  Pre-training vs fine tuning</h2><img src="/8cb014c5/9.png" class><p>ä»¥ä¸‹æ˜¯é¢„è®­ç»ƒï¼ˆPre-trainingï¼‰å’Œå¾®è°ƒï¼ˆFine-tuningï¼‰ä¸¤ä¸ªé˜¶æ®µçš„å¯¹æ¯”è¡¨æ ¼ï¼Œä»ç›®æ ‡ã€æ•°æ®é›†ã€è¿‡ç¨‹ã€æˆæœ¬å’Œè¿­ä»£ä¸æ”¹è¿›äº”ä¸ªæ–¹é¢è¿›è¡Œæ€»ç»“ï¼š</p><div class="table-container"><table><thead><tr><th>ç‰¹å¾</th><th>é¢„è®­ç»ƒï¼ˆPre-trainingï¼‰</th><th>å¾®è°ƒï¼ˆFine-tuningï¼‰</th></tr></thead><tbody><tr><td>ç›®æ ‡</td><td>å­¦ä¹ å¹¿æ³›çš„è¯­è¨€çŸ¥è¯†å’Œäº’è”ç½‘ä¿¡æ¯ï¼Œä¸ä¸“æ³¨äºç‰¹å®šä»»åŠ¡ã€‚</td><td>è°ƒæ•´é¢„è®­ç»ƒæ¨¡å‹ä»¥é€‚åº”ç‰¹å®šä»»åŠ¡æˆ–åº”ç”¨åœºæ™¯ã€‚</td></tr><tr><td>æ•°æ®é›†</td><td>æ¥è‡ªäº’è”ç½‘çš„å¤§è§„æ¨¡ã€å¤šæ ·åŒ–æ–‡æœ¬æ•°æ®ï¼Œå¯èƒ½åŒ…å«å¤šç§è¯­è¨€å’Œä¸»é¢˜ã€‚</td><td>è¾ƒå°ä½†é«˜è´¨é‡çš„ç‰¹å®šä»»åŠ¡ç›¸å…³æ•°æ®é›†ï¼Œå¦‚é—®ç­”å¯¹ã€æ ‡æ³¨æ–‡æœ¬ç­‰ã€‚</td></tr><tr><td>è¿‡ç¨‹</td><td>é€šè¿‡é¢„æµ‹æ–‡æœ¬åºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªè¯è¿›è¡Œè®­ç»ƒï¼Œä½¿ç”¨å¤§è§„æ¨¡æ•°æ®é›†è¿›è¡Œå¹¿æ³›å­¦ä¹ ã€‚</td><td>åœ¨é¢„è®­ç»ƒæ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨ç‰¹å®šä»»åŠ¡çš„æ•°æ®é›†è¿›è¡Œé¢å¤–è®­ç»ƒã€‚</td></tr><tr><td>æˆæœ¬</td><td>é«˜ï¼Œéœ€è¦å¤§é‡è®¡ç®—èµ„æºï¼ˆå¦‚GPUé›†ç¾¤ï¼‰å’Œæ—¶é—´ï¼Œæˆæœ¬å¯èƒ½é«˜è¾¾æ•°ç™¾ä¸‡è‡³æ•°åäº¿ç¾å…ƒã€‚</td><td>ç›¸å¯¹è¾ƒä½ï¼Œä¸»è¦æ¶‰åŠæ•°æ®æ ‡æ³¨å’Œæ¨¡å‹è°ƒæ•´ï¼Œè®¡ç®—èµ„æºéœ€æ±‚è¾ƒå°ã€‚</td></tr><tr><td>è¿­ä»£å’Œæ”¹è¿›</td><td>é€šå¸¸åœ¨å¤§å‹å…¬å¸æˆ–ç ”ç©¶æœºæ„ä¸­è¿›è¡Œï¼Œå¯èƒ½æ¯å¹´æˆ–å‡ ä¸ªæœˆè¿›è¡Œä¸€æ¬¡ï¼Œå–å†³äºèµ„æºå’Œéœ€æ±‚ã€‚</td><td>å¯ä»¥é¢‘ç¹è¿›è¡Œï¼Œæ ¹æ®æ¨¡å‹è¡¨ç°å’Œç”¨æˆ·åé¦ˆä¸æ–­ä¼˜åŒ–æ¨¡å‹ã€‚</td></tr></tbody></table></div><h1 id="3-rlhf"><a href="#3-RLHF" class="headerlink" title="3. RLHF"></a>3. RLHF</h1><p>Reinforcement Learning from Human Feedback<br>æ ¹æ®äººç±»åé¦ˆè¿›è¡Œå¼ºåŒ–å­¦ä¹ <br>è¿™ä¸ªé˜¶æ®µåŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼Œ</p><ol><li>Reward Modeling</li><li>Reinforcement Learning<h2 id="3-1-reward-modeling"><a href="#3-1-Reward-Modeling" class="headerlink" title="3. 1 Reward Modeling"></a>3. 1 Reward Modeling</h2></li></ol><h3 id="311-dataset-comparisons"><a href="#3-1-1-Dataset-comparisons" class="headerlink" title="3.1.1  Dataset- comparisons"></a>3.1.1  Dataset- comparisons</h3><img src="/8cb014c5/10.png" class><ol><li>ç›¸åŒçš„prompt, SFT model  ä¼šç»™å‡ºä¸åŒç‰ˆæœ¬çš„å›ç­”ï¼Œå³å¤šä¸ªå€™é€‰ç­”æ¡ˆã€‚ç›®å‰æˆ‘ä»¬åœ¨ä½¿ç”¨</li><li>äººç±»è¯„ä¼°è€…ä¼šå¯¹è¿™äº›å€™é€‰å›ç­”è¿›è¡Œæ¯”è¾ƒæ‰“åˆ†æ’åï¼Œå¹¶é€‰æ‹©ä»–ä»¬è®¤ä¸ºæœ€åˆé€‚æˆ–æœ€å‡†ç¡®çš„å›ç­”ã€‚</li><li>æ¨¡å‹ä¼šæ ¹æ®è¿™äº›æ¯”è¾ƒç»“æœè¿›è¡Œå­¦ä¹ ï¼Œä»¥ä¾¿å¯¹å…¶ä»–é—®é¢˜çš„å¤šä¸ªå€™é€‰ç­”æ¡ˆçš„å¥½åè¿›è¡Œé¢„æµ‹</li></ol><h3 id="312-rm-training"><a href="#3-1-2-RM-Training" class="headerlink" title="3.1.2 RM Training"></a>3.1.2 RM Training</h3><img src="/8cb014c5/11.png" class><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œ æç¤ºè¯+ ç»“æœ+ äººç±»è¯„ä¼°è€…åé¦ˆä½œä¸ºå…³è”åœ¨ä¸€èµ·çš„æ•°æ®åˆè¢«æ‰“åŒ…åˆ°batchä¸­è¿›è¡Œè®­ç»ƒï¼Œ å¦‚å›¾ï¼Œå¯ä»¥ç†è§£æˆä¸€ä¸ªç›¸åŒçš„æç¤ºè¯prompt æœ‰3ä¸ªä¸åŒç‰ˆæœ¬çš„å›ç­”ï¼Œå¯¹åº”çš„3ä¸ªä¸åŒçš„reward(å¯ä»¥ç†è§£æˆæ˜¯åˆ†æ•°)ï¼Œ è®­ç»ƒåæ¨¡å‹å°±å¯ä»¥é’ˆå¯¹ä¸€ä¸ªprompt çš„å›ç­”é¢„æµ‹å‡ºä¸€ä¸ªäººç±»è¯„ä¼°è€…çš„æ‰“åˆ†ã€‚</p><p>æ‰€ä»¥è¿™ä¸ªé˜¶æ®µçš„ç›®çš„å°±æ˜¯æ„å»ºä¸€ä¸ªreward model å­¦ä¹ äººç±»æ‰“åˆ†çš„è§„å¾‹ï¼Œä»¥æ¥é¢„æµ‹ä¸€ä¸ªå›ç­”å¯èƒ½ä¼šè·å¾—çš„äººç±»è¯„åˆ†ã€‚</p><p>ç”±äºreward modelåªæ˜¯å­¦ä¹ äº†äººç±»æ‰“åˆ†çš„è§„å¾‹ï¼Œæ‰€ä»¥å¦‚æœå•ç‹¬ä½¿ç”¨Reward Model è¿›è¡Œæ‰“åˆ†å¹¶ä¸ä¼šä¿ƒè¿›æ¨¡å‹ç”Ÿæˆæ›´å¥½çš„ç­”æ¡ˆ ï¼Œ å®ƒéœ€è¦å’ŒReinforcement Learning å¼ºåŒ–å­¦ä¹ ç»“åˆä½¿ç”¨æ‰èƒ½èµ·ä½œç”¨</p><h2 id="32-reinforcement-learning"><a href="#3-2-Reinforcement-Learning" class="headerlink" title="3.2 Reinforcement Learning"></a>3.2 Reinforcement Learning</h2><p>æœ‰äº†reward model åï¼Œå°±å¯ä»¥å¯¹æ¨¡å‹çš„å›ç­”è¿›è¡Œæ‰“åˆ†ã€‚å¯¹äºåˆ†æ•°é«˜çš„å›ç­”ï¼Œè¦æé«˜å…¶å‡ºç°çš„æ¦‚ç‡ï¼Œå¦‚æ­¤ä¸æ–­è¿­ä»£ï¼Œå°½å¯èƒ½ç”Ÿæˆè·å¾—æ›´é«˜åˆ†çš„å›ç­”ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ¬æ–‡å†…å®¹åŸºäº Andrej Karpathy çš„è§†é¢‘ &lt;a href=&quot;https://www.youtube.com/watch?v=bZQun8Y4L2A&quot;&gt;State of GPT&lt;/a&gt;ï¼Œå¹¶åŠ å…¥äº†ä¸ªäººç†è§£ï¼Œè¿›è¡Œæ€»ç»“ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥éƒ¨åˆ†çš„ä¸»é¢˜æ˜¯how to tra</summary>
      
    
    
    
    
    <category term="AI" scheme="http://example.com/tags/AI/"/>
    
    <category term="chatGPT" scheme="http://example.com/tags/chatGPT/"/>
    
  </entry>
  
  <entry>
    <title>Intro to chatGPT,ä»Gã€Pã€Tçš„å«ä¹‰è§£é‡ŠchatGPT</title>
    <link href="http://example.com/60dfe914/"/>
    <id>http://example.com/60dfe914/</id>
    <published>2024-04-19T07:19:46.000Z</published>
    <updated>2024-05-17T09:14:34.174Z</updated>
    
    <content type="html"><![CDATA[<p>ChatGPTæ˜¯ç”±OpenAIå¼€å‘çš„ï¼Œä¸€ä¸ªèƒ½å¤Ÿç†è§£å’Œç”Ÿæˆè‡ªç„¶è¯­è¨€çš„äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰æ¨¡å‹ï¼Œå¯ä»¥å’Œç”¨æˆ·è¿›è¡Œäº’åŠ¨å¹¶ç”Ÿæˆç±»ä¼¼äººç±»çš„å¯¹è¯ã€‚</p><img src="/60dfe914/1.png" class><h1 id="1-chatgpt-çš„å‘å±•å†ç¨‹"><a href="#1-chatGPT-çš„å‘å±•å†ç¨‹" class="headerlink" title="1. chatGPT çš„å‘å±•å†ç¨‹"></a>1. chatGPT çš„å‘å±•å†ç¨‹</h1><p>ChatGPTæ¨¡å‹çš„å‘å±•å†ç¨‹æ˜¯ä¸€ä¸ªä¸æ–­æ¼”è¿›å’Œæ”¹è¿›çš„è¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯å…³é”®çš„æ—¶é—´èŠ‚ç‚¹å’Œå‘å±•é˜¶æ®µï¼š</p><ol><li><strong>GPT-1ï¼ˆ2018å¹´6æœˆï¼‰</strong>ï¼šOpenAIå‘å¸ƒäº†é¦–ä¸ªç”Ÿæˆé¢„è®­ç»ƒå˜æ¢å™¨æ¨¡å‹ï¼ˆGenerative Pre-trained Transformerï¼ŒGPT-1ï¼‰ã€‚è¯¥æ¨¡å‹åŸºäºTransformeræ¶æ„ï¼Œä½¿ç”¨æ— ç›‘ç£å­¦ä¹ æ–¹æ³•åœ¨å¤§è§„æ¨¡æ–‡æœ¬è¯­æ–™ä¸Šè¿›è¡Œé¢„è®­ç»ƒï¼Œç„¶ååœ¨ç‰¹å®šä»»åŠ¡ä¸Šè¿›è¡Œå¾®è°ƒï¼ˆFine-tuningï¼‰ã€‚<ul><li><strong>æ¶æ„</strong>ï¼š12å±‚Transformerè§£ç å™¨ï¼Œå‚æ•°é‡çº¦ä¸º1.17äº¿ã€‚</li><li><strong>åˆ›æ–°ç‚¹</strong>ï¼šå¼•å…¥æ— ç›‘ç£é¢„è®­ç»ƒå’Œæœ‰ç›‘ç£å¾®è°ƒç›¸ç»“åˆçš„è®­ç»ƒæ–¹æ³•ï¼Œåœ¨å¤šä¸ªNLPä»»åŠ¡ä¸Šè¡¨ç°ä¼˜å¼‚ã€‚</li></ul></li><li><strong>GPT-2ï¼ˆ2019å¹´2æœˆï¼‰</strong>ï¼šOpenAIå‘å¸ƒäº†GPT-2ï¼Œæ¨¡å‹è§„æ¨¡å’Œèƒ½åŠ›å¤§å¹…æå‡ã€‚æœ€åˆç”±äºæ‹…å¿ƒæ¨¡å‹è¢«æ»¥ç”¨ï¼ŒOpenAIä»…å‘å¸ƒäº†éƒ¨åˆ†å‚æ•°çš„æ¨¡å‹ï¼Œåäº2019å¹´11æœˆå‘å¸ƒäº†å®Œæ•´æ¨¡å‹ã€‚<ul><li><strong>æ¶æ„</strong>ï¼šæœ€å¤§ç‰ˆæœ¬æœ‰48å±‚ï¼Œå‚æ•°é‡è¾¾15äº¿ã€‚</li><li><strong>åˆ›æ–°ç‚¹</strong>ï¼šæ˜¾è‘—æé«˜äº†æ¨¡å‹çš„ç”Ÿæˆè´¨é‡å’Œè¿è´¯æ€§ï¼Œåœ¨æ–‡æœ¬ç”Ÿæˆã€ç¿»è¯‘ã€é—®ç­”ç­‰ä»»åŠ¡ä¸Šè¡¨ç°å‡ºè‰²ã€‚</li></ul></li><li><strong>GPT-3ï¼ˆ2020å¹´6æœˆï¼‰</strong>ï¼šæ˜¯å½“æ—¶æœ€å¤§å’Œæœ€å¼ºå¤§çš„è¯­è¨€æ¨¡å‹ï¼ŒåŒ…å«1750äº¿å‚æ•°ã€‚<ul><li><strong>æ¶æ„</strong>ï¼š1750äº¿å‚æ•°ï¼Œ96å±‚ï¼Œé‡‡ç”¨æ›´å¤§è§„æ¨¡çš„æ•°æ®è¿›è¡Œè®­ç»ƒã€‚</li><li><strong>åˆ›æ–°ç‚¹</strong>ï¼šé€šè¿‡è¶…å¤§è§„æ¨¡é¢„è®­ç»ƒå’Œå°‘é‡ç¤ºä¾‹ï¼ˆFew-shot Learningï¼‰ï¼Œåœ¨æ— éœ€å¾®è°ƒçš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½åœ¨å¤šä¸ªä»»åŠ¡ä¸Šå–å¾—æƒŠäººçš„æ•ˆæœã€‚</li></ul></li><li><strong>GPT-3.5ï¼ˆ2021å¹´11æœˆï¼‰</strong>ï¼š<ul><li>æ˜¯GPT-3çš„æ”¹è¿›ç‰ˆæœ¬ï¼Œæ¨¡å‹å‚æ•°è¾¾åˆ°2000äº¿ï¼Œåˆ©ç”¨äººç±»åé¦ˆè¿›è¡Œå¼ºåŒ–å­¦ä¹ ï¼Œè¿›ä¸€æ­¥æå‡æ¨¡å‹çš„äº¤äº’èƒ½åŠ›ã€‚</li><li>å¢å¼ºäº†å¤„ç†å¤æ‚å¯¹è¯å’Œå¤šè½®å¯¹è¯çš„èƒ½åŠ›ã€‚</li></ul></li><li><strong>GPT-4ï¼ˆ2023å¹´2æœˆï¼‰</strong>ï¼š<ul><li>å°šæœªå…¬å¼€å…·ä½“å‚æ•°ï¼Œä½†æ¨æµ‹è¿œè¶…GPT-3.5ï¼Œæ”¯æŒå¤šæ¨¡æ€è¾“å…¥å’Œè¾“å‡º</li><li>æä¾›äº†æ›´é«˜æ°´å¹³çš„è‡ªç„¶è¯­è¨€ç†è§£å’Œç”Ÿæˆèƒ½åŠ›ï¼Œæ”¯æŒå¤šæ¨¡æ€è¾“å…¥ä¸è¾“å‡º</li></ul></li></ol><ul><li><strong>GPT-4o(2024å¹´5æœˆ)</strong><ul><li>å·¥ç¨‹èƒ½åŠ›å¤§å¹…æå‡ï¼Œ ä½“ç°åœ¨ç›¸åº”é€Ÿåº¦æ›´å¿«ï¼Œä¸”å¼€å§‹èƒ½ç†è§£è¯­éŸ³è¯­è°ƒ</li></ul></li></ul><p>ChatGPTæ¨¡å‹çš„å‘å±•ä¸ä»…ä»…æ˜¯å‚æ•°çš„å¢åŠ ï¼Œæ›´æ˜¯ç®—æ³•ä¼˜åŒ–ã€æ•°æ®å¤šæ ·åŒ–å’Œå¯¹ç”¨æˆ·åé¦ˆçš„æŒç»­æ”¹è¿›ã€‚</p><p>ç›®å‰æˆ‘ä»¬ä½¿ç”¨çš„chatGPT åGPT-3.5ã€GPT-4ã€GPT-4o ä¸‰ä¸ªç‰ˆæœ¬å¯é€‰ã€‚</p><h1 id="2-g-p-tåˆ†åˆ«æ˜¯ä»€ä¹ˆæ„æ€"><a href="#2-Gã€Pã€Tåˆ†åˆ«æ˜¯ä»€ä¹ˆæ„æ€" class="headerlink" title="2. Gã€Pã€Tåˆ†åˆ«æ˜¯ä»€ä¹ˆæ„æ€"></a>2. Gã€Pã€Tåˆ†åˆ«æ˜¯ä»€ä¹ˆæ„æ€</h1><p>GPT æ˜¯ Generative Pre-trained Transformer çš„ç¼©å†™ã€‚ä»¥ä¸‹å†…å®¹å°†é‡ç‚¹ä»‹ç»Gã€Pã€T ä¸‰ä¸ªå­—æ¯å„è‡ªçš„å«ä¹‰ï¼Œä»¥æ­¤æ¥æ›´å¥½å¾—ç†è§£chatGPT æ˜¯ä»€ä¹ˆã€‚</p><h2 id="21-generative-ç”Ÿæˆå¼"><a href="#2-1-Generative-ç”Ÿæˆå¼" class="headerlink" title="2.1 Generative  ç”Ÿæˆå¼"></a>2.1 Generative  ç”Ÿæˆå¼</h2><p>ChatGPTæ˜¯ä¸€ä¸ªGenerative AI, å³ç”Ÿæˆå¼AIã€‚</p><p>AI ä½œä¸ºä¸€ä¸ªæ€»ç§°ï¼Œå…¶å®åŒ…å«éå¸¸å¤šå…·ä½“çš„ç±»å‹ï¼Œ ChatGPT æ‰€å±çš„Generative  AI æ˜¯å…¶ä¸­ä¸€ä¸ªå­ç±»ã€‚</p><p>æ—¥å¸¸ç”Ÿæ´»ä¸­ä¼šç”¨åˆ°çš„siriã€å°åº¦ã€å°çˆ±ã€è¯†åˆ«å›¾ç‰‡ä¸­åŠ¨ç‰©æ˜¯å°çŒ«ã€åŒ»é™¢çš„ä¸“å®¶è¯Šæ–­ç³»ç»Ÿã€å’Œä½ å›½é™…è±¡æ£‹å¯¹æˆ˜çš„æœºå™¨äººï¼Œè¿™äº›éƒ½æ˜¯AI ã€‚ ä½†æ˜¯è¿™äº›AI éƒ½æ˜¯è§„åˆ™é©±åŠ¨çš„ç³»ç»Ÿï¼Œåªèƒ½æ ¹æ®é¢„è®¾è§„åˆ™è¿›è¡Œå›ç­”ï¼Œä¸€æ—¦è¶…å‡ºé¢„è®¾èŒƒå›´ï¼Œå°±ä¼šè¡¨ç°çš„äººå·¥æ™ºéšœã€‚</p><p>chatGPTä½œä¸ºä¸€ä¸ªGenerative AI, å…¶æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯æ ¹æ®è¾“å…¥ç”Ÿæˆæ–°å†…å®¹ã€‚å®ƒä¸ä»…èƒ½å›ç­”é—®é¢˜ï¼Œè¿˜èƒ½è¿›è¡Œåˆ›æ„å†™ä½œã€æ•…äº‹ç”Ÿæˆã€è¯—æ­Œåˆ›ä½œç­‰å¤šç§ä»»åŠ¡ã€‚</p><p>Generative AI ä¹Ÿæœ‰è‡ªå·±å…·ä½“çš„åˆ†ç±»</p><ol><li>Natural language generation<br>chatGPT å°±æ˜¯ NLG, å¯ä»¥è¯´æ˜¯ç›®å‰æœ€è‘—åçš„AI åº”ç”¨</li><li>text to image<br>æ ¹æ®æ–‡å­—ç”Ÿæˆå›¾ç‰‡<ol><li>Midjourney</li><li>DALL-E</li><li>Stable Diffusion</li></ol></li><li>Generative Adversarial Networks (GANs)<br>ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼Œå…¶æ ¸å¿ƒæ˜¯ä¸¤ä¸ªç›¸äº’å¯¹æŠ—çš„ç½‘ç»œï¼šç”Ÿæˆå™¨ï¼ˆGeneratorï¼‰å’Œåˆ¤åˆ«å™¨ï¼ˆDiscriminatorï¼‰ã€‚è¿™ä¸¤ä¸ªç½‘ç»œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ç›¸äº’ç«äº‰ï¼Œä»è€Œä¸æ–­æå‡è‡ªèº«çš„æ€§èƒ½ã€‚<ol><li><strong>ç”Ÿæˆå™¨ï¼ˆGeneratorï¼‰</strong> - è¿™ä¸ªç½‘ç»œçš„ä»»åŠ¡æ˜¯æ•æ‰è®­ç»ƒæ•°æ®çš„åˆ†å¸ƒï¼Œå¹¶ç”Ÿæˆå°½å¯èƒ½æ¥è¿‘çœŸå®æ•°æ®çš„æ–°æ•°æ®ã€‚ç”Ÿæˆå™¨æ¥å—ä¸€ä¸ªéšæœºå™ªå£°å‘é‡ä½œä¸ºè¾“å…¥ï¼Œé€šè¿‡è¿™ä¸ªå™ªå£°å‘é‡æ„é€ å‡ºæ–°çš„æ•°æ®å®ä¾‹ã€‚</li><li><strong>åˆ¤åˆ«å™¨ï¼ˆDiscriminatorï¼‰</strong> - åˆ¤åˆ«å™¨çš„ä»»åŠ¡æ˜¯åŒºåˆ†è¾“å…¥ç»™å®ƒçš„æ•°æ®æ˜¯æ¥è‡ªè®­ç»ƒé›†ï¼ˆå³çœŸå®æ•°æ®ï¼‰è¿˜æ˜¯ç”Ÿæˆå™¨ç”Ÿæˆçš„å‡æ•°æ®ã€‚åŸºæœ¬ä¸Šï¼Œåˆ¤åˆ«å™¨æ˜¯ä¸€ä¸ªäºŒåˆ†ç±»æ¨¡å‹ï¼Œè¾“å‡ºä¸€ä¸ªæ ‡é‡è¡¨ç¤ºè¾“å…¥æ•°æ®æ˜¯çœŸå®æ•°æ®çš„æ¦‚ç‡ã€‚<br>è¿™ä¸¤ä¸ªæ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¿›è¡Œå¯¹æŠ—ã€‚ç”Ÿæˆå™¨è¯•å›¾äº§ç”Ÿè¶Šæ¥è¶ŠçœŸå®çš„æ•°æ®ä»¥â€œæ¬ºéª—â€åˆ¤åˆ«å™¨ï¼Œè€Œåˆ¤åˆ«å™¨åˆ™è¯•å›¾å˜å¾—æ›´å¥½åœ°åŒºåˆ†çœŸå‡æ•°æ®ã€‚é€šè¿‡è¿™ç§å¯¹æŠ—è¿‡ç¨‹ï¼Œç”Ÿæˆå™¨å­¦ä¼šç”Ÿæˆé«˜è´¨é‡çš„æ•°æ®ã€‚</li></ol></li><li>VAEs<br>å¯ç”¨äºå¼‚å¸¸æ£€æµ‹ï¼Œæ–¹æ³•æ˜¯åœ¨æ­£å¸¸æ•°æ®çš„æ•°æ®é›†ä¸Šè®­ç»ƒæ¨¡å‹ï¼Œç„¶åä½¿ç”¨ç»è¿‡è®­ç»ƒçš„æ¨¡å‹æ¥è¯†åˆ«åç¦»æ­£å¸¸æ•°æ®çš„å®ä¾‹ã€‚è¿™å¯ç”¨äºæ£€æµ‹å„ç§æƒ…å†µä¸‹çš„å¼‚å¸¸æƒ…å†µï¼Œä¾‹å¦‚å‘ç°é‡‘èäº¤æ˜“ä¸­çš„æ¬ºè¯ˆè¡Œä¸ºã€å‘ç°åˆ¶é€ ä¸­çš„ç¼ºé™·æˆ–å‘ç°ç½‘ç»œä¸­çš„å®‰å…¨æ¼æ´ã€‚ä¾‹å¦‚ï¼ŒUber åœ¨å…¶é‡‘èäº¤æ˜“ä¸­ä½¿ç”¨ VAE è¿›è¡Œå¼‚å¸¸æ£€æµ‹ï¼Œä»¥æ£€æµ‹æ¬ºè¯ˆè¡Œä¸ºã€‚</li></ol><h2 id="22-pre-trained-é¢„è®­ç»ƒ"><a href="#2-2-Pre-trained-é¢„è®­ç»ƒ" class="headerlink" title="2.2 Pre-trained é¢„è®­ç»ƒ"></a>2.2 Pre-trained é¢„è®­ç»ƒ</h2><p>é¢„è®­ç»ƒ æ˜¯chatGPTè®­ç»ƒ çš„ç¬¬ä¸€ä¸ªé˜¶æ®µã€‚</p><p>chatGPT çš„ è®­ç»ƒå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µ</p><ol><li>pre-training</li><li>supervised fine-tuning</li><li>reward modeling</li><li>reinforcement learning</li></ol><p>å…¶ä¸­pre-trainingæ˜¯ç¬¬ä¸€ä¸ªé˜¶æ®µ, åœ¨é¢„è®­ç»ƒé˜¶æ®µä½¿ç”¨çš„æ•°æ®é›†é€šå¸¸æ˜¯ä»äº’è”ç½‘ä¸Šæ”¶é›†çš„å¤§é‡æ–‡æœ¬ï¼Œè¿™äº›æ–‡æœ¬å¯èƒ½åŒ…å«å¤šç§è¯­è¨€ã€ä¸»é¢˜å’Œæ ¼å¼ã€‚</p><p>é¢„è®­ç»ƒçš„ç›®æ ‡æ˜¯è®©æ¨¡å‹åœ¨å¤§é‡çš„æ–‡æœ¬æ•°æ®ä¸Šè¿›è¡Œäº†å¹¿æ³›çš„è®­ç»ƒå­¦ä¹ äº†è¯­è¨€çš„ç»“æ„ã€è¯­æ³•ä»¥åŠå¤§é‡çš„çŸ¥è¯†ã€‚å­¦ä¹ ç»“æŸåï¼Œ é¢„è®­ç»ƒ é˜¶æ®µä¼šäº§å‡ºä¸€ä¸ªbase model, base model å¯ä»¥æ ¹æ® ç”¨æˆ·çš„è¾“å…¥ï¼Œ å»ç»­å†™æ–‡æœ¬ï¼Œ æ³¨æ„ï¼Œ è¿™ä¸ªé˜¶æ®µçš„chatGPT è¿˜ä¸èƒ½å›ç­”ä½ çš„é—®é¢˜ã€‚</p><p>é’ˆå¯¹ä»¥ä¸‹é—®é¢˜è¾“å…¥ï¼Œï¼Œæ¯”å¦‚ï¼Œ å®ƒåªèƒ½ç»™å‡ºè¿™æ ·çš„å›ç­”ã€‚<br>what is the capital of China?</p><p>base model å¹¶ä¸ä¼šå›ç­”é—®é¢˜ï¼Œç»™å‡ºâ€œbeijingâ€, è€Œæ˜¯ä¼šç»­å†™å†…å®¹ï¼Œ ç»™å‡ºä»¥ä¸‹å¯èƒ½çš„ç­”æ¡ˆ</p><p>what is Chinaâ€™s largest city?<br>what is Chinaâ€™s population?<br>what is the currency of China?</p><p>å¦‚æœæƒ³è®©æ¨¡å‹â€œç†è§£â€äººç±»çš„é—®é¢˜å¹¶è¿›è¡Œå›ç­”ï¼Œ è¿˜éœ€è¦è¿›è¡Œç¬¬äºŒé˜¶æ®µçš„è®­ç»ƒ supervised fine-tuningã€‚</p><h2 id="23-transformer"><a href="#2-3-Transformer" class="headerlink" title="2.3 Transformer"></a>2.3 Transformer</h2><p>ChatGPTçš„æ ¸å¿ƒæŠ€æœ¯æ˜¯Transformeræ¶æ„ï¼Œè¿™æ˜¯ä¸€ç§æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œæ“…é•¿å¤„ç†åºåˆ—æ•°æ®ã€‚Transformeré€šè¿‡è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆself-attention mechanismï¼‰æ¥æ•æ‰è¾“å…¥æ–‡æœ¬ä¸­çš„é‡è¦ç‰¹å¾å’Œä¸Šä¸‹æ–‡å…³ç³»ã€‚è¿™ç§æ¶æ„ä½¿å¾—æ¨¡å‹åœ¨å¤„ç†é•¿æ–‡æœ¬å’Œå¤æ‚ä¸Šä¸‹æ–‡æ—¶ï¼Œèƒ½å¤Ÿä¿æŒè¾ƒé«˜çš„å‡†ç¡®æ€§å’Œè¿è´¯æ€§ã€‚</p><p>è¦ç†è§£Transformeråœ¨ChatGPTä¸­çš„åº”ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„ç±»æ¯”æ¥è¯´æ˜ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ åœ¨è¯»ä¸€æœ¬ä¹¦ï¼Œå¹¶è¯•å›¾ç†è§£æ¯ä¸€æ®µçš„æ„æ€ã€‚ä½ çš„å¤§è„‘ä¸ä»…ä»…æ˜¯é€å­—é€å¥åœ°é˜…è¯»ï¼Œè¿˜ä¼šç»“åˆå‰åçš„å†…å®¹ï¼Œç†è§£æ•´æ®µçš„æ„ä¹‰ã€‚Transformeråœ¨ChatGPTä¸­çš„ä½œç”¨å°±åƒä½ å¤§è„‘çš„è¿™ç§ç†è§£æœºåˆ¶ã€‚</p><h1 id="3-chatgpt-ä½¿ç”¨åœºæ™¯"><a href="#3-chatGPT-ä½¿ç”¨åœºæ™¯" class="headerlink" title="3. chatGPT ä½¿ç”¨åœºæ™¯"></a>3. chatGPT ä½¿ç”¨åœºæ™¯</h1><p>å‘æŒ¥ä½ çš„æƒ³è±¡ï¼Œèƒ½ç”¨çš„å…·ä½“åœºæ™¯æ˜¯åœ¨å¤ªå¤šäº†ã€‚åé¢è¿™é‡Œä¼šé™†ç»­è¡¥å……æˆ‘ä½¿ç”¨çš„åœºæ™¯</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ChatGPTæ˜¯ç”±OpenAIå¼€å‘çš„ï¼Œä¸€ä¸ªèƒ½å¤Ÿç†è§£å’Œç”Ÿæˆè‡ªç„¶è¯­è¨€çš„äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰æ¨¡å‹ï¼Œå¯ä»¥å’Œç”¨æˆ·è¿›è¡Œäº’åŠ¨å¹¶ç”Ÿæˆç±»ä¼¼äººç±»çš„å¯¹è¯ã€‚&lt;/p&gt;
&lt;img src=&quot;/60dfe914/1.png&quot; class&gt;
&lt;h1 id=&quot;1-chatgpt-çš„å‘å±•å†ç¨‹&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    
    <category term="AI" scheme="http://example.com/tags/AI/"/>
    
    <category term="chatGPT" scheme="http://example.com/tags/chatGPT/"/>
    
  </entry>
  
  <entry>
    <title>GPTså¼€å‘-Best English Nameï¼Œä½ æ‰¾åˆ°æœ€åˆé€‚ã€æœ€æ»¡æ„çš„è‹±æ–‡å</title>
    <link href="http://example.com/209fa7d3/"/>
    <id>http://example.com/209fa7d3/</id>
    <published>2024-04-16T08:44:20.000Z</published>
    <updated>2024-05-17T09:14:34.164Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å¼€å‘äº†ä¸€ä¸ªç”¨æ¥å–è‹±æ–‡åçš„GPTs <code>Best English Name</code>ã€‚<br>ä½œä¸ºGPTs å¼€å‘è€…ï¼Œè™½ç„¶ç¦»openai ç»™æˆ‘å‘é’±è¿˜è¿œç€å‘¢ï¼Œä½†æ˜¯æ²¡å…³ç³»ï¼Œæˆ‘å¯ä»¥è‡ªå·±å…ˆç”¨GPTs å˜ç°ï¼Œè™½ç„¶å˜ç°çš„é’±è¿˜åªå¤Ÿcover ä¸€ä¸ªæœˆplus  çš„è´¹ç”¨ã€‚</p><h1 id="best-english-name-æ˜¯ä»€ä¹ˆ"><a href="#Best-English-Name-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Best English Name æ˜¯ä»€ä¹ˆ"></a>Best English Name æ˜¯ä»€ä¹ˆ</h1><img src="/209fa7d3/1.png" class><p>Best English Name æ˜¯ä¸€ä¸ªèµ·ååŠ©æ‰‹ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ æ‰¾åˆ°æ°”è´¨ç›¸ç¬¦ä¸”æ»¡è¶³å„ç§è¦æ±‚çš„è‹±æ–‡åï¼Œå¹¶ä¸”ä¼šå¯¹è‹±æ–‡åæœ‰è¯¦ç»†ä¸”æ·±å…¥çš„è§£é‡Šï¼Œè®©ä½ å……åˆ†äº†è§£è‡ªå·±çš„è‹±æ–‡åã€‚<br><img src="/209fa7d3/2.png" class><br>è¿™ä¸ªæ°”è´¨å¯ä»¥æ˜¯ä½ é€šè¿‡å›¾ç‰‡ä¸Šä¼ å‘Šè¯‰chatGPT, ä¹Ÿå¯ä»¥è‡ªå·±æè¿°ç»™chatGPT,åŒæ—¶ä½ ä¹Ÿå¯ä»¥æœ‰å…¶ä»–å®šåˆ¶åŒ–è¦æ±‚ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº</p><ol><li>å’Œä¸­æ–‡è¯»éŸ³/æ‹¼å†™ç±»ä¼¼</li><li>ç‰¹å®šé•¿åº¦</li><li>ç‰¹å®šå¼€å¤´å­—æ¯</li><li>å¥³æ€§åŒ–/ä¸­æ€§åŒ–/ç”·æ€§åŒ–</li><li>MBTI</li></ol><h1 id="æˆ‘ä¸ºä»€ä¹ˆè¦å¼€å‘best-english-name"><a href="#æˆ‘ä¸ºä»€ä¹ˆè¦å¼€å‘Best-English-Name" class="headerlink" title="æˆ‘ä¸ºä»€ä¹ˆè¦å¼€å‘Best English Name"></a>æˆ‘ä¸ºä»€ä¹ˆè¦å¼€å‘Best English Name</h1><h2 id="æˆ‘çš„ç—›ç‚¹"><a href="#æˆ‘çš„ç—›ç‚¹" class="headerlink" title="æˆ‘çš„ç—›ç‚¹"></a>æˆ‘çš„ç—›ç‚¹</h2><p>æœ¬äººåœ¨å·¥ä½œã€ç”Ÿæ´»ä¸­å‡æœ‰éœ€è¦ç”¨åˆ°è‹±æ–‡åçš„åœºæ™¯ï¼Œ è®°å¾—ç¬¬ä¸€æ¬¡éœ€è¦å–è‹±æ–‡åæ˜¯å…¥èŒæ–°å…¬å¸ï¼Œæˆ‘èŠ±äº†ä¸€ä¸‹åˆçš„æ—¶é—´åœ¨è±†ç“£ä¸Šç¿»æ‰¾æ›¾ç»çœ‹è¿‡çš„è‹±æ–‡å½±è§†å‰§ï¼Œè¯•å›¾æ‰¾åˆ°ä¸€ä¸ªå–œæ¬¢çš„è‹±æ–‡åï¼Œ ä½†æœ€åé€‰å®šçš„åå­—æ€»è®©æˆ‘è§‰å¾—â€œè¿™ä¸æ˜¯æˆ‘â€ã€‚</p><p>æˆ‘è‡ªå·±åœ¨ç¡®å®šè‹±æ–‡åçš„è¿‡ç¨‹ä¸­ï¼Œæœ‰è¿™æ ·çš„æ‹…å¿§</p><ol><li>è¿™ä¸ªåå­—å¬èµ·æ¥éå¸¸â€œä¸åƒæˆ‘â€</li><li>è¿™ä¸ªåå­—é€‚åˆå¥³ç”Ÿå—</li><li>è¿™ä¸ªåå­—åœ¨è‹±è¯­å›½å®¶å¥‡æ€ªå—ï¼Œä¼šä¸ä¼šæ ¹æœ¬å°±æ²¡äººèµ·è¿™ä¸ªåå­—</li><li>è¿™ä¸ªåå­—ä¼šä¸ä¼šå¤ªå¤§ä¼—åŒ–äº†ï¼Œä¼šä¸ä¼šæœ‰ç‚¹è¿‡æ—¶äº†</li><li>è¿™ä¸ªåå­—ä¼šä¸ä¼šæœ‰ä»€ä¹ˆä¸å¥½çš„å¯“æ„ï¼Œåˆ°æ—¶å€™å¼•èµ·ä¸å¿…è¦çš„è¯¯ä¼š</li></ol><p>åŒæ—¶æˆ‘å¯¹é‚£ä¸ªæˆ‘å°†è¦å–œæ¬¢ä¸”é€‚åˆçš„è‹±æ–‡åä¹Ÿæœ‰ä¸€å®šçš„è¦æ±‚</p><ol><li>æˆ‘å¸Œæœ›è¿™ä¸ªè‹±æ–‡åä¸­æ€§åŒ–ä¸€ç‚¹</li><li>æˆ‘å¸Œæœ›æˆ‘çš„åå­—ä»¥A å¼€å¤´</li><li>æˆ‘å¸Œæœ›è¿™ä¸ªåå­—æœ‰ç¾å¥½çš„å¯“æ„ä¸”æˆ‘èƒ½å¤Ÿäº†è§£è¿™ä¸ªç¾å¥½çš„å¯“æ„ï¼Œè¿™æ ·å½“åˆ«äººé—®æˆ‘ä¸ºä»€ä¹ˆå–è¿™ä¸ªåå­—çš„æ—¶å€™ï¼Œæˆ‘å°±å¯ä»¥æ¸…æ¥šåœ°å‘ta ä»‹ç»æˆ‘çš„åå­—</li></ol><p>å¼€å§‹ä½¿ç”¨chatGPT åï¼Œ æˆ‘å‘ç°å®ƒå¯ä»¥å¾ˆå¥½çš„æä¾›ä¸€äº›æ»¡è¶³æˆ‘è¦æ±‚çš„è‹±æ–‡åï¼ŒåŒæ—¶è§„é¿æ‰æˆ‘çš„æ‹…å¿§ã€‚</p><h2 id="ç—›ç‚¹çš„å¤§ä¼—åŒ–"><a href="#ç—›ç‚¹çš„å¤§ä¼—åŒ–" class="headerlink" title="ç—›ç‚¹çš„å¤§ä¼—åŒ–"></a>ç—›ç‚¹çš„å¤§ä¼—åŒ–</h2><p>åœ¨å°çº¢ä¹¦é—²é€›æ—¶ï¼Œæˆ‘å‘ç°æœ‰å¾ˆå¤šäººéƒ½åœ¨ä¸ºé€‰æ‹©ä¸€ä¸ªè‹±æ–‡åå›°æ‰°ï¼Œ ta ä»¬é€šå¸¸ä¼šå‘å‡ºä¸€å¼ ç…§ç‰‡è®©ç½‘å‹æ ¹æ®ç¬¬ä¸€çœ¼å°è±¡å¸®å¿™èµ·åï¼Œæœ‰æ—¶å€™ä¼šæœ‰ä¸€äº›é¢å¤–çš„éœ€æ±‚ã€‚</p><p>åŒæ—¶æˆ‘è¿˜å‘ç°æœ‰å¾ˆå¤šäººç»å¸¸å‘ç½‘å‹è¯¢é—®è‡ªå·±çš„è‹±æ–‡åæ˜¯ä»€ä¹ˆæ„æ€ã€‚</p><p>æˆ‘è®¤ä¸ºè¿™ä¸¤ç§æƒ…å†µå’Œæˆ‘èµ·åå­—æ—¶é‡åˆ°çš„é—®é¢˜æ˜¯ä¸€æ ·çš„ï¼ŒchatGPT èƒ½å¸®åŠ©æˆ‘æ‰¾åˆ°æ»¡æ„çš„è‹±æ–‡åï¼Œé‚£ä¹ˆå®ƒä¹Ÿå¯ä»¥å¸®åŠ©å…¶ä»–äººæ‰¾åˆ°æ»¡æ„çš„è‹±æ–‡åï¼Œ æ‰€ä»¥æˆ‘æŠŠè‡ªå·±å–è‹±æ–‡çš„è¿‡ç¨‹åšæˆäº†ä¸€ä¸ªå¯å¤ç”¨çš„GPTs, å¸Œæœ›å¯ä»¥å¸®åŠ©æ›´å¤šäººæ‰¾åˆ°æ»¡æ„é€‚åˆçš„è‹±æ–‡å</p><h1 id="gpts-çš„å·¥ç¨‹å¼€å‘"><a href="#GPTs-çš„å·¥ç¨‹å¼€å‘" class="headerlink" title="GPTs çš„å·¥ç¨‹å¼€å‘"></a>GPTs çš„å·¥ç¨‹å¼€å‘</h1><h2 id="ä¸€ä¸ªä¸æ‡’çš„gpts"><a href="#ä¸€ä¸ªä¸æ‡’çš„GPTs" class="headerlink" title="ä¸€ä¸ªä¸æ‡’çš„GPTs"></a>ä¸€ä¸ªä¸æ‡’çš„GPTs</h2><p>å›ç­”è¯¦ç»†æ·±å…¥ã€‚</p><h2 id="ä¸€ä¸ªæŠ—æ”»å‡»çš„gpts"><a href="#ä¸€ä¸ªæŠ—æ”»å‡»çš„GPTs" class="headerlink" title="ä¸€ä¸ªæŠ—æ”»å‡»çš„GPTs"></a>ä¸€ä¸ªæŠ—æ”»å‡»çš„GPTs</h2><p>ä¸ä¼šæ³„æ¼è¯¥GPTs çš„instruction</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ€è¿‘å¼€å‘äº†ä¸€ä¸ªç”¨æ¥å–è‹±æ–‡åçš„GPTs &lt;code&gt;Best English Name&lt;/code&gt;ã€‚&lt;br&gt;ä½œä¸ºGPTs å¼€å‘è€…ï¼Œè™½ç„¶ç¦»openai ç»™æˆ‘å‘é’±è¿˜è¿œç€å‘¢ï¼Œä½†æ˜¯æ²¡å…³ç³»ï¼Œæˆ‘å¯ä»¥è‡ªå·±å…ˆç”¨GPTs å˜ç°ï¼Œè™½ç„¶å˜ç°çš„é’±è¿˜åªå¤Ÿcover ä¸€ä¸ªæœˆplus  çš„è´¹ç”¨ã€‚&lt;/p&gt;</summary>
      
    
    
    
    
    <category term="AI" scheme="http://example.com/tags/AI/"/>
    
    <category term="chatGPT" scheme="http://example.com/tags/chatGPT/"/>
    
  </entry>
  
  <entry>
    <title>Intro to AI</title>
    <link href="http://example.com/81fcff81/"/>
    <id>http://example.com/81fcff81/</id>
    <published>2024-04-16T07:13:57.000Z</published>
    <updated>2024-05-17T09:14:34.171Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å­¦ä¹ AI è¿‡ç¨‹ä¸­ï¼Œå‘ç°ä¸“ä¸šåè¯ç›¸å½“å¤šï¼Œåˆå­¦è€…å¯èƒ½ä¼šæ„Ÿåˆ°è€Œæ··ä¹±ï¼Œæ‰€ä»¥æœ¬ç¯‡å†…å®¹æ˜¯å¯¹è¯¥é¢†åŸŸå†…çš„ä¸€äº›â€œå¤§è¯â€è¿›è¡Œç®€å•ä»‹ç»ï¼Œ åšä¸€äº›æ¦‚å¿µæ‰«ç›²ï¼Œ ä»¥ä¿è¯åœ¨æ¥ä¸‹æ¥çš„å­¦ä¹ ä¸­å¿ƒä¸­æœ‰æ¡†æ¶ã€‚ æ­£å¼å†…å®¹ä¼šæŒ‰ç…§ä¸‹å›¾æ¡†æ¶ä»‹ç»</p><img src="/81fcff81/1.png" class><h2 id="1-äººå·¥æ™ºèƒ½-artificial-intelligence"><a href="#1-äººå·¥æ™ºèƒ½-Artificial-Intelligence" class="headerlink" title="1. äººå·¥æ™ºèƒ½ (Artificial Intelligence)"></a>1. äººå·¥æ™ºèƒ½ (Artificial Intelligence)</h2><p>äººå·¥æ™ºèƒ½ï¼ˆArtificial Intelligenceï¼Œç®€ç§°AIï¼‰æ˜¯ä¸€é—¨ç ”ç©¶å’Œå¼€å‘ç”¨äºæ¨¡æ‹Ÿã€æ‰©å±•å’Œæ‰©å±•äººç±»æ™ºèƒ½çš„ç†è®ºã€æ–¹æ³•ã€æŠ€æœ¯åŠåº”ç”¨ç³»ç»Ÿçš„ç§‘å­¦æŠ€æœ¯ã€‚</p><p>ç®€å•æ¥è¯´ï¼ŒAIæŒ‡çš„æ˜¯ä½¿è®¡ç®—æœºç³»ç»Ÿèƒ½å¤Ÿæ‰§è¡Œé€šå¸¸éœ€è¦äººç±»æ™ºèƒ½æ‰èƒ½å®Œæˆçš„ä»»åŠ¡ã€‚è¿™äº›ä»»åŠ¡åŒ…æ‹¬å­¦ä¹ ã€æ¨ç†ã€è§£å†³é—®é¢˜ã€æ„ŸçŸ¥ã€è¯­è¨€ç†è§£å’Œç”Ÿæˆç­‰ã€‚</p><p>äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰çš„å‘å±•å†å²å¯ä»¥è¿½æº¯åˆ°20ä¸–çºªä¸­æœŸï¼Œå®ƒçš„å‘å±•ç»å†äº†å¤šä¸ªé‡è¦é˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰å…¶ç‹¬ç‰¹çš„ç‰¹ç‚¹å’Œé‡Œç¨‹ç¢‘äº‹ä»¶ã€‚ä¸‹é¢æ¥ç®€å•ä»‹ç»å…¶å‘å±•å†ç¨‹</p><h3 id="11-æ—©æœŸé˜¶æ®µåŸºç¡€ç†è®ºå’Œåˆæ­¥æ¢ç´¢1950s-1960s"><a href="#1-1-æ—©æœŸé˜¶æ®µï¼šåŸºç¡€ç†è®ºå’Œåˆæ­¥æ¢ç´¢ï¼ˆ1950s-1960sï¼‰" class="headerlink" title="1.1 æ—©æœŸé˜¶æ®µï¼šåŸºç¡€ç†è®ºå’Œåˆæ­¥æ¢ç´¢ï¼ˆ1950s-1960sï¼‰"></a>1.1 æ—©æœŸé˜¶æ®µï¼šåŸºç¡€ç†è®ºå’Œåˆæ­¥æ¢ç´¢ï¼ˆ1950s-1960sï¼‰</h3><p><strong>1956å¹´è¾¾ç‰¹èŒ…æ–¯ä¼šè®®</strong>ï¼šAIæ­£å¼è¯ç”Ÿã€‚1956 å¹´ï¼ŒJohn McCarthyã€Marvin Minskyã€Allen Newell å’Œ Herbert A. Simon ç­‰ç ”ç©¶è€…åœ¨è¾¾ç‰¹èŒ…æ–¯ä¼šè®®ä¸Šé¦–æ¬¡æå‡ºäº†â€œäººå·¥æ™ºèƒ½â€è¿™ä¸€æœ¯è¯­ï¼Œæ ‡å¿—ç€AIç ”ç©¶æ­£å¼æˆä¸ºä¸€ä¸ªç‹¬ç«‹çš„å­¦ç§‘ã€‚</p><p><strong>1950å¹´ä»£æœ«</strong>ï¼šè‰¾ä¼¦Â·å›¾çµæå‡ºäº†â€œå›¾çµæµ‹è¯•â€ï¼Œæˆä¸ºåˆ¤æ–­æœºå™¨æ˜¯å¦å…·å¤‡æ™ºèƒ½çš„åŸºå‡†ã€‚</p><p>è¿™ä¸€æ—¶æœŸï¼Œç”±äºæŠ€æœ¯å’Œç¡¬ä»¶çš„é™åˆ¶ï¼Œæ—©æœŸçš„AIç³»ç»Ÿä¸»è¦å…³æ³¨äºç®€å•ä»»åŠ¡çš„è‡ªåŠ¨åŒ–ï¼Œå¦‚è±¡æ£‹å’Œè·³æ£‹æ¸¸æˆã€‚ä¾‹å¦‚ï¼ŒIBM çš„ Deep Blue å’Œ MIT AI Lab çš„ MacHack VI ç­‰ç³»ç»Ÿåœ¨è±¡æ£‹æ¸¸æˆä¸­å–å¾—äº†æ˜¾è‘—çš„æˆå°±ã€‚è¿™äº›ç³»ç»Ÿè™½ç„¶åœ¨å¤„ç†å¤æ‚æ¨¡å¼æ–¹é¢å—é™ï¼Œä½†å®ƒä»¬çš„æˆåŠŸå±•ç¤ºäº†AIåœ¨è§„åˆ™æ¸…æ™°ã€é™å®šç¯å¢ƒä¸­çš„æ½œåŠ›ã€‚</p><h3 id="12-ä¸“å®¶ç³»ç»Ÿä¸æœºå™¨å­¦ä¹ 1970s-1990s"><a href="#1-2-ä¸“å®¶ç³»ç»Ÿä¸æœºå™¨å­¦ä¹ ï¼ˆ1970s-1990sï¼‰" class="headerlink" title="1.2 ä¸“å®¶ç³»ç»Ÿä¸æœºå™¨å­¦ä¹ ï¼ˆ1970s-1990sï¼‰"></a>1.2 ä¸“å®¶ç³»ç»Ÿä¸æœºå™¨å­¦ä¹ ï¼ˆ1970s-1990sï¼‰</h3><p><strong>1970å¹´ä»£</strong>ï¼šä¸“å®¶ç³»ç»Ÿï¼ˆExpert Systemsï¼‰å¼€å§‹å…´èµ·ï¼Œå¦‚MYCINç”¨äºåŒ»ç–—è¯Šæ–­ï¼ŒDENDRALç”¨äºåŒ–å­¦åˆ†æã€‚è¿™äº›ç³»ç»Ÿèƒ½å¤Ÿå‚¨å­˜ã€è§£é‡Šå’Œæ¨ç†çŸ¥è¯†,å¯ä»¥ç”¨æ¥è§£å†³ç‰¹å®šé¢†åŸŸçš„é—®é¢˜ã€‚</p><p><strong>1980s</strong>ï¼šåå‘ä¼ æ’­ç®—æ³•ï¼ˆBackpropagationï¼‰çš„æå‡ºä½¿ç¥ç»ç½‘ç»œé‡æ–°å—åˆ°å…³æ³¨ã€‚å°½ç®¡è®¡ç®—èƒ½åŠ›ä»æœ‰é™ï¼Œä½†ç†è®ºå’Œæ–¹æ³•ä¸Šçš„çªç ´ä¸ºæœªæ¥çš„å‘å±•å¥ å®šäº†åŸºç¡€ã€‚</p><p><strong>1990s</strong>: éšç€æ›´å¤šçš„æ•°æ®å¯ç”¨å’Œè®¡ç®—èƒ½åŠ›çš„å¢åŠ ï¼Œæœºå™¨å­¦ä¹ æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯åŸºäºç»Ÿè®¡çš„æ–¹æ³•å¼€å§‹ä¸»å¯¼AIç ”ç©¶ã€‚æ”¯æŒå‘é‡æœºå’Œéšæœºæ£®æ—ç­‰æŠ€æœ¯çš„å‘å±•ï¼Œä¸ºAIåœ¨å›¾åƒè¯†åˆ«ã€è‡ªç„¶è¯­è¨€å¤„ç†å’Œå…¶ä»–å¤æ‚æ¨¡å¼è¯†åˆ«ä»»åŠ¡ä¸­çš„åº”ç”¨æ‰“å¼€äº†æ–°çš„å¯èƒ½æ€§ã€‚</p><h3 id="13-ç°ä»£aiå¤§æ•°æ®ä¸æ·±åº¦å­¦ä¹ æ—¶ä»£2000s-è‡³ä»Š"><a href="#1-3-ç°ä»£AIï¼šå¤§æ•°æ®ä¸æ·±åº¦å­¦ä¹ æ—¶ä»£ï¼ˆ2000s-è‡³ä»Šï¼‰" class="headerlink" title="1.3 ç°ä»£AIï¼šå¤§æ•°æ®ä¸æ·±åº¦å­¦ä¹ æ—¶ä»£ï¼ˆ2000s-è‡³ä»Šï¼‰"></a>1.3 ç°ä»£AIï¼šå¤§æ•°æ®ä¸æ·±åº¦å­¦ä¹ æ—¶ä»£ï¼ˆ2000s-è‡³ä»Šï¼‰</h3><ol><li><strong>è®¡ç®—èƒ½åŠ›å’Œæ•°æ®çš„æå‡</strong>ï¼š<ul><li><strong>2000s</strong>ï¼šäº’è”ç½‘å’Œå¤§æ•°æ®çš„å‘å±•ï¼Œä¸ºAIæä¾›äº†å¤§é‡è®­ç»ƒæ•°æ®ã€‚è®¡ç®—èƒ½åŠ›çš„æå‡ï¼Œç‰¹åˆ«æ˜¯GPUçš„ä½¿ç”¨ï¼Œä½¿å¾—å¤æ‚çš„æ¨¡å‹è®­ç»ƒæˆä¸ºå¯èƒ½ã€‚</li></ul></li><li><strong>æ·±åº¦å­¦ä¹ çš„å´›èµ·</strong>ï¼š<ul><li><strong>2010s</strong>ï¼šæ·±åº¦å­¦ä¹ ï¼ˆDeep Learningï¼‰åœ¨å›¾åƒè¯†åˆ«ã€è¯­éŸ³è¯†åˆ«ã€è‡ªç„¶è¯­è¨€å¤„ç†ç­‰é¢†åŸŸå–å¾—çªç ´ã€‚AlexNetåœ¨2012å¹´ImageNetç«èµ›ä¸­çš„æˆåŠŸï¼Œæ ‡å¿—ç€æ·±åº¦å­¦ä¹ çš„é‡å¤§èƒœåˆ©ã€‚</li></ul></li><li><strong>å¹¿æ³›åº”ç”¨</strong>ï¼š<ul><li><strong>2010s-è‡³ä»Š</strong>ï¼šAIåœ¨è‡ªåŠ¨é©¾é©¶ã€åŒ»ç–—è¯Šæ–­ã€é‡‘èåˆ†æã€æ™ºèƒ½å®¢æœç­‰é¢†åŸŸå¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚2016å¹´ï¼ŒAlphaGoå‡»è´¥å›´æ£‹å† å†›æä¸–çŸ³ï¼Œå±•ç¤ºäº†AIåœ¨å¤æ‚åšå¼ˆä¸­çš„å¼ºå¤§èƒ½åŠ›ã€‚</li><li><strong>è‡ªç„¶è¯­è¨€å¤„ç†</strong>ï¼šGPT-3ç­‰å¤§å‹è¯­è¨€æ¨¡å‹çš„æ¨å‡ºï¼Œä½¿å¾—AIèƒ½å¤Ÿç”Ÿæˆé€¼çœŸçš„è‡ªç„¶è¯­è¨€æ–‡æœ¬ï¼Œåº”ç”¨äºç¿»è¯‘ã€å¯¹è¯ç³»ç»Ÿã€å†…å®¹åˆ›ä½œç­‰å¤šä¸ªé¢†åŸŸã€‚</li></ul></li></ol><h2 id="2-æœºå™¨å­¦ä¹ -ä¸-æ·±åº¦å­¦ä¹ "><a href="#2-æœºå™¨å­¦ä¹ -ä¸-æ·±åº¦å­¦ä¹ " class="headerlink" title="2. æœºå™¨å­¦ä¹  ä¸ æ·±åº¦å­¦ä¹ "></a>2. æœºå™¨å­¦ä¹  ä¸ æ·±åº¦å­¦ä¹ </h2><p>æœºå™¨å­¦ä¹ ï¼ˆMachine Learningï¼‰å’Œæ·±åº¦å­¦ä¹ ï¼ˆDeep Learningï¼‰æ˜¯ç°ä»£äººå·¥æ™ºèƒ½ï¼ˆArtificial Intelligenceï¼‰é¢†åŸŸçš„æ ¸å¿ƒæŠ€æœ¯ã€‚å®ƒä»¬çš„å‘å±•æå¤§åœ°æ¨åŠ¨äº†ä»å›¾åƒè¯†åˆ«åˆ°è‡ªç„¶è¯­è¨€å¤„ç†çš„å„ç§åº”ç”¨ã€‚</p><h3 id="21-æœºå™¨å­¦ä¹ machine-learning"><a href="#2-1-æœºå™¨å­¦ä¹ ï¼ˆMachine-Learningï¼‰" class="headerlink" title="2.1 æœºå™¨å­¦ä¹ ï¼ˆMachine Learningï¼‰"></a>2.1 æœºå™¨å­¦ä¹ ï¼ˆMachine Learningï¼‰</h3><p>æœºå™¨å­¦ä¹ æ˜¯ä¸€ç§ä½¿è®¡ç®—æœºèƒ½å¤Ÿé€šè¿‡ç»éªŒè‡ªåŠ¨æ”¹è¿›çš„æŠ€æœ¯ã€‚å®ƒä¾èµ–äºç®—æ³•å’Œç»Ÿè®¡æ¨¡å‹ï¼Œä½¿å¾—è®¡ç®—æœºç³»ç»Ÿå¯ä»¥è¯†åˆ«æ•°æ®ä¸­çš„æ¨¡å¼å¹¶åšå‡ºå†³ç­–ï¼Œæ— éœ€æ˜ç¡®ç¼–ç¨‹ã€‚</p><p><strong>ä¸»è¦ç±»åˆ«</strong>ï¼š</p><ol><li><strong>ç›‘ç£å­¦ä¹ ï¼ˆSupervised Learningï¼‰</strong>ï¼šæ¨¡å‹åœ¨å¸¦æœ‰æ ‡ç­¾çš„æ•°æ®é›†ä¸Šè¿›è¡Œè®­ç»ƒï¼Œå­¦ä¹ è¾“å…¥ä¸è¾“å‡ºä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚åº”ç”¨åŒ…æ‹¬åˆ†ç±»ï¼ˆClassificationï¼‰å’Œå›å½’ï¼ˆRegressionï¼‰ã€‚</li><li><strong>æ— ç›‘ç£å­¦ä¹ ï¼ˆUnsupervised Learningï¼‰</strong>ï¼šæ¨¡å‹åœ¨æ²¡æœ‰æ ‡ç­¾çš„æ•°æ®é›†ä¸Šå·¥ä½œï¼Œç›®æ ‡æ˜¯å‘ç°æ•°æ®çš„å†…åœ¨ç»“æ„ã€‚å¸¸è§çš„ä»»åŠ¡æœ‰èšç±»ï¼ˆClusteringï¼‰å’Œé™ç»´ï¼ˆDimensionality Reductionï¼‰ã€‚</li><li><strong>åŠç›‘ç£å­¦ä¹ ï¼ˆSemi-supervised Learningï¼‰</strong>ï¼šä½¿ç”¨éƒ¨åˆ†æ ‡è®°çš„æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œç»“åˆç›‘ç£å­¦ä¹ å’Œæ— ç›‘ç£å­¦ä¹ çš„ç‰¹ç‚¹ã€‚</li><li><strong>å¼ºåŒ–å­¦ä¹ ï¼ˆReinforcement Learningï¼‰</strong>ï¼šæ¨¡å‹é€šè¿‡ä¸ç¯å¢ƒçš„äº¤äº’å­¦ä¹ ç­–ç•¥ï¼Œç›®æ ‡æ˜¯æœ€å¤§åŒ–æŸç§æ•°å€¼å¥–åŠ±ï¼ˆRewardï¼‰ã€‚</li></ol><h3 id="22-æ·±åº¦å­¦ä¹ deep-learning"><a href="#2-2-æ·±åº¦å­¦ä¹ ï¼ˆDeep-Learningï¼‰" class="headerlink" title="2.2 æ·±åº¦å­¦ä¹ ï¼ˆDeep Learningï¼‰"></a>2.2 æ·±åº¦å­¦ä¹ ï¼ˆDeep Learningï¼‰</h3><p>æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ ä¸­çš„ä¸€ä¸ªå­é›†ï¼Œå®ƒä½¿ç”¨ç§°ä¸ºäººå·¥ç¥ç»ç½‘ç»œï¼ˆArtificial Neural Networksï¼‰çš„æ¨¡å‹ï¼Œç‰¹åˆ«æ˜¯å…·æœ‰å¤šä¸ªå±‚ï¼ˆLayersï¼‰çš„æ·±å±‚ç½‘ç»œï¼Œä»¥å­¦ä¹ æ•°æ®çš„é«˜çº§æŠ½è±¡ç‰¹å¾ã€‚</p><p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š</p><ul><li><strong>ç¥ç»ç½‘ç»œï¼ˆNeural Networksï¼‰</strong>ï¼šä¸€ä¸ªç”±èŠ‚ç‚¹ï¼ˆæˆ–ç§°ä¸ºç¥ç»å…ƒï¼ŒNeuronsï¼‰ç»„æˆçš„ç½‘ç»œï¼ŒèŠ‚ç‚¹åœ¨å±‚ä¸­ç»„ç»‡å¹¶é€šè¿‡æ¿€æ´»å‡½æ•°ï¼ˆActivation Functionsï¼‰å¤„ç†ä¿¡æ¯ã€‚</li><li><strong>å·ç§¯ç¥ç»ç½‘ç»œï¼ˆConvolutional Neural Networks, CNNsï¼‰</strong>ï¼šç‰¹åˆ«é€‚åˆå¤„ç†å›¾åƒæ•°æ®ã€‚</li><li><strong>å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural Networks, RNNsï¼‰</strong>ï¼šä¼˜ç§€çš„å¤„ç†åºåˆ—æ•°æ®å¦‚æ—¶é—´åºåˆ—æˆ–è‡ªç„¶è¯­è¨€çš„å·¥å…·ã€‚</li><li><strong>é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLong Short-Term Memory, LSTMï¼‰</strong>å’Œ<strong>é—¨æ§å¾ªç¯å•å…ƒï¼ˆGated Recurrent Units, GRUï¼‰</strong>ï¼šæ˜¯RNNçš„å˜ä½“ï¼Œè§£å†³äº†ä¼ ç»ŸRNNé•¿æœŸä¾èµ–é—®é¢˜ã€‚</li><li><strong>Transformer</strong>ï¼šä¸€ç§åŸºäºè‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆSelf-attention Mechanismï¼‰çš„æ¶æ„ï¼Œå¹¿æ³›ç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸã€‚</li></ul><h3 id="23-åŒºåˆ«ä¸è”ç³»"><a href="#2-3-åŒºåˆ«ä¸è”ç³»" class="headerlink" title="2.3  åŒºåˆ«ä¸è”ç³»"></a>2.3  åŒºåˆ«ä¸è”ç³»</h3><p><strong>è”ç³»</strong>ï¼š</p><ul><li>æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œåˆ©ç”¨å¤æ‚çš„ç¥ç»ç½‘ç»œç»“æ„æ¥è§£å†³å¹¿æ³›çš„é—®é¢˜ã€‚</li><li>ä¸¤è€…éƒ½ä¾èµ–æ•°æ®æ¥å­¦ä¹ ï¼Œå¹¶é€šè¿‡è¿­ä»£è¿‡ç¨‹æ”¹è¿›æ¨¡å‹æ€§èƒ½ã€‚</li></ul><p><strong>åŒºåˆ«</strong>ï¼š</p><ul><li>æœºå™¨å­¦ä¹ åŒ…æ‹¬ä¸€ç³»åˆ—ä¸ä»…é™äºç¥ç»ç½‘ç»œçš„æŠ€æœ¯å’Œæ–¹æ³•ã€‚</li><li>æ·±åº¦å­¦ä¹ é€šå¸¸éœ€è¦æ›´å¤§é‡çš„æ•°æ®å’Œæ›´å¼ºçš„è®¡ç®—èƒ½åŠ›ã€‚</li></ul><h2 id="3-ç¥ç»ç½‘ç»œ-neural-networks"><a href="#3-ç¥ç»ç½‘ç»œ-Neural-Networks" class="headerlink" title="3. ç¥ç»ç½‘ç»œ (Neural Networks)"></a>3. ç¥ç»ç½‘ç»œ (Neural Networks)</h2><p>ç¥ç»ç½‘ç»œæ˜¯å®ç°AI çš„ä¸€ç§æŠ€æœ¯æ‰‹æ®µï¼Œä¸€ç§å¹¿æ³›ç”¨äºæœºå™¨å­¦ä¹ ï¼ˆMachine Learningï¼‰å’Œæ·±åº¦å­¦ä¹ ï¼ˆDeep Learningï¼‰é¢†åŸŸçš„è®¡ç®—æ¨¡å‹/ç®—æ³•æ¶æ„ã€‚</p><p>å®ƒå—åˆ°äººç±»å¤§è„‘ç¥ç»å…ƒï¼ˆNeuronsï¼‰å’Œå®ƒä»¬çš„äº’åŠ¨æ–¹å¼çš„å¯å‘ï¼Œå®ƒç”±å¤šä¸ªå±‚ï¼ˆLayersï¼‰ç»„æˆï¼Œæ¯å±‚åŒ…å«å¤šä¸ªç¥ç»å…ƒï¼Œè¿™äº›ç¥ç»å…ƒé€šè¿‡æƒé‡ï¼ˆWeightsï¼‰è¿æ¥ä¼ é€’ä¿¡æ¯ã€‚</p><p>ç¥ç»ç½‘ç»œçš„è®­ç»ƒè¿‡ç¨‹åŸºäºæœºå™¨å­¦ä¹ çš„åŸºæœ¬å‰æï¼Œå³èƒ½å¤Ÿä»æ•°æ®ä¸­å­¦ä¹ ã€‚é€šè¿‡å‘ç½‘ç»œæä¾›å¤§é‡çš„æ•°æ®æ ·æœ¬ï¼ˆåŒ…æ‹¬è¾“å…¥å’ŒæœŸæœ›çš„è¾“å‡ºï¼‰ï¼Œç¥ç»ç½‘ç»œå¯ä»¥å­¦ä¹ åˆ°å¦‚ä½•æ˜ å°„è¾“å…¥åˆ°è¾“å‡ºï¼Œè¿™ç§èƒ½åŠ›æ˜¯é€šè¿‡è°ƒæ•´å†…éƒ¨ç»“æ„ï¼ˆå³æƒé‡ï¼‰æ¥å®ç°çš„ã€‚</p><p>è¿™ä¸€å­¦ä¹ è¿‡ç¨‹ä½¿ç”¨äº†æœºå™¨å­¦ä¹ ä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå¦‚æŸå¤±å‡½æ•°ï¼ˆLoss Functionsï¼‰ã€æ¢¯åº¦ä¸‹é™ï¼ˆGradient Descentï¼‰å’Œåå‘ä¼ æ’­ç®—æ³•ï¼ˆBackpropagation Algorithmsï¼‰ã€‚è¿™äº›éƒ½æ˜¯æœºå™¨å­¦ä¹ é¢†åŸŸçš„åŸºæœ¬å·¥å…·ï¼Œç”¨äºè®­ç»ƒæ¨¡å‹ä»¥æ”¹è¿›å…¶æ€§èƒ½ã€‚</p><h2 id="4-transformer"><a href="#4-Transformer" class="headerlink" title="4. Transformer"></a>4. Transformer</h2><p>Transformerï¼ˆå˜æ¢å™¨ï¼‰æ˜¯ä¸€ç§é©å‘½æ€§çš„ç¥ç»ç½‘ç»œæ¶æ„ï¼Œå®ƒåœ¨è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNatural Language Processing, NLPï¼‰å’Œå…¶ä»–åºåˆ—å»ºæ¨¡ä»»åŠ¡ä¸­å–å¾—äº†æ˜¾è‘—çš„æˆå°±ã€‚Transformer æœ€åˆç”± Vaswani ç­‰äººåœ¨ 2017 å¹´çš„è®ºæ–‡ â€œAttention Is All You Needâ€ ä¸­æå‡ºï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å®Œå…¨ä¾é æ³¨æ„åŠ›æœºåˆ¶ï¼ˆattention mechanismsï¼‰ï¼Œæ‘’å¼ƒäº†ä¹‹å‰å¸¸ç”¨çš„å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural Networks, RNNsï¼‰å’Œå·ç§¯ç¥ç»ç½‘ç»œï¼ˆConvolutional Neural Networks, CNNsï¼‰ä¸­çš„ç»“æ„ã€‚</p><h2 id="5-nlp"><a href="#5-NLP" class="headerlink" title="5. NLP"></a>5. NLP</h2><p>è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNatural Language Processingï¼Œç®€ç§°NLPï¼‰æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œè‡´åŠ›äºè®©è®¡ç®—æœºç†è§£ã€è§£é‡Šå’Œç”Ÿæˆäººç±»è¯­è¨€ã€‚å®ƒç»“åˆäº†è®¡ç®—æœºç§‘å­¦ã€äººå·¥æ™ºèƒ½å’Œè¯­è¨€å­¦çš„çŸ¥è¯†ä¸æŠ€æœ¯ï¼Œç”¨äºå¤„ç†å’Œåˆ†æå¤§é‡çš„è‡ªç„¶è¯­è¨€æ•°æ®ã€‚</p><p>NLPä½¿ç”¨å„ç§æŠ€æœ¯æ¥å¤„ç†å’Œç†è§£è¯­è¨€ã€‚è¿™äº›æ–¹æ³•ä»è§„åˆ™åŸºç¡€çš„æ–¹æ³•åˆ°åŸºäºæœºå™¨å­¦ä¹ çš„æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯æ·±åº¦å­¦ä¹ ï¼Œéƒ½æœ‰æ¶µç›–ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ·±åº¦å­¦ä¹ åœ¨NLPä¸­å˜å¾—è¶Šæ¥è¶Šé‡è¦ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿåœ¨å¤„ç†è‡ªç„¶è¯­è¨€çš„å¤æ‚æ€§æ–¹é¢æä¾›æ˜¾è‘—çš„æ”¹è¿›ã€‚</p><p><strong>ä¼ ç»Ÿæ–¹æ³•ï¼š</strong></p><ul><li><strong>åŸºäºè§„åˆ™çš„ç³»ç»Ÿ</strong>ï¼šä½¿ç”¨é¢„å®šä¹‰çš„è¯­è¨€è§„åˆ™æ¥è§£é‡Šæ–‡æœ¬ã€‚</li><li><strong>ç»Ÿè®¡æ¨¡å‹</strong>ï¼šåŸºäºå¤§é‡è¯­æ–™åº“æ•°æ®ï¼Œä½¿ç”¨ç»Ÿè®¡æ–¹æ³•æ¨æ–­å’Œé¢„æµ‹ã€‚</li></ul><p><strong>ç°ä»£æ–¹æ³•</strong></p><ul><li><strong>ç¥ç»ç½‘ç»œ</strong>ï¼šä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œæ¨¡å‹å¤„ç†è¯­è¨€ä»»åŠ¡ï¼Œå¦‚å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ã€é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼‰å’Œæœ€è¿‘çš„å˜æ¢å™¨æ¨¡å‹ï¼ˆå¦‚BERTã€GPTï¼‰ã€‚</li></ul><p>NLPæŠ€æœ¯è¢«å¹¿æ³›åº”ç”¨äºå„ç§ç°å®ä¸–ç•Œçš„åœºæ™¯å’Œäº§å“ä¸­ï¼Œä¾‹å¦‚ï¼š</p><ul><li><strong>èŠå¤©æœºå™¨äºº</strong>å’Œ<strong>è™šæ‹ŸåŠ©æ‰‹</strong>ï¼ˆå¦‚Appleçš„Siriã€Google Assistantã€Amazon Alexaï¼‰ã€‚</li><li><strong>æ–‡æœ¬åˆ†æå·¥å…·</strong>ï¼Œå¸®åŠ©ä¼ä¸šç›‘æµ‹å’Œåˆ†æç¤¾äº¤åª’ä½“ä¸Šçš„æ¶ˆè´¹è€…æƒ…ç»ªã€‚</li><li><strong>ç”µå­é‚®ä»¶è¿‡æ»¤</strong>å’Œ<strong>ååƒåœ¾é‚®ä»¶æŠ€æœ¯</strong>ã€‚</li><li><strong>è¯­éŸ³åˆ°æ–‡æœ¬æœåŠ¡</strong>ï¼Œå¦‚åœ¨æ³•åº­è®°å½•æˆ–åŒ»ç–—è®°å½•ç³»ç»Ÿä¸­è‡ªåŠ¨è½¬å½•å£è¿°å†…å®¹ã€‚</li></ul><h2 id="5-llm"><a href="#5-LLM" class="headerlink" title="5. LLM"></a>5. LLM</h2><p>LLMï¼ˆLarge Language Modelsï¼Œå¤§å‹è¯­è¨€æ¨¡å‹ï¼‰æ˜¯è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNatural Language Processing, NLPï¼‰é¢†åŸŸçš„ä¸€ç§å…ˆè¿›æŠ€æœ¯ï¼Œä¸»è¦ä¾èµ–äºæ·±åº¦å­¦ä¹ ï¼ˆDeep Learningï¼‰æŠ€æœ¯ï¼Œç‰¹åˆ«æ˜¯åŸºäº Transformer æ¶æ„çš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚è¿™äº›æ¨¡å‹å› å…¶è§„æ¨¡åºå¤§å’Œåœ¨å¤šç§è¯­è¨€ä»»åŠ¡ä¸Šçš„å‡ºè‰²è¡¨ç°è€Œå¾—åã€‚</p><p>LM æ˜¯è®¾è®¡ç”¨æ¥ç†è§£ã€ç”Ÿæˆã€ç¿»è¯‘ã€æ‘˜è¦ç­‰å¤„ç†æ–‡æœ¬çš„å¤§è§„æ¨¡ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚å®ƒä»¬é€šå¸¸åŒ…å«æ•°åäº¿è‡³æ•°ä¸‡äº¿ä¸ªå‚æ•°ï¼Œå¹¶åœ¨å¤§é‡å¤šæ ·åŒ–çš„æ–‡æœ¬æ•°æ®ä¸Šè¿›è¡Œè®­ç»ƒï¼Œä»¥å­¦ä¹ è¯­è¨€çš„æ·±å±‚æ¬¡ç»“æ„å’Œè¯­ä¹‰ã€‚<br><strong>æ ¸å¿ƒç»„ä»¶</strong></p><ol><li><strong>Transformer æ¶æ„ï¼ˆTransformer Architectureï¼‰</strong>ï¼š<ul><li>LLM å¤šä½¿ç”¨åŸºäº Transformer çš„æ¨¡å‹ï¼Œè¿™ç§æ¨¡å‹ä¾é è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆSelf-Attention Mechanismï¼‰æ¥å¤„ç†æ–‡æœ¬æ•°æ®ï¼Œä¼˜äºä¼ ç»Ÿçš„å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural Networks, RNNsï¼‰æˆ–å·ç§¯ç¥ç»ç½‘ç»œï¼ˆConvolutional Neural Networks, CNNsï¼‰ã€‚</li></ul></li><li><strong>é¢„è®­ç»ƒä¸å¾®è°ƒï¼ˆPre-training and Fine-tuningï¼‰</strong>ï¼š<ul><li><strong>é¢„è®­ç»ƒï¼ˆPre-trainingï¼‰</strong>ï¼šåœ¨å¤§è§„æ¨¡æœªæ ‡è®°æ•°æ®ä¸Šè¿›è¡Œï¼Œæ¨¡å‹å­¦ä¹ è¯­è¨€çš„é€šç”¨ç‰¹å¾ã€‚</li><li><strong>å¾®è°ƒï¼ˆFine-tuningï¼‰</strong>ï¼šåœ¨ç‰¹å®šä»»åŠ¡çš„è¾ƒå°æ ‡è®°æ•°æ®é›†ä¸Šè¿›è¡Œï¼Œè°ƒæ•´æ¨¡å‹ä»¥é€‚åº”å…·ä½“åº”ç”¨ã€‚</li></ul></li><li><strong>è‡ªç›‘ç£å­¦ä¹ ï¼ˆSelf-supervised Learningï¼‰</strong>ï¼š<ul><li>LLM é€šå¸¸é€šè¿‡è‡ªç›‘ç£å­¦ä¹ é¢„è®­ç»ƒï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä½¿ç”¨è¾“å…¥æ•°æ®çš„ä¸åŒéƒ¨åˆ†ä½œä¸ºè‡ªå·±çš„ç›‘ç£ä¿¡å·ï¼Œä¾‹å¦‚ï¼Œé¢„æµ‹æ–‡æœ¬ä¸­è¢«é®è”½ï¼ˆMaskedï¼‰çš„å•è¯ã€‚</li></ul></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨å­¦ä¹ AI è¿‡ç¨‹ä¸­ï¼Œå‘ç°ä¸“ä¸šåè¯ç›¸å½“å¤šï¼Œåˆå­¦è€…å¯èƒ½ä¼šæ„Ÿåˆ°è€Œæ··ä¹±ï¼Œæ‰€ä»¥æœ¬ç¯‡å†…å®¹æ˜¯å¯¹è¯¥é¢†åŸŸå†…çš„ä¸€äº›â€œå¤§è¯â€è¿›è¡Œç®€å•ä»‹ç»ï¼Œ åšä¸€äº›æ¦‚å¿µæ‰«ç›²ï¼Œ ä»¥ä¿è¯åœ¨æ¥ä¸‹æ¥çš„å­¦ä¹ ä¸­å¿ƒä¸­æœ‰æ¡†æ¶ã€‚ æ­£å¼å†…å®¹ä¼šæŒ‰ç…§ä¸‹å›¾æ¡†æ¶ä»‹ç»&lt;/p&gt;
&lt;img src=&quot;/81fcff81/1.png&quot; class&gt;</summary>
      
    
    
    
    
    <category term="AI" scheme="http://example.com/tags/AI/"/>
    
    <category term="chatGPT" scheme="http://example.com/tags/chatGPT/"/>
    
  </entry>
  
  <entry>
    <title>TrustMessage-åŸºäº2PC+MySQL+æ³›åŒ–è°ƒç”¨å®ç°çš„å¯é æ¶ˆæ¯ä¸­å¿ƒ</title>
    <link href="http://example.com/99d433fa/"/>
    <id>http://example.com/99d433fa/</id>
    <published>2024-04-09T08:41:05.000Z</published>
    <updated>2024-05-08T14:06:28.633Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0-é¡¹ç›®ç»“æ„ä»‹ç»"><a href="#0-é¡¹ç›®ç»“æ„ä»‹ç»" class="headerlink" title="0. é¡¹ç›®ç»“æ„ä»‹ç»"></a>0. é¡¹ç›®ç»“æ„ä»‹ç»</h1><div class="table-container"><table><thead><tr><th>Module</th><th>Description</th></tr></thead><tbody><tr><td>trustmessage-mysql</td><td>åŸºäº2PC+MySQLè¡¨å®ç°çš„å¯é æ¶ˆæ¯ä¸­å¿ƒï¼Œä¸šåŠ¡æ“ä½œ+æ¶ˆæ¯è¡¨æ“ä½œå‡å­˜åœ¨äºåŒä¸€ä¸ªé¡¹ç›®ä¸­</td></tr><tr><td>turstmessage-middleware</td><td>å¯é æ¶ˆæ¯ä¸­å¿ƒä¸­é—´ä»¶ï¼ŒåŸºäºRPCæ¥å£æäº¤æ¶ˆæ¯+2PC+MySQL è¡¨å®ç°</td></tr><tr><td>turstmessage-middlewareapi</td><td>å¯é æ¶ˆæ¯ä¸­å¿ƒä¸­é—´ä»¶ï¼Œ å›æŸ¥æ¥å£å®šä¹‰</td></tr><tr><td>Turstmessage-middlewareclient</td><td>å¯é æ¶ˆæ¯ä¸­å¿ƒä¸­é—´ä»¶ï¼Œ æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œæä¾›äº†HTTPå›æŸ¥æ¥å£ã€Dubboæ³›åŒ–å›æŸ¥æ¥å£çš„ç¤ºä¾‹</td></tr></tbody></table></div><p>ä»¥ä¸‹æ˜¯é¡¹ç›®æ­£å¼ä»‹ç»ã€‚</p><p>åœ¨ä¸šåŠ¡å¤„ç†ä¸­ï¼Œç»å¸¸ä¼šæœ‰é‡è¦ä½†æ²¡é‚£ä¹ˆç´§æ€¥çš„æ•°æ®éœ€è¦åŒæ­¥ç»™ä¸‹æ¸¸ï¼Œæ¯”å¦‚</p><ol><li>è®¢å•ä¾§å®Œæˆæ¶ˆæ¯åç»™ä¼˜æƒ ä¾§å‘ä¸€ä¸ªæ¶ˆæ¯ï¼Œä¼˜æƒ ä¾§åšä¸€ä¸ªå•å‘å¯¹è´¦çš„åŠŸèƒ½ï¼Œç¡®ä¿åˆ¸è¢«æ­£ç¡®æ ¸é”€</li></ol><p>åœ¨è¿™ç§åœºæ™¯ä¸­ï¼Œéœ€è¦æŠŠæœ¬åœ°ä¸šåŠ¡æ“ä½œ + æ¶ˆæ¯å‘é€å½“æˆä¸€ä¸ªäº‹åŠ¡å¤„ç†ï¼Œå³æ»¡è¶³åŸå­æ€§ï¼Œ ä¸€èˆ¬å¸¸è§çš„è§£å†³æ–¹æ¡ˆä¼šæœ‰ä¸¤ç§</p><ol><li>æœ¬åœ°äº‹åŠ¡+æœ¬åœ°æ¶ˆæ¯è¡¨</li><li>RocketMQ</li></ol><p>æœ¬é¡¹ç›®å°†ä»æœ¬åœ°äº‹åŠ¡+æœ¬åœ°æ¶ˆæ¯è¡¨ å‡ºå‘ï¼Œ ä¸€æ­¥æ­¥æ¢è®¨å¦‚ä½•ç”¨ MySQL  å®ç°ä¸€ä¸ªæ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡çš„å¯é æ¶ˆæ¯ä¸­å¿ƒï¼Œå³TrustMessageã€‚</p><p><a href="https://github.com/sysunyan1699/TrustMessage">é¡¹ç›®githubé“¾æ¥ï¼Œç‚¹å‡»å¯æŸ¥çœ‹ä»£ç </a></p><h1 id="1-æœ¬åœ°äº‹åŠ¡-æœ¬åœ°æ¶ˆæ¯è¡¨"><a href="#1-æœ¬åœ°äº‹åŠ¡-æœ¬åœ°æ¶ˆæ¯è¡¨" class="headerlink" title="1. æœ¬åœ°äº‹åŠ¡+ æœ¬åœ°æ¶ˆæ¯è¡¨"></a>1. æœ¬åœ°äº‹åŠ¡+ æœ¬åœ°æ¶ˆæ¯è¡¨</h1><p>ç”±äºSpring çš„äº‹åŠ¡æœºåˆ¶åªä¿è¯æ•°æ®åº“æ“ä½œçš„åŸå­æ€§ï¼Œæ‰€ä»¥å½“æ¶‰åŠåˆ° æ•°æ®åº“çš„ä¸šåŠ¡æ“ä½œ å’Œ å…¶ä»–ä¸­é—´ä»¶å¦‚kafkaæ“ä½œ å…·æœ‰åŸå­æ€§çš„æ—¶å€™ï¼Œå°±è¦ç”¨å…¶ä»–çš„æ–¹æ¡ˆæ¥ä¿è¯ã€‚</p><p>æœ¬åœ°äº‹åŠ¡+ æœ¬åœ°æ¶ˆæ¯è¡¨ è¿™ç§æ–¹æ¡ˆæ˜¯æŠŠ éœ€è¦å‘é€çš„æ¶ˆæ¯ä½œä¸ºæ•°æ®åº“æ“ä½œçš„ä¸€éƒ¨åˆ†ï¼Œä¿å­˜åˆ°æ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨é‡Œï¼Œç„¶åé€šè¿‡å¦å¤–çš„é€»è¾‘ï¼Œå°†æ¶ˆæ¯çš„çœŸæ­£å‘é€ ç¨åå¼‚æ­¥è¿›è¡Œï¼Œæ¯”å¦‚ç”¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å°†æ¶ˆæ¯å¼‚æ­¥å‘é€åˆ°Kafkaã€‚</p><p>è¿™ç§æ–¹æ³•ç¡®ä¿äº†æ•°æ®åº“æ“ä½œå’Œæ¶ˆæ¯å‘é€åœ¨<code>é€»è¾‘è¯­ä¹‰ä¸Šçš„åŸå­æ€§</code>ï¼Œå› ä¸ºå®ƒä»¬éƒ½åœ¨åŒä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡ä¸­å¤„ç†ã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œè¿™ç§æ–¹æ¡ˆçš„å®æ—¶æ€§æ˜¯æ¯”è¾ƒå·®çš„ï¼Œæ‰€ä»¥ä½ éœ€è¦åˆ¤æ–­çš„ä¸šåŠ¡åœºæ™¯åœºæ™¯æ˜¯å¦èƒ½å¤Ÿå®¹å¿è¿™æ ·çš„å¼‚æ­¥æ“ä½œã€‚</p><h2 id="11-ä¸šåŠ¡æµç¨‹"><a href="#1-1-ä¸šåŠ¡æµç¨‹" class="headerlink" title="1.1 ä¸šåŠ¡æµç¨‹"></a>1.1 ä¸šåŠ¡æµç¨‹</h2><img src="/99d433fa/1.png" class><p>ä»¥ä¸Šæµç¨‹ä¸­ï¼Œåœ¨æœ¬åœ°äº‹åŠ¡æäº¤åï¼Œæœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡è½®è¯¢æ¶ˆæ¯è¡¨å°†éœ€è¦å‘é€çš„æ¶ˆæ¯æ¶ˆæ¯å‘é€å‡ºå»ã€‚æœ‰4ä¸ªç‚¹éœ€è¦æ³¨æ„ä¸€ä¸‹</p><ol><li>äº‹åŠ¡æäº¤åäº†ï¼Œæ¶ˆæ¯å‘é€å¤±è´¥ï¼Œ å®šæ—¶ä»»åŠ¡çš„é‡è¯•æœºåˆ¶ï¼Œä¼šæ‰¾å‡ºè¿™æ¡æ¶ˆæ¯è¿›è¡Œå¼‚æ­¥è¡¥å‘ </li><li>äº‹åŠ¡æäº¤åäº†ï¼Œæ¶ˆæ¯å‘é€æˆåŠŸï¼Œä½†æ˜¯æ¶ˆæ¯çŠ¶æ€ä¿®æ”¹çŠ¶æ€ï¼Œ å®šæ—¶ä»»åŠ¡ä¼šæ‰¾å‡ºè¿™æ¡å†æ¬¡å‘é€</li><li>é‡è¯•å¼‚æ­¥è¡¥å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ¶ˆæ¯ä¾ç„¶å‘é€å¤±è´¥ï¼Œé‚£ä¹ˆä¼šç»§ç»­é‡è¯•è¡¥å‘</li><li>é‡è¯•å¼‚æ­¥è¡¥å‘è¿‡ç¨‹ä¸­ï¼Œæ¶ˆæ¯å‘é€æˆåŠŸï¼Œä½†æ˜¯æ•°æ®åº“æ¶ˆæ¯å·²å‘é€çŠ¶æ€ä¿®æ”¹å¤±è´¥ï¼Œé‚£ä¹ˆå®šæ—¶ä»»åŠ¡åˆä¼šå†æ¬¡æ‰¾åˆ°è¿™æ¡æ¶ˆæ¯å†å‘ä¸€é</li></ol><p>ä»¥ä¸Š 2å’Œ4 å‡ä¼šé¢ä¸´æ¶ˆæ¯é‡å¤çš„æƒ…å†µï¼Œ ä¸ªäººè®¤ä¸ºåœ¨ä¸šåŠ¡å¸¸è§ä¸­æ¶ˆæ¯é‡å¤æ˜¯ä¸€ç§å¯æ¥å—çš„æƒ…å†µï¼Œæœ‰æ—¶å€™ä¸šåŠ¡è‡ªå·±ç”šè‡³ä¼šæ¶ˆæ¯é‡æ”¾ï¼Œ æ‰€ä»¥æ¶ˆæ¯æ¶ˆè´¹è€…åšå¥½å¹‚ç­‰é€»è¾‘å°±å¯ä»¥äº†ã€‚</p><h2 id="12-æ¶ˆæ¯å‘é€é‡è¯•æ¬¡æ•°"><a href="#1-2-æ¶ˆæ¯å‘é€é‡è¯•æ¬¡æ•°" class="headerlink" title="1.2 æ¶ˆæ¯å‘é€é‡è¯•æ¬¡æ•°"></a>1.2 æ¶ˆæ¯å‘é€é‡è¯•æ¬¡æ•°</h2><p>æ¶ˆæ¯å‘é€ä¸èƒ½æ— é™æ¬¡é‡è¯•</p><ol><li><p>æµªè´¹èµ„æºï¼Œé‡è¯•äº†é‚£ä¹ˆå¤šæ¬¡éƒ½æœªæˆåŠŸï¼Œå¯èƒ½æ˜¯é€»è¾‘å‡ºç°é—®é¢˜äº†æˆ–è€…å®•æœºäº†ï¼Œèµ¶ç´§å»æŸ¥é—®é¢˜å§</p></li><li><p>ä¸Šä¸‹æ¸¸ä¸šåŠ¡æ•°æ®è¿Ÿè¿Ÿæ— æ³•è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ ï¼Œ æœ¬èº«æˆ‘ä»¬ä½¿ç”¨æ¶ˆæ¯å…¶ç»ˆæç›®çš„å°±æ˜¯ä¸ºäº†è®©ç³»ç»Ÿæ•°æ®è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ï¼Œ å¦‚æœä¸€ç›´æ— é™åˆ¶å‘é€ï¼Œè¿™ä¸ªç›®çš„æ˜¯æ— æ³•è¾¾åˆ°çš„, æ‰€ä»¥èµ¶ç´§åœä¸‹å»æŸ¥é—®é¢˜å§</p></li></ol><p>åŸºäºä»¥ä¸Šä¸¤ä¸ªè€ƒè™‘ï¼Œç³»ç»Ÿå¯¹äºé‡è¯•éƒ½åº”è¯¥æœ‰ä¸ªæ¬¡æ•°é™åˆ¶ï¼Œè¾¾åˆ°æ¬¡æ•°é™åˆ¶åå°±åº”è¯¥å‘Šè­¦è®©äººå·¥ä»‹å…¥å¤„ç†ã€‚</p><h2 id="13-æ¶ˆæ¯è¡¨è®¾è®¡"><a href="#1-3-æ¶ˆæ¯è¡¨è®¾è®¡" class="headerlink" title="1.3 æ¶ˆæ¯è¡¨è®¾è®¡"></a>1.3 æ¶ˆæ¯è¡¨è®¾è®¡</h2><p>åœ¨æœ¬åœ°äº‹åŠ¡+ æœ¬åœ°æ¶ˆæ¯è¡¨ æ–¹æ¡ˆä¸­ï¼Œå…¶æ¶ˆæ¯è¡¨çš„è®¾è®¡ä¸€èˆ¬å¦‚ä¸‹ï¼Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> message (</span><br><span class="line">id <span class="type">bigint</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">message text COMMENT <span class="string">&#x27;æ¶ˆæ¯å†…å®¹&#x27;</span>,</span><br><span class="line">send_status <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;0-æŠ•é€’ä¸­ 1-æŠ•é€’æˆåŠŸ 2-æŠ•é€’å¤±è´¥&#x27;</span>,</span><br><span class="line">send_try_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;commit æ¶ˆæ¯å‘é€ å½“å‰é‡è¯•æ¬¡æ•°&#x27;</span>,</span><br><span class="line">send_next_retry_time DATETIME <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æ¶ˆæ¯å‘é€ ä¸‹æ¬¡é‡è¯•æ—¶é—´&#x27;</span>,</span><br><span class="line">create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">update_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line"><span class="keyword">UNIQUE</span> INDEX idx_messageKey(message_key)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure><h1 id="2-å¦‚æœæ¶ˆæ¯è¡¨å’Œä¸šåŠ¡è¡¨æ“ä½œæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#2-å¦‚æœæ¶ˆæ¯è¡¨å’Œä¸šåŠ¡è¡¨æ“ä½œæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="2. å¦‚æœæ¶ˆæ¯è¡¨å’Œä¸šåŠ¡è¡¨æ“ä½œæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"></a>2. å¦‚æœæ¶ˆæ¯è¡¨å’Œä¸šåŠ¡è¡¨æ“ä½œæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡</h1><p>ä½†æ˜¯å¦‚æœä¿è¯ä¸äº†è¿™ä¸¤ä¸ªè¡¨ä¸åœ¨åŒä¸€ä¸ªåº“ /æ•°æ®åº“å®ä¾‹ä¸­ï¼Œé‚£å°±ä¼šåœ¨ä¸šåŠ¡æ“ä½œå’Œæ¶ˆæ¯è¡¨å†™å…¥ä¸¤ä¸ªæ“ä½œä¸­é‡åˆ°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚è¿™åœ¨åˆ†åº“åˆ†è¡¨çš„ä¸šåŠ¡ä¸­æ˜¯å¾ˆå®¹æ˜“å‡ºç°çš„æƒ…å†µã€‚</p><p>é’ˆå¯¹å¯¹åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¸¸è§çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ 2PCã€3PCã€TCCã€SAGAã€‚</p><p>æ¥ä¸‹æ¥å°†è®²è§£ä»¥ 2PC+MySQLæ¶ˆæ¯è¡¨ å®ç°çš„å¯é æ¶ˆæ¯ä¸­å¿ƒ</p><h2 id="21-ä¸šåŠ¡æµç¨‹"><a href="#2-1-ä¸šåŠ¡æµç¨‹" class="headerlink" title="2.1 ä¸šåŠ¡æµç¨‹"></a>2.1 ä¸šåŠ¡æµç¨‹</h2><p>ä»¥MySQLæ¶ˆæ¯è¡¨+ 2PC æ¥å®ç°å¯é æ¶ˆæ¯ä¸­å¿ƒï¼Œ å…¶æ•´ä½“å®ç°æµç¨‹å¦‚ä¸‹<br><img src="/99d433fa/2.png" class></p><h2 id="22-æ¶ˆæ¯å¯è§æ€§"><a href="#2-2-æ¶ˆæ¯å¯è§æ€§" class="headerlink" title="2.2 æ¶ˆæ¯å¯è§æ€§"></a>2.2 æ¶ˆæ¯å¯è§æ€§</h2><p>æ¶ˆæ¯å¯è§æ€§ï¼Œ åœ¨æ¶‰åŠåˆ†å¸ƒå¼äº‹åŠ¡çš„åœºæ™¯ä¸­ï¼Œæ¶ˆæ¯å¢åŠ äº†ä¸€ä¸ª<code>å¯è§æ€§</code>æ¦‚å¿µï¼Œ è¿™æ˜¯å› ä¸ºåœ¨å¼•å…¥2PC åï¼Œå†™å…¥æ¶ˆæ¯è¡¨çš„æ¶ˆæ¯ä¸å†åƒæœ¬åœ°äº‹åŠ¡+æœ¬åœ°æ¶ˆæ¯è¡¨ä¸€æ ·<code>å†™å…¥å³å¯è§</code>ï¼Œå¿…é¡»æ˜¯commitåæ‰å¯¹æ¶ˆè´¹è€…å¯è§ï¼Œ æ‰€ä»¥åœ¨æ•°æ®è¡¨çš„è®¾è®¡ä¸­éœ€è¦å¢åŠ ä¸€ä¸ªçŠ¶æ€å­—æ®µæ¥ç»´æŠ¤æ¶ˆæ¯å¯è§æ€§ã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">message_status INT COMMENT &#x27;æ¶ˆæ¯çŠ¶æ€ 1-prepare 2-commit 3-rollback 4-unknown&#x27;,</span><br></pre></td></tr></table></figure></p><p>å…¶çŠ¶æ€æµè½¬å¦‚å›¾æ‰€ç¤º<br><img src="/99d433fa/3.png" class></p><h2 id="23-å¦‚æœä¸šåŠ¡æ‰§è¡Œæ¶ˆæ¯commit-or-rollback-å¤±è´¥æ€ä¹ˆåŠ-æ¶ˆæ¯å›æŸ¥"><a href="#2-3-å¦‚æœä¸šåŠ¡æ‰§è¡Œæ¶ˆæ¯commit-or-rollback-å¤±è´¥æ€ä¹ˆåŠ-æ¶ˆæ¯å›æŸ¥" class="headerlink" title="2.3 å¦‚æœä¸šåŠ¡æ‰§è¡Œæ¶ˆæ¯commit or rollback å¤±è´¥æ€ä¹ˆåŠ-æ¶ˆæ¯å›æŸ¥"></a>2.3 å¦‚æœä¸šåŠ¡æ‰§è¡Œæ¶ˆæ¯commit or rollback å¤±è´¥æ€ä¹ˆåŠ-æ¶ˆæ¯å›æŸ¥</h2><p>å¦‚æµç¨‹å›¾ä¸­æ‰€ç¤ºï¼Œåœ¨2PC é˜¶æ®µï¼Œæ‹¿åˆ°ä¸šåŠ¡æ‰§è¡Œç»“æœä¿®æ”¹æ¶ˆæ¯çŠ¶æ€å¤±è´¥æœ‰å¯èƒ½æ˜¯å¤±è´¥ã€‚</p><p>ä¸€ä¸ªæ“ä½œæ‰§è¡Œå¤±è´¥åï¼Œä¸€ç§å¸¸è§çš„è§£å†³æ–¹æ¡ˆæ–¹æ¡ˆå°±æ˜¯é‡è¯•ï¼Œå°½æœ€å¤§åŠªåŠ›äº¤ä»˜ã€‚</p><p>ä½†æ˜¯å¯¹äºä¸šåŠ¡å¤„ç†æ¥è®²ï¼Œä¸€èˆ¬æœ‰è¶…æ—¶æ—¶é—´çš„é™åˆ¶ï¼Œå› ä¸ºè¿™ç§åŒæ­¥é‡è¯•å¯èƒ½å¹¶ä¸é€‚ç”¨ï¼Œå³ä½¿å¯ä»¥ï¼Œä¸€èˆ¬é‡è¯•æ¬¡æ•°éƒ½ä¼šé™å®šåœ¨3æ¬¡ã€‚</p><p>é™¤äº†åŒæ­¥é‡è¯•ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ¡ˆå°±æ˜¯ æ¶ˆæ¯å›æŸ¥ï¼Œæˆ‘ä¸ªäººç†è§£è¿™ç›¸å½“äºä¸€ç§å¼‚æ­¥é‡è¯•ã€‚</p><p>åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæ¶ˆæ¯å›æŸ¥æŒ‡çš„å°±æ˜¯å¼€å¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å»å…¨è¡¨æ‰«æï¼Œæ‰¾å‡ºinsertä¸€å®šæ—¶é—´åï¼Œå…¶çŠ¶æ€ä»ç„¶æ˜¯ prepareçš„æ¶ˆæ¯ ï¼Œé€šè¿‡ä¸šåŠ¡é€»è¾‘åˆ¤æ–­è¯¥æ¡æ¶ˆæ¯æ˜¯å¦å·²ç»æ‰§è¡Œå®Œæˆ or å¤±è´¥ï¼Œå¯¹åº”åœ°æŠŠæ¶ˆæ¯çŠ¶æ€æ›´æ”¹ä¸º commit or rollbackã€‚</p><p>ä¸ºäº†è¿›è¡Œæ¶ˆæ¯å›æŸ¥ï¼Œè‚¯å®šè¦æœ‰ä¸€ä¸ªä¸šåŠ¡å”¯ä¸€æ ‡è¯†æ¥è¯†åˆ«è¯¥æ¡æ¶ˆæ¯éœ€è¦å¯¹åº”ä¸šåŠ¡æ•°æ®ï¼Œä»è€Œåˆ¤æ–­å¯¹åº”ä¸šåŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">message_key VARCHAR(255) COMMENT &#x27;æ¶ˆæ¯å”¯ä¸€é”®ï¼Œç”¨äºåšå›æŸ¥çš„æ ‡è¯†&#x27;,</span><br></pre></td></tr></table></figure></p><h2 id="24-æ¶ˆæ¯å›æŸ¥ä¸èƒ½æ— é™æ¬¡"><a href="#2-4-æ¶ˆæ¯å›æŸ¥ä¸èƒ½æ— é™æ¬¡" class="headerlink" title="2.4 æ¶ˆæ¯å›æŸ¥ä¸èƒ½æ— é™æ¬¡"></a>2.4 æ¶ˆæ¯å›æŸ¥ä¸èƒ½æ— é™æ¬¡</h2><ol><li>æµªè´¹èµ„æºï¼Œå›æŸ¥äº†è¿™ä¹ˆå¤šæ¬¡çš„éƒ½æ²¡æ‹¿åˆ°ç»“æœï¼Œä¸€ç§å¯èƒ½å°±æ˜¯ä¸šåŠ¡é€»è¾‘å‡ºç°é—®é¢˜äº†ï¼Œé€‚å¯è€Œæ­¢èµ¶ç´§å»æŸ¥é—®é¢˜å§</li><li>ç³»ç»Ÿæ•°æ®è¿Ÿè¿Ÿæ— æ³•è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ ï¼Œ æœ¬èº«æˆ‘ä»¬ä½¿ç”¨æ¶ˆæ¯å…¶ç»ˆæç›®çš„å°±æ˜¯ä¸ºäº†è®©ç³»ç»Ÿæ•°æ®è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ï¼Œ å¦‚æœä¸€ç›´æ— é™åˆ¶æŸ¥è¯¢ï¼Œè¿™ä¸ªç›®çš„æ˜¯æ— æ³•è¾¾åˆ°çš„, æ‰€ä»¥èµ¶ç´§åœä¸‹å»æŸ¥é—®é¢˜å§</li></ol><p>æ‰€æœ‰æ¶ˆæ¯å›æŸ¥åº”è¯¥æœ‰ä¸ªæ¬¡æ•°é™åˆ¶ï¼Œ è¿™å°±æ˜¯è¡¨ä¸­ä»¥ä¸‹ä¸¤ä¸ªå­—æ®µçš„ä½œç”¨<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">verify_try_count <span class="type">INT</span> COMMENT <span class="string">&#x27;æ¶ˆæ¯çŠ¶æ€å›æŸ¥ ä¸‹æ¬¡é‡è¯•æ¬¡æ•°&#x27;</span>,  </span><br><span class="line">verify_next_retry_time <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æ¶ˆæ¯çŠ¶æ€å›æŸ¥ ä¸‹æ¬¡é‡è¯•æ—¶é—´ 1-æœªå‘é€ 2-å·²å‘é€&#x27;</span>,</span><br></pre></td></tr></table></figure></p><h2 id="25-æ¶ˆæ¯å›æŸ¥æ¬¡æ•°è¾¾åˆ°ä¸Šé™æ€ä¹ˆåŠ"><a href="#2-5-æ¶ˆæ¯å›æŸ¥æ¬¡æ•°è¾¾åˆ°ä¸Šé™æ€ä¹ˆåŠ" class="headerlink" title="2.5 æ¶ˆæ¯å›æŸ¥æ¬¡æ•°è¾¾åˆ°ä¸Šé™æ€ä¹ˆåŠ"></a>2.5 æ¶ˆæ¯å›æŸ¥æ¬¡æ•°è¾¾åˆ°ä¸Šé™æ€ä¹ˆåŠ</h2><p>æœ‰ä¸¤ç§å‚è€ƒæ–¹æ¡ˆ</p><ol><li>é»˜è®¤ä¿®æ”¹æ¶ˆæ¯çŠ¶æ€ä¸ºcommit  æˆ–è€… rollbackï¼Œ</li><li>å°†æ¶ˆæ¯çŠ¶æ€ç½®ä¸ºå›æŸ¥å¤±è´¥çŠ¶æ€ ï¼Œ å‘Šè­¦äººå·¥ä»‹å…¥å¤„ç†</li></ol><p>é»˜è®¤ä¿®æ”¹æ¶ˆæ¯çŠ¶æ€ä¸ºcommit  æˆ–è€… rollback è¿™ä¸ªæ–¹æ¡ˆï¼Œä¸€ä¸ªæœ€å¤§çš„é—®é¢˜å°±æ˜¯é’ˆå¯¹çŠ¶æ€ä¸ç¡®å®šçš„æ¶ˆæ¯ï¼Œä¸è®ºå°†å…¶é»˜è®¤ä¿®æ”¹ä¸ºé‚£ç§çŠ¶æ€ï¼Œ éƒ½æ˜¯æœ‰å¯èƒ½å¼•èµ·ä¸šåŠ¡ä¸Šä¸‹æ¸¸æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</p><p>ä¸€æ—¦ä¸Šä¸‹æ¸¸æ•°æ®äº§ç”Ÿäº†æ•°æ®ä¸ä¸€è‡´æ€§ï¼Œå¿…ç„¶å¯¼è‡´å¾ˆé•¿çš„æ’æŸ¥é“¾è·¯å’Œå¤§é‡çš„æ•°æ®ä¿®å¤å·¥ä½œã€‚</p><p>æ‰€ä»¥æœ¬é¡¹ç›®ä¸­æˆ‘é€‰æ‹©ç¬¬äºŒç§æ–¹æ¡ˆï¼Œæ¶ˆæ¯å›æŸ¥è¾¾åˆ°ä¸Šé™åç›´æ¥å‘Šè­¦ï¼Œè®©æ¶ˆæ¯ç”Ÿäº§è€…è¿™ä¸€æ–¹äººå·¥ä»‹å…¥å¤„ç†ã€‚</p><p>æ­¤å¤„è¯´æ˜ä¸€ä¸‹ï¼Œè¿™ç§æ–¹æ¡ˆå½“ç„¶ä¹Ÿä¼šæœ‰æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå› ä¸ºä¸‹æ¸¸ä¸šåŠ¡å§‹ç»ˆè¿˜æœªæ‹¿åˆ°æ¶ˆæ¯ä¿®æ”¹è‡ªå·±çš„çŠ¶æ€ï¼Œä½†æ˜¯ç›¸æ¯”æ‹¿åˆ°äº†éšæœºç¡®å®šçš„çš„çŠ¶æ€ å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´æ€§ï¼Œæ­¤æ—¶é—®é¢˜è¿˜è¢«æ§åˆ¶åœ¨æ¶ˆæ¯ç”Ÿäº§è€…è¿™ä¸€ç¯ï¼Œé—®é¢˜æ’æŸ¥ä¼šç›¸å¯¹ç®€å•ã€‚</p><h2 id="26-æ¶ˆæ¯å‘é€é‡è¯•"><a href="#2-6-æ¶ˆæ¯å‘é€é‡è¯•" class="headerlink" title="2.6 æ¶ˆæ¯å‘é€é‡è¯•"></a>2.6 æ¶ˆæ¯å‘é€é‡è¯•</h2><p>ä¸æœ¬åœ°äº‹åŠ¡+æœ¬åœ°æ¶ˆæ¯è¡¨æ–¹æ¡ˆä¸€è‡´</p><h2 id="27-æ¶ˆæ¯è¡¨è®¾è®¡"><a href="#2-7-æ¶ˆæ¯è¡¨è®¾è®¡" class="headerlink" title="2.7 æ¶ˆæ¯è¡¨è®¾è®¡"></a>2.7 æ¶ˆæ¯è¡¨è®¾è®¡</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> message (</span><br><span class="line">id <span class="type">bigint</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">message_key <span class="type">VARCHAR</span>(<span class="number">255</span>) COMMENT <span class="string">&#x27;æ¶ˆæ¯å”¯ä¸€é”®ï¼Œç”¨äºåšå›æŸ¥çš„æ ‡è¯†&#x27;</span>,</span><br><span class="line">message text COMMENT <span class="string">&#x27;æ¶ˆæ¯å†…å®¹&#x27;</span>,</span><br><span class="line">message_status <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;æ¶ˆæ¯çŠ¶æ€ 1-prepare 2-commit 3-rollback 4-unknown&#x27;</span>,</span><br><span class="line">verify_try_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;æ¶ˆæ¯çŠ¶æ€å›æŸ¥ å½“å‰é‡è¯•æ¬¡æ•°&#x27;</span>,</span><br><span class="line">verify_next_retry_time DATETIME <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æ¶ˆæ¯çŠ¶æ€å›æŸ¥ ä¸‹æ¬¡é‡è¯•æ—¶é—´&#x27;</span>,</span><br><span class="line">send_status <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;0-æŠ•é€’ä¸­ 1-æŠ•é€’æˆåŠŸ 2-æŠ•é€’å¤±è´¥&#x27;</span>,</span><br><span class="line">send_try_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;commit æ¶ˆæ¯å‘é€ å½“å‰é‡è¯•æ¬¡æ•°&#x27;</span>,</span><br><span class="line">send_next_retry_time DATETIME <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æ¶ˆæ¯å‘é€ ä¸‹æ¬¡é‡è¯•æ—¶é—´&#x27;</span>,</span><br><span class="line">create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">update_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line"><span class="keyword">UNIQUE</span> INDEX idx_messageKey(message_key)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure><h2 id="28-æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯"><a href="#2-8-æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯" class="headerlink" title="2.8 æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯"></a>2.8 æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯</h2><p>é’ˆå¯¹å¯è§ï¼Œ å³å·²ç»commit çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…è¯¥å¦‚ä½•è·å–åˆ°æ¶ˆæ¯æ¶ˆè´¹å‘¢ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆ</p><ol><li>æ¶ˆæ¯è€…ç›´æ¥æŸ¥è¯¢æ¶ˆæ¯è¡¨</li><li>æ¶ˆè´¹è€…ä»æ¶ˆæ¯é˜Ÿåˆ—é˜Ÿåˆ—æ¶ˆè´¹</li></ol><h3 id="281-æ¶ˆæ¯è€…è½®è®­æ¶ˆæ¯è¡¨"><a href="#2-8-1-æ¶ˆæ¯è€…è½®è®­æ¶ˆæ¯è¡¨" class="headerlink" title="2.8.1 æ¶ˆæ¯è€…è½®è®­æ¶ˆæ¯è¡¨"></a>2.8.1 æ¶ˆæ¯è€…è½®è®­æ¶ˆæ¯è¡¨</h3><p>è¿™ç§æ–¹æ¡ˆæœ€å¤§çš„é—®é¢˜å°±æ˜¯ï¼Œåœ¨å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œä¸Šä¸‹æ¸¸ä¸¤ä¸ªä¸åŒçš„æœåŠ¡ æ“ä½œ åŒä¸€ä¸ªæ•°æ®è¡¨ æ˜¯ä¸€ä¸ªä¸åˆç†ä¸”ä¸æ¨èçš„åšæ³•ã€‚</p><h3 id="282-æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹"><a href="#2-8-2-æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹" class="headerlink" title="2.8.2 æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹"></a>2.8.2 æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹</h3><p>å’Œæœ¬åœ°äº‹åŠ¡+æœ¬åœ°æ¶ˆæ¯è¡¨ä¸€æ ·ï¼Œå·²ç»commit çš„æ¶ˆæ¯å¯ä»¥ç”±ä¸€ä¸ªå®šæ—¶ä»»åŠ¡è½®è®­å‘é€åˆ°ä¸šåŠ¡åˆ›å»ºçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ä¾›è®¢é˜…çš„æ¶ˆè´¹è€…æ¶ˆè´¹<br>å‘é€è¿‡ç¨‹ä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ªé‡è¯•çš„è¿‡ç¨‹ã€‚</p><h1 id="3-å¦‚æœè¿™æ˜¯ä¸€ä¸ªå…¬å…±ä¸­é—´ä»¶-åŸºäºrpc-æ¥å£å®ç°çš„å¯é æ¶ˆæ¯ä¸­å¿ƒ"><a href="#3-å¦‚æœè¿™æ˜¯ä¸€ä¸ªå…¬å…±ä¸­é—´ä»¶-åŸºäºRPC-æ¥å£å®ç°çš„å¯é æ¶ˆæ¯ä¸­å¿ƒ" class="headerlink" title="3. å¦‚æœè¿™æ˜¯ä¸€ä¸ªå…¬å…±ä¸­é—´ä»¶-åŸºäºRPC æ¥å£å®ç°çš„å¯é æ¶ˆæ¯ä¸­å¿ƒ"></a>3. å¦‚æœè¿™æ˜¯ä¸€ä¸ªå…¬å…±ä¸­é—´ä»¶-åŸºäºRPC æ¥å£å®ç°çš„å¯é æ¶ˆæ¯ä¸­å¿ƒ</h1><p>ä»¥ä¸Šè®¨è®ºçš„æ–¹æ¡ˆï¼Œ éƒ½æ˜¯åŸºäºæ¶ˆæ¯è¡¨é€»è¾‘å’Œä¸šåŠ¡é€»è¾‘åŒä¸€ä¸ªæœåŠ¡ä¸­ï¼Œ å¦‚æœæŠŠè¯¥åŠŸèƒ½åšæˆä¸€ä¸ªå…¬å…±ä¸­é—´ä»¶ï¼Œé‚£ä¹ˆåœ¨æŠ€æœ¯æ–¹æ¡ˆä¸Šä¼šç•¥æœ‰å˜åŒ–ã€‚</p><p>ä¸­é—´ä»¶éœ€è¦æä¾›çš„åŠŸèƒ½</p><ol><li>ä¸¤é˜¶æ®µæäº¤åŠŸèƒ½</li><li>å›æŸ¥åŠŸèƒ½</li><li>æ¶ˆæ¯è½¬å‘</li></ol><p>ä»¥ä¸Š3ä¸ªåŠŸèƒ½å’Œä¸Šä¸€ç§æ–¹æ¡ˆæ²¡æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼Œ åªæ˜¯åŸºäºä¸€ä¸ªä¸­é—´ä»¶çš„å®šä½ï¼Œæ”¯æŒè¿™3ç§åŠŸèƒ½éœ€è¦æ›´å¤šçš„å°è£…ä¸æ•°æ®ä¿¡æ¯ã€‚</p><h2 id="31-ä¸šåŠ¡æµç¨‹"><a href="#3-1-ä¸šåŠ¡æµç¨‹" class="headerlink" title="3.1 ä¸šåŠ¡æµç¨‹"></a>3.1 ä¸šåŠ¡æµç¨‹</h2><img src="/99d433fa/4.png" class><h2 id="32-ä¸¤é˜¶æ®µæäº¤åŠŸèƒ½"><a href="#3-2-ä¸¤é˜¶æ®µæäº¤åŠŸèƒ½" class="headerlink" title="3.2 ä¸¤é˜¶æ®µæäº¤åŠŸèƒ½"></a>3.2 ä¸¤é˜¶æ®µæäº¤åŠŸèƒ½</h2><p>æä¾›3ä¸ªRPC æ¥å£ï¼Œ prepareï¼Œ commit, rollback, æ¥å£åº•å±‚å°è£…å¯¹æ•°æ®è¡¨çš„æ“ä½œ</p><h2 id="33-æ¶ˆæ¯å”¯ä¸€æ€§"><a href="#3-3-æ¶ˆæ¯å”¯ä¸€æ€§" class="headerlink" title="3.3 æ¶ˆæ¯å”¯ä¸€æ€§"></a>3.3 æ¶ˆæ¯å”¯ä¸€æ€§</h2><p>å½“ä½œä¸ºä¸€ä¸ªå…¬å…±ä¸­é—´ä»¶ï¼Œæ¥å—å¤šä¸ªä¸šåŠ¡æ•°æ®çš„æ—¶å€™ï¼Œæ¶ˆæ¯çš„å”¯ä¸€æ€§åº”è¯¥æœ‰ä¸šåŠ¡æ ‡è¯† + æ¶ˆæ¯æ ‡è¯†å…±åŒç¡®å®šï¼Œå³bizId + messageKey</p><h2 id="34-å›æŸ¥åŠŸèƒ½"><a href="#3-4-å›æŸ¥åŠŸèƒ½" class="headerlink" title="3.4 å›æŸ¥åŠŸèƒ½"></a>3.4 å›æŸ¥åŠŸèƒ½</h2><p>ç›¸æ¯”äºç›´æ¥åœ¨ä¸šåŠ¡æœåŠ¡é‡Œé›†æˆå¯é æ¶ˆæ¯çš„åŠŸèƒ½æ—¶ï¼Œå¯ä»¥ç®€å•ç›´æ¥çš„åœ¨æœåŠ¡å†…éƒ¨æŸ¥è¯¢ï¼Œå½“ä½œä¸ºå…¬å…±ä¸­é—´ä»¶æ—¶ï¼Œ  åªèƒ½é€šè¿‡æœåŠ¡é—´è°ƒç”¨å®Œæˆï¼ŒæœåŠ¡é—´è°ƒç”¨æœ‰ä¸¤ç§å½¢å¼</p><ol><li>HTTP</li><li>RPC</li></ol><p>ä¸ºäº†å¢åŠ å¯ç»´æŠ¤æ€§å’Œæ‹“å±•å‹ï¼Œ æ— è®ºæ˜¯å“ªç§å½¢å¼ï¼Œä¸­é—´ä»¶éƒ½åº”è¯¥å®šä¹‰å¥½è°ƒç”¨çš„æ ¼å¼ï¼Œè®©æ¶ˆæ¯ç”Ÿäº§è€…æŒ‰ç…§ç»Ÿä¸€æ ¼å¼æä¾›å›æŸ¥æ¥å£ã€‚</p><p>è¿™ä¸ªæ ¼å¼åŒ…æ‹¬</p><ol><li>æ¥å£å®šä¹‰</li><li>æ¥å£å…¥å‚</li><li>æ¥å£è¿”å›å€¼</li></ol><p>å…¶ä¸­æ¥å£å®šä¹‰ä¿¡æ¯éœ€è¦ç”Ÿäº§æ¶ˆæ¯æ—¶æä¾›</p><p>åœ¨å®ç°æ¶ˆæ¯ç”Ÿäº§è€…æŒ‰ç…§ç»Ÿä¸€æ ¼å¼æä¾›å›æŸ¥æ¥å£ è¿™ä¸€ç‚¹æ˜¯ï¼ŒHTTPæ¥å£çš„å›æŸ¥ç›¸å¯¹ç®€å•ï¼Œ å¦‚æœRPC æ¥å£ï¼Œ è¦æ³¨æ„ä½¿ç”¨æ³›åŒ–è°ƒç”¨ã€‚</p><p>æœ¬é¡¹ç›®å®ç°äº†HTTP æ¥å£çš„å›æŸ¥å’Œ Dubbo åè®®çš„æ³›åŒ–è°ƒç”¨å›æŸ¥</p><p>HTTPæ¥å£æ ¼å¼ä¸º<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8082/verifyMessage?bizID=1&amp;messageKey=key1</span><br></pre></td></tr></table></figure></p><p>Dubbo RPC æ¥å£å®šä¹‰ä¸º<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public interface VerifyMessageService &#123;  </span><br><span class="line">  </span><br><span class="line">// æ¶ˆæ¯å›æŸ¥æ¥å£  </span><br><span class="line">int verifyMessage(Integer bizID,String messageKey);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="35-æ¶ˆæ¯è½¬å‘"><a href="#3-5-æ¶ˆæ¯è½¬å‘" class="headerlink" title="3.5 æ¶ˆæ¯è½¬å‘"></a>3.5 æ¶ˆæ¯è½¬å‘</h2><p>åœ¨ä¸€ä¸ªå…¬å…±ä¸­é—´ä»¶é‡Œå®ç°æ¶ˆæ¯è½¬å‘ï¼Œå¿…ç„¶ä¹Ÿéœ€è¦ç”Ÿäº§æ¶ˆæ¯æ—¶æä¾›è¿™éƒ¨åˆ†ä¿¡æ¯<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">forward_topic VARCHAR(255) COMMENT &#x27;ä¸šåŠ¡è½¬å‘topic&#x27;,  </span><br><span class="line">forward_key VARCHAR(255) COMMENT &#x27;ä¸šåŠ¡è½¬å‘æŒ‡å®škey&#x27;,  </span><br></pre></td></tr></table></figure></p><h2 id="36-æ¶ˆæ¯è¡¨è®¾è®¡"><a href="#3-6-æ¶ˆæ¯è¡¨è®¾è®¡" class="headerlink" title="3.6 æ¶ˆæ¯è¡¨è®¾è®¡"></a>3.6 æ¶ˆæ¯è¡¨è®¾è®¡</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> message (</span><br><span class="line">id <span class="type">bigint</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    biz_id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¸šåŠ¡ID&#x27;</span>,</span><br><span class="line">    message_key <span class="type">VARCHAR</span>(<span class="number">255</span>) COMMENT <span class="string">&#x27;æ¶ˆæ¯å”¯ä¸€é”®ï¼Œç”¨äºåšå›æŸ¥çš„æ ‡è¯†&#x27;</span>,</span><br><span class="line">message text COMMENT <span class="string">&#x27;æ¶ˆæ¯å†…å®¹&#x27;</span>,</span><br><span class="line">message_status <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;æ¶ˆæ¯çŠ¶æ€ 1-prepare 2-commit 3-rollback 4-verify fail&#x27;</span>,</span><br><span class="line">    forward_topic <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¸šåŠ¡è½¬å‘topic&#x27;</span>,</span><br><span class="line">forward_key <span class="type">VARCHAR</span>(<span class="number">255</span>) COMMENT <span class="string">&#x27;ä¸šåŠ¡è½¬å‘æŒ‡å®škey&#x27;</span>,</span><br><span class="line">    verify_info <span class="type">VARCHAR</span>(<span class="number">2000</span>) COMMENT <span class="string">&#x27;å›æŸ¥ä¿¡æ¯&#x27;</span>,</span><br><span class="line">verify_try_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;æ¶ˆæ¯çŠ¶æ€å›æŸ¥ å½“å‰é‡è¯•æ¬¡æ•°&#x27;</span>,</span><br><span class="line">verify_next_retry_time DATETIME <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æ¶ˆæ¯çŠ¶æ€å›æŸ¥ ä¸‹æ¬¡é‡è¯•æ—¶é—´&#x27;</span>,</span><br><span class="line">send_status <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;0-æŠ•é€’ä¸­ 1-æŠ•é€’æˆåŠŸ 2-æŠ•é€’å¤±è´¥&#x27;</span>,</span><br><span class="line">send_try_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;commitæ¶ˆæ¯å‘é€ å½“å‰é‡è¯•æ¬¡æ•°&#x27;</span>,</span><br><span class="line">send_next_retry_time DATETIME  <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æ¶ˆæ¯å‘é€ ä¸‹æ¬¡é‡è¯•æ—¶é—´&#x27;</span>,</span><br><span class="line">create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">update_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line"><span class="keyword">UNIQUE</span> INDEX idx_message_key_biz_id (message_key, biz_id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure><h1 id="4-åŸºäºkafka-æäº¤æ¶ˆæ¯å®ç°çš„å¯é äº‹ä»¶ä¸­å¿ƒ"><a href="#4-åŸºäºkafka-æäº¤æ¶ˆæ¯å®ç°çš„å¯é äº‹ä»¶ä¸­å¿ƒ" class="headerlink" title="4. åŸºäºkafka æäº¤æ¶ˆæ¯å®ç°çš„å¯é äº‹ä»¶ä¸­å¿ƒ"></a>4. åŸºäºkafka æäº¤æ¶ˆæ¯å®ç°çš„å¯é äº‹ä»¶ä¸­å¿ƒ</h1><p>åœ¨å®ç°æ¶ˆæ¯å›æŸ¥çš„å¯é æ¶ˆæ¯ä¸­å¿ƒæ–¹æ¡ˆä¸­ï¼Œå¦å¤–ä¸€ç§å¸¸è§çš„æ–¹æ¡ˆæ˜¯ ä¸šåŠ¡ä»£ç ç›´æ¥æŠŠæ¶ˆæ¯æäº¤ç»™kafka, ç„¶åä¸­é—´ä»¶æ¶ˆè´¹æ¶ˆæ¯å¹¶æŒä¹…åŒ–é“æ•°æ®åº“ä¸­ï¼Œç­‰å¾…æ¶ˆæ¯æäº¤commit æˆ–è€…rollback , æ²¡æœ‰çš„è¯å°±è¿›è¡Œå›æŸ¥ã€‚å¦‚ä¸‹å›¾ï¼Œå›¾ç‰‡æºè‡ªæå®¢æ—¶é—´ä¸“æ </p><img src="/99d433fa/5.png" class><p>æˆ‘è®¤ä¸ºä¸¤ç§æŠ€æœ¯æ–¹æ¡ˆæ²¡æœ‰æœ¬è´¨çš„åŒºåˆ«ï¼Œ å…¶å·®å¼‚åªæ˜¯æ¶ˆæ¯çš„prepare ã€commitã€rollback çš„æäº¤æ˜¯ç”±RPC æ¥å£å®Œæˆè¿˜æ˜¯ç”±æ¶ˆæ¯ç”Ÿäº§æ¶ˆè´¹å®Œæˆï¼Œ å…¶ä»–å›æŸ¥çš„é€»è¾‘ã€å‘é€é€»è¾‘ã€ä»¥åŠéœ€è¦çš„ä¿¡æ¯åŸºæœ¬æ— å·®å¼‚ã€‚</p><p>ä¸è¿‡åœ¨ä½¿ç”¨Kafka æäº¤æ—¶ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§éœ€è¦è€ƒè™‘</p><h2 id="41-ä¸­é—´ä»¶å¦‚ä½•è¯†åˆ«ä¸€æ¡æ¶ˆæ¯æ˜¯äº‹åŠ¡æ¶ˆæ¯"><a href="#4-1-ä¸­é—´ä»¶å¦‚ä½•è¯†åˆ«ä¸€æ¡æ¶ˆæ¯æ˜¯äº‹åŠ¡æ¶ˆæ¯" class="headerlink" title="4.1 ä¸­é—´ä»¶å¦‚ä½•è¯†åˆ«ä¸€æ¡æ¶ˆæ¯æ˜¯äº‹åŠ¡æ¶ˆæ¯"></a>4.1 ä¸­é—´ä»¶å¦‚ä½•è¯†åˆ«ä¸€æ¡æ¶ˆæ¯æ˜¯äº‹åŠ¡æ¶ˆæ¯</h2><ol><li>Topicå‘½åçº¦å®š</li></ol><p>ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯é€šè¿‡Topicå‘½åæ¥åŒºåˆ†ã€‚ä¾‹å¦‚ï¼Œæ‰€æœ‰éœ€è¦æ”¯æŒå›æŸ¥çš„Topicå¯ä»¥éµå¾ªä¸€ä¸ªç‰¹å®šçš„å‘½åæ¨¡å¼ï¼Œå¦‚æ·»åŠ å‰ç¼€æˆ–åç¼€ï¼ˆä¾‹å¦‚ï¼Œ<code>replayable-myTopic</code>ï¼‰ã€‚è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯ç®€å•æ˜“å®æ–½ï¼Œä½†ç¼ºç‚¹æ˜¯çµæ´»æ€§è¾ƒä½ï¼Œä¸”å¯¹ç°æœ‰ç³»ç»Ÿå¯èƒ½éœ€è¦æ›´å¤šçš„æ”¹åŠ¨ã€‚</p><ol><li>ç‰¹å®šä¸»é¢˜æˆ–åˆ†åŒº</li></ol><p>å°†éœ€è¦å›æŸ¥çš„æ¶ˆæ¯å‘é€åˆ°Kafkaçš„ç‰¹å®šä¸»é¢˜æˆ–åˆ†åŒºä¸­ã€‚è¿™æ ·ï¼Œä¸­é—´ä»¶åªéœ€ç›‘å¬è¿™ä¸ªç‰¹å®šçš„ä¸»é¢˜æˆ–åˆ†åŒºæ¥å¤„ç†éœ€è¦å›æŸ¥çš„æ¶ˆæ¯ã€‚è¿™ç§æ–¹æ³•è¦æ±‚ç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶çŸ¥é“å“ªäº›æ¶ˆæ¯éœ€è¦å›æŸ¥ï¼Œå¹¶æ®æ­¤å‘é€åˆ°æ­£ç¡®çš„ä¸»é¢˜æˆ–åˆ†åŒºã€‚</p><ol><li>Topicé…ç½®å±æ€§</li></ol><p>Kafkaå…è®¸ä¸ºæ¯ä¸ªTopicè®¾ç½®è‡ªå®šä¹‰é…ç½®å±æ€§ã€‚å¯ä»¥å¼•å…¥ä¸€ä¸ªè‡ªå®šä¹‰å±æ€§ï¼ˆå¦‚<code>replayable=true</code>ï¼‰æ¥æ ‡è¯†ä¸€ä¸ªTopicéœ€è¦æ”¯æŒæ¶ˆæ¯å›æŸ¥ã€‚è¿™ç§æ–¹å¼æ¯”å‘½åçº¦å®šæ›´ä¸ºçµæ´»å’Œéšè”½ï¼Œä½†è¦æ±‚åº”ç”¨å±‚å’Œæ¶ˆæ¯ç”Ÿäº§è€…éµå¾ªè¿™ä¸€çº¦å®šï¼Œå¹¶ä¸”éœ€è¦åœ¨åº”ç”¨å±‚å®ç°é€»è¾‘æ¥å¤„ç†è¿™äº›å±æ€§ã€‚</p><ol><li>æ¶ˆæ¯å…ƒæ•°æ®æ ‡è®°</li></ol><p>åœ¨æ¶ˆæ¯å‘é€æ—¶ï¼Œå¯ä»¥åœ¨æ¶ˆæ¯çš„å…ƒæ•°æ®ï¼ˆMetadataï¼‰ä¸­æ·»åŠ ç‰¹å®šçš„æ ‡è®°æˆ–å­—æ®µæ¥æŒ‡ç¤ºè¿™æ¡æ¶ˆæ¯éœ€è¦è¿›è¡Œå›æŸ¥ã€‚</p><p>è®¾è®¡è€ƒè™‘ï¼š</p><ul><li><strong>æ€§èƒ½</strong>ï¼šç¡®å®šè¿™äº›æ–¹æ³•ä¸­å“ªä¸€ç§å¯¹ç”Ÿäº§å’Œæ¶ˆè´¹çš„æ€§èƒ½å½±å“æœ€å°ã€‚</li><li><strong>æ˜“ç”¨æ€§</strong>ï¼šé€‰æ‹©æ˜“äºå®æ–½å’Œç»´æŠ¤çš„æ–¹æ³•ã€‚</li><li><strong>çµæ´»æ€§</strong>ï¼šè¯„ä¼°æ˜¯å¦éœ€è¦å¯¹å•ä¸ªæ¶ˆæ¯è¿›è¡Œæ ‡è®°ï¼Œè¿˜æ˜¯ä»¥Topicä¸ºå•ä½è¿›è¡ŒåŒºåˆ†ã€‚</li></ul><h2 id="42-å¦‚ä½•è¯†åˆ«æ¶ˆæ¯ç±»å‹-è½¬å‘ä¿¡æ¯-å›æŸ¥ä¿¡æ¯"><a href="#4-2-å¦‚ä½•è¯†åˆ«æ¶ˆæ¯ç±»å‹ã€è½¬å‘ä¿¡æ¯ã€å›æŸ¥ä¿¡æ¯" class="headerlink" title="4.2 å¦‚ä½•è¯†åˆ«æ¶ˆæ¯ç±»å‹ã€è½¬å‘ä¿¡æ¯ã€å›æŸ¥ä¿¡æ¯"></a>4.2 å¦‚ä½•è¯†åˆ«æ¶ˆæ¯ç±»å‹ã€è½¬å‘ä¿¡æ¯ã€å›æŸ¥ä¿¡æ¯</h2><p>æ¶ˆæ¯ç±»å‹åŒ…æ‹¬ prepareã€commitã€rollback<br>è½¬å‘ä¿¡æ¯,éœ€è¦è½¬å‘è‡³çš„çœŸæ­£ä¸šåŠ¡tpoicã€ å¦‚æœéœ€è¦æŒ‡å®šåˆ†åŒºçš„è¯è¿˜åŒ…æ‹¬keyä¿¡æ¯<br>å›æŸ¥ä¿¡æ¯ï¼ŒåŒ…æ‹¬å›æŸ¥æ–¹å¼å¦‚HTTPã€RPC, å›æŸ¥åœ°å€ï¼Œå›æŸ¥æ¥å£ç­‰</p><ol><li>ä½¿ç”¨Kafkaæ¶ˆæ¯å¤´</li></ol><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>ä¿æŒäº†æ¶ˆæ¯ä½“çš„çº¯å‡€å’Œç‹¬ç«‹æ€§ã€‚</li><li>çµæ´»æ€§é«˜ï¼Œæ˜“äºæ·»åŠ æˆ–ä¿®æ”¹é¢å¤–çš„æ§åˆ¶ä¿¡æ¯å’Œå…ƒæ•°æ®ã€‚</li><li>æ€§èƒ½è€ƒè™‘ï¼Œå¯¹äºå°åˆ°ä¸­ç­‰å¤§å°çš„æ¶ˆæ¯ï¼Œä½¿ç”¨æ¶ˆæ¯å¤´çš„æ€§èƒ½å¼€é”€ç›¸å¯¹è¾ƒå°<br><strong>ç¼ºç‚¹</strong>ï¼š</li><li>æ–°ç‰ˆæœ¬ä¾èµ–ï¼šè¾ƒæ—§ç‰ˆæœ¬çš„Kafkaå®¢æˆ·ç«¯å¯èƒ½ä¸æ”¯æŒæ¶ˆæ¯å¤´åŠŸèƒ½ï¼Œè¿™è¦æ±‚ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä½¿ç”¨æ”¯æŒæ¶ˆæ¯å¤´çš„Kafkaç‰ˆæœ¬ã€‚</li><li><strong>é¢å¤–å¤„ç†</strong>ï¼šæ¶ˆè´¹è€…éœ€è¦é¢å¤–çš„æ­¥éª¤æ¥è¯»å–å’Œè§£ææ¶ˆæ¯å¤´ã€‚</li></ul><ol><li>é¢„å…ˆå®šä¹‰æ¶ˆæ¯æ ¼å¼</li></ol><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>ç›´æ¥ä¸”ç®€å•ï¼Œæ˜“äºå®ç°ã€‚</li><li>ä¸ä¾èµ–Kafkaç‰¹å®šçš„åŠŸèƒ½ï¼Œå…·æœ‰è¾ƒå¥½çš„å…¼å®¹æ€§ã€‚<br><strong>ç¼ºç‚¹</strong>ï¼š</li><li>å¢åŠ äº†æ¶ˆæ¯ä½“çš„å¤§å°ã€‚</li><li>éœ€è¦åœ¨æ¶ˆè´¹ç«¯è¿›è¡Œæ¶ˆæ¯è§£æï¼Œç•¥å¾®å¢åŠ äº†å¤„ç†çš„å¤æ‚æ€§ã€‚</li></ul><p>æœ¬é¡¹ç›®ä»¥æŒ‡å®štopic+é¢„å®šä¹‰æ¶ˆæ¯æ ¼å¼çš„æ–¹å¼ç®€å•å®ç°äº†æ¶ˆæ¯çš„æäº¤ï¼Œæ¶ˆæ¯æ ¼å¼å¦‚ä¸‹ï¼Œ å¤§å®¶å¯ä»¥å‚è€ƒã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">package com.example.trustmessage.middlewareapi.common;</span><br><span class="line">public class MiddlewareMessage &#123;  </span><br><span class="line">  </span><br><span class="line">// è¦ç»™åˆ°ä¸šåŠ¡æ–¹çš„çœŸæ­£æ¶ˆæ¯  </span><br><span class="line">private String message;  </span><br><span class="line"></span><br><span class="line">private int bizID; </span><br><span class="line">  </span><br><span class="line">// ç”¨äºæ¶ˆæ¯å›æŸ¥çš„ä¸šåŠ¡å”¯ä¸€æ ‡è¯†  </span><br><span class="line">private String messageKey;  </span><br><span class="line"> </span><br><span class="line">private int messageStatus;  </span><br><span class="line">  </span><br><span class="line">private String forwardTopic;  </span><br><span class="line">  </span><br><span class="line">// å‘ä¸šåŠ¡æ–¹è½¬å‘æ—¶éœ€è¦æŒ‡å®šçš„keyï¼Œæ²¡æœ‰åˆ™è¯´æ˜æŒ‰ç…§kafka é»˜è®¤åˆ†åŒºç­–ç•¥è¿›è¡Œåˆ†åŒº  </span><br><span class="line">private String forwardKey;  </span><br><span class="line">  </span><br><span class="line">private VerifyInfo verifyInfo;  </span><br><span class="line">   </span><br><span class="line">public static class VerifyInfo &#123;  </span><br><span class="line">private int protocolType; // 1-http, 2-rpc-dubbo  </span><br><span class="line">private String registryProtocol;  </span><br><span class="line">private String registryAddress;  </span><br><span class="line">private String url;  </span><br><span class="line">private String version;   </span><br><span class="line">&#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="5-åŸºäºrpcæ¥å£-vs-åŸºäºkafkaæäº¤"><a href="#5-åŸºäºRPCæ¥å£-vs-åŸºäºKafkaæäº¤" class="headerlink" title="5. åŸºäºRPCæ¥å£ vs åŸºäºKafkaæäº¤"></a>5. åŸºäºRPCæ¥å£ vs åŸºäºKafkaæäº¤</h1><p>åŸºäºä¸¤ç§ä¸åŒæ¶ˆæ¯æäº¤æ–¹å¼å®ç°çš„ä¸­é—´ä»¶ï¼Œ å°†ä»ä»¥ä¸‹ä¸¤æ–¹é¢è¿›è¡Œæ¯”è¾ƒ</p><ol><li>æ¶ˆæ¯çš„é¡ºåºæ€§</li><li>æµé‡å¢åŠ åæ‰©å®¹</li></ol><h2 id="51-æ¶ˆæ¯çš„é¡ºåºæ€§"><a href="#5-1-æ¶ˆæ¯çš„é¡ºåºæ€§" class="headerlink" title="5.1 æ¶ˆæ¯çš„é¡ºåºæ€§"></a>5.1 æ¶ˆæ¯çš„é¡ºåºæ€§</h2><p>ä½¿ç”¨ä¸­é—´ä»¶å›æŸ¥æœºåˆ¶ï¼Œç”±äºç½‘ç»œåŸå› ï¼Œæœ‰å¯èƒ½å‡ºç° æŸæ¡ä¸šåŠ¡çš„commit or rollback æ¶ˆæ¯æ¯”prepare å…ˆåˆ°è¾¾ä¸­é—´ä»¶ï¼Œé¢å¯¹è¿™ç§æƒ…å†µ,commit or rollbackçš„å¤„ç†é€»è¾‘æ˜¯éœ€è¦æŠ¥é”™çš„ï¼Œclient åªèƒ½é‡è¯•æˆ–è€…ç­‰å¾…å›æŸ¥æœºåˆ¶æ›´æ–°æ¶ˆæ¯çŠ¶æ€</p><p>ä½†æ˜¯ç”±äºkafka å¯ä»¥åœ¨ä¸€ä¸ªåˆ†åŒºå†…çš„ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§ï¼Œæ‰€ä»¥åŸºäºKafkaæäº¤çš„æ–¹æ¡ˆå¯ä»¥æœ‰ä¸€ç§ä¼˜é›…çš„æ–¹å¼ä¿è¯prepareæ¶ˆæ¯å’Œcommit/rollback æ¶ˆæ¯çš„æœ‰åºæ€§ã€‚</p><p>è§£å†³æ–¹æ¡ˆå¾ˆç®€å•ï¼Œç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æŒ‰ç…§ä¸šåŠ¡ å”¯ä¸€æ ‡è¯†æŒ‡å®škey ,å³æŒ‡å®šç›®æ ‡åˆ†åŒºå³å¯ã€‚</p><h2 id="52-æµé‡å¢åŠ åæ‰©å®¹"><a href="#5-2-æµé‡å¢åŠ åæ‰©å®¹" class="headerlink" title="5.2 æµé‡å¢åŠ åæ‰©å®¹"></a>5.2 æµé‡å¢åŠ åæ‰©å®¹</h2><p>ä»¥ä¸‹æ¯”è¾ƒåŸºäºåœ¨ä»£ç å±‚é¢å·²ç»åšå¥½åˆ†åº“åˆ†è¡¨ã€å¼‚æ­¥å¤„ç†ã€æ‰¹é‡å¤„ç†ã€cache ç­‰æ€§èƒ½ä¼˜åŒ–çš„åŸºç¡€ä¸Š</p><p>å‡è®¾å·²ç»åˆ†åº“åˆ†è¡¨ï¼Œæ•°æ®åº“å¤„ç†ä¸æ˜¯ç“¶é¢ˆ<br>ä¸‡ä¸€æµé‡æ¿€å¢ï¼ŒåŸºäºKafkaæäº¤çš„æ–¹æ¡ˆ å¯èƒ½ä¼šäº§ç”Ÿäº§ç”Ÿå¿…é¡»è¦å¤„ç†çš„æ¶ˆæ¯ç§¯å‹ï¼Œé’ˆå¯¹æ¶ˆæ¯ç§¯å‹å¸¸è§çš„è§£å†³æ–¹æ¡ˆä¸­</p><ol><li>å¢åŠ æ¶ˆè´¹è€…æ•°é‡ï¼Œä¸è¿‡ä¸€èˆ¬æ¥è®²ï¼Œçº¿ä¸Šç”Ÿäº§ç¯å¢ƒéƒ½ä¼šå·²ç»æŠŠæ¶ˆè´¹è€…æ•°é‡å’Œåˆ†åŒºæ•°é‡è®¾ç½®æˆä¸€æ ·çš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ¡ˆæ— æ³•å‘æŒ¥åŠŸèƒ½</li><li>å¢åŠ åˆ†åŒºæ•°é‡ï¼Œå‡è®¾å…¬å¸çš„å·¥ä½œæµç¨‹é‡Œå…è®¸å¢åŠ ï¼Œå¦‚æœä½¿ç”¨åœºæ™¯å¯¹æ¶ˆæ¯é¡ºåºæ€§æœ‰è¦æ±‚ï¼Œä½ åˆè¦è€ƒè™‘æ–°å¢åˆ†åŒºåå¯¹æ¶ˆæ¯é¡ºåºæ€§çš„å½±å“</li><li>æ–°å»ºä¸€ä¸ªæ›´å¤šåˆ†åŒºçš„topic, æ¶‰åŠåˆ°ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…çš„ä»£ç å˜æ›´</li><li>æ¶ˆè´¹è€…æ€§èƒ½ä¼˜åŒ–ï¼Œ æ¯”å¦‚å¼‚æ­¥å¤„ç†ã€æ‰¹é‡å¤„ç†ï¼Œ ä½†æ˜¯å¦‚æœé¡¹ç›®å·²ç»åšå¥½è¿™äº›æªæ–½ï¼Œé¢å¯¹æ¶ˆæ¯ç§¯å‹ï¼Œåªèƒ½å›åˆ°ä¸‹é¢3ç§æ–¹å¼</li></ol><p>ç»¼åˆä»¥ä¸Šï¼Œæˆ‘ä¸ªäººè®¤ä¸ºåŸºäºRPCæ¥å£çš„æ–¹æ¡ˆå¯ä»¥ç”¨<code>è‡ªåŠ¨æ‰©å®¹ç­–ç•¥</code>ç›´æ¥åº”å¯¹ï¼Œ ç®€å•ç›´æ¥ä¼˜é›…ã€‚</p><h1 id="6-ä½œä¸ºä¸­é—´ä»¶çš„æŠ€æœ¯è®¾è®¡"><a href="#6-ä½œä¸ºä¸­é—´ä»¶çš„æŠ€æœ¯è®¾è®¡" class="headerlink" title="6. ä½œä¸ºä¸­é—´ä»¶çš„æŠ€æœ¯è®¾è®¡"></a>6. ä½œä¸ºä¸­é—´ä»¶çš„æŠ€æœ¯è®¾è®¡</h1><h2 id="61-æ€§èƒ½æå‡"><a href="#6-1-æ€§èƒ½æå‡" class="headerlink" title="6.1 æ€§èƒ½æå‡"></a>6.1 æ€§èƒ½æå‡</h2><ol><li>çº¿ç¨‹æ± å¼‚æ­¥å¤„ç†</li><li>cache å­˜å‚¨å›æŸ¥æ¥å£</li><li>åŸºäºbizID + messageKey çš„åˆ†åº“åˆ†è¡¨</li></ol><h2 id="62-å¹‚ç­‰æ€§"><a href="#6-2-å¹‚ç­‰æ€§" class="headerlink" title="6.2 å¹‚ç­‰æ€§"></a>6.2 å¹‚ç­‰æ€§</h2><ol><li>prepare æ¶ˆæ¯çš„å¹‚ç­‰æ€§ï¼Œ å”¯ä¸€ç´¢å¼•</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0-é¡¹ç›®ç»“æ„ä»‹ç»&quot;&gt;&lt;a href=&quot;#0-é¡¹ç›®ç»“æ„ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;0. é¡¹ç›®ç»“æ„ä»‹ç»&quot;&gt;&lt;/a&gt;0. é¡¹ç›®ç»“æ„ä»‹ç»&lt;/h1&gt;&lt;div class=&quot;table-container&quot;&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;</summary>
      
    
    
    
    
    <category term="äº‹åŠ¡" scheme="http://example.com/tags/%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥è§£æbloom filterçš„åŸç†ä¸å®ç°</title>
    <link href="http://example.com/b4fa673f/"/>
    <id>http://example.com/b4fa673f/</id>
    <published>2024-03-31T08:16:17.000Z</published>
    <updated>2024-05-02T01:35:18.938Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šç”¨åˆ°bloom-filter"><a href="#0-ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šç”¨åˆ°bloom-filter" class="headerlink" title="0.ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šç”¨åˆ°bloom filter"></a>0.ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šç”¨åˆ°bloom filter</h1><ol><li>ç¼“å­˜ç©¿é€</li><li>çˆ¬è™«é‡å¤ URL æ£€æµ‹ï¼Œ é¿å…çˆ¬è™«è¿‡ç¨‹å½¢æˆç¯</li><li>å‡è®¾æœ‰ 10 äº¿æ¡æ‰‹æœºå·ï¼Œç„¶ååˆ¤æ–­æŸæ¡æ‰‹æœºå·æ˜¯å¦åœ¨åˆ—è¡¨å†…</li><li><a href="https://redis.com/blog/redis-redisbloom-bloom-filters/?_ga=2.218233113.1633975579.1711521515-926213951.1711521515&amp;_gl=1*538r6b*_ga*OTI2MjEzOTUxLjE3MTE1MjE1MTU.*_ga_8BKGRQKRPV*MTcxMTU4OTkzMi4zLjEuMTcxMTU5MzQyMy41NS4wLjA.*_gcl_au*OTkyMjAyNDAyLjE3MTE1MjE1MTQ">å”¯ä¸€æ˜µç§°åˆ¤æ–­ </a></li></ol><p>è¿™äº›åœºæ™¯å¯ä»¥ç”¨ä»€ä¹ˆæ–¹å¼è§£å†³</p><ol><li>hashmap, hashset</li><li>MySQLï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæ•°æ®é‡ä¸å¤§ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨ mysql å­˜å‚¨ã€‚å°†æ‰€æœ‰æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œç„¶åæ¯æ¬¡å»åº“é‡ŒæŸ¥è¯¢åˆ¤æ–­æ˜¯å¦å­˜åœ¨ã€‚ä½†æ˜¯å¦‚æœæ•°æ®é‡å¤ªå¤§ï¼Œè¶…è¿‡åƒä¸‡ï¼Œmysql æŸ¥è¯¢æ•ˆç‡æ˜¯å¾ˆä½çš„ï¼Œç‰¹åˆ«æ¶ˆè€—æ€§èƒ½ã€‚</li><li>bitmap</li><li>bloom filter</li></ol><h1 id="1bloom-filter-æ˜¯ä»€ä¹ˆ"><a href="#1-bloom-filter-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.bloom filter æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.bloom filter æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§æ¦‚ç‡æ€§æ•°æ®ç»“æ„ï¼Œå®ƒæä¾›äº†ä¸€ç§ç©ºé—´æ•ˆç‡æé«˜çš„æ–¹æ³•æ¥æµ‹è¯•ä¸€ä¸ªå…ƒç´ æ˜¯å¦å±äºä¸€ä¸ªé›†åˆã€‚</p><p>å…¶åŸºæœ¬åŸç†æ˜¯ä½¿ç”¨å¤šä¸ªä¸åŒçš„å“ˆå¸Œå‡½æ•°å¯¹å…ƒç´ è¿›è¡Œå“ˆå¸Œï¼Œç„¶åå°†å¾—åˆ°çš„å“ˆå¸Œå€¼å¯¹åº”åˆ°ä½æ•°ç»„ä¸Šã€‚ä¸€ä¸ªå…ƒç´ è¢«åŠ å…¥åˆ°é›†åˆä¸­ï¼Œé‚£ä¹ˆæ‰€æœ‰å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºçš„ä½ç½®éƒ½ä¼šè¢«ç½®ä¸º1ã€‚æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­æ—¶ï¼Œä½¿ç”¨è¿™äº›å“ˆå¸Œå‡½æ•°è®¡ç®—å“ˆå¸Œå€¼ï¼Œå¹¶æ£€æŸ¥å¯¹åº”çš„ä½æ˜¯å¦éƒ½æ˜¯1ã€‚å¦‚æœéƒ½æ˜¯1ï¼Œé‚£ä¹ˆå…ƒç´ å¯èƒ½å­˜åœ¨äºé›†åˆä¸­ï¼›å¦‚æœä»»ä½•ä¸€ä¸ªä½ä¸æ˜¯1ï¼Œé‚£ä¹ˆå…ƒç´ è‚¯å®šä¸åœ¨é›†åˆä¸­ã€‚</p><p>å…¶ä¸»è¦ç‰¹ç‚¹æ˜¯ï¼š</p><ul><li><strong>é«˜ç©ºé—´æ•ˆç‡</strong>ï¼šç›¸æ¯”äºä¼ ç»Ÿçš„é›†åˆæ•°æ®ç»“æ„ï¼Œå¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨æå°‘çš„ç©ºé—´æ¥å¤„ç†å¤§é‡æ•°æ®ã€‚</li><li><strong>è¯¯æŠ¥ç‡/å‡é˜³</strong>ï¼šå¸ƒéš†è¿‡æ»¤å™¨æœ‰ä¸€å®šçš„è¯¯æŠ¥æ¦‚ç‡ï¼Œè¿™æ„å‘³ç€å®ƒå¯èƒ½ä¼šé”™è¯¯åœ°è®¤ä¸ºæŸä¸ªä¸åœ¨é›†åˆä¸­çš„å…ƒç´ å­˜åœ¨äºé›†åˆä¸­ã€‚</li><li><strong>é›¶æ¼æŠ¥ç‡</strong>ï¼šä¸ä¼šé—æ¼é›†åˆä¸­çœŸæ­£å­˜åœ¨çš„å…ƒç´ </li><li><strong>ä¸å¯åˆ é™¤</strong>ï¼šæ ‡å‡†çš„å¸ƒéš†è¿‡æ»¤å™¨ä¸æ”¯æŒä»é›†åˆä¸­åˆ é™¤å…ƒç´ ï¼Œå°½ç®¡å­˜åœ¨å˜ç§ï¼ˆå¦‚è®¡æ•°å¸ƒéš†è¿‡æ»¤å™¨ï¼‰æ”¯æŒè¿™ä¸€æ“ä½œã€‚</li><li><strong>å¤šå“ˆå¸Œå‡½æ•°</strong>ï¼šå¸ƒéš†è¿‡æ»¤å™¨é€šè¿‡å¤šä¸ªå“ˆå¸Œå‡½æ•°æ¥å‡å°‘è¯¯æŠ¥ç‡ï¼Œæ¯ä¸ªå…ƒç´ è¢«å¤šä¸ªå“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°ä½æ•°ç»„çš„å¤šä¸ªä½ç½®ã€‚</li></ul><h2 id="11-ä¸ºä»€ä¹ˆç©ºé—´æ•ˆç‡é«˜"><a href="#1-1-ä¸ºä»€ä¹ˆç©ºé—´æ•ˆç‡é«˜" class="headerlink" title="1.1 ä¸ºä»€ä¹ˆç©ºé—´æ•ˆç‡é«˜"></a>1.1 ä¸ºä»€ä¹ˆç©ºé—´æ•ˆç‡é«˜</h2><p>bloom filter é‡‡ç”¨ ä½æ•°ç»„ï¼ˆbit arrayï¼‰ä½œä¸ºæ ¸å¿ƒçš„æ•°æ®ç»“æ„ã€‚</p><p>ä½æ•°ç»„æ˜¯ä¸€ä¸ªéå¸¸ç´§å‡‘çš„æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥æœ‰æ•ˆåœ°è¡¨ç¤ºå¤§é‡çš„å¸ƒå°”å€¼ï¼ˆtrueæˆ–falseï¼‰ï¼Œæ¯ä¸ªå€¼åªå ç”¨ä¸€ä¸ªä½ï¼ˆbitï¼‰ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ›´ä¼ ç»Ÿçš„æ•°æ®ç±»å‹ä¼šå ç”¨æ›´å¤šçš„ç©ºé—´ã€‚</p><p>æ¯”å¦‚åœ¨çˆ¬è™«åœºæ™¯ä¸­ï¼Œå‡è®¾æœ‰1äº¿ä¸ªURLï¼Œæ¯ä¸ªURLç®—4å­—èŠ‚, å¦‚æœç”¨hashmap å®ç°ï¼Œä¸€ä¸ªURLæ‰€å ç©ºé—´è‡³å°‘4bytes;å¦‚æœç”¨ä½æ•°ç»„å®ç°ï¼Œæ¯ä¸ªURL æ‰€å çš„ç©ºé—´ä»…1bitï¼Œç©ºé—´æ•ˆç‡æå‡äº†32å€ï¼ˆå­˜å‚¨ç©ºé—´ä¸è€ƒè™‘è¯¯åˆ¤ç‡çš„å‰æä¸‹ï¼‰ã€‚ä¸å¯è°“ä¸é«˜æ•ˆã€‚</p><h2 id="12-ä¸ºä»€ä¹ˆä¼šæœ‰è¯¯æŠ¥ç‡å‡é˜³"><a href="#1-2-ä¸ºä»€ä¹ˆä¼šæœ‰è¯¯æŠ¥ç‡-å‡é˜³" class="headerlink" title="1.2 ä¸ºä»€ä¹ˆä¼šæœ‰è¯¯æŠ¥ç‡/å‡é˜³"></a>1.2 ä¸ºä»€ä¹ˆä¼šæœ‰è¯¯æŠ¥ç‡/å‡é˜³</h2><p>æ—¢ç„¶ç”¨åˆ°äº†å“ˆå¸Œå‡½æ•°ï¼Œè‚¯å®šä¼šé‡åˆ°å“ˆå¸Œå†²çªã€‚æ‰€ä»¥ä¸€ä¸ªå…ƒç´ å¯¹åº” çš„n  ä¸ªä½ç½®ï¼Œ å¯èƒ½å› ä¸ºå…¶ä»–å…ƒç´ çš„å“ˆå¸Œå†²çª è€Œå¯¼è‡´åˆ¤æ–­æ—¶å‘ç°ç­‰äº1ï¼Œ ä»è€Œäº§ç”Ÿå‡é˜³ç°è±¡ã€‚</p><h2 id="13-è¯¯æŠ¥å¦‚ä½•è§£å†³"><a href="#1-3-è¯¯æŠ¥å¦‚ä½•è§£å†³" class="headerlink" title="1.3 è¯¯æŠ¥å¦‚ä½•è§£å†³"></a>1.3 è¯¯æŠ¥å¦‚ä½•è§£å†³</h2><p>å‡é˜³é—®é¢˜æ— æ³•è¢«é¿å…ï¼Œåªèƒ½å°½å¯èƒ½å‡å°‘ã€‚ å‡å°‘çš„é€”å¾„æ˜¯é€‰æ‹©åˆé€‚çš„å“ˆå¸Œå‡½æ•°ä»¥åŠæŒ‡å®šåˆé€‚çš„ç©ºé—´å¤§å°</p><h2 id="14-ä¸ºä»€ä¹ˆéœ€è¦å¤šä¸ªå“ˆå¸Œå‡½æ•°"><a href="#1-4-ä¸ºä»€ä¹ˆéœ€è¦å¤šä¸ªå“ˆå¸Œå‡½æ•°" class="headerlink" title="1.4 ä¸ºä»€ä¹ˆéœ€è¦å¤šä¸ªå“ˆå¸Œå‡½æ•°"></a>1.4 ä¸ºä»€ä¹ˆéœ€è¦å¤šä¸ªå“ˆå¸Œå‡½æ•°</h2><p>å¸ƒéš†è¿‡æ»¤å™¨çš„è®¾è®¡ä½¿ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°æ¥è§£å†³å•ä¸ªå“ˆå¸Œå‡½æ•°å¯èƒ½å¸¦æ¥çš„å±€é™æ€§ï¼Œæé«˜å…¶æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚å…·ä½“æ¥è¯´ï¼Œä½¿ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°çš„åŸå› åŒ…æ‹¬ï¼š</p><ul><li><p>é™ä½è¯¯æŠ¥ç‡</p><p>é€šè¿‡ä½¿ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°ç‹¬ç«‹åœ°æ˜ å°„æ¯ä¸ªå…ƒç´ åˆ°ä½æ•°ç»„ä¸­çš„å¤šä¸ªä½ç½®ï¼Œå¹¶åœ¨æ‰€æœ‰è¿™äº›ä½ç½®ä¸Šæ ‡è®°ä¸º1ï¼Œå¯ä»¥æ˜¾è‘—é™ä½ä¸åŒå…ƒç´ æ˜ å°„åˆ°ç›¸åŒä½ç½®ï¼ˆå³äº§ç”Ÿå†²çªï¼‰çš„æ¦‚ç‡ï¼Œä»è€Œé™ä½è¯¯æŠ¥ç‡</p></li><li><p>å‡åŒ€åˆ†å¸ƒ</p><p>å¤šä¸ªå“ˆå¸Œå‡½æ•°å¯ä»¥å°†å…ƒç´ æ›´å‡åŒ€åœ°åˆ†å¸ƒåœ¨ä½æ•°ç»„ä¸Šï¼Œå‡å°‘äº†é›†ä¸­å†²çªçš„å¯èƒ½æ€§ã€‚å¦‚æœåªä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œå³ä½¿å…¶åˆ†å¸ƒæ€§è´¨è‰¯å¥½ï¼Œä¹Ÿéš¾ä»¥ä¿è¯å¯¹äºæ‰€æœ‰å¯èƒ½çš„è¾“å…¥é›†åˆéƒ½èƒ½ä¿æŒè‰¯å¥½çš„å‡åŒ€æ€§ã€‚å¤šä¸ªå“ˆå¸Œå‡½æ•°çš„ç»„åˆï¼Œå¦‚æœè®¾è®¡å¾—å½“ï¼Œå¯ä»¥ç›¸äº’è¡¥å¿ï¼Œå®ç°æ›´ä¸ºå‡åŒ€çš„åˆ†å¸ƒã€‚</p></li></ul><h2 id="15-ä¸ºä»€ä¹ˆæ•°æ®ä¸å¯åˆ é™¤"><a href="#1-5-ä¸ºä»€ä¹ˆæ•°æ®ä¸å¯åˆ é™¤" class="headerlink" title="1.5 ä¸ºä»€ä¹ˆæ•°æ®ä¸å¯åˆ é™¤"></a>1.5 ä¸ºä»€ä¹ˆæ•°æ®ä¸å¯åˆ é™¤</h2><p>åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå…ƒç´ çš„å­˜åœ¨æ˜¯é€šè¿‡å¤šä¸ªä½çš„â€œ1â€çŠ¶æ€æ¥è¡¨ç¤ºçš„ï¼Œè€Œå°†è¿™äº›ä½é‡ç½®ä¸ºâ€œ0â€å¯èƒ½ä¼šé”™è¯¯åœ°å½±å“å…¶ä»–å…ƒç´ çš„å­˜åœ¨æ£€æµ‹ã€‚</p><p>å¦‚æœéœ€è¦æ”¯æŒåˆ é™¤ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ å˜ä½“Bloom Filterï¼Œ å¦‚cuckoo filter</p><h1 id="2-bitmap-å’Œ-bloom-filter-çš„åŒºåˆ«"><a href="#2-bitmap-å’Œ-bloom-filter-çš„åŒºåˆ«" class="headerlink" title="2. bitmap å’Œ bloom filter çš„åŒºåˆ«"></a>2. bitmap å’Œ bloom filter çš„åŒºåˆ«</h1><p>Bitmapï¼ˆä½å›¾ï¼‰å’Œå¸ƒéš†è¿‡æ»¤å™¨éƒ½æ˜¯ä½¿ç”¨ç©ºé—´æ•ˆç‡é«˜çš„æ•°æ®ç»“æ„ï¼Œå®ƒä»¬é€šè¿‡åˆ©ç”¨ä½æ“ä½œæ¥å®ç°å­˜å‚¨å’ŒæŸ¥è¯¢ï¼Œä½†å®ƒä»¬çš„è®¾è®¡ç›®çš„å’Œåº”ç”¨åœºæ™¯æœ‰æ‰€ä¸åŒã€‚</p><h2 id="21-bitmapä½å›¾"><a href="#2-1-Bitmapï¼ˆä½å›¾ï¼‰" class="headerlink" title="2.1 Bitmapï¼ˆä½å›¾ï¼‰"></a>2.1 Bitmapï¼ˆä½å›¾ï¼‰</h2><p>ä½å›¾æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œç”¨äºé«˜æ•ˆåœ°å­˜å‚¨å’ŒæŸ¥è¯¢çŠ¶æ€ä¿¡æ¯ã€‚åœ¨ä½å›¾ä¸­ï¼Œæ¯ä¸ªå…ƒç´ çš„å­˜åœ¨æˆ–çŠ¶æ€æ˜¯ç”±å•ç‹¬çš„ä½æ¥è¡¨ç¤ºçš„ï¼Œå³ä½¿ç”¨1ä½äºŒè¿›åˆ¶æ•°ï¼ˆ0æˆ–1ï¼‰æ¥è¡¨ç¤ºæ¯ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨æˆ–æŸç§ç‰¹å®šçŠ¶æ€ã€‚</p><p><strong>ä¸»è¦ç‰¹ç‚¹å’Œç”¨é€”</strong>ï¼š</p><ul><li><strong>ç®€å•ç›´æ¥</strong>ï¼šé€‚ç”¨äºéœ€è¦è¿½è¸ªå¤§é‡å…ƒç´ ï¼ˆå¦‚æ•´æ•°ï¼‰å­˜åœ¨ä¸å¦çš„åœºæ™¯ã€‚</li><li><strong>ç©ºé—´æ•ˆç‡</strong>ï¼šå¯¹äºå¤§è§„æ¨¡æ•°æ®é›†ï¼Œä½å›¾ä½¿ç”¨çš„ç©ºé—´è¿œå°äºä¼ ç»Ÿçš„æ•°æ®ç»“æ„ï¼ˆå¦‚æ•°ç»„æˆ–åˆ—è¡¨ï¼‰ã€‚</li><li><strong>éšæœºè®¿é—®</strong>ï¼šå¯ä»¥éå¸¸å¿«é€Ÿåœ°æ£€æŸ¥ä»»ä½•ä¸€ä¸ªå…ƒç´ çš„å­˜åœ¨ä¸å¦æˆ–çŠ¶æ€ã€‚</li><li><p><strong>å›ºå®šå¤§å°</strong>ï¼šä½å›¾çš„å¤§å°åœ¨åˆ›å»ºæ—¶ç”±æœ€å¤§å…ƒç´ å€¼å†³å®šï¼Œå› æ­¤å…¶ç©ºé—´æ•ˆç‡ä¾èµ–äºæ•°æ®çš„åˆ†å¸ƒã€‚</p></li><li><p><strong>BitMap çš„å®ç°</strong><br>java BitSet<br>redis setbitã€getbit</p></li></ul><h2 id="22-åŒºåˆ«"><a href="#2-2-åŒºåˆ«" class="headerlink" title="2.2 åŒºåˆ«"></a>2.2 åŒºåˆ«</h2><ul><li><strong>ç”¨é€”</strong>ï¼šä½å›¾ä¸»è¦ç”¨äºç²¾ç¡®è¡¨ç¤ºä¸€ä¸ªå¤§å‹æ•°æ®é›†ä¸­å…ƒç´ çš„å­˜åœ¨ä¸å¦æˆ–çŠ¶æ€ä¿¡æ¯ï¼Œè€Œå¸ƒéš†è¿‡æ»¤å™¨ç”¨äºä»¥æå°çš„ç©ºé—´æˆæœ¬åˆ¤æ–­å…ƒç´ æ˜¯å¦å¯èƒ½å­˜åœ¨äºé›†åˆä¸­ã€‚</li><li><strong>é”™è¯¯ç‡</strong>ï¼šä½å›¾æä¾›äº†100%å‡†ç¡®çš„ç»“æœï¼ˆå‡è®¾è¶³å¤Ÿçš„ç©ºé—´æ¥è¡¨ç¤ºæ‰€æœ‰å…ƒç´ ï¼‰ï¼Œè€Œå¸ƒéš†è¿‡æ»¤å™¨å…è®¸ä¸€å®šçš„è¯¯æŠ¥ç‡ã€‚</li><li><strong>æ“ä½œ</strong>ï¼šä½å›¾æ”¯æŒæ·»åŠ ã€æŸ¥è¯¢å’Œåˆ é™¤ï¼ˆé€šè¿‡ä½åè½¬ï¼‰æ“ä½œï¼Œè€Œæ ‡å‡†å¸ƒéš†è¿‡æ»¤å™¨ä¸æ”¯æŒåˆ é™¤æ“ä½œã€‚</li><li><strong>ç©ºé—´æ•ˆç‡ä¸æ•°æ®è§„æ¨¡</strong>ï¼šå¸ƒéš†è¿‡æ»¤å™¨åœ¨è¡¨ç¤ºå¤§å‹é›†åˆæˆå‘˜èµ„æ ¼æ—¶é€šå¸¸æ¯”ä½å›¾æ›´åŠ ç©ºé—´æ•ˆç‡ï¼Œå°¤å…¶æ˜¯å½“å…ƒç´ èŒƒå›´éå¸¸å¤§ä½†å®é™…å…ƒç´ æ•°é‡ç›¸å¯¹è¾ƒå°‘æ—¶ã€‚</li></ul><p>æ€»ä¹‹ï¼Œä½å›¾å’Œå¸ƒéš†è¿‡æ»¤å™¨å„æœ‰ä¼˜åŠ¿å’Œåº”ç”¨åœºæ™¯ï¼Œé€‰æ‹©å“ªç§æ•°æ®ç»“æ„å–å†³äºå…·ä½“éœ€æ±‚ï¼ŒåŒ…æ‹¬å¯¹ç©ºé—´æ•ˆç‡ã€å‡†ç¡®ç‡å’Œæ“ä½œç±»å‹çš„è¦æ±‚ã€‚</p><h1 id="3-å•æœºç‰ˆæœ¬guava-cache-æºç è§£æ"><a href="#3-å•æœºç‰ˆæœ¬Guava-Cache-æºç è§£æ" class="headerlink" title="3. å•æœºç‰ˆæœ¬Guava Cache æºç è§£æ"></a>3. å•æœºç‰ˆæœ¬Guava Cache æºç è§£æ</h1><h2 id="31-create"><a href="#3-1-create" class="headerlink" title="3.1 create"></a>3.1 create</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; BloomFilter&lt;T&gt; <span class="title function_">create</span><span class="params">(Funnel&lt;T&gt; funnel, <span class="type">int</span> expectedInsertions <span class="comment">/* n */</span>,  </span></span><br><span class="line"><span class="params">    <span class="type">double</span> falsePositiveProbability)</span> &#123;  </span><br><span class="line">    <span class="type">int</span> <span class="variable">numBits</span> <span class="operator">=</span> optimalNumOfBits(expectedInsertions, falsePositiveProbability);  </span><br><span class="line">    <span class="type">int</span> <span class="variable">numHashFunctions</span> <span class="operator">=</span> optimalNumOfHashFunctions(expectedInsertions, numBits);  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BloomFilter</span>&lt;T&gt;(<span class="keyword">new</span> <span class="title class_">BitArray</span>(numBits), numHashFunctions, funnel,  </span><br><span class="line">BloomFilterStrategies.MURMUR128_MITZ_32);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="311-å‚æ•°è§£é‡Š"><a href="#3-1-1-å‚æ•°è§£é‡Š" class="headerlink" title="3.1.1 å‚æ•°è§£é‡Š"></a>3.1.1 å‚æ•°è§£é‡Š</h3><ul><li><p><strong><code>funnel</code></strong>ï¼š<code>Funnel</code>ç±»å‹çš„å‚æ•°ï¼Œç”¨äºå°†ä»»æ„ç±»å‹çš„æ•°æ®è½¬åŒ–æˆå¸ƒéš†è¿‡æ»¤å™¨å†…éƒ¨ä½¿ç”¨çš„ä¸€ç§å½¢å¼ã€‚<code>Funnel</code>å®šä¹‰äº†å¦‚ä½•æŠŠå¯¹è±¡è½¬æ¢æˆäºŒè¿›åˆ¶æµï¼Œç„¶åå¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨è¿™ä¸ªäºŒè¿›åˆ¶æµæ¥è®¡ç®—å…ƒç´ çš„å“ˆå¸Œå€¼ã€‚</p></li><li><p><strong><code>expectedInsertions</code></strong>ï¼šè¿™ä¸ªå‚æ•°æŒ‡å®šäº†é¢„æœŸè¦æ’å…¥å¸ƒéš†è¿‡æ»¤å™¨çš„å…ƒç´ æ•°é‡ã€‚è¿™ä¸ªæ•°å€¼æ˜¯ä¸ºäº†ä¼˜åŒ–å¸ƒéš†è¿‡æ»¤å™¨å†…éƒ¨æ•°æ®ç»“æ„çš„å¤§å°ã€‚</p></li><li><p><strong><code>falsePositiveProbability</code></strong>ï¼ˆfalse positive probabilityï¼‰ï¼šè¯¯åˆ¤ç‡ã€‚è¿™æ˜¯æŒ‡ä¸€ä¸ªä¸å­˜åœ¨é›†åˆä¸­çš„å…ƒç´ è¢«åˆ¤æ–­ä¸ºå­˜åœ¨çš„æ¦‚ç‡ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œéšç€å®é™…æ’å…¥æ•°é‡çš„å¢åŠ ï¼Œå®é™…çš„è¯¯åˆ¤ç‡å¯èƒ½ä¼šä¸Šå‡ã€‚</p></li></ul><h3 id="312-optimalnumofbits"><a href="#3-1-2-optimalNumOfBits" class="headerlink" title="3.1.2 optimalNumOfBits"></a>3.1.2 optimalNumOfBits</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="title function_">optimalNumOfBits</span><span class="params">(<span class="type">int</span> expectedInsertions, <span class="type">double</span> falsePositiveProbability)</span> &#123;  </span><br><span class="line"><span class="keyword">return</span> (<span class="type">int</span>) (-n * Math.log(p) / LN2_SQUARED);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>optimalNumOfBits</code>é€šè¿‡è®¡ç®—,å¯ä»¥å¾—åˆ°ä¸€ä¸ªåœ¨æ»¡è¶³ç‰¹å®šå‡é˜³æ€§ç‡ï¼ˆ<code>falsePositiveProbability</code>ï¼‰è¦æ±‚ä¸‹ï¼Œå¯¹äºç»™å®šæ•°é‡çš„å…ƒç´ é¢„æœŸæ’å…¥é‡ï¼ˆ<code>expectedInsertions</code>ï¼‰ï¼Œæ‰€éœ€çš„æœ€å°‘ä½æ•°ã€‚è¿™ä½¿å¾—å¸ƒéš†è¿‡æ»¤å™¨èƒ½å¤Ÿåœ¨ä¿è¯è¯¯åˆ¤ç‡çš„å‰æä¸‹ï¼Œä½¿ç”¨æœ€å°‘çš„ç©ºé—´ã€‚è¿™ç§è®¡ç®—å¯¹äºè®¾è®¡é«˜æ•ˆä¸”ç©ºé—´èŠ‚çº¦çš„å¸ƒéš†è¿‡æ»¤å™¨è‡³å…³é‡è¦</p><h3 id="313-è®¡ç®—é€»è¾‘"><a href="#3-1-3-è®¡ç®—é€»è¾‘" class="headerlink" title="3.1.3 è®¡ç®—é€»è¾‘"></a>3.1.3 è®¡ç®—é€»è¾‘</h3><p><code>optimalNumOfBits</code>å‡½æ•°çš„è®¡ç®—åŸºäºä»¥ä¸‹å…¬å¼ï¼Œè¿™ä¸ªå…¬å¼å¯ä»¥ä»å¸ƒéš†è¿‡æ»¤å™¨çš„ç†è®ºè¯¯åˆ¤ç‡å…¬å¼æ¨å¯¼è€Œæ¥ï¼š<br><img src="/b4fa673f/bitnums.png" class></p><ul><li>m æ˜¯ä½æ•°ç»„çš„é•¿åº¦ï¼ˆå³å‡½æ•°çš„è¿”å›å€¼ï¼‰ã€‚</li><li>n æ˜¯<code>expectedInsertions</code>ï¼Œå³é¢„æœŸçš„æ’å…¥æ•°é‡ã€‚</li><li>p æ˜¯<code>falsePositiveProbability</code>ï¼Œå³æœŸæœ›çš„å‡é˜³æ€§æ¦‚ç‡ã€‚</li><li>lnâ¡2 è¡¨ç¤ºè‡ªç„¶å¯¹æ•°ã€‚<br>è¿™ä¸ªå…¬å¼åˆ©ç”¨äº†å¸ƒéš†è¿‡æ»¤å™¨çš„è¯¯åˆ¤ç‡ç‰¹æ€§ï¼Œé€šè¿‡æŒ‡å®šçš„å‡é˜³æ€§ç‡å’Œé¢„æœŸæ’å…¥æ•°é‡æ¥è®¡ç®—å‡ºä¸€ä¸ªæœ€ä¼˜çš„ä½æ•°ç»„é•¿åº¦ã€‚è¿™ä¸ªé•¿åº¦èƒ½å¤Ÿåœ¨æ»¡è¶³è¯¯åˆ¤ç‡è¦æ±‚çš„åŒæ—¶ï¼Œå°½å¯èƒ½åœ°å‡å°å¸ƒéš†è¿‡æ»¤å™¨æ‰€éœ€çš„ç©ºé—´ã€‚</li></ul><h3 id="314-å®ç°æ³¨æ„"><a href="#3-1-4-å®ç°æ³¨æ„" class="headerlink" title="3.1.4 å®ç°æ³¨æ„"></a>3.1.4 å®ç°æ³¨æ„</h3><p>å®é™…å®ç°æ—¶ï¼Œå¯èƒ½è¿˜éœ€è¦å¯¹è®¡ç®—ç»“æœè¿›è¡Œå–æ•´å¤„ç†ï¼Œå¹¶ç¡®ä¿ç»“æœæ˜¯ä¸€ä¸ªæ­£æ•´æ•°ã€‚æ­¤å¤–ï¼Œå®ç°å¯èƒ½è¿˜ä¼šè€ƒè™‘åˆ°æ€§èƒ½å’Œå­˜å‚¨æ•ˆç‡çš„å¹³è¡¡ï¼Œæ¯”å¦‚é€šè¿‡é™åˆ¶ä½æ•°ç»„çš„é•¿åº¦ä¸º2çš„å¹‚ç­‰ã€‚</p><h3 id="315-optimalnumofhashfunctions"><a href="#3-1-5-optimalNumOfHashFunctions" class="headerlink" title="3.1.5 optimalNumOfHashFunctions"></a>3.1.5 optimalNumOfHashFunctions</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="title function_">optimalNumOfHashFunctions</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m)</span> &#123;  </span><br><span class="line"><span class="keyword">return</span> Math.max(<span class="number">1</span>, (<span class="type">int</span>) Math.round(m / n * LN2));  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>optimalNumOfHashFunctions(expectedInsertions, numBits)</code>è¿™ä¸ªå‡½æ•°ç”¨äºè®¡ç®—ç»™å®šæ¡ä»¶ä¸‹å¸ƒéš†è¿‡æ»¤å™¨çš„æœ€ä¼˜å“ˆå¸Œå‡½æ•°æ•°é‡ã€‚è¿™ä¸ªè®¡ç®—åŸºäºé¢„æœŸè¦æ’å…¥çš„å…ƒç´ æ•°é‡ï¼ˆ<code>expectedInsertions</code>ï¼‰å’Œå¸ƒéš†è¿‡æ»¤å™¨å†…éƒ¨ä½æ•°ç»„çš„å¤§å°ï¼ˆ<code>numBits</code>ï¼‰ã€‚ç›®çš„æ˜¯ä¸ºäº†å¹³è¡¡ç©ºé—´ä½¿ç”¨å’Œè¯¯åˆ¤ç‡ï¼Œç¡®ä¿å¸ƒéš†è¿‡æ»¤å™¨åœ¨ç»™å®šæ¡ä»¶ä¸‹å·¥ä½œå¾—æœ€æœ‰æ•ˆç‡ã€‚</p><p><strong>è®¡ç®—é€»è¾‘</strong></p><p>å¸ƒéš†è¿‡æ»¤å™¨çš„æ•ˆç‡å’Œè¯¯åˆ¤ç‡ä¸ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°æ•°é‡æœ‰å¾ˆå¤§å…³ç³»ã€‚å¤ªå°‘çš„å“ˆå¸Œå‡½æ•°ä¼šå¢åŠ ç¢°æ’çš„æ¦‚ç‡ï¼Œå¯¼è‡´è¯¯åˆ¤ç‡å‡é«˜ï¼›è€Œå¤ªå¤šçš„å“ˆå¸Œå‡½æ•°åˆä¼šå¯¼è‡´ä½æ•°ç»„å¿«é€Ÿå¡«æ»¡ï¼ŒåŒæ ·å¢åŠ è¯¯åˆ¤ç‡ï¼ŒåŒæ—¶è¿˜ä¼šå¢åŠ è®¡ç®—çš„å¼€é”€ã€‚</p><p>æœ€ä¼˜å“ˆå¸Œå‡½æ•°æ•°é‡çš„è®¡ç®—å…¬å¼æ˜¯ï¼š<br><img src="/b4fa673f/hashnums.png" class><br>è¿™ä¸ªå…¬å¼åŸºäºä»¥ä¸‹åŸç†ï¼šç»™å®šä¸€ä¸ªå›ºå®šå¤§å°çš„ä½æ•°ç»„ï¼Œå­˜åœ¨ä¸€ä¸ªæœ€ä¼˜çš„å“ˆå¸Œå‡½æ•°æ•°é‡ï¼Œå¯ä»¥æœ€å°åŒ–ç»™å®šå…ƒç´ æ•°é‡æ¡ä»¶ä¸‹çš„è¯¯åˆ¤ç‡ã€‚è¿™ä¸ªæœ€ä¼˜æ•°é‡ç›´æ¥å…³è”äºä½æ•°ç»„çš„å¤§å°å’Œè¦å¤„ç†çš„å…ƒç´ æ•°é‡ã€‚</p><p>å…¶ä¸­ï¼š</p><ul><li>k æ˜¯æœ€ä¼˜çš„å“ˆå¸Œå‡½æ•°æ•°é‡ï¼Œ</li><li>m æ˜¯ä½æ•°ç»„çš„å¤§å°ï¼ˆ<code>numBits</code>ï¼‰ï¼Œ</li><li>n æ˜¯é¢„æœŸæ’å…¥çš„å…ƒç´ æ•°é‡ï¼ˆ<code>expectedInsertions</code>ï¼‰ï¼Œ</li><li>lnâ¡(2) æ˜¯è‡ªç„¶å¯¹æ•°2çš„å€¼ï¼Œå¤§çº¦ç­‰äº0.693ã€‚</li></ul><h3 id="316-new-bitarraynumbits"><a href="#3-1-6-new-BitArray-numBits" class="headerlink" title="3.1.6 new BitArray(numBits)"></a>3.1.6 new BitArray(numBits)</h3><p>Guava cache  bloom filter åœ¨å®ç°ä½æ•°ç»„æ˜¯é‡‡ç”¨åˆ›å»ºlong[]  + ä½ç§»æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">BitArray</span> &#123;  </span><br><span class="line"><span class="keyword">final</span> <span class="type">long</span>[] data;  </span><br><span class="line">  </span><br><span class="line">BitArray(<span class="type">int</span> bits) &#123;  </span><br><span class="line">    <span class="built_in">this</span>(<span class="keyword">new</span> <span class="title class_">long</span>[IntMath.divide(bits, <span class="number">64</span>, RoundingMode.CEILING)]);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Used by serialization  </span></span><br><span class="line">BitArray(<span class="type">long</span>[] data) &#123;  </span><br><span class="line">    checkArgument(data.length &gt; <span class="number">0</span>, <span class="string">&quot;data length is zero!&quot;</span>);  </span><br><span class="line">    <span class="built_in">this</span>.data = data;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> index)</span> &#123;  </span><br><span class="line">    data[index &gt;&gt; <span class="number">6</span>] |= (<span class="number">1L</span> &lt;&lt; index);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="type">boolean</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> (data[index &gt;&gt; <span class="number">6</span>] &amp; (<span class="number">1L</span> &lt;&lt; index)) != <span class="number">0</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">/** Number of bits */</span>  </span><br><span class="line"><span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> data.length * Long.SIZE;  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="32-put"><a href="#3-2-put" class="headerlink" title="3.2 put"></a>3.2 put</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">MURMUR128_MITZ_32() &#123;  </span><br><span class="line"><span class="meta">@Override</span> <span class="keyword">public</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(T object, Funnel&lt;? <span class="built_in">super</span> T&gt; funnel,  </span></span><br><span class="line"><span class="params"><span class="type">int</span> numHashFunctions, BitArray bits)</span> &#123;  </span><br><span class="line"><span class="comment">// TODO(user): when the murmur&#x27;s shortcuts are implemented, update this code  </span></span><br><span class="line"><span class="type">long</span> <span class="variable">hash64</span> <span class="operator">=</span> Hashing.murmur3_128().newHasher().putObject(object, funnel).hash().asLong();  </span><br><span class="line"><span class="type">int</span> <span class="variable">hash1</span> <span class="operator">=</span> (<span class="type">int</span>) hash64;  </span><br><span class="line"><span class="type">int</span> <span class="variable">hash2</span> <span class="operator">=</span> (<span class="type">int</span>) (hash64 &gt;&gt;&gt; <span class="number">32</span>);  </span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= numHashFunctions; i++) &#123;  </span><br><span class="line"><span class="type">int</span> <span class="variable">nextHash</span> <span class="operator">=</span> hash1 + i * hash2;  </span><br><span class="line"><span class="keyword">if</span> (nextHash &lt; <span class="number">0</span>) &#123;  </span><br><span class="line">nextHash = ~nextHash;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">// up to here, the code is identical with the next method  </span></span><br><span class="line">bits.set(nextHash % bits.size());  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œè¿™è¡Œä»£ç ä½¿ç”¨MurmurHash3ç®—æ³•ç”Ÿæˆä¸€ä¸ª128ä½çš„å“ˆå¸Œå€¼ï¼Œç„¶åå°†å…¶è½¬æ¢æˆä¸€ä¸ª<code>long</code>ç±»å‹çš„æ•°å€¼<code>hash64</code>ã€‚</p><ul><li><code>funnel</code>æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œç”¨äºå°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œä»¥ä¾¿å“ˆå¸Œå‡½æ•°å¯ä»¥å¤„ç†ã€‚</li><li><code>hash64</code>å®é™…ä¸ŠåŒ…å«ä¸¤ä¸ª32ä½çš„å“ˆå¸Œå€¼ï¼Œå®ƒä»¬å¯ä»¥ä»<code>hash64</code>çš„é«˜32ä½å’Œä½32ä½åˆ†åˆ«æå–ã€‚ä»<code>hash64</code>ä¸­æå–ä¸¤ä¸ª32ä½çš„å“ˆå¸Œå€¼<code>hash1</code>å’Œ<code>hash2</code>ã€‚<code>hash1</code>æ˜¯ä½32ä½ï¼Œ<code>hash2</code>æ˜¯é«˜32ä½ã€‚</li><li><ul><li>æ¥ä¸‹æ¥ï¼Œä»£ç éå†ä»1åˆ°<code>numHashFunctions</code>ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨è¦æ±‚çš„å“ˆå¸Œå‡½æ•°æ•°é‡ï¼‰ï¼Œæ¯æ¬¡å¾ªç¯è®¡ç®—ä¸€ä¸ªæ–°çš„å“ˆå¸Œå€¼<code>nextHash</code>ã€‚è¿™ä¸ªæ–°çš„å“ˆå¸Œå€¼æ˜¯é€šè¿‡<code>hash1 + i * hash2</code>è®¡ç®—å¾—åˆ°çš„ï¼Œå…¶ä¸­<code>i</code>æ˜¯å½“å‰çš„è¿­ä»£æ¬¡æ•°ã€‚</li></ul></li><li>å¦‚æœ<code>nextHash</code>ä¸ºè´Ÿæ•°ï¼Œé€šè¿‡ä½å–åæ“ä½œï¼ˆ<code>~nextHash</code>ï¼‰å°†å…¶è½¬æ¢ä¸ºæ­£æ•°ï¼Œä»¥ä¿è¯èƒ½å¤Ÿæ­£ç¡®åœ°æ˜ å°„åˆ°ä½æ•°ç»„çš„ç´¢å¼•ä¸Šã€‚</li><li>æœ€åï¼Œä½¿ç”¨<code>nextHash % bits.size()</code>è®¡ç®—å¾—åˆ°çš„ç´¢å¼•å€¼åœ¨ä½æ•°ç»„ï¼ˆ<code>BitArray</code>ï¼‰ä¸­å¯¹åº”çš„ä½ç½®ä¸Šè®¾ç½®ä½ã€‚<code>bits.size()</code>è¿”å›ä½æ•°ç»„çš„å¤§å°ï¼Œè¿™ç¡®ä¿äº†è®¡ç®—å¾—åˆ°çš„ç´¢å¼•å€¼ä¸ä¼šè¶…å‡ºä½æ•°ç»„çš„èŒƒå›´ã€‚</li></ul><h3 id="321-å“ˆå¸Œå‡½æ•°"><a href="#3-2-1-å“ˆå¸Œå‡½æ•°" class="headerlink" title="3.2.1 å“ˆå¸Œå‡½æ•°"></a>3.2.1 å“ˆå¸Œå‡½æ•°</h3><p>Guava cache é‡‡ç”¨äº†éåŠ å¯†çš„å•å‘æ•£åˆ—å‡½æ•°Murmur3.<br><strong>MurmurHash</strong> ç”±Austin Applebyè®¾è®¡ï¼Œå› å…¶é«˜æ€§èƒ½å’Œè‰¯å¥½çš„åˆ†å¸ƒç‰¹æ€§è€Œå¹¿æ³›åº”ç”¨ã€‚MurmurHashæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œå¦‚MurmurHash2ã€MurmurHash3ç­‰ã€‚</p><p>æ ¹æ®æœ€å¼€å§‹å¯¹bloom filter çš„å®šä¹‰ï¼Œå®ƒéœ€è¦å¤šä¸ªå“ˆå¸Œå‡½æ•°å¯¹æ•°æ®è¿›è¡Œå“ˆå¸Œæ˜ å°„ï¼Œ ä½†Guava Cache bloom filter å®ç°ä¸­å…¶å®æ²¡æœ‰ä½¿ç”¨å¤šä¸ªä¸åŒçš„å“ˆå¸Œå‡½æ•°ï¼Œè€Œæ˜¯é‡‡ç”¨äº†ä¸€ç§å«åšâ€œåŒå“ˆå¸ŒæŠ€æœ¯â€çš„æ–¹æ³•ã€‚</p><p>â€œåŒå“ˆå¸ŒæŠ€æœ¯â€çš„åŸºæœ¬æ€æƒ³æ˜¯åˆ©ç”¨ä¸¤ä¸ªå“ˆå¸Œå‡½æ•°<code>h1(x)</code>å’Œ<code>h2(x)</code>ç”Ÿæˆä»»æ„æ•°é‡çš„å“ˆå¸Œå€¼ï¼Œå¯¹äºç¬¬<code>i</code>ä¸ªå“ˆå¸Œä½ç½®ï¼Œä½¿ç”¨<code>h1(x) + i*h2(x)</code>çš„æ–¹å¼æ¥ç”Ÿæˆã€‚è¿™ç§æ–¹æ³•åªéœ€è¦ä¸¤æ¬¡å“ˆå¸Œæ“ä½œï¼Œå°±å¯ä»¥æ¨¡æ‹Ÿå‡ºå¤šä¸ªå“ˆå¸Œå‡½æ•°çš„æ•ˆæœï¼Œä¸”ç”Ÿæˆçš„å“ˆå¸Œåºåˆ—å…·æœ‰å¾ˆå¥½çš„å‡åŒ€åˆ†å¸ƒæ€§ï¼Œæ—¢ä¿è¯äº†å¸ƒéš†è¿‡æ»¤å™¨çš„æ•ˆç‡ï¼Œåˆé¿å…äº†å¯»æ‰¾å¤šä¸ªå¥½çš„å“ˆå¸Œå‡½æ•°çš„å¤æ‚æ€§ï¼Œæ˜¯ä¸€ç§åœ¨å®é™…åº”ç”¨ä¸­éå¸¸å®ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>æ•ˆç‡å’Œå¤æ‚æ€§å…·ä½“æŒ‡</p><ol><li><strong>æ€§èƒ½å’Œæ•ˆç‡</strong>ï¼šä½¿ç”¨å•ä¸ªå“ˆå¸Œå‡½æ•°åé€šè¿‡ç®—æ³•å˜æ¢ç”Ÿæˆå¤šä¸ªå“ˆå¸Œå€¼ï¼Œå¯ä»¥å¤§å¤§å‡å°‘è®¡ç®—çš„å¤æ‚åº¦å’Œæ—¶é—´ã€‚å¤šä¸ªç‹¬ç«‹çš„å“ˆå¸Œå‡½æ•°æ„å‘³ç€æ¯ä¸ªå…ƒç´ éƒ½éœ€è¦è¢«å¤šæ¬¡ç‹¬ç«‹å“ˆå¸Œï¼Œè¿™ä¼šå¢åŠ è®¡ç®—æˆæœ¬å’Œæ—¶é—´ã€‚é€šè¿‡ä½¿ç”¨å•ä¸ªå“ˆå¸Œå‡½æ•°å¹¶é€šè¿‡æ•°å­¦æ–¹æ³•æ´¾ç”Ÿå‡ºå¤šä¸ªä¼ªéšæœºçš„å“ˆå¸Œå€¼ï¼Œå¯ä»¥åœ¨ä¿æŒå¸ƒéš†è¿‡æ»¤å™¨é”™è¯¯ç‡ä¸å˜çš„å‰æä¸‹ï¼Œæ˜¾è‘—æé«˜æ•ˆç‡ã€‚</li><li><strong>ç®€åŒ–å®ç°</strong>ï¼šå¤šä¸ªä¸åŒçš„å“ˆå¸Œå‡½æ•°éš¾ä»¥é€‰å–ï¼Œè€Œä¸”è¿˜éœ€ä¿è¯å®ƒä»¬ç›¸äº’ä¹‹é—´çš„ç‹¬ç«‹æ€§å’Œåˆ†å¸ƒçš„å‡åŒ€æ€§ï¼Œè¿™åœ¨å®è·µä¸­æ˜¯éå¸¸æŒ‘æˆ˜æ€§çš„ã€‚</li></ol><h2 id="33-mightcontains"><a href="#3-3-mightContains" class="headerlink" title="3.3 mightContains"></a>3.3 mightContains</h2><p>å’Œput å¤„ç†è¿‡ç¨‹ä¿æŒä¸€è‡´</p><h2 id="34-guava-cache-è¯¯æŠ¥ç‡-ä½æ•°ç»„é•¿åº¦å›ºå®š"><a href="#3-4-guava-cache-è¯¯æŠ¥ç‡-ä½æ•°ç»„é•¿åº¦å›ºå®š" class="headerlink" title="3.4 guava cache è¯¯æŠ¥ç‡-ä½æ•°ç»„é•¿åº¦å›ºå®š"></a>3.4 guava cache è¯¯æŠ¥ç‡-ä½æ•°ç»„é•¿åº¦å›ºå®š</h2><p>åœ¨ä½¿ç”¨Guavaçš„å¸ƒéš†è¿‡æ»¤å™¨æ—¶ï¼Œé¢„å…ˆä¼°è®¡å°†è¦æ’å…¥çš„æ•°æ®é‡éå¸¸é‡è¦ã€‚å¸ƒéš†è¿‡æ»¤å™¨åœ¨åˆ›å»ºæ—¶ä¼šæ ¹æ®è¿™ä¸ªé¢„ä¼°çš„æ•°æ®é‡å’ŒæŒ‡å®šçš„è¯¯åˆ¤ç‡æ¥å†³å®šä½æ•°ç»„çš„å¤§å°å’Œä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°æ•°é‡ã€‚è¿™äº›å‚æ•°å…±åŒå†³å®šäº†å¸ƒéš†è¿‡æ»¤å™¨çš„æ€§èƒ½å’Œå‡†ç¡®æ€§ã€‚</p><p>å¦‚æœå®é™…æ’å…¥çš„å…ƒç´ æ•°é‡è¶…è¿‡äº†æœ€åˆçš„é¢„ä¼°ï¼Œè¿‡æ»¤å™¨çš„å®é™…è¯¯åˆ¤ç‡ä¼šé«˜äºé¢„æœŸçš„è¯¯åˆ¤ç‡ã€‚è¿™æ˜¯å› ä¸ºå½“ä½æ•°ç»„å˜å¾—è¿‡äºé¥±å’Œæ—¶ï¼Œä¸åŒå…ƒç´ çš„å“ˆå¸Œå€¼æ›´æœ‰å¯èƒ½æ˜ å°„åˆ°å·²ç»è¢«è®¾ç½®ä¸º1çš„ä½ä¸Šï¼Œä»è€Œå¢åŠ äº†è¯¯åˆ¤çš„å‡ ç‡ã€‚</p><p>Guavaçš„æ–‡æ¡£æ˜ç¡®æŒ‡å‡ºäº†è¿™ä¸€ç‚¹ï¼Œå¼ºè°ƒåœ¨åˆ›å»ºå¸ƒéš†è¿‡æ»¤å™¨æ—¶åº”è¯¥å‡†ç¡®é¢„ä¼°å…ƒç´ æ•°é‡ï¼Œå¹¶è€ƒè™‘åˆ°è¿™ä¸€ç‚¹åœ¨å…¶APIè®¾è®¡ä¸­ã€‚<code>BloomFilter.create()</code>æ–¹æ³•å…è®¸å¼€å‘è€…åœ¨åˆ›å»ºè¿‡æ»¤å™¨æ—¶æŒ‡å®šé¢„æœŸæ’å…¥çš„å…ƒç´ æ•°é‡å’Œå¯æ¥å—çš„è¯¯åˆ¤ç‡ã€‚</p><p><a href="https://guava.dev/releases/20.0/api/docs/com/google/common/hash/BloomFilter.html">https://guava.dev/releases/20.0/api/docs/com/google/common/hash/BloomFilter.html</a></p><img src="/b4fa673f/errorrate.png" class><p>ä¸ºäº†ä¿è¯å¸ƒéš†è¿‡æ»¤å™¨çš„æ•ˆæœï¼Œåº”è¯¥æ ¹æ®å®é™…ä½¿ç”¨åœºæ™¯ä»”ç»†ä¼°ç®—å…ƒç´ æ•°é‡ã€‚å¦‚æœé¢„è®¡æ•°æ®é‡å­˜åœ¨ä¸ç¡®å®šæ€§ï¼Œå»ºè®®é¢„ä¼°ä¸€ä¸ªä¸Šé™ï¼Œæˆ–è€…åœ¨å®é™…å…ƒç´ æ•°é‡è¶…è¿‡é¢„ä¼°æ—¶é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„å¸ƒéš†è¿‡æ»¤å™¨ã€‚è¿™å½“ç„¶ä¼šå¸¦æ¥é¢å¤–çš„æˆæœ¬ï¼Œå› æ­¤åœ¨è®¾è®¡åˆæœŸåšå‡ºå‡†ç¡®ä¼°è®¡éå¸¸å…³é”®ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œæ­£ç¡®ä¼°è®¡å°†è¦å¤„ç†çš„æ•°æ®é‡å¯¹äºä½¿ç”¨Guavaå¸ƒéš†è¿‡æ»¤å™¨æ¥è¯´æ˜¯éå¸¸é‡è¦çš„ã€‚å¦‚æœå®é™…æ•°æ®é‡è¶…è¿‡äº†é¢„ä¼°ï¼Œå°†ä¼šå¯¼è‡´é«˜äºé¢„æœŸçš„è¯¯åˆ¤ç‡ï¼Œå¯èƒ½å½±å“åˆ°åº”ç”¨çš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚</p><h1 id="4-åˆ†å¸ƒå¼-redis-bloom-filter"><a href="#4-åˆ†å¸ƒå¼-Redis-bloom-filter" class="headerlink" title="4. åˆ†å¸ƒå¼ Redis bloom filter"></a>4. åˆ†å¸ƒå¼ Redis bloom filter</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BF.RESERVE &#123;key&#125; &#123;error_rate&#125; &#123;capacity&#125; [EXPANSION expansion] [NONSCALING]</span><br></pre></td></tr></table></figure><h2 id="41-å‚æ•°è§£é‡Š"><a href="#4-1-å‚æ•°è§£é‡Š" class="headerlink" title="4.1 å‚æ•°è§£é‡Š"></a>4.1 å‚æ•°è§£é‡Š</h2><h3 id="411-expansion-expansion"><a href="#4-1-1-EXPANSION-expansion" class="headerlink" title="4.1.1 EXPANSION expansion"></a>4.1.1 EXPANSION expansion</h3><p><code>BF.RESERVE</code>å‘½ä»¤æ˜¯RedisBloomæ¨¡å—ä¸­ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¸ƒéš†è¿‡æ»¤å™¨çš„å‘½ä»¤ã€‚è¿™ä¸ªå‘½ä»¤å…è®¸ç”¨æˆ·é¢„å…ˆä¸ºå¸ƒéš†è¿‡æ»¤å™¨æŒ‡å®šå‚æ•°ï¼Œä»¥ä¾¿åœ¨æ’å…¥å…ƒç´ ä¹‹å‰å°±ç¡®å®šå…¶å¤§å°å’Œå…¶ä»–é‡è¦çš„è¡Œä¸ºç‰¹æ€§ã€‚ä»¥ä¸‹æ˜¯<code>BF.RESERVE</code>å‘½ä»¤å„ä¸ªå‚æ•°çš„å«ä¹‰ï¼š</p><ul><li><p><strong><code>&#123;key&#125;</code></strong>ï¼šè¿™æ˜¯å°†è¦åˆ›å»ºçš„å¸ƒéš†è¿‡æ»¤å™¨çš„åç§°æˆ–é”®å€¼ã€‚åœ¨Redisä¸­ï¼Œæ¯ä¸ªæ•°æ®ç»“æ„éƒ½é€šè¿‡ä¸€ä¸ªå”¯ä¸€çš„é”®æ¥æ ‡è¯†å’Œè®¿é—®ã€‚</p></li><li><p><strong><code>&#123;error_rate&#125;</code></strong>ï¼šé¢„æœŸçš„è¯¯æŠ¥ç‡ã€‚è¿™æ˜¯ä¸€ä¸ª0åˆ°1ä¹‹é—´çš„æµ®ç‚¹æ•°ï¼Œè¡¨ç¤ºå…è®¸çš„è¯¯åˆ¤æ¦‚ç‡çš„ä¸Šé™ã€‚è¯¯æŠ¥ç‡è¶Šä½ï¼Œå¸ƒéš†è¿‡æ»¤å™¨æ‰€éœ€çš„ç©ºé—´å°±è¶Šå¤§ã€‚</p></li><li><p><strong><code>&#123;capacity&#125;</code></strong>ï¼šå¸ƒéš†è¿‡æ»¤å™¨é¢„æœŸè¦å­˜å‚¨çš„å…ƒç´ çš„æ•°é‡ã€‚è¿™ä¸ªæ•°å€¼ç”¨äºåœ¨ä¿æŒè¯¯æŠ¥ç‡ä¸å˜çš„æƒ…å†µä¸‹ï¼Œé¢„å…ˆè®¡ç®—å¸ƒéš†è¿‡æ»¤å™¨æ‰€éœ€çš„æœ€å°å¤§å°ã€‚</p></li><li><p><strong><code>[EXPANSION expansion]</code></strong>ï¼ˆå¯é€‰ï¼‰ï¼šè¿™ä¸ªå¯é€‰å‚æ•°ç”¨äºæŒ‡å®šå½“å¸ƒéš†è¿‡æ»¤å™¨çš„å®¹é‡ä¸è¶³ä»¥å®¹çº³æ›´å¤šå…ƒç´ æ—¶ï¼Œè‡ªåŠ¨æ‰©å±•çš„è¡Œä¸ºã€‚<code>expansion</code>æ˜¯ä¸€ä¸ªå¤§äº1çš„æ•´æ•°ï¼Œè¡¨ç¤ºæ¯æ¬¡æ‰©å±•å¢åŠ çš„æ¯”ä¾‹æˆ–å®¹é‡ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå¸ƒéš†è¿‡æ»¤å™¨å¯èƒ½ä¼šä½¿ç”¨é»˜è®¤çš„æ‰©å±•ç­–ç•¥ã€‚</p></li><li><p><strong><code>[NONSCALING]</code></strong>ï¼ˆå¯é€‰ï¼‰ï¼šè¿™ä¸ªå¯é€‰æ ‡å¿—ç”¨æ¥æŒ‡ç¤ºåˆ›å»ºçš„å¸ƒéš†è¿‡æ»¤å™¨ä¸åº”è‡ªåŠ¨æ‰©å±•ã€‚è¿™æ„å‘³ç€ä¸€æ—¦è¾¾åˆ°å…¶å®¹é‡ä¸Šé™ï¼Œå°±ä¸ä¼šå°è¯•æ‰©å¤§è¿‡æ»¤å™¨ä»¥å®¹çº³æ›´å¤šçš„å…ƒç´ ã€‚è¿™é€šå¸¸ç”¨äºé‚£äº›å¯¹ç©ºé—´ä½¿ç”¨æœ‰ä¸¥æ ¼é™åˆ¶çš„åº”ç”¨åœºæ™¯ã€‚</p></li><li><p><strong>ä½œç”¨</strong>ï¼šè¿™ä¸ªå‚æ•°ç”¨äºè®¾ç½®å¸ƒéš†è¿‡æ»¤å™¨åœ¨è¾¾åˆ°å®¹é‡é™åˆ¶å¹¶éœ€è¦æ‰©å±•æ—¶ï¼Œæ–°åˆ›å»ºçš„å¸ƒéš†è¿‡æ»¤å™¨å±‚çš„å¤§å°ã€‚<code>expansion</code>çš„å€¼å†³å®šäº†æ–°å±‚çš„å®¹é‡æ˜¯å‰ä¸€å±‚å®¹é‡çš„å¤šå°‘å€ã€‚è¿™æ˜¯ä¸€ç§è‡ªåŠ¨æ‰©å±•å¸ƒéš†è¿‡æ»¤å™¨å®¹é‡çš„æœºåˆ¶ï¼Œä»¥é€‚åº”ä¸æ–­å¢é•¿çš„å…ƒç´ æ•°é‡ï¼ŒåŒæ—¶æ§åˆ¶è¯¯æŠ¥ç‡ã€‚</p></li><li><strong>åœºæ™¯</strong>ï¼šé€‚ç”¨äºé‚£äº›å…ƒç´ æ•°é‡ä¸ç¡®å®šæˆ–å¯èƒ½ä¼šè¶…å‡ºåˆå§‹è®¾å®šå®¹é‡çš„åœºåˆã€‚é€šè¿‡é€‚å½“è®¾ç½®<code>expansion</code>å‚æ•°ï¼Œå¯ä»¥åœ¨ç»´æŒè¯¯æŠ¥ç‡çš„åŒæ—¶åŠ¨æ€å¢åŠ å¸ƒéš†è¿‡æ»¤å™¨çš„å®¹é‡ã€‚</li><li><strong>ä¸¾ä¾‹</strong>ï¼šå¦‚æœè®¾ç½®<code>[EXPANSION 2]</code>ï¼Œé‚£ä¹ˆæ¯æ¬¡æ‰©å±•æ—¶ï¼Œæ–°çš„å¸ƒéš†è¿‡æ»¤å™¨å±‚çš„å®¹é‡å°†æ˜¯å‰ä¸€å±‚çš„ä¸¤å€ã€‚</li></ul><h3 id="412-nonscaling"><a href="#4-1-2-NONSCALING" class="headerlink" title="4.1.2 NONSCALING"></a>4.1.2 NONSCALING</h3><ul><li><strong>ä½œç”¨</strong>ï¼šæŒ‡å®šåˆ›å»ºçš„å¸ƒéš†è¿‡æ»¤å™¨ä¸ºéæ‰©å±•å‹ï¼ˆNon-scalingï¼‰ã€‚å³ï¼Œä¸€æ—¦åˆ›å»ºï¼Œå¸ƒéš†è¿‡æ»¤å™¨çš„å®¹é‡å›ºå®šï¼Œä¸ä¼šæ ¹æ®å…ƒç´ çš„å¢åŠ è€Œè‡ªåŠ¨å¢åŠ æ–°çš„å±‚ã€‚è¿™æ„å‘³ç€æ‰€æœ‰å…ƒç´ éƒ½å°†è¢«æ·»åŠ åˆ°è¿™ä¸ªå›ºå®šå¤§å°çš„å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œä¸ç®¡å…¶å®¹é‡æ˜¯å¦å·²æ»¡ã€‚</li><li><strong>åœºæ™¯</strong>ï¼šé€‚ç”¨äºå…ƒç´ æ•°é‡é¢„å…ˆå·²çŸ¥ä¸”ä¸ä¼šè¶…å‡ºåˆå§‹è®¾å®šå®¹é‡çš„åœºåˆã€‚è¿™ç§æ–¹å¼å¯ä»¥é¿å…å› ä¸ºæ‰©å±•è€Œå¯èƒ½å¸¦æ¥çš„é¢å¤–å†…å­˜ä½¿ç”¨ï¼Œä½†è¦æ±‚ç”¨æˆ·å¿…é¡»æ›´å‡†ç¡®åœ°é¢„ä¼°æ‰€éœ€çš„å®¹é‡å’Œè¯¯æŠ¥ç‡ã€‚</li></ul><p><strong>æ³¨æ„</strong>ï¼šå½“ä½¿ç”¨<code>[NONSCALING]</code>å‚æ•°æ—¶ï¼Œ<code>[EXPANSION expansion]</code>å‚æ•°å°†æ— æ•ˆï¼Œå› ä¸ºéæ‰©å±•å‹çš„å¸ƒéš†è¿‡æ»¤å™¨ä¸ä¼šè¿›è¡Œä»»ä½•æ‰©å±•æ“ä½œã€‚</p><h2 id="42-å¯æ‹“å±•ç‰¹æ€§æ˜¯å¦‚ä½•å®ç°"><a href="#4-2-å¯æ‹“å±•ç‰¹æ€§æ˜¯å¦‚ä½•å®ç°" class="headerlink" title="4.2 å¯æ‹“å±•ç‰¹æ€§æ˜¯å¦‚ä½•å®ç°"></a>4.2 å¯æ‹“å±•ç‰¹æ€§æ˜¯å¦‚ä½•å®ç°</h2><p>redis å¯æ‰©å±•å¸ƒéš†è¿‡æ»¤(Scalable Bloom Filters)å¯ä»¥ç†è§£æˆæ˜¯ç”±å¤šä¸ªä½æ•°ç»„/å­è¿‡æ»¤å™¨ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨å®ä¾‹ï¼‰é“¾æ¥åœ¨ä¸€èµ·å½¢æˆçš„é“¾è¡¨(SBChain)ã€‚</p><p>æ¯ä¸ªå­è¿‡æ»¤å™¨éƒ½æœ‰å…¶è‡ªå·±çš„å®¹é‡å’Œè¯¯æŠ¥ç‡è®¾ç½®ã€‚å½“å‰çš„å­è¿‡æ»¤å™¨è¾¾åˆ°å®¹é‡é™åˆ¶æ—¶ï¼Œå°±ä¼šåŠ¨æ€åœ°æ·»åŠ ä¸€ä¸ªæ–°çš„å­è¿‡æ»¤å™¨ã€‚</p><p>è¿™ç§æ–¹æ³•çš„å…³é”®ä¼˜åŠ¿æ˜¯ï¼Œå®ƒå¯ä»¥åœ¨ä¸æ–­å¢åŠ å…ƒç´ çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°æ‰©å±•æ€»å®¹é‡ï¼ŒåŒæ—¶æ§åˆ¶æ•´ä½“è¯¯æŠ¥ç‡ã€‚</p><p>ç„¶è€Œï¼Œè¿™ç§åŠ¨æ€æ‰©å±•çš„èƒ½åŠ›ä¹Ÿæ„å‘³ç€æŸ¥è¯¢æ“ä½œå¯èƒ½éœ€è¦éå†é“¾è¡¨ä¸­çš„å¤šä¸ªå¸ƒéš†è¿‡æ»¤å™¨å®ä¾‹ï¼Œè¿™å¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿä¸€å®šå½±å“ã€‚</p><p>redis bloom filter çš„æ•´ä½“ä¸Šçš„åŸºæœ¬é€»è¾‘ï¼Œæ¯”å¦‚ä½æ•°ç»„çš„å¤§å°ã€é€‰æ‹©çš„å“ˆå¸Œå‡½æ•°ã€å“ˆå¸Œå‡½æ•°çš„æ•°é‡ã€å¤šä¸ªå“ˆå¸Œå‡½æ•°çš„æ¨¡æ‹Ÿä¸Guava cache  bloom filteråŸºæœ¬ä¿æŒä¸€è‡´ï¼Œ æ¥ä¸‹æ¥åªé‡ç‚¹åˆ†æå…¶å¯æ‹“å±•æ€§æ˜¯å¦‚ä½•å®ç°çš„</p><h3 id="421-bloom-ç»“æ„ä½“"><a href="#4-2-1-bloom-ç»“æ„ä½“" class="headerlink" title="4.2.1 bloom ç»“æ„ä½“"></a>4.2.1 bloom ç»“æ„ä½“</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">bloom.h</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">bloom</span> &#123;</span>  </span><br><span class="line"><span class="type">uint32_t</span> hashes;  </span><br><span class="line"><span class="type">uint8_t</span> force64;  </span><br><span class="line"><span class="type">uint8_t</span> n2;  </span><br><span class="line"><span class="type">uint64_t</span> entries;  </span><br><span class="line">  </span><br><span class="line"><span class="type">double</span> error;  </span><br><span class="line"><span class="type">double</span> bpe;  </span><br><span class="line">  </span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> *bf;  </span><br><span class="line"><span class="type">uint64_t</span> bytes;  </span><br><span class="line"><span class="type">uint64_t</span> bits;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª<code>struct bloom</code>å®šä¹‰äº†ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨çš„åŸºæœ¬æ•°æ®ç»“æ„ï¼Œç”¨äºåœ¨RedisBloomæ¨¡å—ä¸­è¡¨ç¤ºä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨å®ä¾‹ã€‚ä¸‹é¢æ˜¯å¯¹å„ä¸ªæˆå‘˜å˜é‡çš„è¯¦ç»†è§£é‡Šï¼š</p><ul><li><strong><code>uint32_t hashes;</code></strong>ï¼šè¿™è¡¨ç¤ºå¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°çš„æ•°é‡ã€‚åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå…ƒç´ çš„å­˜åœ¨æ˜¯é€šè¿‡å¤šä¸ªå“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°ä½æ•°ç»„çš„ä¸åŒä½ç½®æ¥è¡¨ç¤ºçš„ã€‚å› æ­¤ï¼Œå“ˆå¸Œå‡½æ•°çš„æ•°é‡ç›´æ¥å½±å“å¸ƒéš†è¿‡æ»¤å™¨çš„è¯¯åˆ¤ç‡å’Œæ•ˆç‡ã€‚</li><li><strong><code>uint8_t force64;</code></strong>ï¼šè¿™æ˜¯ä¸€ä¸ªæ ‡å¿—ä½ï¼Œç”¨äºæŒ‡ç¤ºæ˜¯å¦å¼ºåˆ¶ä½¿ç”¨64ä½å“ˆå¸Œå‡½æ•°ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¿è¯åœ¨ä¸åŒå¹³å°ä¸Šçš„ä¸€è‡´æ€§å’Œæ€§èƒ½ï¼Œå¯èƒ½éœ€è¦å¼ºåˆ¶ä½¿ç”¨64ä½å“ˆå¸Œå‡½æ•°ã€‚</li><li><strong><code>uint8_t n2;</code></strong>ï¼šè¿™ä¸ªæˆå‘˜å¯èƒ½ç”¨äºè¡¨ç¤ºä¸ä½æ•°ç»„å¤§å°ç›¸å…³çš„ä¸€ä¸ªå‚æ•°ï¼Œå…·ä½“å«ä¹‰å–å†³äºå®ç°ç»†èŠ‚ã€‚åœ¨ä¸€äº›å¸ƒéš†è¿‡æ»¤å™¨çš„å®ç°ä¸­ï¼Œè¿™ä¸ªå‚æ•°å¯èƒ½ä¸ä½æ•°ç»„å¤§å°ä¸º2çš„å¹‚æ¬¡æ–¹æœ‰å…³ã€‚</li><li><strong><code>uint64_t entries;</code></strong>ï¼šè¿™è¡¨ç¤ºé¢„æœŸå­˜å‚¨åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„å…ƒç´ æ•°é‡ã€‚è¿™ä¸ªæ•°å€¼å¯¹äºè®¡ç®—ä½æ•°ç»„çš„å¤§å°å’Œå“ˆå¸Œå‡½æ•°æ•°é‡éå¸¸é‡è¦ã€‚</li><li><strong><code>double error;</code></strong>ï¼šè¿™æ˜¯é¢„æœŸçš„è¯¯åˆ¤ç‡ï¼ˆfalse positive rateï¼‰ï¼Œæ˜¯è®¾è®¡å¸ƒéš†è¿‡æ»¤å™¨æ—¶çš„ä¸€ä¸ªå…³é”®å‚æ•°ã€‚è¯¯åˆ¤ç‡è¶Šä½ï¼Œæ‰€éœ€çš„ä½æ•°ç»„å¤§å°å’Œå“ˆå¸Œå‡½æ•°æ•°é‡å°±è¶Šå¤šã€‚</li><li><strong><code>double bpe;</code></strong>ï¼šè¿™è¡¨ç¤ºæ¯ä¸ªå…ƒç´ å¹³å‡å ç”¨çš„ä½æ•°ï¼ˆBits Per Entryï¼‰ã€‚è¿™ä¸ªå€¼æ˜¯æ ¹æ®é¢„æœŸçš„è¯¯åˆ¤ç‡å’Œå…ƒç´ æ•°é‡è®¡ç®—å¾—å‡ºçš„ï¼Œç”¨äºç¡®å®šä½æ•°ç»„çš„å¤§å°ã€‚</li><li><strong><code>unsigned char *bf;</code></strong>ï¼šè¿™æ˜¯ä¸€ä¸ªæŒ‡å‘ä½æ•°ç»„çš„æŒ‡é’ˆã€‚ä½æ•°ç»„æ˜¯å¸ƒéš†è¿‡æ»¤å™¨çš„æ ¸å¿ƒï¼Œç”¨äºå­˜å‚¨å…ƒç´ çš„å“ˆå¸Œå€¼æ˜ å°„ã€‚<code>unsigned char</code>ç±»å‹è¢«ç”¨æ¥è¡¨ç¤ºä½æ•°ç»„ï¼Œæ¯ä¸ªå­—èŠ‚åŒ…å«8ä½ã€‚</li><li><strong><code>uint64_t bytes;</code></strong>ï¼šè¿™è¡¨ç¤ºä½æ•°ç»„å ç”¨çš„å­—èŠ‚æ•°ã€‚ç”±äºä½æ•°ç»„æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½è¿›è¡Œåˆ†é…çš„ï¼Œå› æ­¤è¿™ä¸ªæ•°å€¼è¡¨ç¤ºæ•´ä¸ªä½æ•°ç»„çš„å¤§å°ã€‚</li><li><strong><code>uint64_t bits;</code></strong>ï¼šè¿™è¡¨ç¤ºä½æ•°ç»„ä¸­çš„ä½æ•°ã€‚è¿™ä¸ªæ•°å€¼æ˜¯æ ¹æ®<code>entries</code>ã€<code>error</code>å’Œ<code>bpe</code>è®¡ç®—å¾—å‡ºçš„ï¼Œå†³å®šäº†å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥æœ‰æ•ˆå­˜å‚¨çš„å…ƒç´ æ•°é‡å’Œè¯¯åˆ¤ç‡ã€‚</li></ul><h3 id="422-sblinkç»“æ„ä½“"><a href="#4-2-2-SBLinkç»“æ„ä½“" class="headerlink" title="4.2.2 SBLinkç»“æ„ä½“"></a>4.2.2 <code>SBLink</code>ç»“æ„ä½“</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sb.h</span><br><span class="line"><span class="comment">/** Single link inside a scalable bloom filter */</span>  </span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">SBLink</span> &#123;</span>  </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">bloom</span> <span class="title">inner</span>;</span> <span class="comment">//&lt; Inner structure  </span></span><br><span class="line"><span class="type">size_t</span> size; <span class="comment">// &lt; Number of items in the link  </span></span><br><span class="line">&#125; SBLink;  </span><br></pre></td></tr></table></figure><p><code>SBLink</code>ä»£è¡¨äº†å¯æ‰©å±•å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„å•ä¸ªé“¾æ¥ï¼Œå³å•ä¸ªå¸ƒéš†è¿‡æ»¤å™¨å®ä¾‹ã€‚</p><ul><li><strong><code>struct bloom inner;</code></strong>ï¼šè¿™æ˜¯ä¸€ä¸ªåµŒå¥—çš„ç»“æ„ä½“ï¼Œè¡¨ç¤ºå•ä¸ªå¸ƒéš†è¿‡æ»¤å™¨çš„å†…éƒ¨ç»“æ„ã€‚è¿™ä¸ª<code>inner</code>ç»“æ„ä½“å¯èƒ½åŒ…å«äº†å®ç°å¸ƒéš†è¿‡æ»¤å™¨æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ï¼Œå¦‚ä½æ•°ç»„ã€å“ˆå¸Œå‡½æ•°æ•°é‡ç­‰ã€‚</li><li><strong><code>size_t size;</code></strong>ï¼šè¡¨ç¤ºå½“å‰é“¾æ¥ï¼ˆå³å•ä¸ªå¸ƒéš†è¿‡æ»¤å™¨å®ä¾‹ï¼‰ä¸­çš„å…ƒç´ æ•°é‡ã€‚è¿™æ˜¯ä¸ºäº†å¿«é€Ÿè®¿é—®å•ä¸ªè¿‡æ»¤å™¨å†…å…ƒç´ çš„æ•°é‡ï¼Œè€Œæ— éœ€éå†æ•´ä¸ªä½æ•°ç»„ã€‚</li></ul><h3 id="423-sbchainç»“æ„ä½“"><a href="#4-2-3-SBChainç»“æ„ä½“" class="headerlink" title="4.2.3 SBChainç»“æ„ä½“"></a>4.2.3 <code>SBChain</code>ç»“æ„ä½“</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sb.h  </span><br><span class="line"><span class="comment">/** A chain of one or more bloom filters */</span>  </span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">SBChain</span> &#123;</span>  </span><br><span class="line">SBLink *filters; <span class="comment">//&lt; Current filter  </span></span><br><span class="line"><span class="type">size_t</span> size; <span class="comment">//&lt; Total number of items in all filters  </span></span><br><span class="line"><span class="type">size_t</span> nfilters; <span class="comment">//&lt; Number of links in chain  </span></span><br><span class="line"><span class="type">unsigned</span> options; <span class="comment">//&lt; Options passed directly to bloom_init  </span></span><br><span class="line"><span class="type">unsigned</span> growth;  </span><br><span class="line">&#125; SBChain;</span><br></pre></td></tr></table></figure><p><code>SBChain</code>ä»£è¡¨äº†ä¸€ç³»åˆ—ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰<code>SBLink</code>ç»“æ„ä½“çš„é“¾è¡¨ï¼Œæ„æˆäº†ä¸€ä¸ªå¯æ‰©å±•çš„å¸ƒéš†è¿‡æ»¤å™¨ã€‚</p><ul><li><strong><code>SBLink *filters;</code></strong>ï¼šè¿™æ˜¯ä¸€ä¸ªæŒ‡å‘<code>SBLink</code>æ•°ç»„çš„æŒ‡é’ˆï¼Œè¡¨ç¤ºå½“å‰æ‰€æœ‰çš„è¿‡æ»¤å™¨é“¾ã€‚æ¯ä¸ª<code>SBLink</code>ä»£è¡¨é“¾ä¸­çš„ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨å®ä¾‹ã€‚</li><li><strong><code>size_t size;</code></strong>ï¼šè¡¨ç¤ºæ‰€æœ‰è¿‡æ»¤å™¨ä¸­å…ƒç´ çš„æ€»æ•°é‡ã€‚è¿™ä¸ªæ•°å­—æ˜¯æ‰€æœ‰å•ä¸ª<code>SBLink</code>ä¸­<code>size</code>æˆå‘˜çš„æ€»å’Œã€‚</li><li><strong><code>size_t nfilters;</code></strong>ï¼šè¡¨ç¤ºé“¾ä¸­<code>SBLink</code>å®ä¾‹çš„æ•°é‡ï¼Œå³å½“å‰æœ‰å¤šå°‘ä¸ªå¸ƒéš†è¿‡æ»¤å™¨è¢«é“¾æ¥åœ¨ä¸€èµ·ã€‚</li><li><strong><code>unsigned options;</code></strong>ï¼šè¿™æ˜¯ä¼ é€’ç»™æ¯ä¸ªå¸ƒéš†è¿‡æ»¤å™¨åˆå§‹åŒ–å‡½æ•°<code>bloom_init</code>çš„é€‰é¡¹ã€‚è¿™äº›é€‰é¡¹å¯èƒ½æ§åˆ¶å¦‚å¸ƒéš†è¿‡æ»¤å™¨çš„è¯¯æŠ¥ç‡ã€æ˜¯å¦è‡ªåŠ¨æ‰©å±•ç­‰è¡Œä¸ºã€‚</li><li><strong><code>unsigned growth;</code></strong>ï¼šè¿™ä¸ªæˆå‘˜å˜é‡æ§åˆ¶é“¾çš„å¢é•¿è¡Œä¸ºã€‚å®ƒå¯èƒ½æŒ‡å®šå½“å½“å‰çš„å¸ƒéš†è¿‡æ»¤å™¨å¡«æ»¡æ—¶ï¼Œå¦‚ä½•å¢åŠ æ–°çš„<code>SBLink</code>å®ä¾‹ï¼Œä¾‹å¦‚ï¼Œå¢åŠ çš„å¤§å°æˆ–æ¯”ä¾‹ç­‰ã€‚</li></ul><h2 id="43-å¯æ‰©å±•bloom-filterçš„å·¥ä½œæµç¨‹"><a href="#4-3-å¯æ‰©å±•bloom-filterçš„å·¥ä½œæµç¨‹" class="headerlink" title="4.3 å¯æ‰©å±•bloom filterçš„å·¥ä½œæµç¨‹"></a>4.3 å¯æ‰©å±•bloom filterçš„å·¥ä½œæµç¨‹</h2><ol><li><strong>åˆå§‹åŒ–</strong>ï¼šå½“åˆ›å»ºä¸€ä¸ªæ–°çš„å¯æ‰©å±•å¸ƒéš†è¿‡æ»¤å™¨æ—¶ï¼Œä¼šæŒ‡å®šåˆå§‹å®¹é‡ã€è¯¯æŠ¥ç‡ç­‰å‚æ•°ã€‚åŸºäºè¿™äº›å‚æ•°ï¼Œåˆ›å»ºç¬¬ä¸€ä¸ªå­è¿‡æ»¤å™¨ã€‚</li><li><strong>æ·»åŠ å…ƒç´ </strong>ï¼šå‘å¸ƒéš†è¿‡æ»¤å™¨æ·»åŠ å…ƒç´ æ—¶ï¼Œä¼šä»å½“å‰å­è¿‡æ»¤å™¨å¼€å§‹å°è¯•æ·»åŠ ã€‚å¦‚æœå½“å‰å­è¿‡æ»¤å™¨å·²æ»¡ï¼ˆå³è¾¾åˆ°äº†å…¶å®¹é‡é™åˆ¶ï¼‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å­è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨æ–°çš„å­è¿‡æ»¤å™¨ä¸­æ·»åŠ å…ƒç´ ã€‚æ¯ä¸ªæ–°æ·»åŠ çš„å­è¿‡æ»¤å™¨éƒ½å¯ä»¥æ ¹æ®é…ç½®çš„è§„åˆ™è°ƒæ•´å¤§å°å’Œè¯¯æŠ¥ç‡ï¼Œä»¥é€‚åº”ä¸æ–­å¢åŠ çš„å…ƒç´ ã€‚</li><li><strong>æ£€æŸ¥å…ƒç´ </strong>ï¼šæ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨æ—¶ï¼Œéœ€è¦æŸ¥è¯¢æ‰€æœ‰çš„å­è¿‡æ»¤å™¨ã€‚å¦‚æœä»»ä½•å­è¿‡æ»¤å™¨è¡¨ç¤ºå…ƒç´ å¯èƒ½å­˜åœ¨ï¼ˆå³å¯¹åº”çš„ä½éƒ½ä¸º1ï¼‰ï¼Œåˆ™è®¤ä¸ºå…ƒç´ å¯èƒ½å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚è™½ç„¶å¯æ‰©å±•å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥åŠ¨æ€å¢åŠ å®¹é‡ï¼Œä½†æŸ¥è¯¢æ“ä½œçš„æˆæœ¬éšä¹‹å¢åŠ ï¼Œå› ä¸ºå¯èƒ½éœ€è¦æ£€æŸ¥å¤šä¸ªå¸ƒéš†è¿‡æ»¤å™¨å®ä¾‹ã€‚</li><li><strong>å‚æ•°è°ƒæ•´</strong>ï¼šéšç€å­è¿‡æ»¤å™¨çš„å¢åŠ ï¼Œæ¯ä¸ªæ–°çš„å­è¿‡æ»¤å™¨é€šå¸¸ä¼šæœ‰æ›´å¤§çš„å®¹é‡ã€‚è¿™æ˜¯é€šè¿‡è°ƒæ•´å¦‚æ¯”ç‰¹æ•°ã€å“ˆå¸Œå‡½æ•°æ•°é‡ç­‰å‚æ•°æ¥å®ç°çš„ã€‚è¿™ç§æ–¹æ³•æ—¨åœ¨å¹³è¡¡è¯¯æŠ¥ç‡å’Œå†…å­˜ä½¿ç”¨ï¼Œå³ä½¿åœ¨ä¸æ–­æ·»åŠ å…ƒç´ çš„æƒ…å†µä¸‹ä¹Ÿèƒ½ç»´æŒç›¸å¯¹ç¨³å®šçš„è¯¯æŠ¥ç‡ã€‚</li></ol><h1 id="5-å¯åˆ é™¤-bloom-filter"><a href="#5-å¯åˆ é™¤-bloom-filter" class="headerlink" title="5. å¯åˆ é™¤ bloom filter"></a>5. å¯åˆ é™¤ bloom filter</h1><h2 id="51-å“ªäº›åœºæ™¯ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ—¶éœ€è¦åˆ é™¤"><a href="#5-1-å“ªäº›åœºæ™¯ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ—¶éœ€è¦åˆ é™¤" class="headerlink" title="5.1 å“ªäº›åœºæ™¯ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ—¶éœ€è¦åˆ é™¤"></a>5.1 å“ªäº›åœºæ™¯ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ—¶éœ€è¦åˆ é™¤</h2><p>ä»¥ä¸Šï¼Œ guava å’Œ redis çš„bloom filter éƒ½æ²¡æœ‰å®ç°åˆ é™¤åŠŸèƒ½ï¼Œä¸èƒ½åˆ é™¤çš„åŸå› å·²ç»è§£é‡Šè¿‡ï¼Œå…ƒç´ çš„å­˜åœ¨æ˜¯é€šè¿‡å¤šä¸ªä½çš„â€œ1â€çŠ¶æ€æ¥è¡¨ç¤ºçš„ï¼Œè€Œå°†è¿™äº›ä½é‡ç½®ä¸ºâ€œ0â€å¯èƒ½ä¼šé”™è¯¯åœ°å½±å“å…¶ä»–å…ƒç´ çš„å­˜åœ¨æ£€æµ‹ã€‚</p><p>ä½†æ˜¯åœ¨æŸäº›åœºæ™¯è¿˜æ˜¯éœ€è¦åˆ é™¤ï¼Œæ¯”å¦‚ï¼Œ<br>æŸ¥çœ‹ä¸€å¼ ä¼˜æƒ åˆ¸æ˜¯å¦å·²è¢«ä½¿ç”¨ï¼Ÿåˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰å­˜åœ¨ä½†è¿˜æœªè¢«ä½¿ç”¨ä¼˜æƒ åˆ¸çš„filterã€‚æ¯æ¬¡æ ¡éªŒæ—¶</p><ul><li>å¦‚æœå¦ï¼Œåˆ™ä¼˜æƒ åˆ¸ä¸å­˜åœ¨ã€‚</li><li>å¦‚æœæ˜¯ï¼Œåˆ™ä¼˜æƒ åˆ¸æœ‰æ•ˆã€‚æ£€æŸ¥ä¸»æ•°æ®åº“ã€‚å¦‚æœæœ‰æ•ˆï¼Œåˆ™ä½¿ç”¨åä» Cuckoo è¿‡æ»¤å™¨ä¸­åˆ é™¤ã€‚</li></ul><h2 id="52-å®ç°åˆ é™¤å¸ƒéš†è¿‡æ»¤å™¨çš„æ€è·¯"><a href="#5-2-å®ç°åˆ é™¤å¸ƒéš†è¿‡æ»¤å™¨çš„æ€è·¯" class="headerlink" title="5.2 å®ç°åˆ é™¤å¸ƒéš†è¿‡æ»¤å™¨çš„æ€è·¯"></a>5.2 å®ç°åˆ é™¤å¸ƒéš†è¿‡æ»¤å™¨çš„æ€è·¯</h2><h3 id="521-è®¡æ•°å‹å¸ƒéš†è¿‡æ»¤å™¨counting-bloom-filter"><a href="#5-2-1-è®¡æ•°å‹å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆCounting-Bloom-Filterï¼‰" class="headerlink" title="5.2.1 è®¡æ•°å‹å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆCounting Bloom Filterï¼‰"></a>5.2.1 è®¡æ•°å‹å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆCounting Bloom Filterï¼‰</h3><p>è¿™æ˜¯æœ€ç›´æ¥çš„æ–¹æ³•ä¹‹ä¸€ï¼Œå®ƒé€šè¿‡ä¸ºæ¯ä¸ªä½ä½¿ç”¨ä¸€ä¸ªè®¡æ•°å™¨è€Œä¸æ˜¯ç®€å•çš„å¸ƒå°”æ ‡è®°æ¥å®ç°ã€‚å½“æ’å…¥ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå®ƒç»è¿‡å¤šä¸ªå“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°å¤šä¸ªè®¡æ•°å™¨ä¸Šï¼Œå¹¶å°†è¿™äº›è®¡æ•°å™¨çš„å€¼å¢åŠ ã€‚ç›¸åº”åœ°ï¼Œåˆ é™¤ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¿™äº›è®¡æ•°å™¨çš„å€¼ä¼šè¢«å‡å°‘ã€‚å¦‚æœä»»ä½•è®¡æ•°å™¨çš„å€¼è¾¾åˆ°é›¶ï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰ä»»ä½•å…ƒç´ æ˜ å°„åˆ°è¿™ä¸ªä½ä¸Šã€‚è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯éœ€è¦æ›´å¤šçš„ç©ºé—´æ¥å­˜å‚¨è®¡æ•°å™¨ã€‚</p><h3 id="522-åŒå¸ƒéš†è¿‡æ»¤å™¨"><a href="#5-2-2-åŒå¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="5.2.2 åŒå¸ƒéš†è¿‡æ»¤å™¨"></a>5.2.2 åŒå¸ƒéš†è¿‡æ»¤å™¨</h3><p>è¿™ç§æ–¹æ³•æ¶‰åŠåˆ°ä½¿ç”¨ä¸¤ä¸ªç‹¬ç«‹çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼šä¸€ä¸ªç”¨äºæ·»åŠ æ“ä½œï¼Œå¦ä¸€ä¸ªç”¨äºåˆ é™¤æ“ä½œã€‚å½“æ·»åŠ ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå®ƒè¢«æ·»åŠ åˆ°ç¬¬ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼›å½“åˆ é™¤ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¯¥å…ƒç´ è¢«æ·»åŠ åˆ°ç¬¬äºŒä¸ªå¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨æ—¶ï¼Œå¦‚æœå®ƒåœ¨ç¬¬ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨ä¸­å¹¶ä¸”ä¸åœ¨ç¬¬äºŒä¸ªå¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œåˆ™è®¤ä¸ºè¯¥å…ƒç´ å­˜åœ¨ã€‚è¿™ç§æ–¹æ³•çš„é—®é¢˜æ˜¯è¯¯æŠ¥ç‡ä¼šå¢åŠ ï¼Œå› ä¸ºåˆ é™¤è¿‡æ»¤å™¨ä¸­çš„å…ƒç´ ä¹Ÿå¯èƒ½é”™è¯¯åœ°é˜»æ­¢å¯¹å®é™…å­˜åœ¨äºé›†åˆä¸­çš„å…ƒç´ çš„æ­£ç¡®åˆ¤æ–­ã€‚</p><h3 id="523-d-left-è®¡æ•°å“ˆå¸Œ"><a href="#5-2-3-d-left-è®¡æ•°å“ˆå¸Œ" class="headerlink" title="5.2.3 d-left è®¡æ•°å“ˆå¸Œ"></a>5.2.3 d-left è®¡æ•°å“ˆå¸Œ</h3><p>d-leftè®¡æ•°å“ˆå¸Œæ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå®ƒå°†å…ƒç´ æ˜ å°„åˆ°å›ºå®šæ•°é‡çš„æ¡¶ä¸­ï¼Œå¹¶åœ¨æ¯ä¸ªæ¡¶å†…ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å®ç°å¿«é€Ÿçš„æ’å…¥ã€æŸ¥è¯¢å’Œåˆ é™¤æ“ä½œï¼Œå¹¶ä¸”ç›¸æ¯”äºè®¡æ•°å‹å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå®ƒå¯ä»¥æ›´æœ‰æ•ˆåœ°åˆ©ç”¨ç©ºé—´ã€‚ä¸è¿‡ï¼Œå®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œä¸”å½“æ¡¶å¡«æ»¡æ—¶æ€§èƒ½ä¼šä¸‹é™ã€‚</p><h3 id="524-å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨cuckoo-filter"><a href="#5-2-4-å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼ˆCuckoo-Filterï¼‰" class="headerlink" title="5.2.4 å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼ˆCuckoo Filterï¼‰"></a>5.2.4 å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼ˆCuckoo Filterï¼‰</h3><p>å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨æ˜¯å¦ä¸€ç§æ”¯æŒåˆ é™¤æ“ä½œçš„å¸ƒéš†è¿‡æ»¤å™¨å˜ç§ï¼Œå®ƒåŸºäºå¸ƒè°·é¸Ÿå“ˆå¸Œå’Œéƒ¨åˆ†é”®å­˜å‚¨ã€‚æ¯ä¸ªå…ƒç´ é€šè¿‡å“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä½ç½®ï¼Œå¹¶å­˜å‚¨å…¶â€œæŒ‡çº¹â€ã€‚æ’å…¥ã€æŸ¥è¯¢å’Œåˆ é™¤æ“ä½œéƒ½åŸºäºè¿™äº›æŒ‡çº¹ã€‚å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ç›¸æ¯”è®¡æ•°å‹å¸ƒéš†è¿‡æ»¤å™¨åœ¨ç©ºé—´æ•ˆç‡ä¸Šæœ‰æ‰€æé«˜ï¼Œä¸”æ”¯æŒåˆ é™¤æ“ä½œï¼Œä½†åœ¨æç«¯æƒ…å†µä¸‹å¯èƒ½éœ€è¦é‡å»ºè¿‡æ»¤å™¨ã€‚</p><p>æ€»ä½“ä¸Šå¯ä»¥çœ‹å‡ºå¯åˆ é™¤bloom filter çš„å®ç°éƒ½æ˜¯éœ€è¦é¢å¤–çš„ç©ºé—´å»å­˜å‚¨é¢å¤–çš„ä¿¡æ¯ï¼Œ é‚£ä¹ˆå…¶å®ç°æ–¹å¼çš„å¥½åçš„è¯„åˆ¤æ ‡å‡†å°±æ˜¯ é¢å¤–ç©ºé—´çš„å¤§å°ã€æ€§èƒ½ ä»¥åŠå¯¹è¯¯æŠ¥ç‡çš„å½±å“ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€å¼ è¡¨æ ¼ï¼Œæ€»ç»“äº†å‡ ç§æ”¯æŒåˆ é™¤æ“ä½œçš„å¸ƒéš†è¿‡æ»¤å™¨å˜ä½“çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼š</p><div class="table-container"><table><thead><tr><th>è¿‡æ»¤å™¨ç±»å‹</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>è®¡æ•°å‹å¸ƒéš†è¿‡æ»¤å™¨</td><td>- ç›´æ¥æ”¯æŒåˆ é™¤æ“ä½œ<br>- å®ç°ç›¸å¯¹ç®€å•</td><td>- æ›´å¤šç©ºé—´éœ€æ±‚<br>- è®¡æ•°å™¨æº¢å‡ºé—®é¢˜</td></tr><tr><td>åŒå¸ƒéš†è¿‡æ»¤å™¨</td><td>- å®ç°ç®€å•<br>- é€šè¿‡é¢å¤–å¸ƒéš†è¿‡æ»¤å™¨è·Ÿè¸ªåˆ é™¤æ“ä½œ</td><td>- å¢åŠ ç©ºé—´éœ€æ±‚<br>- è¯¯åˆ¤ç‡å¢åŠ </td></tr><tr><td>å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨</td><td>- é«˜æ•ˆçš„æ’å…¥ã€åˆ é™¤å’ŒæŸ¥è¯¢<br>- ç©ºé—´æ•ˆç‡é«˜</td><td>- å®ç°å¤æ‚<br>- è´Ÿè½½å› å­é«˜æ—¶æ€§èƒ½å¯èƒ½ä¸‹é™</td></tr><tr><td>d-leftè®¡æ•°å“ˆå¸Œè¿‡æ»¤å™¨</td><td>- é«˜ç©ºé—´æ•ˆç‡<br>- æ€§èƒ½ä¼˜äºä¼ ç»Ÿè®¡æ•°å‹å¸ƒéš†è¿‡æ»¤å™¨</td><td>- å®ç°å¤æ‚ï¼Œéœ€è¦ç²¾å¿ƒè®¾è®¡</td></tr></tbody></table></div><ul><li>å¦‚æœåº”ç”¨å¯¹ç©ºé—´æ•ˆç‡è¦æ±‚ä¸æ˜¯ç‰¹åˆ«é«˜ï¼Œä¸”éœ€è¦é¢‘ç¹è¿›è¡Œåˆ é™¤æ“ä½œï¼Œè®¡æ•°å‹å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ä¸ªç®€å•æœ‰æ•ˆçš„é€‰æ‹©ã€‚</li><li>å¯¹äºéœ€è¦æœ€å°åŒ–è¯¯æŠ¥ç‡è€Œä¸”å¯¹ç©ºé—´æœ‰ä¸€å®šè¦æ±‚çš„åº”ç”¨ï¼Œå¸ƒè°·é¸Ÿè¿‡æ»¤å™¨æä¾›äº†ä¸€ä¸ªè¾ƒå¥½çš„å¹³è¡¡ç‚¹ã€‚</li><li>åœ¨éœ€è¦æè‡´ç©ºé—´æ•ˆç‡ä¸”èƒ½å¤Ÿæ¥å—å®ç°å¤æ‚åº¦çš„é«˜æ€§èƒ½åº”ç”¨åœºæ™¯ä¸­ï¼Œd-left è®¡æ•°å“ˆå¸Œè¿‡æ»¤å™¨å¯èƒ½æ˜¯æœ€ä½³é€‰æ‹©ã€‚</li></ul><p>å…³äºç©ºé—´çš„ä½¿ç”¨ï¼Œæœ‰å¦‚ä¸‹æ¯”å¯¹æ•ˆæœ<br><img src="/b4fa673f/spacecompare.png" class></p><p>redis å®ç°äº†cuckoo å˜ä½“bloom filterï¼Œ ä¸‹é¢æ¥è®²ä¸€ä¸‹ cuckoo  filter çš„åŸç†</p><h1 id="6-cuckoo-filter"><a href="#6-Cuckoo-Filter" class="headerlink" title="6. Cuckoo Filter"></a>6. Cuckoo Filter</h1><p><a href="https://www.cs.cmu.edu/~binfan/papers/conext14_cuckoofilter.pdf">Cuckoo Filter è®ºæ–‡</a></p><p>the basic unit of the cuckoo hash tables used for our cuckoo filters is called an entry. Each entry stores one fingerprint. The hash table consists of an array of buckets, where a bucket can have multiple entries.</p><p>åœ¨Cuckoo Filter ä¸­ï¼Œæœ€åŸºæœ¬çš„å­˜å‚¨å•å…ƒæ˜¯entry,  æ¯ä¸ªå•å…ƒå­˜å‚¨ä¸€ä¸ª fingerprintã€‚cuckoo hashing å“ˆå¸Œè¡¨ç”±ä¸€ç»„æ¡¶ï¼ˆbucketsï¼‰ç»„æˆï¼Œæ¯ä¸ªæ¡¶å¯ä»¥åŒ…å«å¤šä¸ªæ¡ç›®ï¼ˆentriesï¼‰ã€‚</p><p>Cuckoo Filterçš„å…³é”®ç‰¹æ€§</p><ol><li><strong>åŒå“ˆå¸Œå‡½æ•°</strong>ï¼šå¯¹äºä»»ä½•ä¸€ä¸ªç»™å®šçš„é”®ï¼ŒCuckoo Hashingä½¿ç”¨ä¸¤ä¸ªç‹¬ç«‹çš„å“ˆå¸Œå‡½æ•° <code>h1</code> å’Œ <code>h2</code> æ¥è®¡ç®—ä¸¤ä¸ªå€™é€‰æ¡¶çš„ä½ç½®ã€‚è¿™ä¸¤ä¸ªä½ç½®æ˜¯é”®å¯èƒ½è¢«å­˜å‚¨çš„åœ°æ–¹ã€‚</li><li><strong>æŒ‡çº¹å­˜å‚¨</strong>ï¼šä¸ä¼ ç»Ÿçš„å“ˆå¸Œè¡¨ä¸åŒï¼ŒCuckoo Hashingä¸å­˜å‚¨å®Œæ•´çš„é”®ï¼Œè€Œæ˜¯å­˜å‚¨é”®çš„æŒ‡çº¹ã€‚è¿™å…è®¸åœ¨ä¸ç‰ºç‰²å¤ªå¤šç©ºé—´æ•ˆç‡çš„æƒ…å†µä¸‹è¿›è¡Œé«˜æ•ˆçš„æŸ¥æ‰¾å’Œåˆ é™¤æ“ä½œã€‚</li><li><strong>åŠ¨æ€æ’å…¥</strong>ï¼šå½“æ’å…¥ä¸€ä¸ªæ–°é”®æ—¶ï¼Œå¦‚æœå€™é€‰æ¡¶ä¸­æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼ŒCuckoo Hashingä¼šé€šè¿‡ä¸€ç³»åˆ—ç½®æ¢æ“ä½œæ¥ä¸ºæ–°é”®è…¾å‡ºç©ºé—´ã€‚è¿™æ¶‰åŠåˆ°å°†ç°æœ‰çš„æŒ‡çº¹ç§»åŠ¨åˆ°å®ƒä»¬çš„æ›¿ä»£ä½ç½®ï¼Œä»è€Œä¸ºæ–°é”®è…¾å‡ºç©ºé—´ã€‚å·²å ç”¨ä½ç½®çš„å…ƒç´ ä¼šè¢«ç§»åŠ¨åˆ°å…¶å®ƒå“ˆå¸Œå‡½æ•°ç¡®å®šçš„ä½ç½®ï¼Œå¯èƒ½å¯¼è‡´ä¸€ä¸ªè¿é”çš„é‡æ–°æ”¾ç½®è¿‡ç¨‹ã€‚è¿™ä¸ªç®—æ³•çš„åå­—æ¥æºäºå¸ƒè°·é¸Ÿï¼Œå› ä¸ºå¸ƒè°·é¸Ÿä¼šå°†è‡ªå·±çš„è›‹æ”¾å…¥å…¶ä»–é¸Ÿç±»çš„å·¢ä¸­ï¼Œè¿«ä½¿å…¶ä»–é¸Ÿç±»çš„è›‹è¢«ç§»ä½æˆ–ä¸¢å¼ƒã€‚</li><li><strong>æŸ¥æ‰¾æ“ä½œ</strong>ï¼šç»™å®šä¸€ä¸ªé”®ï¼ŒCuckoo Hashingé€šè¿‡æ£€æŸ¥ä¸¤ä¸ªå€™é€‰æ¡¶ä¸­çš„æŒ‡çº¹æ¥ç¡®å®šé”®æ˜¯å¦å­˜åœ¨äºè¡¨ä¸­ã€‚å¦‚æœä»»ä¸€æ¡¶ä¸­å­˜åœ¨åŒ¹é…çš„æŒ‡çº¹ï¼Œåˆ™è®¤ä¸ºé”®å­˜åœ¨äºè¡¨ä¸­ã€‚</li><li><strong>åˆ é™¤æ“ä½œ</strong>ï¼šåˆ é™¤æ“ä½œç›¸å¯¹ç®€å•ï¼ŒCuckoo Hashingæ£€æŸ¥ä¸¤ä¸ªå€™é€‰æ¡¶ï¼Œå¦‚æœæ‰¾åˆ°åŒ¹é…çš„æŒ‡çº¹ï¼Œåˆ™ç§»é™¤è¯¥æŒ‡çº¹ã€‚è¿™ç§åˆ é™¤æ–¹æ³•ä¸ä¼šå½±å“å…¶ä»–é”®çš„å­˜å‚¨ä½ç½®ã€‚</li><li><strong>é«˜ç©ºé—´æ•ˆç‡</strong>ï¼šCuckoo Hashingé€šè¿‡å­˜å‚¨æŒ‡çº¹è€Œä¸æ˜¯å®Œæ•´çš„é”®æ¥ä¼˜åŒ–ç©ºé—´ä½¿ç”¨ï¼ŒåŒæ—¶ä¿æŒè¾ƒé«˜çš„è¡¨å ç”¨ç‡ï¼Œä»è€Œå®ç°é«˜ç©ºé—´æ•ˆç‡ã€‚</li></ol><h2 id="61-fingerprint"><a href="#6-1-fingerprint" class="headerlink" title="6.1 fingerprint"></a>6.1 fingerprint</h2><p>â€œfingerprintâ€æ˜¯å­˜å‚¨åœ¨Cuckoo Filterä¸­çš„æ•°æ®ã€‚ï¼Œä¸€ä¸ªå“ˆå¸Œå‡½æ•°å¤„ç†æ•°æ®åå¾—åˆ°çš„å“ˆå¸Œä¸²ã€‚</p><h2 id="62-partial-key-cuckoo-hashing"><a href="#6-2-Partial-Key-Cuckoo-Hashing" class="headerlink" title="6.2 Partial-Key Cuckoo Hashing"></a>6.2 Partial-Key Cuckoo Hashing</h2><p>A cuckoo filter is a compact variant of a cuckoo hash table that stores only fingerprints-a bit string derived from the item using a hash functionã€‚</p><p>åœ¨cuckoo filter ä¸­ï¼Œå“ˆå¸Œè¡¨ä¸­å­˜å‚¨çš„æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼Œç”±åŸå§‹æ•°æ®å˜æˆäº†fingerprintã€‚<br><code>æ³¨æ„è¿™é‡Œçš„ï¼ˆbasic/standardï¼‰ cuckoo hash tablesæŒ‡çš„æ˜¯å­˜å‚¨åŸå§‹æ•°æ®çš„åšæ³•ã€‚</code></p><p>partial-key cuckoo hashing æ˜¯ä¸€ç§ä»…ä½¿ç”¨æŒ‡çº¹ï¼Œè€Œä¸éœ€è¦åŸå§‹æ•°æ®å°±å¯ä»¥åœ¨ç½®æ¢æ“ä½œä¸­æ¥ç¡®å®šå…ƒç´ å­˜å‚¨ä½ç½®çš„å“ˆå¸ŒæŠ€æœ¯ã€‚ç”±äºä»…å­˜å‚¨fingerprint æ¯”å­˜å‚¨åŸå§‹æ•°æ®æ‰€å å†…å­˜ç©ºé—´å°ï¼Œæ‰€ä»¥ Partial-Key Cuckoo Hashingä¸ºä¼˜åŒ–Cuckoo Filterçš„ç©ºé—´æ•ˆç‡å’Œæ“ä½œæ€§èƒ½è€Œè®¾è®¡ã€‚</p><img src="/b4fa673f/PartialKey.png" class><p>å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼ŒPartial-Key Cuckoo Hashingä½¿ç”¨ä¸¤ä¸ªå“ˆå¸Œå‡½æ•° <code>h1</code> å’Œ <code>h2</code> æ¥è®¡ç®—ä¸¤ä¸ªå€™é€‰æ¡¶ä½ç½®ã€‚ç¬¬ä¸€ä¸ªå“ˆå¸Œå‡½æ•° <code>h1</code> ç›´æ¥ä½œç”¨äºå…ƒç´ çš„æŒ‡çº¹ï¼Œè€Œç¬¬äºŒä¸ªå“ˆå¸Œå‡½æ•° <code>h2</code> åˆ™æ˜¯ <code>h1</code> ä¸æŒ‡çº¹çš„å“ˆå¸Œå€¼çš„å¼‚æˆ–ï¼ˆXORï¼‰ç»“æœã€‚<br>è¿™ç§XORçš„å¤„ç†ç»“æœ å¯ä»¥æ ¹æ®å…¶ä¸­ä»»æ„ä¸€ä¸ªå·²çŸ¥çš„å€™é€‰æ¡¶ä½ç½®ï¼ˆiï¼‰è®¡ç®—å‡ºå¦å¤–ä¸€ä¸ªå€™é€‰æ¡¶ä½ç½®ï¼ˆjï¼‰<br>j = i XOR fingerprint</p><h2 id="63-insert"><a href="#6-3-Insert" class="headerlink" title="6.3 Insert"></a>6.3 Insert</h2><img src="/b4fa673f/cuckooinsert.png" class><p><strong>cuckoo å“ˆå¸Œçš„æ’å…¥è¿‡ç¨‹ï¼š</strong></p><ol><li>è®¡ç®—å…ƒç´ çš„æŒ‡çº¹ã€‚</li><li>ç¡®å®šä¸¤ä¸ªå€™é€‰æ¡¶ä½ç½® <code>i1</code> å’Œ <code>i2</code>ã€‚</li><li>å¦‚æœ <code>i1</code> æˆ– <code>i2</code> æœ‰ç©ºé—²æ¡ç›®ï¼Œåˆ™å°†æŒ‡çº¹æ’å…¥åˆ°è¯¥æ¡ç›®ä¸­ã€‚</li><li>å¦‚æœä¸¤ä¸ªæ¡¶éƒ½æ»¡ï¼Œåˆ™é€‰æ‹©ä¸€ä¸ªæ¡¶ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªæ¡ç›®å¹¶å°†å…¶æŒ‡çº¹ä¸æ–°å…ƒç´ çš„æŒ‡çº¹äº¤æ¢ã€‚</li><li>Partial-Key Cuckoo Hashing ï¼Œæ›´æ–°å€™é€‰æ¡¶ä½ç½® <code>i</code> ä¸º <code>i</code> XOR æŒ‡çº¹çš„å“ˆå¸Œå€¼ã€‚</li><li>å¦‚æœæ‰¾åˆ°ç©ºé—²æ¡ç›®ï¼Œåˆ™æ’å…¥æŒ‡çº¹ï¼›å¦åˆ™ç»§ç»­ç½®æ¢è¿‡ç¨‹ï¼Œç›´åˆ°æ‰¾åˆ°ç©ºé—²æ¡ç›®æˆ–è¾¾åˆ°æœ€å¤§ç½®æ¢æ¬¡æ•°ã€‚</li></ol><h2 id="64-lookup"><a href="#6-4-Lookup" class="headerlink" title="6.4 Lookup"></a>6.4 Lookup</h2><img src="/b4fa673f/Lookup.png" class><h2 id="65-delete"><a href="#6-5-Delete" class="headerlink" title="6.5 Delete"></a>6.5 Delete</h2><img src="/b4fa673f/delete.png" class><p>ä¸ºä»€ä¹ˆcuckoo filter å¯ä»¥åˆ é™¤å…ƒç´ ä½†æ˜¯åˆä¸å½±å“å…¶ä»–å…ƒç´ çš„åˆ¤æ–­ï¼Œ å…¶å®å°±æ˜¯æ¯ä¸ªentry åªå­˜å‚¨äº†ä¸€ä¸ªå…ƒç´ çš„ä¿¡æ¯ï¼Œåˆ é™¤åè‡ªç„¶ä¸ä¼šå½±å“å…¶ä»–å…ƒç´ çš„åˆ¤æ–­ã€‚</p><h2 id="66-ç©ºé—´ä¼˜åŒ–"><a href="#6-6-ç©ºé—´ä¼˜åŒ–" class="headerlink" title="6.6 ç©ºé—´ä¼˜åŒ–"></a>6.6 ç©ºé—´ä¼˜åŒ–</h2><p>Cuckoo Filterè¿›è¡Œç©ºé—´ä¼˜åŒ–ï¼ˆSPACE OPTIMIZATIONSï¼‰çš„æ–¹æ³•ä¸»è¦æ¶‰åŠå¯¹å“ˆå¸Œè¡¨å‚æ•°çš„é€‰æ‹©å’Œé…ç½®ï¼Œä»¥åŠå¯¹æ¡¶ï¼ˆbucketsï¼‰çš„ç¼–ç ç­–ç•¥ã€‚ä»¥ä¸‹æ˜¯è®ºæ–‡ä¸­æåˆ°çš„ä¸€äº›å…³é”®çš„ç©ºé—´ä¼˜åŒ–ç­–ç•¥ï¼š</p><ol><li><strong>é€‰æ‹©åˆé€‚çš„æ¡¶å¤§å°ï¼ˆBucket Sizeï¼‰</strong>ï¼š<ul><li>æ¡¶å¤§å°ï¼ˆbï¼‰å¯¹Cuckoo Filterçš„ç©ºé—´æ•ˆç‡æœ‰æ˜¾è‘—å½±å“ã€‚è¾ƒå¤§çš„æ¡¶å¯ä»¥æé«˜å“ˆå¸Œè¡¨çš„å ç”¨ç‡ï¼ˆÎ±ï¼‰ï¼Œä½†åŒæ—¶ä¹Ÿéœ€è¦æ›´é•¿çš„æŒ‡çº¹æ¥ç»´æŒç›¸åŒçš„è¯¯æŠ¥ç‡ã€‚</li><li>è®ºæ–‡ä¸­é€šè¿‡å®éªŒç¡®å®šäº†å¯¹äºä¸åŒçš„ç›®æ ‡è¯¯æŠ¥ç‡ï¼ˆÏµï¼‰ï¼Œæœ€ä¼˜çš„æ¡¶å¤§å°æ˜¯ä¸åŒçš„ã€‚ä¾‹å¦‚ï¼Œå½“è¯¯æŠ¥ç‡å¤§äº0.002æ—¶ï¼Œæ¯ä¸ªæ¡¶æœ‰2ä¸ªæ¡ç›®å¯èƒ½æ¯”4ä¸ªæ¡ç›®æ›´æœ‰æ•ˆï¼›è€Œå½“è¯¯æŠ¥ç‡é™ä½åˆ°0.00001è‡³0.002æ—¶ï¼Œæ¯ä¸ªæ¡¶æœ‰4ä¸ªæ¡ç›®å¯ä»¥æœ€å°åŒ–ç©ºé—´ä½¿ç”¨ã€‚</li></ul></li><li><strong>åŠæ’åºæ¡¶ç¼–ç ï¼ˆSemi-Sorting Bucketsï¼‰</strong>ï¼š<ul><li>å¯¹äºæ¯ä¸ªæ¡¶ä¸­çš„æŒ‡çº¹è¿›è¡Œæ’åºï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªé¢„å…ˆè®¡ç®—å¥½çš„è¡¨æ¥ç¼–ç è¿™äº›æ’åºåçš„æŒ‡çº¹åºåˆ—ã€‚ç”±äºæ¡¶å†…æŒ‡çº¹çš„é¡ºåºä¸å½±å“æŸ¥è¯¢ç»“æœï¼Œè¿™ç§æ–¹æ³•å¯ä»¥é€šè¿‡ç´¢å¼•æ¥èŠ‚çœç©ºé—´ã€‚</li><li>ä¾‹å¦‚ï¼Œå¦‚æœæ¯ä¸ªæ¡¶æœ‰4ä¸ªæŒ‡çº¹ï¼Œæ¯ä¸ªæŒ‡çº¹æ˜¯4æ¯”ç‰¹é•¿ï¼Œé‚£ä¹ˆæœªå‹ç¼©çš„æ¡¶å°†å ç”¨16æ¯”ç‰¹ã€‚é€šè¿‡æ’åºå’Œç¼–ç ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª12æ¯”ç‰¹çš„ç´¢å¼•æ¥ä»£æ›¿åŸæ¥çš„16æ¯”ç‰¹æ¡¶ï¼Œå› ä¸ºå¯ä»¥é¢„å…ˆè®¡ç®—å‡ºæ‰€æœ‰å¯èƒ½çš„æ¡¶å€¼ï¼ˆä¾‹å¦‚ï¼Œ3876ç§ï¼‰ï¼Œå¹¶å°†æ¯ä¸ªæ¡¶è¡¨ç¤ºä¸ºä¸€ä¸ªç´¢å¼•ï¼Œä»è€ŒèŠ‚çœ1æ¯”ç‰¹æ¯ä¸ªæŒ‡çº¹ã€‚</li></ul></li><li><strong>å¹³è¡¡æ¡¶çš„è´Ÿè½½ï¼ˆBalancing Bucket Loadsï¼‰</strong>ï¼š<ul><li>é€šè¿‡åˆç†é…ç½®å“ˆå¸Œå‡½æ•°å’Œæ¡¶å¤§å°ï¼Œå¯ä»¥å‡å°‘å“ˆå¸Œè¡¨ä¸­çš„å†²çªå’Œç©ºæ¡¶ï¼Œä»è€Œæé«˜ç©ºé—´åˆ©ç”¨ç‡ã€‚</li><li>è®ºæ–‡ä¸­æåˆ°ï¼Œé€šè¿‡é€‚å½“çš„é…ç½®ï¼ŒCuckoo Filterå¯ä»¥ä»¥é«˜æ¦‚ç‡è¾¾åˆ°95%çš„è¡¨ç©ºé—´å ç”¨ç‡ã€‚</li></ul></li><li><strong>æŒ‡çº¹é•¿åº¦çš„ä¼˜åŒ–</strong>ï¼š<ul><li>æŒ‡çº¹é•¿åº¦ï¼ˆfï¼‰ä¸æ¡¶å¤§å°å’Œç›®æ ‡è¯¯æŠ¥ç‡æœ‰å…³ã€‚é€šè¿‡è°ƒæ•´æŒ‡çº¹é•¿åº¦ï¼Œå¯ä»¥åœ¨ä¿æŒç›®æ ‡è¯¯æŠ¥ç‡çš„åŒæ—¶ï¼Œä¼˜åŒ–ç©ºé—´ä½¿ç”¨ã€‚</li><li>è®ºæ–‡ä¸­çš„åˆ†æè¡¨æ˜ï¼Œå¯¹äºå®é™…åº”ç”¨ä¸­çš„é›†åˆå¤§å°ï¼Œè¾ƒçŸ­çš„æŒ‡çº¹ï¼ˆä¾‹å¦‚6æ¯”ç‰¹æˆ–æ›´é•¿ï¼‰é€šå¸¸è¶³ä»¥ç¡®ä¿å“ˆå¸Œè¡¨çš„é«˜åˆ©ç”¨ç‡ã€‚</li></ul></li></ol><p>é€šè¿‡è¿™äº›ç©ºé—´ä¼˜åŒ–ç­–ç•¥ï¼ŒCuckoo Filterèƒ½å¤Ÿåœ¨ä¿æŒé«˜æ•ˆåŠ¨æ€æ“ä½œçš„åŒæ—¶ï¼Œå®ç°ç´§å‡‘çš„æ•°æ®å­˜å‚¨ã€‚è¿™äº›ä¼˜åŒ–ä½¿å¾—Cuckoo Filteråœ¨å¾ˆå¤šå®é™…åº”ç”¨ä¸­æ¯”ä¼ ç»Ÿçš„Bloom Filterå’ŒCounting Bloom Filteræ›´åŠ ç©ºé—´é«˜æ•ˆ</p><h2 id="67-redis-cuckoo-filter"><a href="#6-7-Redis-cuckoo-filter" class="headerlink" title="6.7 Redis cuckoo filter"></a>6.7 Redis cuckoo filter</h2><p>redis å®ç°äº† cuckoo filter ï¼ŒåŸºæœ¬å®ç°é€»è¾‘å’Œè®ºæ–‡ä¸­è¡¨ç°ä¸€è‡´ï¼Œæœ‰å…´è¶£å¤§å®¶å¯ä»¥è‡ªå·±å»çœ‹ä¸€ä¸‹</p><h1 id="7-è‡ªå·±å¦‚ä½•å®ç°ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨"><a href="#7-è‡ªå·±å¦‚ä½•å®ç°ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="7. è‡ªå·±å¦‚ä½•å®ç°ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨"></a>7. è‡ªå·±å¦‚ä½•å®ç°ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨</h1><p>åŸºäºä»¥ä¸Šå¯¹3ç§bloom filterçš„åˆ†æï¼Œå¯ä»¥æ€»ç»“å‡ºè‡ªå·±å®ç°bloom filteræ—¶éœ€è¦è€ƒè™‘çš„å› ç´ <br><a href="https://github.com/sysunyan1699/BloomFilterPractice">æœ¬é¡¹ç›®ä»£ç å¯ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹</a></p><h2 id="71-ä½æ•°ç»„çš„å®ç°"><a href="#7-1-ä½æ•°ç»„çš„å®ç°" class="headerlink" title="7.1 ä½æ•°ç»„çš„å®ç°"></a>7.1 ä½æ•°ç»„çš„å®ç°</h2><p>é¦–å…ˆå‚è€ƒBitSetã€‚<br>BitSetç±»æ˜¯Javaæ ‡å‡†åº“ä¸­æä¾›çš„ä¸€ä¸ªç”¨äºå¤„ç†ä½æ•°ç»„çš„ç±»ï¼ŒåŸºæœ¬å¯ä»¥è®¤ä¸ºæ˜¯bitmap åœ¨Java çš„ä¸­çš„å®ç°ï¼Œå…¶åŸç†æ˜¯æ˜¯long[] æ•°ç»„+ ä½æ“ä½œã€‚<br>åœ¨è‡ªå·±å®ç°å¸ƒéš†è¿‡æ»¤å™¨æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨BitSet ï¼Œ ä¹Ÿå¯ä»¥åƒguava cache ä¸€æ ·ï¼Œè‡ªå·±ç”¨long[] + ä½æ“ä½œè‡ªå·±å°è£…ä¸€ä¸ªbitarrayï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨çš„BitSetã€‚</p><h2 id="72-ä½æ•°ç»„çš„å¤§å°"><a href="#7-2-ä½æ•°ç»„çš„å¤§å°" class="headerlink" title="7.2 ä½æ•°ç»„çš„å¤§å°"></a>7.2 ä½æ•°ç»„çš„å¤§å°</h2><p>åœ¨ç®€å•çš„è‡ªå·±å®ç°çš„ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šbitarray å¤§å°ã€‚</p><p>ä½†åœ¨å®é™…çº¿ä¸Šç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨çš„bloom filter å®ç°ï¼Œä¸€èˆ¬éƒ½æ˜¯æ ¹æ®é¢„æœŸæ’å…¥çš„æ•°æ®é‡ å’Œ å¯æ¥å—çš„è¯¯æŠ¥ç‡ä¸¤ä¸ªæ•°å­—é€šè¿‡ ä¸€ä¸ªæ•°å­¦å…¬å¼ç®—å‡ºçš„ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨é¢„æœŸæ’å…¥çš„æ•°æ®é‡ã€‚</p><p>åŒæ—¶æˆ‘ä»¬åœ¨çº¿ä¸Šç”Ÿäº§ç¯å¢ƒä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ—¶ï¼Œæ ¹æ®ä¸šåŠ¡ç‰¹æ€§å’Œæµé‡å»ä¼°ç®—é¢„æœŸæ’å…¥çš„æ•°æ®é‡ å’Œè¡¡é‡  å¯æ¥å—çš„è¯¯æŠ¥ç‡ ä¹Ÿæ˜¯éå¸¸é‡è¦çš„æ­¥éª¤ã€‚ å¦‚æœä¼°ç®—æ•°æ®é‡æ¯”å®é™…å€¼å¤§å¾ˆå¤šï¼Œå°±ä¼šæµªè´¹å†…å­˜ç©ºé—´ã€‚å¦‚æœä¼°ç®—æ•°æ®é‡æ¯”å®é™…å€¼å°å¾ˆå¤šï¼Œé‚£ä¹ˆè¯¯æŠ¥ç‡å¾ˆå¯èƒ½å°±æ— æ³•æ§åˆ¶åœ¨å¯æ¥å—çš„èŒƒå›´å†…ã€‚</p><ol><li>guava cache bloom filter ä½æ•°ç»„å¤§å°ä¸€æ—¦ç¡®å®šæ—¶æ— æ³•ä¿®æ”¹çš„ï¼Œæ‰€ä»¥å®é™…æ•°æ®é‡å¦‚æœè¿‡å¤§ï¼Œé‚£ä¹ˆè¯¯æŠ¥ç‡è‚¯å®šä¼šä¸Šå‡</li><li>redis bloom filter ä½æ•°ç»„å¤§å°å¯ä»¥scale, ä½†æ˜¯åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨çš„è¿™ä¸ªæ­¥éª¤æ€§èƒ½ä¼šå—åˆ°å½±å“</li></ol><h2 id="73-ç”¨å“ªä¸ªå“ˆå¸Œå‡½æ•°"><a href="#7-3-ç”¨å“ªä¸ªå“ˆå¸Œå‡½æ•°" class="headerlink" title="7.3 ç”¨å“ªä¸ªå“ˆå¸Œå‡½æ•°"></a>7.3 ç”¨å“ªä¸ªå“ˆå¸Œå‡½æ•°</h2><p>è¿™ä¸ªå“ˆå¸Œå‡½æ•°åœ¨å¯†ç å­¦ä¸­å«åšå•å‘æ•£åˆ—å‡½æ•°ã€‚å•å‘æ•£åˆ—å‡½æ•°æœ‰ä¸¤ç±»<br>åŠ å¯†ä¸éåŠ å¯†æ•£åˆ—ï¼Œå…¶ä¸»è¦åŒºåˆ«å¦‚ä¸‹ã€‚</p><h3 id="731-åŠ å¯†æ•£åˆ—å‡½æ•°"><a href="#7-3-1-åŠ å¯†æ•£åˆ—å‡½æ•°" class="headerlink" title="7.3.1 åŠ å¯†æ•£åˆ—å‡½æ•°"></a>7.3.1 åŠ å¯†æ•£åˆ—å‡½æ•°</h3><p>è®¾è®¡ç”¨äºåŠ å¯†åº”ç”¨ï¼Œå¼ºè°ƒå®‰å…¨æ€§ã€‚å®ƒä»¬éœ€è¦å…·å¤‡ä¸€å®šçš„æ€§è´¨ï¼Œå¦‚æŠ—ç¢°æ’ï¼ˆä¸¤ä¸ªä¸åŒçš„è¾“å…¥ä¸åº”è¯¥äº§ç”ŸåŒä¸€ä¸ªè¾“å‡ºï¼‰ã€éšè—æ€§ï¼ˆæ— æ³•ä»è¾“å‡ºæ¨æ–­ä»»ä½•ä¿¡æ¯å…³äºè¾“å…¥ï¼‰å’ŒæŠ—ç¯¡æ”¹ï¼ˆå¯¹è¾“å…¥çš„å¾®å°å˜åŒ–ä¼šåœ¨è¾“å‡ºä¸­äº§ç”Ÿä¸<br>å¯é¢„æµ‹çš„ã€å¤§çš„å˜åŒ–ï¼‰ã€‚</p><ul><li><strong>SHAå®¶æ—ï¼ˆSHA-1ã€SHA-256ã€SHA-512ç­‰ï¼‰</strong>ï¼šå®‰å…¨å“ˆå¸Œç®—æ³•ï¼ˆSecure Hash Algorithmï¼‰å®¶æ—ï¼Œå¹¿æ³›ç”¨äºåŠ å¯†ã€æ•°æ®å®Œæ•´æ€§æ ¡éªŒå’Œæ•°å­—ç­¾åç­‰å®‰å…¨ç›¸å…³çš„åº”ç”¨ã€‚</li><li><strong>MD5</strong>ï¼šæ¶ˆæ¯æ‘˜è¦ç®—æ³•5ï¼ˆMessage Digest Algorithm 5ï¼‰ï¼Œå°½ç®¡å› ä¸ºå®‰å…¨æ€§é—®é¢˜ä¸å†æ¨èç”¨äºåŠ å¯†å®‰å…¨é¢†åŸŸï¼Œä½†åœ¨ä¸€äº›éå®‰å…¨æ€§è¦æ±‚çš„åœºåˆä»ç„¶å¯ä»¥è§åˆ°å…¶èº«å½±ã€‚</li><li><strong>RIPEMD</strong>ï¼šä¸€ç³»åˆ—çš„åŠ å¯†å“ˆå¸Œå‡½æ•°ï¼ŒåŒ…æ‹¬RIPEMD-160ã€RIPEMD-256å’ŒRIPEMD-320ï¼Œå…¶ä¸­RIPEMD-160è®¾è®¡ç”¨äºæ›¿ä»£MD5å’ŒSHA-1ã€‚<br>-<h3 id="732-éåŠ å¯†æ•£åˆ—å‡½æ•°"><a href="#7-3-2-éåŠ å¯†æ•£åˆ—å‡½æ•°" class="headerlink" title="7.3.2 éåŠ å¯†æ•£åˆ—å‡½æ•°"></a>7.3.2 éåŠ å¯†æ•£åˆ—å‡½æ•°</h3>è®¾è®¡é‡ç‚¹æ˜¯é«˜æ•ˆç‡å’Œå‡åŒ€åˆ†å¸ƒçš„è¾“å‡ºï¼Œä»¥æ”¯æŒå¿«é€Ÿæ•°æ®æ£€ç´¢ã€æ•°æ®åˆ†å¸ƒå¹³è¡¡ç­‰ï¼Œè€Œä¸æ˜¯å®‰å…¨æ€§ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå…è®¸å­˜åœ¨ç¢°æ’ï¼Œä½†ç¢°æ’çš„æ¦‚ç‡è¦å°½å¯èƒ½ä½ã€‚</li></ul><p>å¸¸è§çš„éåŠ å¯†å•å‘æ•£åˆ—å‡½æ•°ï¼š</p><ol><li><strong>MurmurHash</strong>ï¼šç”±Austin Applebyè®¾è®¡ï¼Œå› å…¶é«˜æ€§èƒ½å’Œè‰¯å¥½çš„åˆ†å¸ƒç‰¹æ€§è€Œå¹¿æ³›åº”ç”¨ã€‚MurmurHashæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œå¦‚MurmurHash2ã€MurmurHash3ç­‰ã€‚</li><li><strong>CityHash</strong>ï¼šç”±Googleå¼€å‘ï¼Œä¸“ä¸ºå“ˆå¸Œå­—ç¬¦ä¸²æ•°æ®è®¾è®¡ï¼Œé€‚ç”¨äºæ„å»ºå“ˆå¸Œè¡¨ç­‰æ•°æ®ç»“æ„ã€‚åç»­Googleåˆæ¨å‡ºäº†FarmHashï¼Œä½œä¸ºCityHashçš„æ”¹è¿›ç‰ˆï¼Œæä¾›æ›´å¥½çš„æ€§èƒ½å’Œæ›´å¹¿çš„é€‚ç”¨èŒƒå›´ã€‚</li><li><strong>xxHash</strong>ï¼šæ˜¯ä¸€ç§éå¸¸å¿«çš„å“ˆå¸Œç®—æ³•ï¼Œæä¾›äº†æé«˜çš„æ•°æ®å¤„ç†é€Ÿåº¦ï¼ŒåŒæ—¶ä¿æŒäº†è‰¯å¥½çš„æ•£åˆ—åˆ†å¸ƒç‰¹æ€§ï¼Œé€‚ç”¨äºéœ€è¦å¿«é€Ÿæ•£åˆ—å¤§é‡æ•°æ®çš„åœºæ™¯ã€‚</li><li><strong>Jenkinså“ˆå¸Œå‡½æ•°ï¼ˆå¦‚ä¸€è‡´æ€§å“ˆå¸Œï¼‰</strong>ï¼šBob Jenkinsæ‰€è®¾è®¡çš„ä¸€ç³»åˆ—å“ˆå¸Œå‡½æ•°ï¼ŒåŒ…æ‹¬lookup3ã€SpookyHashç­‰ï¼Œå®ƒä»¬å¹¿æ³›ç”¨äºè½¯ä»¶å¼€å‘ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦å¿«é€Ÿä¸”åˆ†å¸ƒå‡åŒ€çš„å“ˆå¸Œç®—æ³•çš„åœºåˆã€‚</li><li><strong>FNVï¼ˆFowler-Noll-Voï¼‰</strong>ï¼šæ˜¯ä¸€ç³»åˆ—è®¾è®¡ç®€å•ã€æ€§èƒ½è‰¯å¥½çš„å“ˆå¸Œå‡½æ•°ï¼Œç‰¹åˆ«é€‚åˆäºæ•£åˆ—å•ä¸ªæ–‡æœ¬å­—ç¬¦ä¸²ã€‚FNV-1å’ŒFNV-1aæ˜¯ä¸¤ä¸ªæœ€è‘—åçš„å˜ç§ã€‚</li></ol><p>åœ¨ä»¥ä¸Šåˆ†æåŸç†åˆ†æä¸­ï¼Œguava cacheå’ŒRedis  éƒ½æ˜¯ç”¨äº†MurmurHash<br>å¦‚æœæˆ‘ä»¬è‡ªå·±ä¹Ÿæƒ³è¦ç”¨MurmurHashï¼Œç›®å‰Javaå¹¶æ²¡æœ‰æä¾›å®ç°ï¼Œå¯ä»¥å¼•å…¥guava cache åŒ…ä½¿ç”¨MurmurHashã€‚</p><h2 id="74-ç”¨å¤šå°‘ä¸ªå“ˆå¸Œå‡½æ•°"><a href="#7-4-ç”¨å¤šå°‘ä¸ªå“ˆå¸Œå‡½æ•°" class="headerlink" title="7.4 ç”¨å¤šå°‘ä¸ªå“ˆå¸Œå‡½æ•°"></a>7.4 ç”¨å¤šå°‘ä¸ªå“ˆå¸Œå‡½æ•°</h2><p>å‰é¢è¯´è¿‡ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°å¯ä»¥å‡å°‘è¯¯æŠ¥ç‡ï¼Œé‚£ä¹ˆåˆ°åº•è¦ç”¨å¤šå°‘ä¸ªå“ˆå¸Œå‡½æ•°å‘¢ï¼Œ è¿™ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡ é¢„æœŸæ’å…¥çš„æ•°æ®é‡+ å¯æ¥å—çš„è¯¯æŠ¥ç‡ é€šè¿‡å›ºå®šçš„æ•°å­¦å…¬å¼è®¡ç®—å¾—å‡ºã€‚<br>åŒæ—¶å¤šä¸ªå“ˆå¸Œç»“æœå¯ä»¥é€šè¿‡åƒGuava cacheä¸€æ ·ï¼Œç”¨åŒå“ˆå¸ŒæŠ€æœ¯æ¨¡æ‹Ÿå¾—åˆ°ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šç”¨åˆ°bloom-filter&quot;&gt;&lt;a href=&quot;#0-ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šç”¨åˆ°bloom-filter&quot; class=&quot;headerlink&quot; title=&quot;0.ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šç”¨åˆ°bloom filter&quot;&gt;&lt;/a&gt;0.ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šç”¨åˆ°bloom filte</summary>
      
    
    
    
    
    <category term="Programming" scheme="http://example.com/tags/Programming/"/>
    
  </entry>
  
</feed>
